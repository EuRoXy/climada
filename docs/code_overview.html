<body>
<H1><FONT COLOR="FF0000">Overview of climada routines</FONT></FONT></H1>
<P>
Use <i>Find in page</i> ... from the Edit Menu to search for any text in all help-files.<P>
Use the <i>which</i> command in MATLAB to locate the specific function.<P>
This page has been automatically created by <i>compile_all_function_headers</i>.<P>
Please consult <A HREF="climada_manual.pdf">climada_manual.pdf</A> for more information.<P>
<P>
<P><STRONG>Last modified: </STRONG>04-Aug-2017 13:48:44<P>

<HR>

<A NAME="ROUTINELIST">
<UL>

<P><STRONG>/code:</STRONG><LI><A HREF="#climada">climada</A>
<LI><A HREF="#climada_EDS_calc">climada_EDS_calc</A>
<LI><A HREF="#climada_adaptation_bar_chart">climada_adaptation_bar_chart</A>
<LI><A HREF="#climada_adaptation_cost_curve">climada_adaptation_cost_curve</A>
<LI><A HREF="#climada_adaptation_event_view">climada_adaptation_event_view</A>
<LI><A HREF="#climada_demo">climada_demo</A>
<LI><A HREF="#climada_demo_gui">climada_demo_gui</A>
<LI><A HREF="#climada_demo_step_by_step">climada_demo_step_by_step</A>
<LI><A HREF="#climada_entity_country">climada_entity_country</A>
<LI><A HREF="#climada_entity_load">climada_entity_load</A>
<LI><A HREF="#climada_entity_plot">climada_entity_plot</A>
<LI><A HREF="#climada_entity_read">climada_entity_read</A>
<LI><A HREF="#climada_hazard_load">climada_hazard_load</A>
<LI><A HREF="#climada_init_vars">climada_init_vars</A>
<LI><A HREF="#climada_measures_impact">climada_measures_impact</A>
<LI><A HREF="#climada_measures_impact_parametric">climada_measures_impact_parametric</A>
<LI><A HREF="#climada_tc_guess">climada_tc_guess</A>
<LI><A HREF="#climada_tc_hazard_set">climada_tc_hazard_set</A>
<LI><A HREF="#climada_tc_hazard_set_exercise">climada_tc_hazard_set_exercise</A>
<LI><A HREF="#climada_tc_random_walk">climada_tc_random_walk</A>
<LI><A HREF="#climada_tc_read_unisys_database">climada_tc_read_unisys_database</A>
<LI><A HREF="#climada_tc_windfield">climada_tc_windfield</A>
<LI><A HREF="#climada_tc_windfield_exercise">climada_tc_windfield_exercise</A>
<LI><A HREF="#climada_viewer">climada_viewer</A>
<LI><A HREF="#climada_waterfall_graph">climada_waterfall_graph</A>
<LI><A HREF="#git_pull">git_pull</A>

<P><STRONG>/code/data_import:</STRONG><LI><A HREF="#RivDIS_read">RivDIS_read</A>
<LI><A HREF="#chirps_read">chirps_read</A>
<LI><A HREF="#climada_tif_read">climada_tif_read</A>
<LI><A HREF="#loadods">loadods</A>
<LI><A HREF="#trmm_get">trmm_get</A>
<LI><A HREF="#trmm_read">trmm_read</A>

<P><STRONG>/code/helper_functions:</STRONG><LI><A HREF="#cbfreeze">cbfreeze</A>
<LI><A HREF="#cbhandle">cbhandle</A>
<LI><A HREF="#climada_DFC_compare">climada_DFC_compare</A>
<LI><A HREF="#climada_DFC_read">climada_DFC_read</A>
<LI><A HREF="#climada_EDS2DFC">climada_EDS2DFC</A>
<LI><A HREF="#climada_EDS2YDS">climada_EDS2YDS</A>
<LI><A HREF="#climada_EDS_DFC">climada_EDS_DFC</A>
<LI><A HREF="#climada_EDS_DFC_hist">climada_EDS_DFC_hist</A>
<LI><A HREF="#climada_EDS_DFC_match">climada_EDS_DFC_match</A>
<LI><A HREF="#climada_EDS_DFC_report">climada_EDS_DFC_report</A>
<LI><A HREF="#climada_EDS_ED_at_centroid_report">climada_EDS_ED_at_centroid_report</A>
<LI><A HREF="#climada_EDS_ED_at_centroid_report_xls">climada_EDS_ED_at_centroid_report_xls</A>
<LI><A HREF="#climada_EDS_ED_per_category_report">climada_EDS_ED_per_category_report</A>
<LI><A HREF="#climada_EDS_combine">climada_EDS_combine</A>
<LI><A HREF="#climada_EDS_load">climada_EDS_load</A>
<LI><A HREF="#climada_EDS_save">climada_EDS_save</A>
<LI><A HREF="#climada_EDS_stats">climada_EDS_stats</A>
<LI><A HREF="#climada_ED_plot">climada_ED_plot</A>
<LI><A HREF="#climada_IFC_plot">climada_IFC_plot</A>
<LI><A HREF="#climada_NPV">climada_NPV</A>
<LI><A HREF="#climada_admin0_fix">climada_admin0_fix</A>
<LI><A HREF="#climada_admin1_get_shapes">climada_admin1_get_shapes</A>
<LI><A HREF="#climada_admin1_select_on_map">climada_admin1_select_on_map</A>
<LI><A HREF="#climada_arrow">climada_arrow</A>
<LI><A HREF="#climada_asci2hazard">climada_asci2hazard</A>
<LI><A HREF="#climada_ascii_read">climada_ascii_read</A>
<LI><A HREF="#climada_assets_category_ID">climada_assets_category_ID</A>
<LI><A HREF="#climada_assets_complete">climada_assets_complete</A>
<LI><A HREF="#climada_assets_encode">climada_assets_encode</A>
<LI><A HREF="#climada_assets_encode_check">climada_assets_encode_check</A>
<LI><A HREF="#climada_assets_read">climada_assets_read</A>
<LI><A HREF="#climada_assets_select">climada_assets_select</A>
<LI><A HREF="#climada_calibrate">climada_calibrate</A>
<LI><A HREF="#climada_centroids_cleanup">climada_centroids_cleanup</A>
<LI><A HREF="#climada_centroids_load">climada_centroids_load</A>
<LI><A HREF="#climada_centroids_plot">climada_centroids_plot</A>
<LI><A HREF="#climada_centroids_read">climada_centroids_read</A>
<LI><A HREF="#climada_check_matfile">climada_check_matfile</A>
<LI><A HREF="#climada_circle_plot">climada_circle_plot</A>
<LI><A HREF="#climada_code_copy">climada_code_copy</A>
<LI><A HREF="#climada_code_optimizer">climada_code_optimizer</A>
<LI><A HREF="#climada_code_update">climada_code_update</A>
<LI><A HREF="#climada_collect_measures_impact">climada_collect_measures_impact</A>
<LI><A HREF="#climada_color_plot">climada_color_plot</A>
<LI><A HREF="#climada_colormap">climada_colormap</A>
<LI><A HREF="#climada_concatenate_lon_lat">climada_concatenate_lon_lat</A>
<LI><A HREF="#climada_country_name">climada_country_name</A>
<LI><A HREF="#climada_csvread">climada_csvread</A>
<LI><A HREF="#climada_damage_exceedence">climada_damage_exceedence</A>
<LI><A HREF="#climada_damagefunctions_check">climada_damagefunctions_check</A>
<LI><A HREF="#climada_damagefunctions_complete">climada_damagefunctions_complete</A>
<LI><A HREF="#climada_damagefunctions_generate">climada_damagefunctions_generate</A>
<LI><A HREF="#climada_damagefunctions_map">climada_damagefunctions_map</A>
<LI><A HREF="#climada_damagefunctions_plot">climada_damagefunctions_plot</A>
<LI><A HREF="#climada_damagefunctions_read">climada_damagefunctions_read</A>
<LI><A HREF="#climada_damagefunctions_replace">climada_damagefunctions_replace</A>
<LI><A HREF="#climada_data_check">climada_data_check</A>
<LI><A HREF="#climada_dateline_resolve">climada_dateline_resolve</A>
<LI><A HREF="#climada_demo_adapt_cost_curve">climada_demo_adapt_cost_curve</A>
<LI><A HREF="#climada_demo_parameter_table">climada_demo_parameter_table</A>
<LI><A HREF="#climada_demo_parameter_table_full">climada_demo_parameter_table_full</A>
<LI><A HREF="#climada_demo_waterfall_graph">climada_demo_waterfall_graph</A>
<LI><A HREF="#climada_digit_set">climada_digit_set</A>
<LI><A HREF="#climada_discount_read">climada_discount_read</A>
<LI><A HREF="#climada_distance2coast_km">climada_distance2coast_km</A>
<LI><A HREF="#climada_distance_km">climada_distance_km</A>
<LI><A HREF="#climada_distribution_lon_lat">climada_distribution_lon_lat</A>
<LI><A HREF="#climada_distribution_v0_vi">climada_distribution_v0_vi</A>
<LI><A HREF="#climada_ellipse">climada_ellipse</A>
<LI><A HREF="#climada_entity_check">climada_entity_check</A>
<LI><A HREF="#climada_entity_combine">climada_entity_combine</A>
<LI><A HREF="#climada_entity_save">climada_entity_save</A>
<LI><A HREF="#climada_entity_value_GDP_adjust">climada_entity_value_GDP_adjust</A>
<LI><A HREF="#climada_entity_value_GDP_adjust_one">climada_entity_value_GDP_adjust_one</A>
<LI><A HREF="#climada_event_damage_animation">climada_event_damage_animation</A>
<LI><A HREF="#climada_event_damage_data_tc">climada_event_damage_data_tc</A>
<LI><A HREF="#climada_excel_hazard_set">climada_excel_hazard_set</A>
<LI><A HREF="#climada_figure_axis_limits_equal_for_lat_lon">climada_figure_axis_limits_equal_for_lat_lon</A>
<LI><A HREF="#climada_figure_scale_add">climada_figure_scale_add</A>
<LI><A HREF="#climada_figuresize">climada_figuresize</A>
<LI><A HREF="#climada_find_most_severe_event">climada_find_most_severe_event</A>
<LI><A HREF="#climada_geo_distance">climada_geo_distance</A>
<LI><A HREF="#climada_git_clone">climada_git_clone</A>
<LI><A HREF="#climada_git_pull">climada_git_pull</A>
<LI><A HREF="#climada_git_pull_repositories">climada_git_pull_repositories</A>
<LI><A HREF="#climada_gridded_VALUE">climada_gridded_VALUE</A>
<LI><A HREF="#climada_hazard2IFC">climada_hazard2IFC</A>
<LI><A HREF="#climada_hazard2ge">climada_hazard2ge</A>
<LI><A HREF="#climada_hazard2octave">climada_hazard2octave</A>
<LI><A HREF="#climada_hazard_check">climada_hazard_check</A>
<LI><A HREF="#climada_hazard_cleanup">climada_hazard_cleanup</A>
<LI><A HREF="#climada_hazard_clim_scen">climada_hazard_clim_scen</A>
<LI><A HREF="#climada_hazard_plot">climada_hazard_plot</A>
<LI><A HREF="#climada_hazard_plot_hr">climada_hazard_plot_hr</A>
<LI><A HREF="#climada_hazard_stats">climada_hazard_stats</A>
<LI><A HREF="#climada_hazard_stats_figure">climada_hazard_stats_figure</A>
<LI><A HREF="#climada_hazards">climada_hazards</A>
<LI><A HREF="#climada_init_folders">climada_init_folders</A>
<LI><A HREF="#climada_inpolygon">climada_inpolygon</A>
<LI><A HREF="#climada_interp1">climada_interp1</A>
<LI><A HREF="#climada_load">climada_load</A>
<LI><A HREF="#climada_location_sum">climada_location_sum</A>
<LI><A HREF="#climada_longitude_unify">climada_longitude_unify</A>
<LI><A HREF="#climada_lonlat_cleanup">climada_lonlat_cleanup</A>
<LI><A HREF="#climada_map_plot">climada_map_plot</A>
<LI><A HREF="#climada_measure_regional_scope">climada_measure_regional_scope</A>
<LI><A HREF="#climada_measures_assets_change">climada_measures_assets_change</A>
<LI><A HREF="#climada_measures_attach_measures">climada_measures_attach_measures</A>
<LI><A HREF="#climada_measures_check">climada_measures_check</A>
<LI><A HREF="#climada_measures_complete">climada_measures_complete</A>
<LI><A HREF="#climada_measures_encode">climada_measures_encode</A>
<LI><A HREF="#climada_measures_impact2EDS_waterfall">climada_measures_impact2EDS_waterfall</A>
<LI><A HREF="#climada_measures_impact_attach_measures_impact">climada_measures_impact_attach_measures_impact</A>
<LI><A HREF="#climada_measures_impact_combine">climada_measures_impact_combine</A>
<LI><A HREF="#climada_measures_impact_combine_scenario">climada_measures_impact_combine_scenario</A>
<LI><A HREF="#climada_measures_impact_discount">climada_measures_impact_discount</A>
<LI><A HREF="#climada_measures_impact_load">climada_measures_impact_load</A>
<LI><A HREF="#climada_measures_impact_read">climada_measures_impact_read</A>
<LI><A HREF="#climada_measures_impact_report">climada_measures_impact_report</A>
<LI><A HREF="#climada_measures_read">climada_measures_read</A>
<LI><A HREF="#climada_names_read">climada_names_read</A>
<LI><A HREF="#climada_nightlight_entity">climada_nightlight_entity</A>
<LI><A HREF="#climada_nonspheric_distance_m">climada_nonspheric_distance_m</A>
<LI><A HREF="#climada_octave">climada_octave</A>
<LI><A HREF="#climada_odsread">climada_odsread</A>
<LI><A HREF="#climada_plot_ACE">climada_plot_ACE</A>
<LI><A HREF="#climada_plot_IFC_return">climada_plot_IFC_return</A>
<LI><A HREF="#climada_plot_probabilistic_wind_speed_map">climada_plot_probabilistic_wind_speed_map</A>
<LI><A HREF="#climada_plot_tc_track_season">climada_plot_tc_track_season</A>
<LI><A HREF="#climada_plot_tc_track_stormcategory">climada_plot_tc_track_stormcategory</A>
<LI><A HREF="#climada_plot_world_borders">climada_plot_world_borders</A>
<LI><A HREF="#climada_processed2assets">climada_processed2assets</A>
<LI><A HREF="#climada_progress2stdout">climada_progress2stdout</A>
<LI><A HREF="#climada_scenario_name">climada_scenario_name</A>
<LI><A HREF="#climada_scenario_waterfall_identify">climada_scenario_waterfall_identify</A>
<LI><A HREF="#climada_shape_selector">climada_shape_selector</A>
<LI><A HREF="#climada_shapeplotter">climada_shapeplotter</A>
<LI><A HREF="#climada_shaperead">climada_shaperead</A>
<LI><A HREF="#climada_sparse_interp">climada_sparse_interp</A>
<LI><A HREF="#climada_spreadsheet_read">climada_spreadsheet_read</A>
<LI><A HREF="#climada_subarray">climada_subarray</A>
<LI><A HREF="#climada_tc_add_timestep">climada_tc_add_timestep</A>
<LI><A HREF="#climada_tc_equal_timestep">climada_tc_equal_timestep</A>
<LI><A HREF="#climada_tc_event_damage_ens">climada_tc_event_damage_ens</A>
<LI><A HREF="#climada_tc_event_damage_ens_gui">climada_tc_event_damage_ens_gui</A>
<LI><A HREF="#climada_tc_get_unisys_databases">climada_tc_get_unisys_databases</A>
<LI><A HREF="#climada_tc_hazard_clim_scen">climada_tc_hazard_clim_scen</A>
<LI><A HREF="#climada_tc_hurdat_read">climada_tc_hurdat_read</A>
<LI><A HREF="#climada_tc_interp">climada_tc_interp</A>
<LI><A HREF="#climada_tc_jtwc_fetch">climada_tc_jtwc_fetch</A>
<LI><A HREF="#climada_tc_overview_table">climada_tc_overview_table</A>
<LI><A HREF="#climada_tc_random_walk_position_windspeed">climada_tc_random_walk_position_windspeed</A>
<LI><A HREF="#climada_tc_read_unisys_track">climada_tc_read_unisys_track</A>
<LI><A HREF="#climada_tc_season">climada_tc_season</A>
<LI><A HREF="#climada_tc_stormcategory">climada_tc_stormcategory</A>
<LI><A HREF="#climada_tc_track_info">climada_tc_track_info</A>
<LI><A HREF="#climada_tc_track_load">climada_tc_track_load</A>
<LI><A HREF="#climada_tc_track_nodes">climada_tc_track_nodes</A>
<LI><A HREF="#climada_tc_track_quality_check">climada_tc_track_quality_check</A>
<LI><A HREF="#climada_tc_windfield_nodes">climada_tc_windfield_nodes</A>
<LI><A HREF="#climada_template">climada_template</A>
<LI><A HREF="#climada_tif2assets">climada_tif2assets</A>
<LI><A HREF="#climada_waterfall_graph_advanced">climada_waterfall_graph_advanced</A>
<LI><A HREF="#climada_waterfall_graph_animation">climada_waterfall_graph_animation</A>
<LI><A HREF="#climada_workshop_step_by_step">climada_workshop_step_by_step</A>
<LI><A HREF="#climada_xlsread">climada_xlsread</A>
<LI><A HREF="#compile_all_function_headers">compile_all_function_headers</A>
<LI><A HREF="#cprintf">cprintf</A>
<LI><A HREF="#freezeColors">freezeColors</A>
<LI><A HREF="#gauss_distribution">gauss_distribution</A>
<LI><A HREF="#git">git</A>
<LI><A HREF="#hist2d">hist2d</A>
<LI><A HREF="#isassets">isassets</A>
<LI><A HREF="#iscentroids">iscentroids</A>
<LI><A HREF="#isdamagefunctions">isdamagefunctions</A>
<LI><A HREF="#isentity">isentity</A>
<LI><A HREF="#ishazard">ishazard</A>
<LI><A HREF="#makeColorMap">makeColorMap</A>
<LI><A HREF="#mygaussfit">mygaussfit</A>
<LI><A HREF="#nanmax">nanmax</A>
<LI><A HREF="#nanmean">nanmean</A>
<LI><A HREF="#parseArgs">parseArgs</A>
<LI><A HREF="#plot_normal">plot_normal</A>
<LI><A HREF="#plotclr">plotclr</A>
<LI><A HREF="#subaxis">subaxis</A>
<LI><A HREF="#waitbar_toggle">waitbar_toggle</A>

<P><STRONG>_modules/CAM/code:</STRONG><LI><A HREF="#cam_USA_hazard_check">cam_USA_hazard_check</A>
<LI><A HREF="#cam_batch">cam_batch</A>
<LI><A HREF="#cam_batch2">cam_batch2</A>
<LI><A HREF="#cam_batch_multi">cam_batch_multi</A>
<LI><A HREF="#cam_calibrate">cam_calibrate</A>
<LI><A HREF="#cam_entity_value_GDP_SSP">cam_entity_value_GDP_SSP</A>
<LI><A HREF="#cam_entity_value_GDP_SSP_one">cam_entity_value_GDP_SSP_one</A>
<LI><A HREF="#climada_tc_analyze_cam">climada_tc_analyze_cam</A>
<LI><A HREF="#climada_tc_analyze_cam_all">climada_tc_analyze_cam_all</A>
<LI><A HREF="#climada_tc_filter_basin">climada_tc_filter_basin</A>
<LI><A HREF="#climada_tc_read_cam_IBTrAC_V01">climada_tc_read_cam_IBTrAC_V01</A>
<LI><A HREF="#climada_tc_read_cam_database">climada_tc_read_cam_database</A>
<LI><A HREF="#climada_tc_read_cam_database_V01">climada_tc_read_cam_database_V01</A>
<LI><A HREF="#climada_tc_read_cam_database_V02">climada_tc_read_cam_database_V02</A>
<LI><A HREF="#climada_tc_read_cam_ibtrac_v02">climada_tc_read_cam_ibtrac_v02</A>
<LI><A HREF="#selected_countries_CAM">selected_countries_CAM</A>

<P><STRONG>_modules/advanced/code:</STRONG><LI><A HREF="#climada_assets_crop">climada_assets_crop</A>
<LI><A HREF="#climada_centroids_elevation_add">climada_centroids_elevation_add</A>
<LI><A HREF="#climada_centroids_generate">climada_centroids_generate</A>
<LI><A HREF="#climada_circle_create">climada_circle_create</A>
<LI><A HREF="#climada_entity_crop">climada_entity_crop</A>
<LI><A HREF="#climada_entity_plot_all">climada_entity_plot_all</A>
<LI><A HREF="#climada_exceedence_freq2freq">climada_exceedence_freq2freq</A>
<LI><A HREF="#climada_hazard2xls">climada_hazard2xls</A>
<LI><A HREF="#climada_hazard_crop">climada_hazard_crop</A>
<LI><A HREF="#climada_hazard_init">climada_hazard_init</A>
<LI><A HREF="#climada_measures_construct">climada_measures_construct</A>
<LI><A HREF="#climada_measures_impact_add">climada_measures_impact_add</A>

<P><STRONG>_modules/advanced/code/ECA_graphics:</STRONG><LI><A HREF="#axescenter">axescenter</A>
<LI><A HREF="#batch_create_ECA_graphics">batch_create_ECA_graphics</A>
<LI><A HREF="#climada_adaptation_graph">climada_adaptation_graph</A>
<LI><A HREF="#climada_adaptation_graph_damage">climada_adaptation_graph_damage</A>
<LI><A HREF="#climada_adaptation_graph_new">climada_adaptation_graph_new</A>
<LI><A HREF="#climada_adaptation_graph_upsidedown">climada_adaptation_graph_upsidedown</A>
<LI><A HREF="#climada_read_risk_analysis">climada_read_risk_analysis</A>
<LI><A HREF="#climada_waterfall_graph_special">climada_waterfall_graph_special</A>
<LI><A HREF="#climada_waterfall_graph_special_NY">climada_waterfall_graph_special_NY</A>
<LI><A HREF="#climada_waterfall_graph_special_tanzania">climada_waterfall_graph_special_tanzania</A>
<LI><A HREF="#font_test">font_test</A>

<P><STRONG>_modules/advanced/code/ktools:</STRONG><LI><A HREF="#ktools_model_from_climada">ktools_model_from_climada</A>

<P><STRONG>_modules/advanced/code/old_code:</STRONG><LI><A HREF="#climada_tc_windfield_animation">climada_tc_windfield_animation</A>
<LI><A HREF="#climada_tc_windfield_timestep">climada_tc_windfield_timestep</A>

<P><STRONG>_modules/coastal_hazards/code:</STRONG><LI><A HREF="#GeoDistance">GeoDistance</A>
<LI><A HREF="#arcgridwrite">arcgridwrite</A>
<LI><A HREF="#aux_historical_storms_MEX">aux_historical_storms_MEX</A>
<LI><A HREF="#class_plot_profiles">class_plot_profiles</A>
<LI><A HREF="#climada_EDS_DFC_2xls">climada_EDS_DFC_2xls</A>
<LI><A HREF="#climada_EDS_DFC_coastal">climada_EDS_DFC_coastal</A>
<LI><A HREF="#climada_EDS_calc_coastal">climada_EDS_calc_coastal</A>
<LI><A HREF="#climada_EDS_calc_coastal_oneasset">climada_EDS_calc_coastal_oneasset</A>
<LI><A HREF="#climada_arrow_2015">climada_arrow_2015</A>
<LI><A HREF="#climada_arrow_orig">climada_arrow_orig</A>
<LI><A HREF="#climada_calculate_ACE">climada_calculate_ACE</A>
<LI><A HREF="#climada_calculate_LTtrend">climada_calculate_LTtrend</A>
<LI><A HREF="#climada_calculate_storms_stats">climada_calculate_storms_stats</A>
<LI><A HREF="#climada_calculate_storms_stats_inregion">climada_calculate_storms_stats_inregion</A>
<LI><A HREF="#climada_coastal_plot_DFC">climada_coastal_plot_DFC</A>
<LI><A HREF="#climada_colormap_coastal">climada_colormap_coastal</A>
<LI><A HREF="#climada_compare_windfields">climada_compare_windfields</A>
<LI><A HREF="#climada_damagefunctions_plot_coastal">climada_damagefunctions_plot_coastal</A>
<LI><A HREF="#climada_distribution_v0_vi">climada_distribution_v0_vi</A>
<LI><A HREF="#climada_entity_calc_diff">climada_entity_calc_diff</A>
<LI><A HREF="#climada_entity_read_coastal">climada_entity_read_coastal</A>
<LI><A HREF="#climada_getTemporalSerie_AT">climada_getTemporalSerie_AT</A>
<LI><A HREF="#climada_get_GlobalWaveClimate">climada_get_GlobalWaveClimate</A>
<LI><A HREF="#climada_get_LandSubsidence">climada_get_LandSubsidence</A>
<LI><A HREF="#climada_get_SLRProjection">climada_get_SLRProjection</A>
<LI><A HREF="#climada_get_SLRhistorical">climada_get_SLRhistorical</A>
<LI><A HREF="#climada_hazard_stats_coastal">climada_hazard_stats_coastal</A>
<LI><A HREF="#climada_init_vars_coastal">climada_init_vars_coastal</A>
<LI><A HREF="#climada_plot_compare_tc_tracks">climada_plot_compare_tc_tracks</A>
<LI><A HREF="#climada_plot_compare_tc_tracks_inregion">climada_plot_compare_tc_tracks_inregion</A>
<LI><A HREF="#climada_tc_ACE_set">climada_tc_ACE_set</A>
<LI><A HREF="#climada_tc_equal_timestep_coastal">climada_tc_equal_timestep_coastal</A>
<LI><A HREF="#climada_tc_hazard_surge">climada_tc_hazard_surge</A>
<LI><A HREF="#climada_tc_hazard_surge_CENAPRED">climada_tc_hazard_surge_CENAPRED</A>
<LI><A HREF="#climada_tc_hazard_surge_CENAPRED_field">climada_tc_hazard_surge_CENAPRED_field</A>
<LI><A HREF="#climada_tc_hazard_surge_DD92_mslope">climada_tc_hazard_surge_DD92_mslope</A>
<LI><A HREF="#climada_tc_hazard_surge_SLOSH">climada_tc_hazard_surge_SLOSH</A>
<LI><A HREF="#climada_tc_surgefield_barotropic">climada_tc_surgefield_barotropic</A>
<LI><A HREF="#climada_tc_tracks_clim_scen">climada_tc_tracks_clim_scen</A>
<LI><A HREF="#climada_tc_wavefield">climada_tc_wavefield</A>
<LI><A HREF="#climada_tc_windfield_ACE">climada_tc_windfield_ACE</A>
<LI><A HREF="#climada_tc_windfield_HURAC">climada_tc_windfield_HURAC</A>
<LI><A HREF="#climada_waterfall_graph_coastal">climada_waterfall_graph_coastal</A>
<LI><A HREF="#create_bathymetry">create_bathymetry</A>
<LI><A HREF="#deg2utm">deg2utm</A>
<LI><A HREF="#disk_kernel">disk_kernel</A>
<LI><A HREF="#filter2_ch">filter2_ch</A>
<LI><A HREF="#fun_DFC2struct">fun_DFC2struct</A>
<LI><A HREF="#fun_SurgeHeightFun">fun_SurgeHeightFun</A>
<LI><A HREF="#fun_angcoast_centroids">fun_angcoast_centroids</A>
<LI><A HREF="#fun_calculate_IFC">fun_calculate_IFC</A>
<LI><A HREF="#fun_calculate_mean_slope">fun_calculate_mean_slope</A>
<LI><A HREF="#fun_clean_track">fun_clean_track</A>
<LI><A HREF="#fun_find_closest_point">fun_find_closest_point</A>
<LI><A HREF="#fun_plot_IFC">fun_plot_IFC</A>
<LI><A HREF="#fun_process_for_EDScalc_coastal">fun_process_for_EDScalc_coastal</A>
<LI><A HREF="#fun_write_xls_Damages">fun_write_xls_Damages</A>
<LI><A HREF="#fun_writeshp_contour_lines">fun_writeshp_contour_lines</A>
<LI><A HREF="#fun_writeshp_stats_points">fun_writeshp_stats_points</A>
<LI><A HREF="#getcontourlines">getcontourlines</A>
<LI><A HREF="#harmonics">harmonics</A>
<LI><A HREF="#nearestneighbour">nearestneighbour</A>
<LI><A HREF="#pol2cart_ch">pol2cart_ch</A>
<LI><A HREF="#save_fig">save_fig</A>
<LI><A HREF="#save_fig_formats">save_fig_formats</A>
<LI><A HREF="#tlabel">tlabel</A>

<P><STRONG>_modules/country_risk/code:</STRONG><LI><A HREF="#centroids_generate_hazard_sets">centroids_generate_hazard_sets</A>
<LI><A HREF="#climada_create_GDP_entity">climada_create_GDP_entity</A>
<LI><A HREF="#climada_entity_GDP">climada_entity_GDP</A>
<LI><A HREF="#climada_hybrid_entity">climada_hybrid_entity</A>
<LI><A HREF="#climada_night_light_to_country">climada_night_light_to_country</A>
<LI><A HREF="#climada_nightlight_global_entity">climada_nightlight_global_entity</A>
<LI><A HREF="#climada_plot_entity_assets">climada_plot_entity_assets</A>
<LI><A HREF="#country_admin1_risk_calc">country_admin1_risk_calc</A>
<LI><A HREF="#country_risk_calc">country_risk_calc</A>
<LI><A HREF="#country_risk_calibrate">country_risk_calibrate</A>
<LI><A HREF="#country_risk_prep">country_risk_prep</A>
<LI><A HREF="#country_risk_report">country_risk_report</A>
<LI><A HREF="#country_risk_report_raw">country_risk_report_raw</A>
<LI><A HREF="#country_risk_waterfall">country_risk_waterfall</A>
<LI><A HREF="#emdat_barplot">emdat_barplot</A>
<LI><A HREF="#emdat_read">emdat_read</A>
<LI><A HREF="#selected_countries_all_in_one">selected_countries_all_in_one</A>

<P><STRONG>_modules/country_risk/code/GDP_entity:</STRONG><LI><A HREF="#GDP_docs_test">GDP_docs_test</A>
<LI><A HREF="#climada_GDP_check_countrynames">climada_GDP_check_countrynames</A>
<LI><A HREF="#climada_GDP_read">climada_GDP_read</A>
<LI><A HREF="#climada_ask_country_name">climada_ask_country_name</A>
<LI><A HREF="#climada_create_centroids_entity_base">climada_create_centroids_entity_base</A>
<LI><A HREF="#climada_cut_out_GDP_entity">climada_cut_out_GDP_entity</A>
<LI><A HREF="#climada_define_polygon">climada_define_polygon</A>
<LI><A HREF="#climada_downscale">climada_downscale</A>
<LI><A HREF="#climada_entity_base_assets_add">climada_entity_base_assets_add</A>
<LI><A HREF="#climada_entity_read_wo_assets">climada_entity_read_wo_assets</A>
<LI><A HREF="#climada_entity_save_xls">climada_entity_save_xls</A>
<LI><A HREF="#climada_entity_scaleup_GDP">climada_entity_scaleup_GDP</A>
<LI><A HREF="#climada_entity_scaleup_factor">climada_entity_scaleup_factor</A>
<LI><A HREF="#climada_load_border_mask">climada_load_border_mask</A>
<LI><A HREF="#climada_load_world_borders">climada_load_world_borders</A>
<LI><A HREF="#climada_mask_buffer_hollow">climada_mask_buffer_hollow</A>
<LI><A HREF="#climada_matrix2centroid">climada_matrix2centroid</A>
<LI><A HREF="#climada_night_light_read">climada_night_light_read</A>
<LI><A HREF="#climada_nightlight_nonlinear_transformation">climada_nightlight_nonlinear_transformation</A>
<LI><A HREF="#climada_parameter_string">climada_parameter_string</A>
<LI><A HREF="#climada_plot_centroids">climada_plot_centroids</A>
<LI><A HREF="#climada_polygon2raster">climada_polygon2raster</A>
<LI><A HREF="#climada_resolution_downscale">climada_resolution_downscale</A>
<LI><A HREF="#inpoly">inpoly</A>

<P><STRONG>_modules/country_risk/code/helper_functions:</STRONG><LI><A HREF="#climada_nightlight2cdf">climada_nightlight2cdf</A>
<LI><A HREF="#country_risk_EDS2YDS">country_risk_EDS2YDS</A>
<LI><A HREF="#country_risk_EDS_combine">country_risk_EDS_combine</A>
<LI><A HREF="#cr_DFC_plot">cr_DFC_plot</A>
<LI><A HREF="#cr_DFC_plot_aggregate">cr_DFC_plot_aggregate</A>
<LI><A HREF="#cr_EDS_emdat_adjust">cr_EDS_emdat_adjust</A>
<LI><A HREF="#cr_checksum">cr_checksum</A>
<LI><A HREF="#cr_country_DFC_sensitivity">cr_country_DFC_sensitivity</A>
<LI><A HREF="#cr_country_hazard_test">cr_country_hazard_test</A>
<LI><A HREF="#cr_damage_as_percentage_of_GDP">cr_damage_as_percentage_of_GDP</A>
<LI><A HREF="#cr_damagefunction_adjust">cr_damagefunction_adjust</A>
<LI><A HREF="#cr_damagefunction_sensitivity">cr_damagefunction_sensitivity</A>
<LI><A HREF="#cr_economic_loss_calc">cr_economic_loss_calc</A>
<LI><A HREF="#cr_get_damage_weight">cr_get_damage_weight</A>
<LI><A HREF="#cr_hazard_clim_scen">cr_hazard_clim_scen</A>
<LI><A HREF="#cr_hazard_comparison">cr_hazard_comparison</A>
<LI><A HREF="#cr_loss_multiplier_plot">cr_loss_multiplier_plot</A>

<P><STRONG>_modules/disaster_risk_finance/code/diana:</STRONG><LI><A HREF="#diana">diana</A>
<LI><A HREF="#diana_params">diana_params</A>
<LI><A HREF="#drf_create_EDS">drf_create_EDS</A>
<LI><A HREF="#drf_damage_calc">drf_damage_calc</A>
<LI><A HREF="#drf_evaluation">drf_evaluation</A>
<LI><A HREF="#drf_plot">drf_plot</A>

<P><STRONG>_modules/disaster_risk_finance/code/helper_functions:</STRONG><LI><A HREF="#MSP_PLS_read">MSP_PLS_read</A>
<LI><A HREF="#climada_PLS_read">climada_PLS_read</A>

<P><STRONG>_modules/drought_fire/code:</STRONG><LI><A HREF="#bf_TEST_jumpy">bf_TEST_jumpy</A>
<LI><A HREF="#bf_TEST_small">bf_TEST_small</A>
<LI><A HREF="#bf_generator_jumpy">bf_generator_jumpy</A>
<LI><A HREF="#bf_generator_large">bf_generator_large</A>
<LI><A HREF="#bf_generator_small">bf_generator_small</A>
<LI><A HREF="#bf_generator_small_DEV">bf_generator_small_DEV</A>
<LI><A HREF="#climada_bf_hazard_set">climada_bf_hazard_set</A>
<LI><A HREF="#climadacrop_init">climadacrop_init</A>
<LI><A HREF="#firms_read">firms_read</A>

<P><STRONG>_modules/earthquake_volcano/code:</STRONG><LI><A HREF="#MMI_attenuation_calc">MMI_attenuation_calc</A>
<LI><A HREF="#climada_get_single_event">climada_get_single_event</A>
<LI><A HREF="#eq_centennial_read">eq_centennial_read</A>
<LI><A HREF="#eq_global_attenuation">eq_global_attenuation</A>
<LI><A HREF="#eq_global_attenuation_TEST">eq_global_attenuation_TEST</A>
<LI><A HREF="#eq_global_hazard_set">eq_global_hazard_set</A>
<LI><A HREF="#eq_global_hazard_set_slow">eq_global_hazard_set_slow</A>
<LI><A HREF="#eq_global_probabilistic">eq_global_probabilistic</A>
<LI><A HREF="#eq_isc_gem_read">eq_isc_gem_read</A>
<LI><A HREF="#eq_signigeq_read">eq_signigeq_read</A>
<LI><A HREF="#plot_attenuation_parameters">plot_attenuation_parameters</A>
<LI><A HREF="#plot_gutenberg_richter">plot_gutenberg_richter</A>
<LI><A HREF="#validate_eq_damage">validate_eq_damage</A>
<LI><A HREF="#vq_global_hazard_set">vq_global_hazard_set</A>
<LI><A HREF="#vq_global_probabilistic">vq_global_probabilistic</A>
<LI><A HREF="#vq_tephra_field_cm">vq_tephra_field_cm</A>
<LI><A HREF="#vq_volcano_list_read">vq_volcano_list_read</A>

<P><STRONG>_modules/elevation_models/code:</STRONG><LI><A HREF="#climada_srtm_entity">climada_srtm_entity</A>
<LI><A HREF="#climada_srtm_get">climada_srtm_get</A>
<LI><A HREF="#etopo_elevation_m">etopo_elevation_m</A>
<LI><A HREF="#etopo_get">etopo_get</A>
<LI><A HREF="#srtm_elevation_m">srtm_elevation_m</A>

<P><STRONG>_modules/elevation_models/code/helper_functions:</STRONG><LI><A HREF="#climada_hdr_read">climada_hdr_read</A>
<LI><A HREF="#climada_srtm_info">climada_srtm_info</A>

<P><STRONG>_modules/flood/code:</STRONG><LI><A HREF="#climada_hazard_encode_distance">climada_hazard_encode_distance</A>
<LI><A HREF="#climada_ls_hazard_binary_plot">climada_ls_hazard_binary_plot</A>
<LI><A HREF="#climada_ls_hazard_set">climada_ls_hazard_set</A>
<LI><A HREF="#climada_ls_hazard_set_binary">climada_ls_hazard_set_binary</A>

<P><STRONG>_modules/flood/code/helper_functions:</STRONG><LI><A HREF="#climada_centroids_TWI_calc">climada_centroids_TWI_calc</A>
<LI><A HREF="#climada_flow_find">climada_flow_find</A>
<LI><A HREF="#climada_geo_distance_2">climada_geo_distance_2</A>

<P><STRONG>_modules/flood/code/under_construction:</STRONG><LI><A HREF="#basin_identify">basin_identify</A>
<LI><A HREF="#centroids_BD">centroids_BD</A>
<LI><A HREF="#centroids_ET">centroids_ET</A>
<LI><A HREF="#centroids_LAI">centroids_LAI</A>
<LI><A HREF="#centroids_SD">centroids_SD</A>
<LI><A HREF="#centroids_SWI">centroids_SWI</A>
<LI><A HREF="#centroids_WHC">centroids_WHC</A>
<LI><A HREF="#centroids_basin_ID">centroids_basin_ID</A>
<LI><A HREF="#centroids_river_network">centroids_river_network</A>
<LI><A HREF="#climada_90m_DEM">climada_90m_DEM</A>
<LI><A HREF="#climada_DEM_plot">climada_DEM_plot</A>
<LI><A HREF="#climada_fl_centroids_prepare">climada_fl_centroids_prepare</A>
<LI><A HREF="#climada_fl_hazard_set">climada_fl_hazard_set</A>
<LI><A HREF="#climada_grid2array">climada_grid2array</A>
<LI><A HREF="#climada_ls_cell_failure">climada_ls_cell_failure</A>
<LI><A HREF="#climada_ls_hazard_set_gilles">climada_ls_hazard_set_gilles</A>
<LI><A HREF="#climada_ls_multi_layer_plot">climada_ls_multi_layer_plot</A>
<LI><A HREF="#climada_rf_hazard_set">climada_rf_hazard_set</A>
<LI><A HREF="#dem">dem</A>
<LI><A HREF="#fl_Climada_Aqueduct_compare">fl_Climada_Aqueduct_compare</A>
<LI><A HREF="#fl_hazard_plot_hr">fl_hazard_plot_hr</A>
<LI><A HREF="#flood_countryrisk_generate">flood_countryrisk_generate</A>
<LI><A HREF="#flood_damagefunction_entity_add">flood_damagefunction_entity_add</A>
<LI><A HREF="#landcolor">landcolor</A>
<LI><A HREF="#seacolor">seacolor</A>
<LI><A HREF="#structfind">structfind</A>

<P><STRONG>_modules/isimip/code:</STRONG><LI><A HREF="#helper_advanced_windfield_global">helper_advanced_windfield_global</A>
<LI><A HREF="#isimip_NatID_RegID">isimip_NatID_RegID</A>
<LI><A HREF="#isimip_YDS_calc">isimip_YDS_calc</A>
<LI><A HREF="#isimip_damage_read">isimip_damage_read</A>
<LI><A HREF="#isimip_flood_load">isimip_flood_load</A>
<LI><A HREF="#isimip_gdp_entity">isimip_gdp_entity</A>
<LI><A HREF="#isimip_haversine">isimip_haversine</A>
<LI><A HREF="#isimip_ibtracs_load">isimip_ibtracs_load</A>
<LI><A HREF="#isimip_ibtracs_read">isimip_ibtracs_read</A>
<LI><A HREF="#isimip_step_by_step">isimip_step_by_step</A>
<LI><A HREF="#isimip_tc_calibrate copy">isimip_tc_calibrate copy</A>
<LI><A HREF="#isimip_tc_calibrate">isimip_tc_calibrate</A>
<LI><A HREF="#isimip_tc_hazard_set">isimip_tc_hazard_set</A>
<LI><A HREF="#isimip_tc_track_load">isimip_tc_track_load</A>
<LI><A HREF="#isimip_windfield_TESTS">isimip_windfield_TESTS</A>
<LI><A HREF="#isimip_windfield_holland">isimip_windfield_holland</A>
<LI><A HREF="#job_isimip01">job_isimip01</A>

<P><STRONG>_modules/kml_toolbox/code:</STRONG><LI><A HREF="#README">README</A>

<P><STRONG>_modules/kml_toolbox/code/html:</STRONG><LI><A HREF="#kmldoc">kmldoc</A>

<P><STRONG>_modules/kml_toolbox/code/test:</STRONG><LI><A HREF="#RunTestTour">RunTestTour</A>
<LI><A HREF="#RunTests">RunTests</A>
<LI><A HREF="#RunTestsRadians">RunTestsRadians</A>
<LI><A HREF="#bitslice">bitslice</A>
<LI><A HREF="#testAnim">testAnim</A>

<P><STRONG>_modules/meteorite/code:</STRONG><LI><A HREF="#climada_meteorite_hazard_set">climada_meteorite_hazard_set</A>

<P><STRONG>_modules/storm_europe/code:</STRONG><LI><A HREF="#WS_intensity_correction">WS_intensity_correction</A>
<LI><A HREF="#climada_cosmo2hazard">climada_cosmo2hazard</A>
<LI><A HREF="#schwierz_etal_2010">schwierz_etal_2010</A>
<LI><A HREF="#winterstorm_TEST">winterstorm_TEST</A>
<LI><A HREF="#winterstorm_blend_hazard_event_sets">winterstorm_blend_hazard_event_sets</A>
<LI><A HREF="#winterstorm_compare">winterstorm_compare</A>
<LI><A HREF="#winterstorm_compare_severity">winterstorm_compare_severity</A>
<LI><A HREF="#winterstorm_scenario_hazard">winterstorm_scenario_hazard</A>
<LI><A HREF="#winterstorm_severity">winterstorm_severity</A>
<LI><A HREF="#wisc_demo">wisc_demo</A>
<LI><A HREF="#wisc_hazard_set">wisc_hazard_set</A>

<P><STRONG>_modules/tropical_cyclone/code:</STRONG><LI><A HREF="#_climada_nonspheric_distance_m">_climada_nonspheric_distance_m</A>
<LI><A HREF="#climada_EDS_scaleup_factor">climada_EDS_scaleup_factor</A>
<LI><A HREF="#climada_RCLIPER">climada_RCLIPER</A>
<LI><A HREF="#climada_admin_name">climada_admin_name</A>
<LI><A HREF="#climada_centroids_distance_to_coast">climada_centroids_distance_to_coast</A>
<LI><A HREF="#climada_centroids_hazard_expand">climada_centroids_hazard_expand</A>
<LI><A HREF="#climada_coastline_read">climada_coastline_read</A>
<LI><A HREF="#climada_event_damage_animation_ge">climada_event_damage_animation_ge</A>
<LI><A HREF="#climada_hazard_clim_scen_IPCC">climada_hazard_clim_scen_IPCC</A>
<LI><A HREF="#climada_hazard_clim_scen_advanced">climada_hazard_clim_scen_advanced</A>
<LI><A HREF="#climada_hazard_climate_screw">climada_hazard_climate_screw</A>
<LI><A HREF="#climada_hazard_distance_to_coast">climada_hazard_distance_to_coast</A>
<LI><A HREF="#climada_hazard_distance_to_coast_USA">climada_hazard_distance_to_coast_USA</A>
<LI><A HREF="#climada_hazard_distance_to_coast_australia">climada_hazard_distance_to_coast_australia</A>
<LI><A HREF="#climada_hazard_distance_to_coast_china">climada_hazard_distance_to_coast_china</A>
<LI><A HREF="#climada_hazard_distance_to_coast_japan">climada_hazard_distance_to_coast_japan</A>
<LI><A HREF="#climada_hazard_extract_event">climada_hazard_extract_event</A>
<LI><A HREF="#climada_hazard_footprint_plot">climada_hazard_footprint_plot</A>
<LI><A HREF="#climada_hazard_merge">climada_hazard_merge</A>
<LI><A HREF="#climada_plot_loss_hist">climada_plot_loss_hist</A>
<LI><A HREF="#climada_plot_lossfootprint">climada_plot_lossfootprint</A>
<LI><A HREF="#climada_plot_probabilistic_wind_speed_decay">climada_plot_probabilistic_wind_speed_decay</A>
<LI><A HREF="#climada_plot_probabilistic_wind_speed_map_gui">climada_plot_probabilistic_wind_speed_map_gui</A>
<LI><A HREF="#climada_scale_to_MSP_to_market">climada_scale_to_MSP_to_market</A>
<LI><A HREF="#climada_tc_global_impact">climada_tc_global_impact</A>
<LI><A HREF="#climada_tc_hazard_set_slow">climada_tc_hazard_set_slow</A>
<LI><A HREF="#climada_tc_on_land">climada_tc_on_land</A>
<LI><A HREF="#climada_tc_track_combine">climada_tc_track_combine</A>
<LI><A HREF="#climada_tc_track_google_earth">climada_tc_track_google_earth</A>
<LI><A HREF="#climada_tc_track_wind_decay">climada_tc_track_wind_decay</A>
<LI><A HREF="#climada_tc_track_wind_decay_calculate">climada_tc_track_wind_decay_calculate</A>
<LI><A HREF="#climada_tc_track_windfield_google_earth">climada_tc_track_windfield_google_earth</A>
<LI><A HREF="#climada_tc_wind_decay">climada_tc_wind_decay</A>
<LI><A HREF="#climada_tc_windfield_slow">climada_tc_windfield_slow</A>
<LI><A HREF="#climada_tr_hazard_set">climada_tr_hazard_set</A>
<LI><A HREF="#climada_tr_hazard_set_slow">climada_tr_hazard_set_slow</A>
<LI><A HREF="#climada_tr_rainfield">climada_tr_rainfield</A>
<LI><A HREF="#climada_tr_rainfield_slow">climada_tr_rainfield_slow</A>
<LI><A HREF="#climada_tr_rainrate_field_animation">climada_tr_rainrate_field_animation</A>
<LI><A HREF="#climada_tr_rainsum_field_animation">climada_tr_rainsum_field_animation</A>
<LI><A HREF="#climada_track_map">climada_track_map</A>
<LI><A HREF="#climada_ts_hazard_set">climada_ts_hazard_set</A>
<LI><A HREF="#figures_for_hazard_advanced_manual">figures_for_hazard_advanced_manual</A>
<LI><A HREF="#haversine">haversine</A>
<LI><A HREF="#tc_surge_TEST">tc_surge_TEST</A>
<LI><A HREF="#tc_surge_TEST_Netherlands">tc_surge_TEST_Netherlands</A>
<LI><A HREF="#tc_surge_plot_3d">tc_surge_plot_3d</A>
<P>
</UL><P>
 
<HR>
 
<H1>Routine Descriptions</H1>
<PRE>


<A NAME="climada">
<H2>climada</H2></A>
<font color="blue">function measures_impact=climada(entity_today_file,entity_future_file,hazard_today_file,hazard_future_file,check_plots) </font>
 climada all in one adaptaton cost curve climate scenarios economic grwoth projection
 MODULE:
   core
 NAME:
   climada
 PURPOSE:
   Import entity today and entity future, ask for corresponding hazard
   event sets, show a few plots for checks, run all calculations and
   produce the final adaptation cost curve - all in one call.

   Special: on subsequent calls, the routine suggest last inputs - and if
   the first file selection is the same as on previous call, even asks to
   re-run with previous call's inputs without asking for each's
   confirmation.
   It further checks for the entity file to have been edited since last
   call. If not, it does not ask for plotting assets and damagefunctions
   again. If one wants to plot, needs to either save the entity again or
   select another file and then cancel.

   NOTE: in order to allow a very intuitive interface to get started with
   climada, the cases climada('TEST_CLIMADA', climada('DEMO') and
   climada('TC') have been implemented, too, see discription below.

   Programmes's note: The present code mainly handles asdmin, i.e.
   checking files, while all calculations are run be the core climada
   functions, i.e. climada_entity_read, climada_measures_impact, 
   climada_adaptation_event_view and - last but not least -
   climada_adaptation_cost_curve. 
 CALLING SEQUENCE:
   measures_impact=climada(entity,entitiy_future,hazard_today_file,hazard_future_file)
 EXAMPLE:
   measures_impact=climada % all prompted for
   climada('TEST_CLIMADA'); % TEST mode
   climada('DEMO'); % run the demo GUI (same as climada_demo)
   climada('TC'); % run a TC event damage calculation
 INPUTS:
   entity_today_file: entity (assets, damagefunctions and measures) today
       a climada entity file, either an Excel (.xls or .xlsx) or Open
       Office (.ods file) or an already encoded .mat file. Note that in
       case a .mat file is provided, the code does not notice if the
       original .xls or .ods got changed - hence preferable select the
       source, i.e. .xls or .ods).   
       &ampgt prompted for if empty
       ='TEST_CLIMADA': special test mode, the code uses the test files
       (as used in climada_demo and climada_demo_step_by_step)
       ='TC': special mode to calculate TC event damage, calls
       climada_tc_event_damage_ens_gui, i.e. allows you to select a basin,
       track and country (optional) in order to calculate TC damage.
       ='DEMO', invoke climada_demo
   entity_future_file: future entity (assets, damagefunctions and measures) to
       represent projected economic growth, a climada entity structure
       (see climada_entity_read, same remark as above)
       &ampgt prompted for if empty
   hazard_today_file: a climada hazard event set for today
       &ampgt promted for if not given
   hazard_future_file: a climada hazard event set for future (climate scenario)
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   check_plots: whether we show a few check plots (assets,
       damagefunctions)
       =0: no plots (default)
       =1: show plots
       The code also switches to ask for plot if it needs to prompt
       for filenames, i.e. operates in interactive mode.
 OUTPUTS:
   measures_impact: the same output as climada_measures_impact
   and plots: adaptation cost curve, adaptation event view
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150101, initial
 David N. Bresch, david.bresch@gmail.com, 20160908, entities_dir and hazards_dir used
 David N. Bresch, david.bresch@gmail.com, 20170504, 'TC' and 'DEMO' added
View <A HREF=file:../../climada/code/climada.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_calc">
<H2>climada_EDS_calc</H2></A>
<font color="blue">function EDS=climada_EDS_calc(entity,hazard,annotation_name,force_re_encode,silent_mode,sanity_check) </font>
 climada calculate event damage set
 NAME:
   climada_EDS_calc
 PURPOSE:
   given an encoded entity (assets and damage functions) and a hazard
   event set, calculate the event damage set (EDS). The event damage set
   contains the event damage for each hazard event. In case you set
   climada_global.damage_at_centroid=1, the damage is also stored for each
   event at each centroids (be aware of memory implications). The exepcted
   damage is always stored at each centroid, see EDS.ED_at_centroid.

   Note that the waitbar consumes quite some time, so switch it off by
   setting climada_global.waitbar=0 or by
   using the climada_code_optimizer, which removes all slowing code, i.e.
   all code lines marked by % CLIMADA_OPT - but by now, the code is pretty
   fast, hence climada_code_optimizer does usually not bring huge
   improvements (i.e. less than 4% speedup).

   Search for 'TEST output' in code to show output for VERY SMALL entities

   next (likely): climada_EDS_DFC or climada_EDS2DFC, climada_EDS_DFC_report
   See also climada_EDS_calc_parfor for a parallelized version (beta)
 CALLING SEQUENCE:
   EDS=climada_EDS_calc(entity,hazard,annotation_name)
 EXAMPLE:
   EDS=climada_EDS_calc(climada_assets_encode(climada_assets_read))
   EDS=climada_EDS_calc('demo_today','TCNA_today_small')
 INPUTS:
   entity: an entity structure or an entity .mat file, see climada_assets_encode(climada_assets_read)
       If a file and no path provided, default path ../data/entities is
       used (and name can be without extension .mat)
       &ampgt promted for if not given
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       If a file and no path provided, default path ../data/hazards is
       used (and name can be without extension .mat). If hazard is empty
       and entity contains hazard in entity.hazard, this hazard is used.
       &ampgt promted for if not given
       Minimum fileds of hazard struct are: 
       peril_ID, event_ID, centroid_ID, intensity and frequency 
 OPTIONAL INPUT PARAMETERS:
   annotation_name: a free text that will appear e.g. on plots for
       annotation, default is the name of the hazard set
   force_re_encode: if =1, force re-encoding (either to be on the safe
       side, or if the entity has been encoded t a different hazard event
       set). Default=0
   silent_mode: suppress any output to stdout (useful i.e. if called many times)
       default=0 (output to stdout), =1: no output and no waitbar at all
       command-line progress output is still shown with silent_mode=1, but
       suppressed if =2. 
 OUTPUTS:
   EDS, the event damage set with:
       ED: the total expected annual damage (=EDS.damage*EDS.frequency')
       reference_year: the year the damages are references to
       event_ID(event_i): the unique ID for each event_i
       damage(event_i): the damage amount for event_i (summed up over all
           assets)
       ED_at_centroid(centroid_i): expected damage at each centroid
       Value: the sum of all Values used in the calculation (to e.g.
           express damages in percentage of total Value)
       frequency(event_i): the per occurrence event frequency for each event_i
       orig_event_flag(event_i): whether an original event (=1) or a
           probabilistic one (=0)
       comment: a free comment, contains time for calculation
       hazard: itself a structure, with:
           filename: the filename of the hazard event set
           comment: a free comment
       assets.lat(asset_i): the latitude of each asset_i
       assets.lon(asset_i): the longitude of each asset_i
       assets.Value(asset_i): the Value of asset_i, i.e. used to show
           ED_at_centroid in percentage of asset value.
       assets.filename: the filename of the assets
       assets.admin0_name: the admin0_name of the assets (optional)
       assets.admin0_ISO3: the admin0_ISO3 code of the assets (optional)
       assets.admin1_name: the admin1_name of the assets (optional)
       assets.admin1_code: the admin1_code of the assets (optional)
       damagefunctions.filename: the filename of the damagefunctions
       annotation_name: a kind of default title (sometimes empty)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091228
 David N. Bresch, david.bresch@gmail.com, 20130316, ELS-&ampgtEDS...
 David N. Bresch, david.bresch@gmail.com, 20130623, re-encoding optional
 David N. Bresch, david.bresch@gmail.com, 20141025, peril_ID added to waitbar title
 David N. Bresch, david.bresch@gmail.com, 20141103, entity.damagefunctions.peril_ID
 David N. Bresch, david.bresch@gmail.com, 20141127, force_re_encode
 David N. Bresch, david.bresch@gmail.com, 20141218, Cover checks added
 David N. Bresch, david.bresch@gmail.com, 20141230, only assets.Value&ampgt0 prcocessed for speedup
 David N. Bresch, david.bresch@gmail.com, 20150101, annotation check for 'MAC' and 'APPLE'
 David N. Bresch, david.bresch@gmail.com, 20150103, check Octave compatibility of (large) hazard event sets
 David N. Bresch, david.bresch@gmail.com, 20150105, filesep conversion (from either PC or MAC) solved
 David N. Bresch, david.bresch@gmail.com, 20150106, add Cover and/or Deductible if missing
 David N. Bresch, david.bresch@gmail.com, 20150106, Octave issue with hazard saved as -v7.3 solved
 David N. Bresch, david.bresch@gmail.com, 20150114, EDS.peril_ID (was EDS.hazard.peril_ID)
 David N. Bresch, david.bresch@gmail.com, 20150320, spfun replaced with explicit call, turns out to be &ampgt50% faster. Further speedup, see loop_mod_step
 Gilles Stassen, gillesstassen@hotmail.com, 20150622, use complete peril_ID in asset_damfun_pos refinement (1:2) -&ampgt (:), MDD, PAA  explicitly capped at max value
 David N. Bresch, david.bresch@gmail.com, 20150804, allow for filename without path for entoity and hazard set name on input
 Lea Mueller, muellele@gmail.com, 20150805, allow centroid_index to be zero, do not integrate such assets in valid_asset_pos, no damage will be calculated
 Lea Mueller, muellele@gmail.com, 20150819, use only unique values in interp_x_table, so that interp1 works (interp_x_table is monotonically increasing)
 Lea Mueller, muellele@gmail.com, 20150819, set minimum damage to min defined in damage function (probably 0)
 Lea Mueller, muellele@gmail.com, 20150831, EDS.ED, EDS.damage, EDS.Value is the sum only of the first Value_unit encountered, all other units are not included
 David N. Bresch, david.bresch@gmail.com, 20150907, ...errant extrapolation leads to WRONG behaviour in case of hazard_intensity_impact_b, commented
 Lea Mueller, muellele@gmail.com, 20150907, add sanity_check variable to call climada_damagefunctions_check
 Lea Mueller, muellele@gmail.com, 20150910, set sanity_check to silent_mode
 Lea Mueller, muellele@gmail.com, 20151117, replace output string to &quotCalculating damage&quot instead of &quotprocessing&quot
 Lea Mueller, muellele@gmail.com, 20151127, add EDS.scenario, EDS.assets.reference_year and EDS.assets.region, add EDS.hazard.refence_year and EDS.hazard.scenario
 Lea Mueller, muellele@gmail.com, 20151127, add EDS.assets.Category
 Lea Mueller, muellele@gmail.com, 20151127, invoke climada_assets_category_ID, add EDS.assets.Category_name and EDS.assets.Category_ID
 David N. Bresch, david.bresch@gmail.com, 20160202, cleanup
 David N. Bresch, david.bresch@gmail.com, 20160210, is_unit removed and substantial speedup (damagefunctions made unique before calc)
 Lea Mueller, muellele@gmail.com, 20160303, bugfix if damage_at_centroid and state ED in fprintf command line output
 David N. Bresch, david.bresch@gmail.com, 20160306, EDS.ED=EDS.damage*EDS.frequency'
 David N. Bresch, david.bresch@gmail.com, 20160308, no printing of ED to stdout, some silent_mode checks slow down too much, removed
 David N. Bresch, david.bresch@gmail.com, 20161008, hazard.fraction added
 David N. Bresch, david.bresch@gmail.com, 20161023, silent_mode=2
 David N. Bresch, david.bresch@gmail.com, 20170225, allow for minimal fields in hazard
 David N. Bresch, david.bresch@gmail.com, 20170305, allow for entity.hazard
 David N. Bresch, david.bresch@gmail.com, 20170313, any(abs(full(temp_damage))) allow for negative damage (i.e. profit)
 David N. Bresch, david.bresch@gmail.com, 20170626, entity.assets.Value_unit used for EDS.Value_unit
 David N. Bresch, david.bresch@gmail.com, 20170715, small fix if no valid asset for EDS.Value_unit
 David N. Bresch, david.bresch@gmail.com, 20170721, currency_unit added
View <A HREF=file:../../climada/code/climada_EDS_calc.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_adaptation_bar_chart">
<H2>climada_adaptation_bar_chart</H2></A>
<font color="blue">function fig = climada_adaptation_bar_chart(measures_impact,sort_measures,scale_benefit,benefit_str,legend_location,tcr_off,cost_unit,xlim_value) </font>
 climada measures impact climate adaptation bar chart
 NAME:
   climada_adaptation_bar_chart_v2
 PURPOSE:
   plot adaptation bar chart (NPV benefits and costs)
   see also: climada_adaptation_cost_curve

 CALLING SEQUENCE:
   climada_adaptation_bar_chart_v2(measures_impact,sort_measures,cb_text_control,scale_benefit,benefit_str,legend_location,tcr_off)
 EXAMPLE:
   climada_adaptation_bar_chart_v2(climada_measures_impact(climada_entity_read),'',1) % from scratch
 INPUTS:
   measures_impact: a climada measures_impact structure, can hold multiple measures_impacts
       see climada_measures_impact
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   sort_measures: if set to 1, sort measures according to size of benefit
   cb_text_control: control position of cb_ratio 
 OUTPUTS:
   fig: a figure handle
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150921, init
 Lea Mueller, muellele@gmail.com, 20150921, measures_impact can hold multiple measures_impact(impact_i)
 Lea Mueller, muellele@gmail.com, 20150924, add cost_unit and xlim_value, introduce climada_digit_set
 Lea Mueller, muellele@gmail.com, 20151019, set bc ratio to less affected people per 10'000 USD
 Lea Mueller, muellele@gmail.com, 20151125, rename to climada_adaptation_bar_chart from climada_adaptation_bar_chart_v2
View <A HREF=file:../../climada/code/climada_adaptation_bar_chart.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_adaptation_cost_curve">
<H2>climada_adaptation_cost_curve</H2></A>
<font color="blue">function [insurance_benefit,insurance_cost]=climada_adaptation_cost_curve(measures_impact,measures_impact_comparison,x_text_control,y_text_control,scaled_AED,nice_numbers,reverse_cb,plot_arrows,annotate_measures) </font>
 climada measures impact climate adaptation cost curve
 NAME:
   climada_adaptation_cost_curve
 PURPOSE:
   plot adaptation cost curve, color measures according to benefit/cost
   ratio (see measures_impact.color_keep to keep colors as defined in
   measures)

   see also: climada_adaptation_event_view

   NOTE: The mode with output arguments insurance_benefit and
   insurance_cost is only used when called from climada_demo (the flag
   called_from_climada_demo), no relevance for standard use .

   Previous call climada_measures_impact
   or read benefits directly from excel file with climada_measures_read
 CALLING SEQUENCE:
   [~,~]=climada_adaptation_cost_curve(measures_impact,measures_impact_comparison,x_text_control,y_text_control,scaled_AED,nice_numbers,reverse_cb,plot_arrows)
 EXAMPLE:
   climada_adaptation_cost_curve(climada_measures_impact(climada_entity_read)) % from scratch
 INPUTS:
   measures_impact: either a struct containing the impacts of measures or
       a measures_impact file (.mat with a struct) see climada_measures_impact
       &ampgt promted for if not given
       If theres is a field measures_impact.y_axis_max, it defines the
       maximum of the vertical axis (to shape plots comparable). There are
       no checks any more, hence if you provide a stange number, you get a
       strange vertical scale ;-)
       If theres is a field measures_impact.x_axis_max, it defines the
       maximum of the horizontal axis (to shape plots comparable).
       If there is a field measures_impact.color_keep, the colors as
       defined in measures are kept, otherwise nice colors are assigned.
 OPTIONAL INPUT PARAMETERS:
   measures_impact_comparison: same as measures_impact, but for comparison
       (will be shown in overlay). Not prompted for, so please specify in
       call, or enter 'ASK' in climada_adaptation_cost_curve('','ASK')
       If theres is a field measures_impact_comparison.label_comparison,
       it defines whether comparison wll be labeld (=1, default) or not (=0)
       If =0, also do not label TCR (total climate risk) for comparison
       These setting are usually good for decluttered plots for presentations
   x_text_control: controls the horizontal distribution of the text labels
       (divider of the length of the x-axis, default=20)
   y_text_control: controls the vertical distribution of the text labels
       (divider of the length of the y-axis, default=50)
   scaled_AED: NOT IMPLEMENTED/IN USE ANY MORE
   nice_numbers: NOT IMPLEMENTED/IN USE ANY MORE
   reverse_cb: (=1, default) show benefit per cost
       Set =0 to show cost/beenfit
   plot_arrows: whether we do (=1) or don't (=0, default) plot arrows
       underneath the x-axis to show cost-effective measures and
       non-cost-effective measures extent.
   annotate_measures: whether we label the measures (=1, default) or not
 OUTPUTS:
   insurance_benefit and insurance_cost: only used when called from
       climada_play_adapt_cost_curve, see there (in essence to write
       insurance cost on the GUI). For illustrative purposes only!
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091228
 David N. Bresch, david.bresch@gmail.com, 20091230 major revision, appreance similar to ECA graphs
 David N. Bresch, david.bresch@gmail.com, 20130316 EDS-&ampgtEDS
 David N. Bresch, david.bresch@gmail.com, 20130316 compatibility for both direct call as well as via climada_demo_gui
 Gilles Stassen gillesstassen@hotmail.com 20141212 fixed the arrow issue; changed labeling of total climate risk to USD x m rounded to 2 s.f.
 David N. Bresch, david.bresch@gmail.com, 20141213 plot_arrows=0 by default and climada_demo option cleaned up
 David N. Bresch, david.bresch@gmail.com, 20141231 subaxis removed (not clean, troubles in Octave)
 Lea Mueller, muellele@gmail.com, 20150617, set to bc_ratio (benefits per cost) instead of cb_ratio
 David N. Bresch, david.bresch@gmail.com, 20150804 reverse_cb fixed for comparison plot
 David N. Bresch, david.bresch@gmail.com, 20150907 decluttered (for presentations), i.e. label_comparison, x_axis_max and y_axis_max introduced
 Lea Mueller, muellele@gmail.com, 20150909, introduce factor for unit 'people', to show cb ratio as people not affected/10'000 USD
 David N. Bresch, david.bresch@gmail.com, 20150909, color_keep introduced
 Lea Mueller, muellele@gmail.com, 20150930, introduce climada_digit_set
 Lea Mueller, muellele@gmail.com, 20160309, bugfix fprintf reverse_cb for insurance
 David N. Bresch, david.bresch@gmail.com, 20160427, total climate risk not plotted for climada_demo, fontsize_ adjusted
 David N. Bresch, david.bresch@gmail.com, 20160429, major review, unit display etc cleaned up
 David N. Bresch, david.bresch@gmail.com, 20160429, insurance_benefit,insurance_cost as output again
 David N. Bresch, david.bresch@gmail.com, 20160429, stdout cleaned up
 Lea Mueller, muellele@gmail.com, 20160531, show x- and y-ticks
 David N. Bresch, david.bresch@gmail.com, 20160606, display units synchronized if same unit_name
 David N. Bresch, david.bresch@gmail.com, 20170423, annotate_measures
View <A HREF=file:../../climada/code/climada_adaptation_cost_curve.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_adaptation_event_view">
<H2>climada_adaptation_event_view</H2></A>
<font color="blue">function AEV = climada_adaptation_event_view(measures_impact,comparison_return_periods) </font>
 climada measures impact climate adaptation damage frequency effect
 NAME:
   climada_adaptation_event_view
 PURPOSE:
   show the effect of measures for events of different return periods
   see also: climada_adaptation_cost_curve
 CALLING SEQUENCE:
   climada_adaptation_event_view(measures_impact,comparison_return_periods)
 EXAMPLE:
   climada_adaptation_event_view(climada_measures_impact(climada_entity_read)) % from scratch
 INPUTS:
   measures_impact: either a struct containing the impacts of measures or a measures_impact file (.mat with a struct)
       see climada_measures_impact
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   comparison_return_periods: the list of return periods to show the
       comparison for, default is [10 25 100]
 OUTPUTS:
   graph, and AEV, a stucture which holds the data of the graph:
       damage(measure_i,return_period_i): the damage for measure_i at return_period_i
           damage(end,return_period_i) holds the damage with no measures
       return_period(return_period_i): the list of return periods
       frequency(return_period_i): the list of frequencies
       effect(measure_i,return_period_i): the effect of measure_i at return_period_i
       total_effect(return_period_i): the total effect of all measures at return_period_i
       cumulated(return_period_i): for each return period, a struct,with
           effect(measure_i): the cumulated effect up to measure i
           NOTE: measures ordered as in adaptation cost curve
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20100109
 David N. Bresch, david.bresch@gmail.com, 20150402, compatibility with version 8ff (R2014...)
 David N. Bresch, david.bresch@gmail.com, 20151021, checked to work for index insurance, too
 Lea Mueller, muellele@gmail.com, 20151125, correct 'FaceColor' issue for version 8
View <A HREF=file:../../climada/code/climada_adaptation_event_view.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_demo">
<H2>climada_demo</H2></A>
<font color="blue">function climada_demo </font>
 climada
 NAME:
   climada_demo
 PURPOSE:
   a brief demo of climada by way of an interactive GUI
   
 CALLING SEQUENCE:
   climada_demo
 EXAMPLE:
   climada_demo
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120116
 David N. Bresch, david.bresch@gmail.com, 20141123, waitbar suppressed for speedup (noticeable)
View <A HREF=file:../../climada/code/climada_demo.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_demo_gui">
<H2>climada_demo_gui</H2></A>
<font color="blue">function varargout = climada_demo_gui(varargin) </font>
 CLIMADA_DEMO_GUI M-file for climada_demo_gui.fig
      CLIMADA_DEMO_GUI, by itself, creates a new CLIMADA_DEMO_GUI or raises the existing
      singleton*.

      H = CLIMADA_DEMO_GUI returns the handle to a new CLIMADA_DEMO_GUI or the handle to
      the existing singleton*.

      CLIMADA_DEMO_GUI('CALLBACK',hObject,eventData,handles,...) calls the local
      function named CALLBACK in CLIMADA_DEMO_GUI.M with the given input
      arguments.

      CLIMADA_DEMO_GUI('Property','Value',...) creates a new CLIMADA_DEMO_GUI or raises the
      existing singleton*.  Starting from the left, property value pairs are
      applied to the GUI before climada_demo_gui_OpeningFcn gets called.  An
      unrecognized property name or invalid value makes property application
      stop.  All inputs are passed to climada_demo_gui_OpeningFcn via varargin.

      *See GUI Options on GUIDE's Tools menu.  Choose &quotGUI allows only one
      instance to run (singleton)&quot.

 See also: GUIDE, GUIDATA, GUIHANDLES
 david.bresch@gmail.com, 20140516, reverse_cb added
 muellele@gmail.com, 20160523, take demo_illu1.png from climada_global.root_dir instead of climada_global.data_dir

 Edit the above text to modify the response to help climada_demo_gui

 Last Modified by GUIDE v2.5 05-Aug-2015 17:49:27
View <A HREF=file:../../climada/code/climada_demo_gui.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_demo_step_by_step">
<H2>climada_demo_step_by_step</H2></A>
 climada_demo_step_by_step
 climada
 NAME:
   climada_demo_step_by_step
 PURPOSE:
   show the core climada key functionality step-by-step. Not a function,
   just a batch-file to allow the user to step trough and inspect all
   individual steps. See climada manual, as this code implements the
   section &quotFrom tropical cyclone hazard generation to the adaptation cost
   curve ? a step-by-step guide&quot provided there.

   running it all takes (first time) about 3 minutes (faster on subsequent
   calls, since the probabilistic hazard event set is loaded rather than
   re-generated)

   Note for Octave users: due to slower processing speed of Octave, the
   demo runs with smaller datasets. Somple plots do not look nice, but all
   calculations and core graphics (adaptation cost curve) work fine.
 CALLING SEQUENCE:
   climada_demo_step_by_step
 EXAMPLE:
   climada_demo_step_by_step
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141217, updated
 David N. Bresch, david.bresch@gmail.com, 20141231, octave-compatible
 David N. Bresch, david.bresch@gmail.com, 20160809, checked, compatible with Octave 4.0.3
 David N. Bresch, david.bresch@gmail.com, 20160908, entities_dir and hazards_dir used
 David N. Bresch, david.bresch@gmail.com, 20160911, climada_tc_equal_timestep for single track also
View <A HREF=file:../../climada/code/climada_demo_step_by_step.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_country">
<H2>climada_entity_country</H2></A>
<font color="blue">function entity=climada_entity_country(admin0_name,high_res_flag) </font>
 climada template
 MODULE:
   core
 NAME:
   climada_entity_country
 PURPOSE:
   Construct an entity file based on mid-resolution (10km) night light
   data for any country of the world.

   just a simple wrapper for climada_nightlight_entity (only another name
   to be found easily)

   previous call: startup
   next call: climada_entity_plot
 CALLING SEQUENCE:
   entity=climada_entity_country(admin0_name)
 EXAMPLE:
   entity=climada_entity_country('PRI')
   climada_entity_plot(entity)
 INPUTS:
   admin0_name: the country name, either full (like 'Puerto Rico')
       or ISO3 (like 'PRI'). See climada_country_name for names/ISO3
       &ampgt If empty, a list dialog lets the user select a country
 OPTIONAL INPUT PARAMETERS:
   high_res_flag: if =1, generate high-res (1km) resolution instead of
   default 10km. Needs country_risk module to be installed
 OUTPUTS:
   entity: a climada entity structure, as described in e.g. climada_entity_read
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170323, init, just a wrapper for climada_nightlight_entity
 David N. Bresch, david.bresch@gmail.com, 20170613, high_res_flag added
View <A HREF=file:../../climada/code/climada_entity_country.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_load">
<H2>climada_entity_load</H2></A>
<font color="blue">function [entity,entity_file]=climada_entity_load(entity) </font>
 climada
 NAME:
   climada_entity_load
 PURPOSE:
   load a previously saved entity (just to avoid typing long paths and
   filenames in the command window)
 CALLING SEQUENCE:
   entity_out=climada_entity_load(entity)
 EXAMPLE:
   entity=climada_entity_load('demo_today')
 INPUTS:
   entity: the filename (and path, optional) of a previously saved entity
       structure. If no path provided, default path ../data/entities is used
       (and name can be without extension .mat or even without
       _entity.mat, in some cases even the ISO3 code only is enough)
       &ampgt promted for if empty
       OR: an entity structure, in which case it is just returned (to allow
       calling climada_entity_load anytime, see e.g. climada_EDS_calc)
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   entity: a struct, see climada_entity_read for details
   entity_file: the full filename the entity was loaded from
       useful in subsequent call climada_entity_save(entity,entity_file)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091230
 David N. Bresch, david.bresch@gmail.com, 20150804, allow for name without path on input
 David N. Bresch, david.bresch@gmail.com, 20150820, memory use optimized, filename checked
 Lea Mueller, muellele@gmail.com, 20151124, check that field .assets exist
 Lea Mueller, muellele@gmail.com, 20151127, enhance to work with complete entity as input
 Lea Mueller, muellele@gmail.com, 20151127, set entity_file to empty if a struct without .assets
 David N. Bresch, david.bresch@gmail.com, 20160202, speedup if entity structure passed
 David N. Bresch, david.bresch@gmail.com, 20160516, _entity added if needed, too. entity_file as output added
 David N. Bresch, david.bresch@gmail.com, 20160908, entities_dir used
 David N. Bresch, david.bresch@gmail.com, 20161001, check for isentity
 David N. Bresch, david.bresch@gmail.com, 20161120, try also to save with '-v7.3'
 David N. Bresch, david.bresch@gmail.com, 20170503, allow also for ISO3 only
View <A HREF=file:../../climada/code/climada_entity_load.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_plot">
<H2>climada_entity_plot</H2></A>
<font color="blue">function params=climada_entity_plot(entity,markersize,params) </font>
 plot an entity, no detailed documentation
 NAME:
   climada_entity_plot
 PURPOSE:
   Plot the assets of an entity

   Note that you can overplot, just call hold on before calling
   climada_entity_plot, i.e. to plot assets on top of tracks (see
   climada_tc_track_info)

   Possible prior call: climada_entity_load;climada_entity_read
 CALLING SEQUENCE:
   climada_entity_plot(entity,markersize,params)
 EXAMPLE:
   entity=climada_entity_load
   climada_entity_plot(entity); % standard use
   climada_entity_plot; % interactively select
   params=climada_entity_plot('params') % return parameters
   params.year_i=1;params.max_value=-1;params.plot_log_value=1;
   climada_entity_plot(entity,2,params) % today, if entity contains Values
   params.plot_population=1;params.year=2030;climada_entity_plot(entity,2,params) % population for year 2030
 INPUTS:
   entity: an entity (see climada_entity_read)
       &ampgt promted for if not given
       if ='params', just return default parameters
 OPTIONAL INPUT PARAMETERS:
   markersize: the size of the 'tiles', one might need to experiment a
       bit (that's why markersize is not part of params.), as the code
       tries (hard) to set a reasonabls default (based on resolution).
       If &amplt0, plot ocean blue and land grey (looks nicer, but takes a bit longer)
   params: a structure with fields (see also entity='params' above):
    plot_centroids: =1: plot centroids as small red dots
       =0: do not plot centroids (default)
    max_value: the maximum value to color, default is max(entity.assets.Value)
       if =-1, use largest Value in entity.assets.Values, instead of .Value
    cbar_ylabel: label for the color bar, default 'Value'
       if empty, indicate entity value locations by black circles, e.g. for
       climada_hazard_plot(hazard);hold on;climada_entity_plot(entity,1,0,[],'')
    year: the year we'd like to plot, if entity.assets.Values and .Values_yyyy
       exist, to plot year instead of the first year (just passes on to
       year_i=-year, i.e. year overrides year_i). Default=[];
    year_i: the year index, if entity.assets.Values and .Values_yyyy
       exist, to plot year_i instead of the data in entity.assets.Value
       If negative, search for abs(year_i) in
       Values_yyyy to plot the corresponding year (on output, params.year_i
       contains the index, not the year any more. See also params.year,
       which overrides year_i).
    title_str: the title of the plot, if empty, use contents of
       entity.assets to define it
    plot_log_value: if =1, plot log(entity.assets.Value), default=0
    plot_population: if =1, plot Population instead of Values, otherwise
       same as for Values (default=0, plot Value(s))
    blue_ocean: plot ocean bliue, if =1 (default=0, since faster)
 OUTPUTS:
   params: the params structure, filled wit defaults, see
   a figure
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141121, ICE initial
 David N. Bresch, david.bresch@gmail.com, 20160514, max_value,cbar_ylabel added
 David N. Bresch, david.bresch@gmail.com, 20160516, added climada_figure_scale_add
 David N. Bresch, david.bresch@gmail.com, 20160516, added option empty cbar_ylabel plus cleanup
 David N. Bresch, david.bresch@gmail.com, 20161001, check for all Values=NaN added
 David N. Bresch, david.bresch@gmail.com, 20161022, markersize&amplt0 allowed
 David N. Bresch, david.bresch@gmail.com, 20161023, land color defined in PARAMETERS
 David N. Bresch, david.bresch@gmail.com, 20161121, check for sum(Values)=0
 David N. Bresch, david.bresch@gmail.com, 20170204, params introduced, and year_i
 David N. Bresch, david.bresch@gmail.com, 20170208, year introduced
 David N. Bresch, david.bresch@gmail.com, 20170213, title correct if _
 David N. Bresch, david.bresch@gmail.com, 20170217, plot_population
 David N. Bresch, david.bresch@gmail.com, 20170423, blue_ocean
 David N. Bresch, david.bresch@gmail.com, 20170504, blue_ocean default =0
 David N. Bresch, david.bresch@gmail.com, 20170721, year_i treatment switched and currency_unit introduced
 David N. Bresch, david.bresch@gmail.com, 20170729, currency_unit fixed
View <A HREF=file:../../climada/code/climada_entity_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_read">
<H2>climada_entity_read</H2></A>
<font color="blue">function [entity,entity_save_file] = climada_entity_read(entity_filename,hazard,force_read) </font>
 climada entity import, read assets, damagefunctions, discount and measures
 NAME:
   climada_entity_read
 PURPOSE:
   read the file with the assets, damagefunctions, measures, discount and
   names tabs. Calls climada_assets_read, climada_damagefunctions_read,
   climada_measures_read and climada_discount_read. climada_assets_encode
   and climada_measures_encode are automatically invoked.

   The code invokes climada_spreadsheet_read to really read the data,
   which implements .xls, .xlsx and .ods files

   To test this code, use entity_template.xls, entity_template.xlsx or
   entity_template.ods. ADVANCED use: entity_template_ADVANCED.xlsx (.ods)

   For .xls and .xslx the sheet names are dynamically checked, for .ods, the sheet
   names are hard-wired (see code), means for .ods, at least the sheets
   'assets', 'damagefunctions', 'measures' and 'discount' need to exist.

   NOTE: For backward compatibility, the code does read OLD entity files
   with a tab vulnerability (instead of damagefunctions) and VulnCurveID ...
   It renames respective fields in the resulting entity structure.

   OCTAVE: Please install the io package first, ether directly from source
   forge with: pkg install -forge io -auto
   or, (e.g. in case this fails, get the io package first from Octave
   source forge and then install from the downloaded package:
   pkg install {local_path}/io-2.2.5.tar -auto
   Note that it looks like Octave prefers .xlsx files
   If this fails, consider https://github.com/davidnbresch/Octave_io_fix

   next step: likely climada_ELS_calc
 CALLING SEQUENCE:
   [entity,entity_save_file] = climada_entity_read(entity_filename,hazard,force_read)
 EXAMPLE:
   entity=climada_entity_read('entity_template','TCNA_today_small',1);
   entity=climada_entity_read('entity_template_ADVANCED','TCNA_today_small',1);
 INPUTS:
   entity_filename: the filename of the Excel (.xls, .xlsx or .ods) file with the assets
       If no path provided, default path ../data/entities is used
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       &ampgt promted for if not given (out of climada_assets_encode)
       ='NOENCODE' or 'noencode': do not encode assets, see climada_assets_encode
   force_read: if =1, force reading from the Excel file, do NOT use the
       possibly already existing .mat file (climada does alaways read from
       Excel in case the Excal has been edited since last time read).
       Default=0.
 OUTPUTS:
   entity: a structure, with (please run the first example above and then
       inspect entity for the latest content)
       assets: itself a structure, with
           lat: [1xn double] the latitude of the values
           lon: [1xn double] the longitude of the values
           Value: [1xn double] the total insurable value
           Value_unit: {1xn cell}
           Deductible: [1xn double] the deductible, default=0
           Cover: [1xn double] the cover, defualt=Value
           DamageFunID: [1xn double] the damagefunction curve ID
           filename: the filename the content has been imported from
           Category_ID: [1xn double] the category ID, see also entity.names
           Region_ID: [1xn double] the region ID, see also entity.names
           reference_year: [double] the year the assets are valid for
           centroid_index: [1xn double] the centroids the assets have been
               encoede to (unless you specifiec 'NOENCODE') 
           hazard: only present if you did encode, itself a struct with
               filename: the filename with path to the hazard you used
               comment: the free comment as in hazard.comment
       damagefunctions: itself a structure, with
           DamageFunID: [nx1 double] the damagefunction curve ID
           Intensity: [nx1 double] the hazard intensity
           MDD: [nx1 double] the mean damage degree (severity of single asset damage)
           PAA: [nx1 double] the percentage of assets affected
           peril_ID: {nx1 cell} the peril_ID (such as 'TC', 'EQ')
           Intensity_unit: {nx1 cell} the intensity unit (such as 'm/s', 'MMI')
           name: {nx1 cell} a free name, eg. 'TC default'
           datenum: [nx1 double] the datenum of this record being last
               modified (set to import date)
       measures: itself a structure, with
           name: {nx1 cell} the (free) name of the measure
           color: {nx1 cell} the color as RGB triple (e.g. '0.5 0.5 0.5')
               to color the measure for display purposes
           color_RGB: [nx3 double] the color converted from a string as in
               color to RGB values as double
           cost: [nx1 double] the cost of the measure. Make sure it is the
               same units as assets.Value ;-)
           hazard_intensity_impact_a: [nx1 double] the a parameter to
               convert hazard intensity, i.e. i_used=i_orig*a+b
           hazard_intensity_impact_b: [nx1 double] the b parameter to
               convert hazard intensity, i.e. i_used=i_orig*a+b
           hazard_high_frequency_cutoff: [nx1 double] the frequency
           cutoff, i.e. set =1/30 to signify a measure which avoids any
               damage up to 30 years of return period
           hazard_event_set: {nx1 cell} to provide an alternative hazard
               event set for a specific measure (advanced use only)
           MDD_impact_a: [nx1 double] the a parameter to
               convert MDD, i.e. MDD_used=MDD_orig*a+b
           MDD_impact_b: [nx1 double] the b parameter to
               convert MDD, i.e. MDD_used=MDD_orig*a+b
           PAA_impact_a: [nx1 double] the a parameter to
               convert PAA, i.e. PAA_used=PAA_orig*a+b
           PAA_impact_b: [nx1 double] the b parameter to
               convert PAA, i.e. PAA_used=PAA_orig*a+b
           damagefunctions_map: {nx1 cell} to map to an alternative damage
               function, contains elements such as '1to3;4to27' which means
               map DamageFunID 1 to 3 and 4 to 27 to implement the impact of
               the measure
           damagefunctions_mapping: [1xn struct] the machine-readable
               version of damagefunctions_map, with fields
               damagefunctions_mapping(i).map_from: the (list of)
               DamageFunIDs to map from, i.e. =[1 4] for the example above
               damagefunctions_mapping(i).map_to: the (list of)
               DamageFunIDs to map to, i.e. =[3 27] for the example above
           peril_ID: {nx1 cell} the peril the respective measure applies
               to (to allow for a multi-peril analysis driven by one entity
               file - the user still needs to run climada_measures_impact for
               each peril separately
           damagefunctions: a full damagefunctions struct (as decribed
               above), which gets 'switched to' when calculating measure's
               impacts (see code climada_measures_impact). It is usally a
               copy of entity.damagefunctions (as the entity file read for
               measures does cntain a tab damagefunctions, hence gets read
               again, does no harm...)
           risk_transfer_attachement: [nx1 double] the attachement point
               for risk transfer
           risk_transfer_cover: [nx1 double] the cover for risk transfer
           filename: the filename the content has been imported from
           Region_ID: [nx1 double] NOT USED currently, see remark for regional_scope
           assets_file: {nx1 cell} NOT USED currently, see remark for assets_file
           /regional_scope/: (only supported in earlier climada release 2)
               if assets tab found wich specifies the regional_scope of a measure 
           /assets_file/: (only supported in earlier climada release 2)
               to provide assets for a regional scope
       discount: a structure, with
           yield_ID: an ID to implement several yield curves (not supported yet, default=1)
           year: the year a particular discount rate is valid for. If you
               use a constant discount rate, just provide the same number for
               each year (as in the template).
           discount_rate: the discount_rate (e.g. 0.02 for 2%, but you can
               format the cell as percentage in Exel - but not in .ods) per year 
   entity_save_file: the name the encoded entity got saved to
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090920
 Lea Mueller, 20110720
 David N. Bresch, david.bresch@gmail.com, 20130328, vuln_MDD_impact -&ampgt MDD_impact ...
 David N. Bresch, david.bresch@gmail.com, 20141029, entity_save_file added as output
 David N. Bresch, david.bresch@gmail.com, 20141121, hint to climada_damagefunction_read added
 David N. Bresch, david.bresch@gmail.com, 20141221, damagefunctions.MDR removed and NOENCODE added
 David N. Bresch, david.bresch@gmail.com, 20141230, cleanup
 David N. Bresch, david.bresch@gmail.com, 20150101, Octave compatibility (at least for .xlsx)
 David N. Bresch, david.bresch@gmail.com, 20150805, allow for name without path on input
 David N. Bresch, david.bresch@gmail.com, 20150829, check for valid/correct entity.assets.filename
 Lea Mueller, muellele@gmail.com, 20150831, assign assets.Value_unit with climada_global.Value_unit if not given
 Lea Mueller, muellele@gmail.com, 20150907, add damagefunctions check and measures check
 Lea Mueller, muellele@gmail.com, 20150908, add assets even it not encoded
 Lea Mueller, muellele@gmail.com, 20151016, delete nans if there are invalid entries
 Lea Mueller, muellele@gmail.com, 20151119, call climada_assets_read, climada_damagefunctions_read, climada_measures_read, climada_discount_read
 David N. Bresch, david.bresch@gmail.com, 20151229, old commented code deleted (finish 20151119 update)
 Lea Mueller, muellele@gmail.com, 20160523, complete extension, if missing
 David N. Bresch, david.bresch@gmail.com, 20160524, allow for entity without assets (e.g. called from nightlight entity)
 David N. Bresch, david.bresch@gmail.com, 20160908, entities_dir used
 David N. Bresch, david.bresch@gmail.com, 20160919, reading tab names added
 David N. Bresch, david.bresch@gmail.com, 20160920, try .xlsx if .xls not found, documentation updated
View <A HREF=file:../../climada/code/climada_entity_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_load">
<H2>climada_hazard_load</H2></A>
<font color="blue">function hazard=climada_hazard_load(hazard) </font>
 climada
 NAME:
   climada_hazard_load
 PURPOSE:
   load a hazard event set (just to avoid typing long paths and
   filenames in the command window)

    the code checkes wehther hazard.filename is current (if loaded from a
    file) and updates, if necessary

    if loading a hazard, the code checks whether a field hazard.fraction
    exists. If not, it is added to the hazard and the .mat file is updated
    (speeds up EDS calc)

   next call: climada_EDS_calc, climada_hazard_plot
 CALLING SEQUENCE:
   hazard=climada_hazard_load(hazard)
 EXAMPLE:
   hazard=climada_hazard_load(hazard)
 INPUTS:
   hazard: the filename (and path, optional) of a previously saved hazard
       event set. If no path provided, default path ../data/hazards is used
       (and name can be without extension .mat)
       &ampgt promted for if empty
       OR: a hazard structure, in which cas it is just returned (to allow
       calling climada_hazard_load anytime, see e.g. climada_EDS_calc)
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   hazard: a struct, see e.g. climada_tc_hazard_set
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20140302
 David N. Bresch, david.bresch@gmail.com, 20150804, allow for name without path on input
 David N. Bresch, david.bresch@gmail.com, 20150820, check for correct filename
 Lea Mueller, muellele@gmail.com, 20151127, enhance to work with complete hazard as input
 Lea Mueller, muellele@gmail.com, 20151127, set hazard_file to empty if a struct without .lon
 David N. Bresch, david.bresch@gmail.com, 20160202, speedup if hazard structure passed
 David N. Bresch, david.bresch@gmail.com, 20160527, climada_hazard2octave added
 David N. Bresch, david.bresch@gmail.com, 20160916, hazards_dir used
 David N. Bresch, david.bresch@gmail.com, 20161008, check for ishazard
 David N. Bresch, david.bresch@gmail.com, 20161008, hazard.fraction added
View <A HREF=file:../../climada/code/climada_hazard_load.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_init_vars">
<H2>climada_init_vars</H2></A>
<font color="blue">function ok=climada_init_vars(reset_flag) </font>
 init variables global
 NAME:
	climada_init_vars
 PURPOSE:
	initialize path and filenames

 CALLING SEQUENCE:
	ok=climada_init_vars(reset_flag)
 EXAMPLE:
	ok=climada_init_vars;
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   reset_flag: if set to 1, forced re-init
       =3 to ONLY set sub-folders of climada_global.data_dir relative
       again (i.e. if one switches climada_global.data_dir and wants to
       make sure folders sich as climada_global.entities_dir are
       sub-folders of it).
 OUTPUTS:
	ok: =1 if no troubles, 0 else
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120430
 David N. Bresch, david.bresch@gmail.com, 20130316, EDS-&ampgtEDS...
 David N. Bresch, david.bresch@gmail.com, 20130623, re_check_encoding
 Lea Mueller, muellele@gmail.com, 20140211, start year set to 2014
 David N. Bresch, david.bresch@gmail.com, 20141018, switch to modules instead of climada_additional
 David N. Bresch, david.bresch@gmail.com, 20141225, climada_global.coastline_file added
 David N. Bresch, david.bresch@gmail.com, 20141226, update to be in line with manual
 David N. Bresch, david.bresch@gmail.com, 20141231, octave compatibility
 David N. Bresch, david.bresch@gmail.com, 20150126, csv_delimiter depends on computer
 David N. Bresch, david.bresch@gmail.com, 20150203, climada_lonlat_cleanup
 David N. Bresch, david.bresch@gmail.com, 20150211, global_CAGR added
 Lea Mueller, muellele@gmail.com, 20150728, add project directory,i.e. now set to San Salvador
 Lea Mueller, muellele@gmail.com, 20150728, set waitbar to 0
 David N. Bresch, david.bresch@gmail.com, 20150805, project_dir NOT possible to set here, set to default data dir
 David N. Bresch, david.bresch@gmail.com, 20150805, climada_demo_gui parameters set here
 David N. Bresch, david.bresch@gmail.com, 20150807, climada_global.tc.extratropical_transition
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 Lea Mueller, muellele@gmail.com, 20150831, introduce climada_global.Value_unit
 David N. Bresch, david.bresch@gmail.com, 20150906, climada_global.font_scale
 Lea Mueller, muellele@gmail.com, 20150924, introduce climada_global.max_distance_to_hazard
 Lea Mueller, muellele@gmail.com, 20151204, introduce climada_global.markersize, for climada_color_plot and plotclr
 David N. Bresch, david.bresch@gmail.com, 20160222, entities_dir added
 Lea Mueller, muellele@gmail.com, 20160225, introduce climada_global.marker, for climada_color_plot and plotclr
 Lea Mueller, muellele@gmail.com, 20160229, introduce climada_global.admin1_plot, default is 0, do not show admin1 lines, for climada_color_plot
 David N. Bresch, david.bresch@gmail.com, 20160411, climada_global.present_reference_year = 2016
 David N. Bresch, david.bresch@gmail.com, 20160429, Value_* extended and cost_* added
 David N. Bresch, david.bresch@gmail.com, 20160429, climada_lonlat_cleanup and climada_centroids_cleanup switched off
 David N. Bresch, david.bresch@gmail.com, 20160606, max_encoding_distance_m (renamed from max_distance_to_hazard) set to 1e5, not 1e6 any more
 David N. Bresch, david.bresch@gmail.com, 20160819, hazards_dir added
 David N. Bresch, david.bresch@gmail.com, 20160908, results_dir added and reset_flag=3
 David N. Bresch, david.bresch@gmail.com, 20160921, default spreadsheet_ext='.xlsx' (best for MATLAB 9.x)
 David N. Bresch, david.bresch@gmail.com, 20170107, EDS_at_centroid renamed to damage_at_centroid
 David N. Bresch, david.bresch@gmail.com, 20170202, parfor
 David N. Bresch, david.bresch@gmail.com, 20170413, save_file_version
 David N. Bresch, david.bresch@gmail.com, 20170730, save_file_version for Octave compatibility
View <A HREF=file:../../climada/code/climada_init_vars.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_impact">
<H2>climada_measures_impact</H2></A>
<font color="blue">function measures_impact=climada_measures_impact(entity,hazard,measures_impact_reference,measures,map_risk_premium,sanity_check) </font>
 climada
 NAME:
   climada_measures_impact
 PURPOSE:
   calculate the impact of a series of measures on a given set of assets
   under a given hazard, main functions called are climada_EDS_calc and
   climada_measures_impact_discount

   next step: climada_adaptation_cost_curve or
   climada_adaptation_event_view

   Note on display units: consider using climada_digit_set to infer good
   values for measures_impact.Value_display_unit_name
   (measures_impact.Value_display_unit_fact) and
   measures_impact.cost_display_unit_name (measures_impact.cost_display_unit_fact)

   see also: climada_measures_impact_parametric

   Note: the risk premiums show need to be handled with UTMOST care, as
   they are proxies of real risk premiums. First, the total climate risk
   premium is calculated as NPV of total climate risk divided by the sum
   of all assets (that simple), hence it does not really reperesent a
   premium that one would i.e. charge to cover these risks over the course
   of a year (since it's the NPV...). The total climate risk premium
   reduction provides an upper bound of the risk premium reduction due to
   the cost-effective measures, since any further csosts, such as
   distribution, claims handling and capital costs are not considered at
   all. Second, the risk premiums mapped (if map_risk_premium=1) are calculated
   as the expected damage at each centroid divided by the asset value at
   this centroid, hence are again a CRUDE PROXY. Again, the difference of
   the fgu and net values is more telling than the absolute numbers.
 CALLING SEQUENCE:
   measures_impact=climada_measures_impact(entity,hazard,measures_impact_reference,measures)
 EXAMPLE:
   measures_impact=climada_measures_impact % all prompted for
   hazard_set_file='...\climada\data\hazards\TCNA_A_Probabilistic.mat';
   measures_impact=climada_measures_impact(climada_entity_read('',hazard_set_file),hazard_set_file,'no')
   measures_impact=climada_measures_impact('','','','',1) % all interactive, show risk premium map
 INPUTS:
   entity: a read and encoded assets and damagefunctions file, see climada_assets_encode(climada_assets_read)
       &ampgt promted for if not given
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   measures_impact_reference: reference measures (e.g. portfolio today and
       measures today). Used to properly calculate the net present values
       of future impacts
       set to 'no' if you would not like to be asked for a reference
   measures: either a struct containing the measures or a measures set file (.mat with a struct)
       see climada_measures_read.
       A bit complex:
       If measures is empty (not provided), it is taken from entity.measures (in case entity
           contains measures). If entity does not contain measures, user gets prompted for.
       If user provides measures, these measures are used
       If user set measures to 'ASK', he gets prompted for and these are used
   map_risk_premium: whether we show a plot (=1) of risk premium at each
       centroid using a contour plot on a map, with cost-effective
       measures and without any measures(fgu). Default=0 
       Please note that this risk premium is a proxy for a real premium,
       as it just consistes of the expected damage at each centroid.
 OUTPUTS:
   measures_impact: a structure with
       EDS(measure_i): the event damage set for each measure, last one EDS(end) for no measures
       ED(measure_i): the annual expected damage to the assets under measure_i,
           last one ED(end) for no measures
       benefit(measure_i): the benefit of measure_i
       cb_ratio(measure_i): the cost/benefit ratio of measure_i
       measures: just a copy of measures, so we have all we need together
       title_str: a meaningful title, of the format: measures @ assets | hazard
       NOTE: currently measures_impact is also stored (with a lengthy filename)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091228
 David N. Bresch, david.bresch@gmail.com, 20130316, ELS-&ampgtEDS...
 David N. Bresch, david.bresch@gmail.com, 20130328, vuln_MDD_impact -&ampgt MDD_impact...
 David N. Bresch, david.bresch@gmail.com, 20130623, hazard set switch added
 David N. Bresch, david.bresch@gmail.com, 20140509, non-linear damage time dependency implemented
 David N. Bresch, david.bresch@gmail.com, 20140509, risk premium calc added
 David N. Bresch, david.bresch@gmail.com, 20140510, risk premium map added
 David N. Bresch, david.bresch@gmail.com, 20141220, re-encoding check added
 David N. Bresch, david.bresch@gmail.com, 20150101, cleanup
 Gilles Stassen, gillesstassen@hotmail.com, 20150626, if exist(hazard_file,'var') -&ampgt exist('hazard_file','var')
 Lea Mueller, muellele@gmail.com, 20150831, introduce measures_impact.Value_unit
 Lea Mueller, muellele@gmail.com, 20150902, rename to hazard_intensity_impact_b from hazard_intensity_impact
 Lea Mueller, muellele@gmail.com, 20150902, call climada_measures_impact_discount in an separate function
 David N. Bresch, david.bresch@gmail.com, 20150907, hazard_intensity_impact_a and hazard_intensity_impact_b properly implemented
 Lea Mueller, muellele@gmail.com, 20150907, add variable sanity_check to perform a safety check within climada_EDS_calc, add climada_measures_check
 Lea Mueller, muellele@gmail.com, 20150908, switch assets if needed (defined in measures.assets_file)
 Lea Mueller, muellele@gmail.com, 20150915, add regional scope of measures
 Lea Mueller, muellele@gmail.com, 20150921, add measures check to ensure size of regional_scope is aligned with number of assets
 Lea Mueller, muellele@gmail.com, 20150921, save entity as .mat if assets are switched (in entity.assets.filename)
 Lea Mueller, muellele@gmail.com, 20151127, add measures_impact.scenario
 Lea Mueller, muellele@gmail.com, 20151130, invoke climada_hazard_load and climada_entity_load
 David N. Bresch, david.bresch@gmail.com, 20160429, automatic determination of display units
 David N. Bresch, david.bresch@gmail.com, 20160429, title_str without measures name
 David N. Bresch, david.bresch@gmail.com, 20160606, display units synchronized if same unit_name
 David N. Bresch, david.bresch@gmail.com, 20170416, comprehensive chech for encoded entity
View <A HREF=file:../../climada/code/climada_measures_impact.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_impact_parametric">
<H2>climada_measures_impact_parametric</H2></A>
<font color="blue">function measures_impact=climada_measures_impact_parametric(measures_impact,index_def) </font>
 climada template
 MODULE:
   core
 NAME:
   climada_measures_impact_parametric
 PURPOSE:
   Add parametric insurance to measures. Define index payout (attachement,
   cover or exit, tick value) and the centroid_ID at which the hazard is
   being evaluated.

   previous call: climada_measures_impact
   next call: climada_adaptation_cost_curve

   TEST settings:
   climada_demo_step_by_step % run this to get a reasonable measures_impact structure
   index_def.attachement=40;index_def.cover=30;index_def.tick_value=1.0000e+09;
   index_def.centroid_index=50;
   measures_impact=climada_measures_impact_parametric(measures_impact,index_def)
   climada_adaptation_event_view(measures_impact,[10,150,1500])
 CALLING SEQUENCE:
   measures_impact=climada_measures_impact_parametric(measures_impact,index_def)
 EXAMPLE:
   measures_impact=climada_measures_impact_parametric(climada_measures_impact)
 INPUTS:
   measures_impact: the output from climada_measures_impact
   index_def: the parametric index definition, with fields (in the
       metric of the pertinent hazard intensity)
       attachement: the attachement point
       cover: the cover (if missing, calculated from exit)
       exit: the exit (if missing, calculated from cover)
       tick_value: the payout per unit, default=1 (in the monetary unit)
       centroid_ID: the centroid ID (in the hazard set) at which the index
           insurance is evaluated or
       centroid_index: the index (in the hazard set) at which the index
           insurance is evaluated. If both centroid_ID and centroid_index
           are passed, centroid_index is used
       markup: the multiplier to get to cost, default=2
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20151021, intial
View <A HREF=file:../../climada/code/climada_measures_impact_parametric.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_guess">
<H2>climada_tc_guess</H2></A>
batch code climada_tc_guess
 climada template
 MODULE:
   core
 NAME:
   climada_tc_guess
 PURPOSE:
   bring up the GUI to calculate event damages.

   Given a single track file, calculate the damage for all countries
   posibbly hit (i.e. at least one node within country boders)

   Plus generate ensemble 'forecast' damage

   Fetches data from: weather.unisys.com/hurricane, but since the format
   and layout of the webpage changed, it only works back to about 2006...
   earier years will,likely lead to errors. In such cases, retrieve the TC
   track file manually and run the code by passing the track file in the
   first variable (UNISYS_regi)

   Just a wrapper for climada_tc_event_damage_ens_gui
 CALLING SEQUENCE:
   climada_tc_guess
 EXAMPLE:
   climada_tc_guess
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   GUI
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161009
View <A HREF=file:../../climada/code/climada_tc_guess.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_hazard_set">
<H2>climada_tc_hazard_set</H2></A>
<font color="blue">function hazard = climada_tc_hazard_set(tc_track,hazard_set_file,centroids,verbose_mode) </font>
 climada TC hazard event set generate
 NAME:
   climada_tr_hazard_set
 PURPOSE:
   generate a tc (tropical cyclone) hazard event set

   If centroids.distance2coast_km exists, the hazard intensity is only
   calculated in the coastal_range_km (usually 200km, see PARAMETERS in
   climada_tc_windfield) - this speeds up calculation for large countries
   considerably.

   Special: the hazard event set is stored every 100 tracks in order to
   allow for interruption of the hazard set generation. Just re-start the
   calculation by calling climada_tr_hazard_set with exactly the same
   input parameters (the last track calculated is stored in hazard.track_i
   and the field track_i is removed in the final complete hazard event set).
   Therefore, if you get errors such as
       Subscripted assignment dimension mismatch.
       Error in climada_tr_hazard_set (line 270) % ... or nearby
       hazard.intensity(track_i,:)     = res.gust;
   It is VERY likely that you changed something between subsequent calls
   (i.e. different centroids). Just delete the hazard set .mat file and run
   climada_tr_hazard_set again.

   NOTE: this code listens to climada_global.parfor for substantial speedup

   previous: isimip_tc_track_load and likely climada_random_walk
   next: diverse
   see also: job_isimip01 (to run this massively parallel on cluster)
 CALLING SEQUENCE:
   res=climada_tr_hazard_set(tc_track,hazard_set_file,centroids,verbose_mode)
 EXAMPLE:
   tc_track=climada_tc_track_load('TEST_tracks.atl_hist');
   centroids=climada_centroids_load('USFL_MiamiDadeBrowardPalmBeach');
   %centroids=climada_entity_load('USA_UnitedStatesFlorida'); % works, too
   hazard=climada_tc_hazard_set(tc_track,'_TC_TEST',centroids);
   climada_global.parfor=1; % switch to parallel mode
   hazard=climada_tc_hazard_set(tc_track,'_TC_TEST_PARFOR',centroids);
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   tc_track: a TC track structure, or a filename of a saved one
       details: see e.g. climada_tc_random_walk
       &ampgt promted for if not given
   hazard_set_file: the name (and path, optional) of the hazard set file
       If no path provided, default path ../data/hazards is used (and name
       can be without extension .mat). If ='NOSAVE', the hazard set is not
       saved (but returned as output)
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           lon(1,:): the longitudes
           lat(1,:): the latitudes
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a .mat-file which contains a centroids struct (saved by
       climada_centroids_read) or the filename of an Excel file (the original
       input to climada_centroids_read) which holds the centroids, in
       which case climada_centroids_read is called.
       OR: an entity, in which case the entity.assets.lat and
       entity.assets.lon are used as centroids.
       &ampgt promted for .mat or .xls filename if not given
       NOTE: if you then select Cancel, a regular default grid is used, see hard-wired definition in code
   verbose_mode: default=1, =0: do not print anything to stdout
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       intensity(event_i,centroid_i), sparse: the hazard intensity of
           event_i at centroid_i
       frequency(event_i): the frequency of each event
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
       tropical cyclone or 'ET' for extratropical cyclone
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       matrix_density: the density of the sparse array hazard.intensity
       windfield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20090729
 david.bresch@gmail.com, 20130506, centroids filename handling improved
 david.bresch@gmail.com, 20140421, waitbar with secs
 david.bresch@gmail.com, 20141226, optional fields in centroids added
 david.bresch@gmail.com, 20150103, equal_timestep (much) improved
 muelleleh@gmail.com, 20150420, include tc category into hazard structure
 david.bresch@gmail.com, 20150804, allow for filename without path for hazard set name on input
 david.bresch@gmail.com, 20150819, climada_global.centroids_dir
 david.bresch@gmail.com, 20150824, removed 'TCNA' from hazard.comment
 david.bresch@gmail.com, 20150906, note on a frequent issue added to header
 david.bresch@gmail.com, 20151008, NOSAVE option added
 muelleleh@gmail.com, 20151127, add hazard.scenario, default is 'no climate change'
 david.bresch@gmail.com, 20160514, -v7.3 in save added
 david.bresch@gmail.com, 20160529, fast parfor version, about twenty times faster
 david.bresch@gmail.com, 20160603, header: comment added
 david.bresch@gmail.com, 20161008, hazard.fraction added
 david.bresch@gmail.com, 20161023, noparfor and verbose_mode added
 david.bresch@gmail.com, 20170202, noparfor -&ampgt climada_global.parfor
 david.bresch@gmail.com, 20170418, climada_global.save_file_version
 david.bresch@gmail.com, 20170524, climada_progress2stdout
View <A HREF=file:../../climada/code/climada_tc_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_hazard_set_exercise">
<H2>climada_tc_hazard_set_exercise</H2></A>
<font color="blue">function hazard = climada_tc_hazard_set_exercise(tc_track, hazard_set_file, centroids) </font>
 climada TC hazard event set generate
 NAME:
   climada_tc_hazard_set_exercise
 PURPOSE:
   generate a tc (tropical cyclone) hazard event set

   previous: likely climada_random_walk
   next: diverse

   NOTE: code for demonstration purposes (e.g. lecture), see 
   climada_tc_windfield for the operational code

 CALLING SEQUENCE:
   res=climada_tc_hazard_set_exercise(tc_track,hazard_set_file)
 EXAMPLE:
   res=climada_tc_hazard_set_exercise(tc_track)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   tc_track: a TC track structure, or a filename of a saved one
       details: see e.g. climada_tc_random_walk
       &ampgt promted for if not given
   hazard_set_file: the name of the hazard set file
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           Longitude(1,:): the longitudes   
           Latitude(1,:): the latitudes   
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a file which contains the struct (saved after climada_centroids_read)
       if you select Cancel, a regular default grid is used, see hard-wired definition in code
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
       tropical cyclone or 'ET' for extratropical cyclone
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event
       matrix_density: the density of the sparse array hazard.intensity
       windfield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090729
 David N. Bresch, david.bresch@gmail.com, 20120404 copy from climada_tc_hazard_set
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir
View <A HREF=file:../../climada/code/climada_tc_hazard_set_exercise.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_random_walk">
<H2>climada_tc_random_walk</H2></A>
<font color="blue">function tc_track_out=climada_tc_random_walk(tc_track,ens_size,ens_amp,Maxangle,check_plot) </font>
 TC event set random walk probabilistic
 NAME:
   climada_tc_random_walk
 PURPOSE:
   given a tc_track structure, create ens_size varied derived tracks based on
   directed random walk

   NOTE see PARAMETER section to change parameters
   (e.g. ens_amp0,ens_amp,Maxangle)

   previous step: see climada_tc_read_unisys_database
   next step: see climada_tc_hazard_set
 CALLING SEQUENCE:
   tc_track=climada_tc_random_walk(tc_track,ens_size);
 EXAMPLE:
   tc_track=climada_tc_read_unisys_database('atl');
   tc_track=climada_tc_random_walk(tc_track);
 INPUTS:
   tc_track: a structure with the track information for each cyclone i at
       each node j, see climada_read_unisys_database for a detailed
       description
 OPTIONAL INPUT PARAMETERS:
   ens_size: create ens_size varied derived tracks, default 9 
       (means for each original track, 9 daughter tracks are generated)
   ens_amp: amplitude of random walk wiggles in degree longitude for
       'directed', default 0.35. Be careful when changing, test with one track and plot, e.g.
       climada_tc_random_walk(tc_track(1),9,ens_amp,[],1)
   Maxangle: the angle the track direction can change for one timestep
       default=pi/7. Be careful when changing, test with one track and plot, e.g.
       climada_tc_random_walk(tc_track(1),9,[],Maxangle,1)
   check_plot: whether we show a check plot (=1) or not (=0), default=0
 OUTPUTS:
   same structure now including the ens_size times number of tracks
   all the info from the original tracks is copied, only the lat, lon
   differs
 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090728
 Markus Huber, markus.huber@env.ethz.ch, 20100412
 Omar Bellprat, mar.bellprat@env.ethz.ch, 20100412, Maxangle added as input
 David N. Bresch, david.bresch@gmail.com, 20160423, rng(0) instead of rand('seed',0)
 David N. Bresch, david.bresch@gmail.com, 20160809, rand('seed',0) for Octave
 David N. Bresch, david.bresch@gmail.com, 20160809, ens_amp (was 0.35) and Maxangle (was pi/7) reduced
 David N. Bresch, david.bresch@gmail.com, 20160821, rand('seed',0) from Ocatve editor was rand(&quotseed&quot,0) - grrr
 David N. Bresch, david.bresch@gmail.com, 20170108, abort if tc_track empty
View <A HREF=file:../../climada/code/climada_tc_random_walk.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_read_unisys_database">
<H2>climada_tc_read_unisys_database</H2></A>
<font color="blue">function [tc_track,tc_track_hist_file]=climada_tc_read_unisys_database(unisys_file,check_plot,no_save) </font>
 TC event set track database UNISYS
 NAME:
   climada_tc_read_unisys_database
 PURPOSE:
   read UNISYS database file, raw data file to be downloaded from
   http://weather.unisys.com/hurricane/index.html (see
   climada_tc_get_unisys_databases), filter the raw data, namely:
   - a VALID record (=node) is required to have lat, lon and either pressure
     or windspeed (so recrods with only geographical information are skipped)
   - pressure [mb] needs to be in the range 800..1100, otherwise set to
     NaN, windspeeds of zero are also set to NaN
   - longitudes are converted such that east is positive and that the
     coordinates within one region (basin) are uniform, means no jump from
     180 to -180 (done based on median longitude of basin database)
   - latitudes (always North in UNISYS data) are converted for Southern
     Hemipshere datasets, if the unisys_file contains 'she' or 'bsh' in the filename
     (see parameter  convert_latitude, she: southern hemisphere, bsh: best track southern hemisphere)

   NOTE: if the binary file (see tc_track_hist_file) containing tc_track
   exists, the code just returns tc_track. This allows for recurent calls
   to the code and results in substantial speed-up.
   If the binary file (see tc_track_raw_file) exists, reading of raw
   data is skipped. This allows faster iteration iro filtering (as often
   required, since raw data contains missing and errors).
   One needs to delete the binary files to re-read the raw ASCII data.

   Wind = Maximum sustained (1 minute) surface (10m) windspeed in knots
       (in general, these are to the nearest 5 knots). 
   Pressure = Central surface pressure of storm in mb (if available).
       Since 1979, central pressures are given everytime even if a
       satellite estimation is needed.  

   More info: http://weather.unisys.com/hurricane/atlantic/tracks_atl_readme.txt

   previous step: see climada_tc_get_unisys_databases
   next step: see climada_tc_random_walk

   See also: climada_tc_hurdat_read and climada_tc_jtwc_fetch
 CALLING SEQUENCE:
   tc_track=climada_tc_read_unisys_database(unisys_file,check_plot,no_save);
 EXAMPLE:
   tc_track=climada_tc_read_unisys_database('tracks.atl.txt');
 INPUTS:
   unisys_file: the filename of the raw databse file (as downloaded from
       UNISYS), prompted for, if not given
       If no path provided, default path ../data/tc_tracks is used, if the
       extension is missing, .txt is assumed, and if 'atl' is provided,
       the code checks also for 'tracks.atl.txt'
   see also PARAMETERS section, especially for filters
 OPTIONAL INPUT PARAMETERS:
   check_plot: if =1, show plots, =0 not (default)
       if=2, start from initial raw *.txt database file, re-generate the
       (intermediate) .mat files
   no_save: if =1, do not save as .mat file (default=0)
 OUTPUTS:
   tc_track: a structure with the track information for each cyclone i and
           data for each node j (times are at 00Z, 06Z, 12Z, 18Z):
       tc_track(i).lat(j): latitude at node j of cyclone i
       tc_track(i).lon(j): longitude at node j of cyclone i
       tc_track(i).MaxSustainedWind(j): Maximum sustained (1 minute)
           surface (10m) windspeed in knots (in general, these are to the nearest 5 knots).
       tc_track(i).MaxSustainedWindUnis, almost always 'kn'
           (others allowed: 'mph', 'm/s' or 'km/h')
       tc_track(i).CentralPressure(j): optional
       tc_track(i).CentralPressureUnit: 'mb'
       tc_track(i).yyyy: 4-digit year, optional
       tc_track(i).mm: month, optional
       tc_track(i).dd: day, optional
       tc_track(i).hh: hours
       tc_track(i).datenum:  matlab notation for date and time (see function datestr)
       tc_track(i).TimeStep(j)=time step [h] from this to next node
       tc_track(i).ID_no: unique ID, optional
       tc_track(i).name: name, optional
       tc_track(i).orig_event_flag: whether it is an mother(=1) or daugther(=0) storm

       Please note that a binary file of raw_data is stored (in the
       background). The raw_data is stored to ease (and speedup) re-reading the
       data. To really start from the raw text file again, please delete the
       binary file (*_raw.mat).

   tc_track_hist_file: the filename with path to the binary file
       tc_track is stored in (see NOTE above)

 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090728
 Joeri Rogelj, jr@env.ethz.ch, 20120429 / correct time step computation
 Reto Stockmann, 20120808 / added axes labels and limits
 Lea Mueller, 20120813, added overview of years in plot and codewort 'she'
 for southern hemisphere filename
 David N. Bresch, david.bresch@gmail.com, 20140221, world border plotted on top of tracks
 David N. Bresch, david.bresch@gmail.com, 20140922 (over the Atlantic, LX016), tc_track_hist_file as output added and storing processed as mat
 David N. Bresch, david.bresch@gmail.com, 20150805, allow for unisys_file without path on input
 David N. Bresch, david.bresch@gmail.com, 20150824, made fully consistent with jtwc and hurdat
 David N. Bresch, david.bresch@gmail.com, 20161017, check_plot=2 and filename completion
 David N. Bresch, david.bresch@gmail.com, 20170403, no_save
View <A HREF=file:../../climada/code/climada_tc_read_unisys_database.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_windfield">
<H2>climada_tc_windfield</H2></A>
<font color="blue">function gust = climada_tc_windfield(tc_track,centroids,~,silent_mode,~) </font>
 TC windfield calculation
 MODULE:
   core
 NAME:
   climada_tc_windfield
 PURPOSE:
   given a TC track (lat/lon,CentralPressure,MaxSustainedWind), calculate
   the wind field at locations (=centroids)

   mainly called from: see climada_tc_hazard_set

   Note: this code is optimized for speed, hence assumes that tc_track is
   free of missing data, climada_tc_equal_timestep applied and
   MaxSustainedWind calculated.

   PARFOR: this code does run with parfor, but it seems not to be faster
   at all (sine there seems to be lots of comms overhead to share tc_track
   between parallel processes) - see climada_tc_hazard_set for another
   PARFOR opportunity (we use it there, not here).

   See climada_tc_windfield_slow in the tropical cyclone module
   (https://github.com/davidnbresch/climada_module_tropical_cyclone)
   for the old slow version (for backward compatibility).

   Technical note: the ~ in the function defintion line are for backward
   compatibility

 CALLING SEQUENCE:
   gust=climada_tc_windfield(tc_track,centroids,'',silent_mode)
 EXAMPLE:
   tc_track=climada_tc_track_load('TEST_tracks.atl_hist');
   tc_track=climada_tc_equal_timestep(tc_track);
   centroids=climada_centroids_load('USFL_MiamiDadeBrowardPalmBeach');
   gust=climada_tc_windfield(tc_track(68),centroids); % Andrew, 1992
   climada_color_plot(gust,centroids.lon,centroids.lat);
 INPUTS:
   tc_track: a structure with the single track information (length(tc_track)!=1)
       see e.g. climada_tc_read_unisys_tc_track
       tc_track.Azimuth and/or tc_track.Celerity calculated, if not existing
       but climada_tc_equal_timestep mist have been run and
       tc_track.MaxSustainedWind must exist on input
   centroids: a structure with the centroids information (see e.g.
       climada_centroids_read):
       centroids.lat: the latitude of the centroids
       centroids.lon: the longitude of the centroids
 OPTIONAL INPUT PARAMETERS:
   silent_mode: default=0, if =-1, use step-by-step detailed windfield,
       i.e. reduce wind to zero at center of the eye (not recommended for
       probabilistic, since hit/miss issue with closest node, see variable
       max_wind_at_bullseye in code).
       Note: if length(tc_track.lon)=2 (i.e. two nodes) and
       silent_mode=-1, only use first node in order to return one single
       step windfield.  
 OUTPUTS:
   gust: the windfield [m/s] at all centroids, NOT sparse for speedup
       i.e. convert like hazard.intensity()=sparse(res.gust)...
 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090728
 David N. Bresch, david.bresch@gmail.com, 20150103, not faster than climada_tc_windfield any more
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 David N. Bresch, david.bresch@gmail.com, 20160529, about 20% faster than climada_tc_windfield_slow
 David N. Bresch, david.bresch@gmail.com, 20160529, only gust returned, even faster
 David N. Bresch, david.bresch@gmail.com, 20161205, Rmax parameters moved to PARAMETERS section
 David N. Bresch, david.bresch@gmail.com, 20161225, Celerity fixed (dipole)
 David N. Bresch, david.bresch@gmail.com, 20161226, further speedup, all to arrays, no struct in main loop
 David N. Bresch, david.bresch@gmail.com, 20170103, special case silent_mode=-1 for single node
 David N. Bresch, david.bresch@gmail.com, 20170216, CALLING SEQUENCE correct 
View <A HREF=file:../../climada/code/climada_tc_windfield.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_windfield_exercise">
<H2>climada_tc_windfield_exercise</H2></A>
<font color="blue">function [res,tc_track] = climada_tc_windfield_exercise(tc_track,centroids,~,silent_mode,~) </font>
 TC windfield calculation
 NAME:
   climada_tc_windfield_exercise
 PURPOSE:
   the EXERCISE version of climada_tc_windfield, used for lecture course,
   see www.iac.ethz.ch/edu/courses/master/modules/climate-risk.html

   given a TC track (lat/lon,MaxSustainedWind), calculate
   the wind field at locations (=centroids)

   mainly called from: see climada_tc_hazard_set

   Note: this code is optimized for speed, hence assumes that tc_track is
   free of missing data, climada_tc_equal_timestep applied and
   MaxSustainedWind calculated.

   PARFOR: this code does run with parfor, but it seems not to be faster
   at all (sine there seems to be lots of comms overhead to share tc_track
   between parallel processes) - see climada_tc_hazard_set for another
   PARFOR opportunity (we use it there, not here).

   See climada_tc_windfield_slow in the tropical cyclone module 
   (https://github.com/davidnbresch/climada_module_tropical_cyclone) 
   for the old slow version (for backward compatibility).

 CALLING SEQUENCE:
   [res,tc_track]=climada_tc_windfield_exercise(tc_track,centroids,~,silent_mode,~)
 EXAMPLE:
   tc_track=climada_tc_track_load('TEST_tracks.atl_hist');
   tc_track=climada_tc_equal_timestep(tc_track);
   centroids=climada_centroids_load('USFL_MiamiDadeBrowardPalmBeach');
   res=climada_tc_windfield_exercise(tc_track(68),centroids);
   climada_color_plot(res.gust,res.lon,res.lat);
 INPUTS:
   tc_track: a structure with the single track information (length(tc_track)!=1)
       see e.g. climada_tc_read_unisys_tc_track
       tc_track.Azimuth and/or tc_track.Celerity calculated, if not existing
       but climada_tc_equal_timestep mist have been run and
       tc_track.MaxSustainedWind must exist on input
   centroids: a structure with the centroids information (see e.g.
       climada_centroids_read):
       centroids.lat: the latitude of the centroids
       centroids.lon: the longitude of the centroids
 OPTIONAL INPUT PARAMETERS:
   silent_mode: default=0, if =-1, use step-by-step detailed windfield,
       i.e. reduce wind to zero at center of the eye (not recommended for
       probabilistic, since hit/miss issue with closest node, see variable
       max_wind_at_bullseye in code).  
 OUTPUTS:
   res.gust: the windfield [m/s] at all centroids, NOT sparse for speedup
       i.e. convert like hazard.intensity()=sparse(res.gust)...
   res.lon: the longitude of the centroids (=centroids.lon)
   res.lat: the latitude of the centroids (=centroids.lat)
   res.time: the time (sec) windfield calculation used
   tc_track: provided on output, to validate added fields, such as e.g.
       Azimuth and Celerity
 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090728
 David N. Bresch, david.bresch@gmail.com, 20150103, not faster than climada_tc_windfield any more
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 David N. Bresch, david.bresch@gmail.com, 20160529, about 20% faster than climada_tc_windfield_slow
View <A HREF=file:../../climada/code/climada_tc_windfield_exercise.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_viewer">
<H2>climada_viewer</H2></A>
<font color="blue">function varargout = climada_viewer(varargin) </font>
 climada_viewer MATLAB code for climada_viewer.fig
      climada_viewer, by itself, creates a new climada_viewer or raises the existing
      singleton*.

      H = climada_viewer returns the handle to a new climada_viewer or the handle to
      the existing singleton*.

      climada_viewer('CALLBACK',hObject,eventData,handles,...) calls the local
      function named CALLBACK in climada_viewer.M with the given input arguments.

      climada_viewer('Property','Value',...) creates a new climada_viewer or raises the
      existing singleton*.  Starting from the left, property value pairs are
      applied to the GUI before climada_viewer_OpeningFcn gets called.  An
      unrecognized property name or invalid value makes property application
      stop.  All inputs are passed to climada_viewer_OpeningFcn via varargin.

      *See GUI Options on GUIDE's Tools menu.  Choose &quotGUI allows only one
      instance to run (singleton)&quot.

 See also: GUIDE, GUIDATA, GUIHANDLES
View <A HREF=file:../../climada/code/climada_viewer.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_waterfall_graph">
<H2>climada_waterfall_graph</H2></A>
<font color="blue">function  fig = climada_waterfall_graph(EDS_today,EDS_dev,EDS_cc,return_period,check_printplot,legend_on) </font>
 NAME:
   climada_waterfall_graph
 PURPOSE:
   show waterfall plot expected damage for specific return period to
   compare
   - risk today (assets today, hazard today)
   - increase due to economic development (future assets, hazard today)
   - increase due to climate change (future assets, future hazard)

   previous call: climada_EDS_calc
 CALLING SEQUENCE:
   climada_waterfall_graph(EDS_today,EDS_dev,EDS_cc,return_period,check_printplot)
 EXAMPLE:
   climada_waterfall_graph
 INPUTS:
   EDS_today: event damage set for risk today (assets today, hazard today)
       usually generated by climada_EDS_calc
       if EDS_today is a struct with three elements, the code assumes
       EDS_today(1) to be real EDS today, EDS_today(2) to be EDS_dev and
       EDS_today(2) to be EDS_cc
       &ampgt prompted for if not provided (as saved EDS), but this is not
       recommended, as one easily mixes up EDSs.
   EDS_dev: event damage set for risk incl. econ. development (future assets, hazard today)
       &ampgt prompted for if not provided (as saved EDS), but this is not
       recommended, as one easily mixes up EDSs.
   EDS_cc: event damage set for risk incl. econ. dev. and climate change
       (future assets, future hazard)
       &ampgt prompted for if not provided (as saved EDS), but this is not
       recommended, as one easily mixes up EDSs.
 OPTIONAL INPUT PARAMETERS:
   return_period: the return period for which damages are shown, e.g. =100
       default (=9999) is annual expected damage (i.e. EDS.ED)
   check_printplot:if set to 1, figure saved, default 0.
       if =-1, avoid all the additonal labels etc (for e.g. slides)
   legend_on: if =1, show legend with entity and hazard names, default=0
 OUTPUTS:
   waterfall graph
 MODIFICATION HISTORY:
 Lea Mueller, 20110622
 Martin Heynen, 20120329
 David N. Bresch, david.bresch@gmail.com, 20130316 EDS-&ampgtEDS
 David N. Bresch, david.bresch@gmail.com, 20150419 try-catch for arrow plotting
 Lea Mueller, muellele@gmail.com, 20150831, integrate Value_unit from EDS_today.Value_unit
 David N. Bresch, david.bresch@gmail.com, 20150906 ED as default for return_period
 David N. Bresch, david.bresch@gmail.com, 20150906 font scale and label texts shortened
 David N. Bresch, david.bresch@gmail.com, 20150907 font scale and label texts shortened
 Lea Mueller, muellele@gmail.com, 20150930, introduce climada_digit_set
 Lea Mueller, muellele@gmail.com, 20151020, add TIV for future reference year
 Lea Mueller, muellele@gmail.com, 20151030, bugfix in climada_arrow
 Lea Mueller, muellele@gmail.com, 20151209, set no_fig=1, add legend_on=1
 David N. Bresch, david.bresch@gmail.com, 20160524, default legend_on=0, some simplifiactions
 David N. Bresch, david.bresch@gmail.com, 20170504, small fix to show correct TIV
View <A HREF=file:../../climada/code/climada_waterfall_graph.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="git_pull">
<H2>git_pull</H2></A>
 git_pull
 just an alias for climada_git_pull(0)
View <A HREF=file:../../climada/code/git_pull.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="RivDIS_read">
<H2>RivDIS_read</H2></A>
<font color="blue">function data=RivDIS_read(data_file,verbose) </font>
 climada template
 MODULE:
   _LOCAL
 NAME:
   data=RivDIS_read(data_file)
 PURPOSE:
   Read RivDIS data from ftp://daac.ornl.gov/data/rivdis/STATIONS.HTM#I
   http://daac.ornl.gov/RIVDIS/rivdis.shtml
   See ftp://daac.ornl.gov/data/rivdis/README
   Units: cubic meters/sec

   file format as:
     Buretto,44.96 N,10.39 E,E4,Italy,Europe,Po,20,55183
     Monthly average discharge in cubic meters/sec  180 records
     POINTID|YEAR|MONTH|DISCHRG
     750|1965|1|823
     750|1965|2|683
     750|1965|3|901
     750|1965|4|630
     750|1965|5|341
     750|1965|6|803
     750|1965|7|382
     750|1965|8|743
     750|1965|9|2110
     750|1965|10|2000
     ...

 CALLING SEQUENCE:
   data=RivDIS_read(data_file,verbose)
 EXAMPLE:
   data=RivDIS_read

   data01=RivDIS_read('TABLE01.DAT',0);
   data02=RivDIS_read('TABLE02.DAT',0);
   data03=RivDIS_read('TABLE03.DAT',0);
   plot(data01.datenum,data01.DISCHRG,'-r');datetick; hold on
   legend_str{1}=data01.station_name;
   plot(data02.datenum,data02.DISCHRG,'-g');datetick; hold on
   legend_str{2}=data02.station_name;
   plot(data03.datenum,data03.DISCHRG,'-b');datetick; hold on
   legend_str{3}=data03.station_name;
   legend(legend_str);ylabel(data01.units);
   title(['river ' data01.river_name ' monthly maximum discharge']);set(gcf,'Color',[1 1 1])
 INPUTS:
   data_file: the filename of the data (.DAT) file.
       If without path, default path is appended and tried
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   verbose: =1: print some verbose (default),
       =2: show check plot, too, =0: silent
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160121
View <A HREF=file:../../climada/code/data_import/RivDIS_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="chirps_read">
<H2>chirps_read</H2></A>
<font color="blue">function res=chirps_read(nc_files,lonlatrect,check_animation,verbose) </font>
 read CHIRPS netCDF file
 MODULE:
   core
 NAME:
   chirps_read
 PURPOSE:
   read CHIRPS netCDF file, see  http://chg.geog.ucsb.edu/data/chirps/#_Data

   currently reading global daily data, i.e. from files obtained from 
   ftp://ftp.chg.ucsb.edu/pub/org/chg/products/CHIRPS-2.0//global_daily/netcdf/p05/by_month/

   currently VERY innefficient memory use, as we store all (70%) of ocean
   points as zeros

 CALLING SEQUENCE:
   res=chirps_read(nc_files,lonlatrect,check_animation,verbose)
 EXAMPLE:
   res=chirps_read(nc_files)
   res=chirps_read('',[40 60 -20 0],3,1)
 INPUTS:
   nc_files: netCDF filename(s) with path. If more than one file, pass as
       struct, i.e. nc_files{i} a single filename with path
 OPTIONAL INPUT PARAMETERS:
   lonlatrect: [minlon maxlon minlat maxlat] to read a rectangular region
       instead of the wholw world, default=[].
   check_animation: =0 (default): no animation, =1: animation to screen
       =2: to screen and saved as MP4 file (CHIRPS_animation.mp4 in pwd)
       =3: only saved to mp4, figure not visible
   verbose: =1 print some info to stdout, =0 not (silent, default)
 OUTPUTS:
   res: a structure with
       lat: [2000x1 single] the latitude
       lon: [7200x1 single] the longitude
       time: [31x1 double] the time (here rather the date),
           as a MATLAB datenum
       time_str: [31x11 char] date string (=datestr(res.time))
   precip: [7200x2000x31 double] the precipitation
   precip_units: the units of res.precip
   &ampgt check output e.g. with
       image(res.lon,res.lat,res.precip(:,end:-1:1,1)');axis equal
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160103, initial
 David N. Bresch, david.bresch@gmail.com, 20160603, pat of core climada
 David N. Bresch, david.bresch@gmail.com, 20161228, pat of core climada
View <A HREF=file:../../climada/code/data_import/chirps_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tif_read">
<H2>climada_tif_read</H2></A>
<font color="blue">function res = climada_tif_read(tif_file,check_plot,verbose) </font>
 climada_tif_read
 MODULE:
   climada code/data_import
 NAME:
   climada_tif_read
 PURPOSE:
   read a tif file (data and coordinates) and put into res.data, res.lon,
   res.lat structure
   tif file can be saved in climada/data/entities or any other folder that
   you select throught he popup-window.
 CALLING SEQUENCE:
   res = climada_tif_read(tif_file,check_plot,verbose)
 EXAMPLE:
   res = climada_tif_read(tif_file,check_plot,verbose)
   res = climada_tif_read
 INPUTS: 
 OPTIONAL INPUT PARAMETERS:
   tif_file: a struct with the following fields, prompted for if not given
   .filename: prompted for if not given. Tif_file is the filename, the file
           contains raster data information.
   .lon_lat_min_max: i.e. [99 100 2 3], define lon min, lon max, lat min, 
           lat max for the gridded data. 
   .lon_lat_min_max_selection: i.e. [99 99.5 2 2.5], define the subset of 
           the data that you want with lon min, lon max, lat min, lat max
   .NODATA_value: i.e. -9999, this data will be overwritten with 0
   check_plot: set to 1 to see a figure, default is 0
   verbose: get fprint information in the command line, default is 0
 OUTPUTS: 
   res: a structure with 
   .data: gridded data from tif-file
   .lon: range of longitude (lon min and lon max)
   .lat: range of latitude (lat min and lat max)
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20160408, init
View <A HREF=file:../../climada/code/data_import/climada_tif_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="loadods">
<H2>loadods</H2></A>
 LOADODS: Loads data from an open document spreadsheet (ods) file into a cell
          array

 SYNTAX: data = loadods(filename,options)

 INPUTS:
   filename:   String representing the path and name of the ods file
   options:    Structural variable containing optional arguments

 OUTPUTS:
   data:       MxN cell array containing data from the spreadsheet

 OPTIONS:
   sheet_name: Name of a specific sheet to load [defaults to the first sheet]
   blank:      Value to store for blank spreadsheet cells [NaN]

 VERSION: 1.0

 Copyright (C) 2007 Alex Marten - alex.marten@gmail.com
 see license at the bottom of this file
View <A HREF=file:../../climada/code/data_import/loadods.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="trmm_get">
<H2>trmm_get</H2></A>
<font color="blue">function TRMM = trmm_get(yyyy,mm,dd,hh,check_plot,verbose) </font>
 climada TRMM precipitation
 MODULE:
   helper functions
 NAME:
   trmm_get
 PURPOSE:
   Read the TRMM precipitation data, GIS-reformatted version of TRMM 3B42
   files (spatial resolution is 0.25 degrees)
   See ftp://trmmopen.gsfc.nasa.gov/pub/trmmdata/GIS/README.GIS.pdf

   The code tries to automatically get the files from
   ftp://trmmopen.gsfc.nasa.gov/pub/trmmdata/GIS/ (see TRMM_URL in
   PARAMETERS in code). If this fails, the required TRMM file
   is printed to stdout for the user to manually retrieve. Once locally
   stored (to TRMM_data_dir, i.e. ../data/trmm), call trmm_get
   again to process the file.

   calls climada functions climada_plot_world_borders and
   climada_figure_scale_add only if they exists. Hence can easily be run
   stand-alone
 CALLING SEQUENCE:
   TRMM = trmm_get(yyyy,mm,dd,hh,check_plot,verbose)
 EXAMPLE:
   TRMM = trmm_get(2014,10,21,15,1,0);
   trmm_get(2014,10,21,[],1,0) % animate all hours of one day
   trmm_get(2014,10,1:31,[],1,0) % animate a full month
 INPUTS:
   yyyy,mm,dd: year month and day (integers)
   hh: the hour UTC, allowed are every 3 hours, i.e. 0,3,6,9,12,15,18,21
       Special: if empty, we get ALL 3-hourly data and produce an
           animation (to e.g. check data consistenccy)
           In this special case, dd can also be a vector, to loop over
           more than one day, e.g. dd=1:30 
           Note that in this special case TRMM is empty on output
 OPTIONAL INPUT PARAMETERS:
   check_plot: show a check plot, if =1, (default=0)
       if &ampgt1, do not open a new figure
       if &ampgt2, do only show precic &amplt400 mm
   verbose: =1 print info, =0 not (default)
 OUTPUTS:
   TRMM: a structure, with
       yyyy,mm,dd,hh: as on input
       datenum: the MATLAB datenum(yyyy,mm,dd,hh,0,0)
       source_filename: the original (ftp) filename with web path
       filename: the local .mat filename (with path)
       tif_filename: the local .tif filename (with path)
       data(i,j): the data
       lon(i,j): the longitude of the pixels
       lat(i,j): the latitude of the pixels
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20160220, initial
View <A HREF=file:../../climada/code/data_import/trmm_get.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="trmm_read">
<H2>trmm_read</H2></A>
<font color="blue">function res=trmm_read(nc_files,lonlatrect,check_animation,verbose) </font>
 read TRMM netCDF file
 MODULE:
   core
 NAME:
   trmm_read
 PURPOSE:
   read TRMM netCDF file, see  and 
   https://disc2.gesdisc.eosdis.nasa.gov/data/TRMM_RT/TRMM_3B42RT.7/doc/TRMM_Readme_v3.pdf

   for the hard-wired test filens below:
   http://disc2.gesdisc.eosdis.nasa.gov/data//TRMM_RT/TRMM_3B42RT.7/2015/004/3B42RT.2015010500.7.nc4
   http://disc2.gesdisc.eosdis.nasa.gov/data//TRMM_RT/TRMM_3B42RT.7/2015/004/3B42RT.2015010421.7.nc4
   http://disc2.gesdisc.eosdis.nasa.gov/data//TRMM_RT/TRMM_3B42RT.7/2015/004/3B42RT.2015010418.7.nc4
   http://disc2.gesdisc.eosdis.nasa.gov/data//TRMM_RT/TRMM_3B42RT.7/2015/004/3B42RT.2015010415.7.nc4
   http://disc2.gesdisc.eosdis.nasa.gov/data//TRMM_RT/TRMM_3B42RT.7/2015/004/3B42RT.2015010412.7.nc4
   http://disc2.gesdisc.eosdis.nasa.gov/data//TRMM_RT/TRMM_3B42RT.7/2015/004/3B42RT.2015010409.7.nc4
   http://disc2.gesdisc.eosdis.nasa.gov/data//TRMM_RT/TRMM_3B42RT.7/2015/004/3B42RT.2015010406.7.nc4
   http://disc2.gesdisc.eosdis.nasa.gov/data//TRMM_RT/TRMM_3B42RT.7/2015/004/3B42RT.2015010403.7.nc4
   http://disc2.gesdisc.eosdis.nasa.gov/data//TRMM_RT/TRMM_3B42RT.7/2015/003/3B42RT.2015010400.7.nc4

   currently VERY innefficient memory use, as we store all (70%) of ocean
   points as zeros

 CALLING SEQUENCE:
   res=trmm_read(nc_files,lonlatrect,check_animation,verbose)
 EXAMPLE:
   res=trmm_read(nc_files)
   res=trmm_read('',[40 60 -20 0],3,1) % TEST, small area
 INPUTS:
   nc_files: netCDF filename(s) with path. If more than one file, pass as
       struct, i.e. nc_files{i} a single filename with path
 OPTIONAL INPUT PARAMETERS:
   lonlatrect: [minlon maxlon minlat maxlat] to read a rectangular region
       instead of the wholw world, default=[].
   check_animation: =0 (default): no animation, =1: animation to screen
       =2: to screen and saved as MP4 file (TRMM_animation.mp4 in pwd)
       =3: only saved to mp4, figure not visible
   verbose: =1 print some info to stdout, =0 not (silent, default)
 OUTPUTS:
   res: a structure with
       lat: [2000x1 single] the latitude
       lon: [7200x1 single] the longitude
       time: [31x1 double] the time (here rather the date),
           as a MATLAB datenum
       time_str: [31x11 char] date string (=datestr(res.time))
   precip: [7200x2000x31 double] the precipitation
   precip_units: the units of res.precip
   &ampgt check output e.g. with
       image(res.lon,res.lat,res.precip(:,end:-1:1,1)');axis equal
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161228, initial, based on chirps_read
View <A HREF=file:../../climada/code/data_import/trmm_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cbfreeze">
<H2>cbfreeze</H2></A>
<font color="blue">function CBH = cbfreeze(varargin) </font>
CBFREEZE   Freezes the colormap of a colorbar.

   SYNTAX:
           cbfreeze
           cbfreeze('off')
           cbfreeze(H,...)
     CBH = cbfreeze(...);

   INPUT:
     H     - Handles of colorbars to be freezed, or from figures to search
             for them or from peer axes (see COLORBAR).
             DEFAULT: gcf (freezes all colorbars from the current figure)
     'off' - Unfreezes the colorbars, other options are:
               'on'    Freezes
               'un'    same as 'off'
               'del'   Deletes the colormap(s).
             DEFAULT: 'on' (of course)

   OUTPUT (all optional):
     CBH - Color bar handle(s).

   DESCRIPTION:
     MATLAB works with a unique COLORMAP by figure which is a big
     limitation. Function FREEZECOLORS by John Iversen allows to use
     different COLORMAPs in a single figure, but it fails freezing the
     COLORBAR. This program handles this problem.

   NOTE:
     * Optional inputs use its DEFAULT value when not given or [].
     * Optional outputs may or not be called.
     * If no colorbar is found, one is created.
     * The new frozen colorbar is an axes object and does not behaves
       as normally colorbars when resizing the peer axes. Although, some
       time the normal behavior is not that good.
     * Besides, it does not have the 'Location' property anymore.
     * But, it does acts normally: no ZOOM, no PAN, no ROTATE3D and no
       mouse selectable.
     * No need to say that CAXIS and COLORMAP must be defined before using
       this function. Besides, the colorbar location. Anyway, 'off' or
       'del' may help.
     * The 'del' functionality may be used whether or not the colorbar(s)
       is(are) froozen. The peer axes are resized back. Try: 
        &ampgt&ampgt colorbar, cbfreeze del

   EXAMPLE:
     surf(peaks(30))
     colormap jet
     cbfreeze
     colormap gray
     title('What...?')

   SEE ALSO:
     COLORMAP, COLORBAR, CAXIS
     and
     FREEZECOLORS by John Iversen
     at http://www.mathworks.com/matlabcentral/fileexchange


   ---
   MFILE:   cbfreeze.m
   VERSION: 1.1 (Sep 02, 2009) (&amplta href=&quotmatlab:web('http://www.mathworks.com/matlabcentral/fileexchange/authors/11258')&quot&ampgtdownload&amplt/a&ampgt) 
   MATLAB:  7.7.0.471 (R2008b)
   AUTHOR:  Carlos Adrian Vargas Aguilera (MEXICO)
   CONTACT: nubeobscura@hotmail.com
   REVISIONS:
   1.0      Released. (Jun 08, 2009)
   1.1      Fixed BUG with image handle on MATLAB R2009a. Thanks to Sergio
            Muniz. (Sep 02, 2009)
   DISCLAIMER:
   cbfreeze.m is provided &quotas is&quot without warranty of any kind, under the
   revised BSD license.
   Copyright (c) 2009 Carlos Adrian Vargas Aguilera
View <A HREF=file:../../climada/code/helper_functions/cbfreeze.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cbhandle">
<H2>cbhandle</H2></A>
<font color="blue">function CBH = cbhandle(varargin) </font>
CBHANDLE   Handle of current colorbar axes.

   SYNTAX:
     CBH = cbhandle;
     CBH = cbhandle(H);

   INPUT:
     H - Handles axes, figures or uipanels to look for colorbars.
         DEFAULT: gca (current axes)

   OUTPUT:
     CBH - Color bar handle(s).

   DESCRIPTION:
     By default, color bars are hidden objects. This function searches for
     them by its 'axes' type and 'Colorbar' tag.
    
   SEE ALSO:
     COLORBAR
     and
     CBUNITS, CBLABEL, CBFREEZE by Carlos Vargas
     at http://www.mathworks.com/matlabcentral/fileexchange


   ---
   MFILE:   cbhandle.m
   VERSION: 1.1 (Aug 20, 2009) (&amplta href=&quotmatlab:web('http://www.mathworks.com/matlabcentral/fileexchange/authors/11258')&quot&ampgtdownload&amplt/a&ampgt) 
   MATLAB:  7.7.0.471 (R2008b)
   AUTHOR:  Carlos Adrian Vargas Aguilera (MEXICO)
   CONTACT: nubeobscura@hotmail.com
   REVISIONS:
   1.0      Released. (Jun 08, 2009)
   1.1      Fixed bug with colorbar handle input. (Aug 20, 2009)
   DISCLAIMER:
   cbhandle.m is provided &quotas is&quot without warranty of any kind, under the
   revised BSD license.
   Copyright (c) 2009 Carlos Adrian Vargas Aguilera
View <A HREF=file:../../climada/code/helper_functions/cbhandle.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_DFC_compare">
<H2>climada_DFC_compare</H2></A>
<font color="blue">function match100fact=climada_DFC_compare(EDS,DFC_file,Percentage_Of_Value_Flag,plot_loglog,scenario_comparison_flag,EDS_multiplier) </font>
 climada
 NAME:
   climada_DFC_compare
 PURPOSE:
   compare climada results (Event damage set, EDS) and the resulting
   damage frequency curve (DFC) with DFC from file, e.g. to compare with
   other models. Purely visual inspection (as the eye of the beholder
   integrates such complex information far better than any code...)

   Instead of a lengthy description of the exact content of the Excel
   file, see the one example (climada_DFC_compare_file.xls) in the
   core climada data results folder. Note that the code (and the format
   of the Excel) is peril-independent. If troubles with .xls, save as
   Excel95.

   See also climada_EDS_calc, climada_EDS_DFC and climada_EDS_DFC_match
 CALLING SEQUENCE:
   climada_DFC_compare(EDS,DFC_file,Percentage_Of_Value_Flag,plot_loglog)
 EXAMPLE:
   DFC_file=[climada_global.data_dir filesep 'results' filesep 'climada_DFC_compare_file.xls']; % the example file
   climada_DFC_compare(EDS,DFC_file)
   climada_DFC_compare(EDS,'',0,0,1,1/5)

   % all in one, e-g frequency_screw on hazard and EDS_multiplier:
   entity_blend=climada_assets_encode(climada_entity_load) % select 'Germany_entity.mat' and WS_Europe.mat from ws_europe module
   module_data_dir=[fileparts(fileparts(which('climada_DFC_compare'))) filesep 'data'];
   DFC_file=[module_data_dir filesep 'climada_DFC_compare_file.xls'];
   frequency_screw=0.25;
   EDS_multiplier=1/3;
   climada_DFC_compare(climada_EDS_calc(entity_blend,...
       winterstorm_blend_hazard_event_sets('WS_Europe_blend.mat',...
       frequency_screw)),'',0,0,1,EDS_multiplier)
 INPUTS:
   EDS: a climada EDS, as produced by climada_EDS_calc
       Only EDS(1) is used for comparison, further EDSs are plotted, but
       not compared.
   DFC_file: an Excel file with a DFC (currently only one single DFC
       supported).If troubles with .xls, save as Excel95 first.
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   Percentage_Of_Value_Flag: if =1, scale vertical axis with Value, such
       that damage as percentage of value is shown, instead of damage amount,
       default=0 (damage amount shown). Very useful to compare DFCs of
       different portfolios to see relative differences in risk
   plot_loglog: if =1, plot logarithmic scale both axes
       =0 plot linear axes (default)
   scenario_comparison_flag: also compare single scenario event losses (if
       in Excel, as tab 'Footprint Report').
   EDS_multiplier: a simple multiplier to multiply the EDS damage with (to
       experiment with a correction factor, highly EXPERIMENTAL
       (default=1, obviously)
 OUTPUTS:
   match100fact: the multiplier to match the 100yr damage
       Note that EDS_multiplier is applied before, hence total suggested
       correction to match 100yr damage = EDS_multiplier*match100fact
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141206, initial 'Samichlaus'
 David N. Bresch, david.bresch@gmail.com, 20141212, minor edits
View <A HREF=file:../../climada/code/helper_functions/climada_DFC_compare.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_DFC_read">
<H2>climada_DFC_read</H2></A>
<font color="blue">function DFC=climada_DFC_read(DFC_file) </font>
 climada
 NAME:
   climada_DFC_read
 PURPOSE:
   Read a damage frequency curve (DFC) with DFC from file, e.g. to compare with
   other models.

   Instead of a lengthy description of the exact content of the Excel
   file, see the one example (climada_DFC_compare_file.xls) in the
   core climada data results folder. Note that the code (and the format
   of the Excel) is peril-independent. If troubles with .xls (or .xlsx),
   save as Excel95 (or 97).

   See also climada_DFC_compare, climada_EDS_DFC and climada_EDS_DFC_match
 CALLING SEQUENCE:
   DFC=climada_DFC_read(DFC_file)
 EXAMPLE:
   DFC_file=[climada_global.data_dir filesep 'results' filesep 'climada_DFC_compare_file.xls']; % the example file
   DFC=climada_DFC_read(DFC_file)
   % process a full folder, e.g.
   folder=[climada_global.data_dir filesep 'results' filesep 'model_results'];D=dir([folder filesep '*.xlsx']);
   for file_i=1:length(D),if ~D(file_i).isdir,DFC=climada_DFC_read([folder filesep D(file_i).name]);end;end
 INPUTS:
   DFC_file: an Excel file with a DFC (currently only one single DFC
       supported).If troubles with .xls, save as Excel95 first.
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   DFC: a strcture with a damage frequency curve (DFC)
       return_period(i): the return periods
       damage(i): the damage for return_period(i) (sometimes termed loss)
       damage_of_value(i): damage as percentage of total asset value
       peril_ID: the peril_ID
       value: the total asset value (often referred to as TIV, i.e. total
           insurable value)
       ED: the annual expected damage (sometimes referred to as groun up
           loss)
       annotation_name: just a free annotation name
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150120, initial
View <A HREF=file:../../climada/code/helper_functions/climada_DFC_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS2DFC">
<H2>climada_EDS2DFC</H2></A>
<font color="blue">function DFC=climada_EDS2DFC(EDS,return_period) </font>
 climada
 NAME:
   climada_EDS2DFC
 PURPOSE:
   convert an event damage set (EDS) into a Damage exceedence Frequency Curve (DFC)

   prior call: climada_EDS_calc
   See also: climada_EDS_DFC (which plots the DFC)
 CALLING SEQUENCE:
   DFC=climada_EDS2DFC(EDS,return_period)
 EXAMPLE:
   DFC=climada_EDS2DFC(climada_EDS_calc)
 INPUTS:
   EDS: either an event damage set (or many, i.e. EDS(i), as e.g. returned by climada_EDS_calc or
       a file containing such a structure
       SPECIAL: we also accept a structure which contains an EDS, like
       measures_impact.EDS
       if EDS has the field annotation_name, the legend will show this
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   return_period: the vector of return periods for which we'd like to
       obtain the damage. Default are the return periods as defined in
       climada_global.DFC_return_periods
       if empty, the default return periods as in climada_global.DFC_return_periods are used
       if =-1, all points as returned by climada_damage_exceedence are used
       if ='AED', the annual expected damage is returned, with return period=1
 OUTPUTS:
   DFC: a strcture with a damage frequency curve (DFC)
       return_period(i): the return periods
       damage(i): the damage for return_period(i)
       damage_of_value(i): damage as percentage of total asset value
       peril_ID: the peril_ID
       value: the total asset value
       ED: the annual expected damage
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150120, initial
 David N. Bresch, david.bresch@gmail.com, 20160429, DFC.Value instead of DFC.value
 David N. Bresch, david.bresch@gmail.com, 20170504, allow for return_period='AED'
 David N. Bresch, david.bresch@gmail.com, 20170626, DFC.Value_unit
 David N. Bresch, david.bresch@gmail.com, 20170721, DFC.currency_unit
View <A HREF=file:../../climada/code/helper_functions/climada_EDS2DFC.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS2YDS">
<H2>climada_EDS2YDS</H2></A>
<font color="blue">function [YDS,sampling_vect]=climada_EDS2YDS(EDS,hazard,number_of_years,sampling_vect) </font>
 climada template
 MODULE:
   core
 NAME:
   climada_EDS2YDS
 PURPOSE:
   convert an event (per occurrence) damage set (EDS) into a year damage
   set (YDS), making reference to hazard.orig_yearset (if exists). If
   there is no yearset in hazard, generate an artificial year damage set
   by sampling the EDS into n_years, where n_years is determined based on
   EDS.frequency (n_years=1/min(EDS.frequency), such that the yearset
   'spans' the period the damage is 'representative' for).

   The code does perform some consistency checks, but the user is
   ultimately repsonsible for results ;-)

   Note that for TS and TR, the TC hazard event set contains
   hazard.orig_yearset, not each sub-peril hazard event set might contain
   its own yearset. See climada_tc_hazard_set for a good example of how
   such an hazard.orig_yearset is constructed.
 CALLING SEQUENCE:
   YDS=climada_EDS2YDS(EDS,hazard,number_of_years)
 EXAMPLE:
   YDS=climada_EDS2YDS(climada_EDS_calc('',hazard),hazard)
 INPUTS:
   EDS: an event damage set (EDS), as produced by climada_EDS_calc
       (see there)
 OPTIONAL INPUT PARAMETERS:
   hazard: a hazard event set (either a struct or a full filename with
       path) which contains a yearset in hazard.orig_yearset
       Note that for TS and TR, the TC hazard event set contains
       hazard.orig_yearset, not each sub-peril hazard event set
       If empty, the hazard event set is inferred from
       EDS.annotation_name, which often contains the filename (without
       path) of the hazard event set. If this is the case, this hazard is
       used, if not, the function prompts for the hazard event set to use.
       If hazard does neither contain a valid hazard struct, nor an
       existing hazard set name, one event per year is assumed and the EDS
       is just replicated enough times to result in number_of_years (or,
       if number_of_years is not provided, YDS=EDS)
   number_of_years: the target number of years the damage yearset shall
       contain. If shorter than the yearset in the hazard set, just cut,
       otherwise replicate until target length is reached. No advanced
       technique, such as re-sampling, is performed (yet).
   sampling_vect: the sampling vector, techincal, see code (can be used to
       re-create the exact same yearset). Needs to be obtained in a first
       call, i.e. [YDS,sampling_vect]=climada_EDS2YDS(...) and then
       provided in subsequent calls(s) to obtain the exact same sampling
       structure of yearset, i.e YDS=climada_EDS2YDS(...,sampling_vect)
 OUTPUTS:
   YDS: the year damage set (YDS), a struct with same fields as EDS (such
       as Value, ED, ...) plus yyyy and orig_year_flag. All fields same
       content as in EDS, except:
       yyyy(i): the year i
       damage(i): the sum of damage for year(i). Note that for a
           probabilitic hazard event set, there are ens_size+1 same years,
           the first instance being the original year.
       frequency(i): the annual frequency, =1
       orig_year_flag(i): =1 if year i is an original year, =0 else
       Hint: if you want to staore a YDS back into an EDS, note that there
       are two more fields in YDS than EDS: yyyy and orig_year_flag
   sampling_vect: the sampling vector, techincal, see code (can be used to
       re-create the exact same yearset)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141226, initial
 David N. Bresch, david.bresch@gmail.com, 20150116, YDS fields same order as in EDS
 David N. Bresch, david.bresch@gmail.com, 20150204, automatic hazard set detection
 David N. Bresch, david.bresch@gmail.com, 20150721, EDS is proxy for output, i.e. YDS=EDS to start with
 David N. Bresch, david.bresch@gmail.com, 20151231, artifical yearsets and number_of_years implemented
 David N. Bresch, david.bresch@gmail.com, 20160307, sampling_vect as optional output
 David N. Bresch, david.bresch@gmail.com, 20160308, allow for no hazard set
 David N. Bresch, david.bresch@gmail.com, 20160420, orig_year_flag improved
View <A HREF=file:../../climada/code/helper_functions/climada_EDS2YDS.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_DFC">
<H2>climada_EDS_DFC</H2></A>
<font color="blue">function [DFC,fig,legend_str,legend_handle] = climada_EDS_DFC(EDS,EDS_comparison,Percentage_Of_Value_Flag,plot_loglog) </font>
 climada
 NAME:
   climada_EDS_DFC
 PURPOSE:
   plot occurrence Damage exceedence Frequency Curve (DFC)
   mainly does plotting, uses climada_EDS2DFC to convert EDS to DFC

   See also: climada_EDS_DFC_match and climada_DFC_compare
 CALLING SEQUENCE:
   climada_EDS_DFC(EDS,EDS_comparison,Percentage_Of_Value_Flag,plot_loglog)
 EXAMPLE:
   climada_EDS_DFC(climada_EDS_calc(climada_entity_read))
 INPUTS:
   EDS: either an event damage set, as e.g. returned by climada_EDS_calc or
       a file containing such a structure
       SPECIAL: we also accept a structure which contains an EDS, like
       measures_impact.EDS
       if EDS has the field annotation_name, the legend will show this
       &ampgt EDS promted for if not given
 OPTIONAL INPUT PARAMETERS:
   EDS_comparison: like EDS see above, plotted (fine lines) for comparison
       not prompted for, if not given,unless set to 'ASK'
   Percentage_Of_Value_Flag: if =1, scale vertical axis with Value, such
       that damage as percentage of value is shown, instead of damage amount,
       default=0 (damage amount shown). Very useful to compare DFCs of
       different portfolios to see relative differences in risk
   plot_loglog: if =1, plot logarithmic scale both axes, =0 plot linear
       axes (default)
 OUTPUTS:
   DFC: a structure with fields
       .return_period
       .damage
       .damage_of_value (as percentage of value)
       .ED, .Value, .Value_unit, and .annotation_name
   a figure with the DFC plot
   legend_str: the legend string
   legend_handle: the handle to the plots (to group legend correctly)
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20100108
 david.bresch@gmail.com, 20100109, comparison added
 muellele@gmail.com, 20120816, comparison title of all comparisons, changed markersize
 david.bresch@gmail.com, 20130316, ELS-&ampgtEDS...
 david.bresch@gmail.com, 20130316, slight cleanup
 muellele@gmail.com, 20150421, legend location SouthEast instead of NorthWest
 david.bresch@gmail.com, 20150515, line 212, legend_str{end+1}...
 david.bresch@gmail.com, 20150906, EDS.Value_unit used
 muellele@gmail.com, 20160308, add output DFC structure
 david.bresch@gmail.com, 20160429, calling EDS2DFC, DFC.Value instead of DFC.value
 david.bresch@gmail.com, 20170211, plotting symbols avoided if more than 20 curves shown
 david.bresch@gmail.com, 20170626, label y-axis with DFC(1).Value_unit
 david.bresch@gmail.com, 20170727, legend_handle added
View <A HREF=file:../../climada/code/helper_functions/climada_EDS_DFC.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_DFC_hist">
<H2>climada_EDS_DFC_hist</H2></A>
<font color="blue">function climada_EDS_DFC_hist(EDS,EDS_comparison,Percentage_Of_Value_Flag) </font>
 climada
 NAME:
   climada_EDS_DFC
 PURPOSE:
   plot occurrence Damage exceedence Frequency Curve (DFC)
 CALLING SEQUENCE:
   climada_EDS_DFC(EDS,EDS_comparison,Percentage_Of_Value_Flag)
 EXAMPLE:
   climada_EDS_DFC(climada_EDS_calc(climada_entity_read))
 INPUTS:
   EDS: either an event damage set, as e.g. returned by climada_EDS_calc or
       a file containing such a structure
       SPECIAL: we also accept a structure which contains an EDS, like
       measures_impact.EDS
       if EDS has the field annotation_name, the legend will show this
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   EDS_comparison: likeEDS see above), plotted (fine lines) for comparison
       not prompted for, if not given,unless set to 'ASK'
   Percentage_Of_Value_Flag: if =1, scale vertical axis with Value, such
       that damage as percentage of value is shown, instead of damage amount,
       default=0 (damage amount shown). Very useful to compare DFCs of
       different portfolios to see relative differences in risk
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20100108
 David N. Bresch, david.bresch@gmail.com, 20100109, comparison added
 David N. Bresch, david.bresch@gmail.com, 20130316, ELS-&ampgtEDS...
View <A HREF=file:../../climada/code/helper_functions/climada_EDS_DFC_hist.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_DFC_match">
<H2>climada_EDS_DFC_match</H2></A>
<font color="blue">function EDS=climada_EDS_DFC_match(EDS,DFC_file,match_ED_flag) </font>
 climada EDS DFC
 NAME:
   climada_EDS_DFC_match
 PURPOSE:
   Given a climada event damage set (EDS) and a  damage frequency curve
   (DFC) from file, adjust the EDS, such that the EDS best matches the
   DFC (e.g. to 'reproduce' other model results with climada).

   Instead of a lengthy description of the exact content of the Excel
   file, see the one example (climada_DFC_compare_file.xls) in the
   core climada data results folder. Note that the code (and the format
   of the Excel) is peril-independent. If troubles with .xls, save as
   Excel95.

   There are three steps:
   1) compare and if necessary adjust for EDS to have the same total Value
      as the DFC (i.e. adjust EDS.damage, EDS.Value, EDS.assets.Value)
   2) compare the DFCs of the EDS with the one read from file and adjust
      the single event damages (EDS.damage) such that the adjusted DFC based
      on the EDS matches the one from file
   3) recalculate EDS.ED (expected damage) and compare withe the
      Ground_Up_Loss of the DFC. Adjust EDS.damage once more and finally
      recalculate EDS.ED again.

   See also climada_EDS_calc, climada_EDS_DFC and climada_DFC_compare
 CALLING SEQUENCE:
   EDS=climada_EDS_DFC_match(EDS,DFC_file)
 EXAMPLE:
   DFC_file=[climada_global.data_dir filesep 'results' filesep 'climada_DFC_compare_file.xls']; % the example file
   EDS=climada_EDS_DFC_match(EDS,DFC_file)
 INPUTS:
   EDS: a climada EDS, as produced by climada_EDS_calc
       Only EDS(1) is used for comparison, further EDSs are plotted, but
       not compared.
   DFC_file: an Excel file with a DFC (currently only one single DFC
       supported).If troubles with .xls, save as Excel95 first.
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   match_ED_flag: =1 make sure the expected damage (ED) is matching
       exactly (might lead to small differences on EDS), =0, do not match ED,
       just match the DFC (default, as this leads to perfect match for return
       periods).
       If you set match_ED_flag=-99, the comparison plot of the DFCs is
       omitted
 OUTPUTS:
   EDS: EDS such that it best matches the DFC from file (events adjusted)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150118, initial
View <A HREF=file:../../climada/code/helper_functions/climada_EDS_DFC_match.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_DFC_report">
<H2>climada_EDS_DFC_report</H2></A>
<font color="blue">function res = climada_EDS_DFC_report(EDS,Percentage_Of_Value_Flag,report_style,report_file) </font>
 climada
 NAME:
   climada_EDS_DFC_report
 PURPOSE:
   Interpolate damage frequency curve (DFC) to standard return periods
   (see climada_global.DFC_return_periods)

   previous call: climada_EDS_calc
 CALLING SEQUENCE:
   res=climada_EDS_DFC_report(EDS,Percentage_Of_Value_Flag,report_style)
 EXAMPLE:
   res=climada_EDS_DFC_report(climada_EDS_calc(climada_entity_read))
 INPUTS:
   EDS: either an event damage set, as e.g. returned by climada_EDS_calc or
       a file containing such a structure
       SPECIAL: we also accept a structure which contains an EDS, like
       measures_impact.EDS
       if EDS has the field annotation_name, the legend will show this
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   Percentage_Of_Value_Flag: if =1, scale vertical axis with Value, such
       that damage as percentage of value is shown, instead of damage amount,
       default=0 (damage amount shown). Very useful to compare DFCs of
       different portfolios to see relative differences in risk
   report_style: 'lean' for only the damages at predefined return periods
       'std' (default): the damages at return periods.
   report_file: filename (and path) to save the report to (as .csv)
       ='': no saving to file (default)
       ='ASK' to prompt for
 OUTPUTS:
   res: a structure with fields
       return_periods(RP_i): return period RP_i
       damage(EDS_i,RP_i)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20100108
 David N. Bresch, david.bresch@gmail.com, 20100109, comparison added
 David N. Bresch, david.bresch@gmail.com, 20130316, ELS-&ampgtEDS...
 David N. Bresch, david.bresch@gmail.com, 20150101, report_file added
View <A HREF=file:../../climada/code/helper_functions/climada_EDS_DFC_report.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_ED_at_centroid_report">
<H2>climada_EDS_ED_at_centroid_report</H2></A>
<font color="blue">function climada_EDS_ED_at_centroid_report(EDS,Percentage_Of_Value_Flag,report_file) </font>
 climada
 NAME:
   climada_EDS_ED_at_centroid_report
 PURPOSE:
   Write out ED at centroids for one or multiple EDS structures into .csv
   file
   previous call: climada_EDS_calc
 CALLING SEQUENCE:
   climada_EDS_ED_at_centroid_report(EDS,Percentage_Of_Value_Flag,report_file)
 EXAMPLE:
   climada_EDS_ED_at_centroid_report(climada_EDS_calc(climada_entity_read))
 INPUTS:
   EDS: either an event damage set, as e.g. returned by climada_EDS_calc or
       a file containing such a structure
       SPECIAL: we also accept a structure which contains an EDS, like
       measures_impact.EDS
       if EDS has the field annotation_name, the legend will show this
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   Percentage_Of_Value_Flag: if =1, scale vertical axis with Value, such
       that damage as percentage of value is shown, instead of damage amount,
       default=0 (damage amount shown). Very useful to compare DFCs of
       different portfolios to see relative differences in risk
   report_file: filename (and path) to save the report to (as .csv), if
       empty, prompted for
 OUTPUTS:
   none, report file written as .csv
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150430, init
View <A HREF=file:../../climada/code/helper_functions/climada_EDS_ED_at_centroid_report.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_ED_at_centroid_report_xls">
<H2>climada_EDS_ED_at_centroid_report_xls</H2></A>
<font color="blue">function climada_EDS_ED_at_centroid_report_xls(EDS,entity,xls_file) </font>
 climada
 NAME:
   climada_EDS_ED_at_centroid_report
 PURPOSE:
   Write out ED at centroids for one or multiple EDS structures into .csv
   file
   previous call: climada_EDS_calc
 CALLING SEQUENCE:
   climada_EDS_ED_at_centroid_report(EDS,entity,xls_file)
 EXAMPLE:
   climada_EDS_ED_at_centroid_report(climada_EDS_calc(climada_entity_read), climada_entity_read)
 INPUTS:
   EDS: either an event damage set, as e.g. returned by climada_EDS_calc or
       a file containing such a structure
       SPECIAL: we also accept a structure which contains an EDS, like
       measures_impact.EDS
       if EDS has the field annotation_name, the legend will show this
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   xls_file: filename (and path) to save the report to (as .xls), if
       empty, prompted for
 OUTPUTS:
   none, report file written as .xls
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150430, init
View <A HREF=file:../../climada_modules/_barisal_demo/code/climada_EDS_ED_at_centroid_report_xls.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_ED_per_category_report">
<H2>climada_EDS_ED_per_category_report</H2></A>
<font color="blue">function output_report = climada_EDS_ED_per_category_report(entity,EDS,xls_file,sheet,benefit_flag,percentage_flag,assets_flag,summary) </font>
 climada_EDS_ED_per_category_report
 MODULE:
   climada core
 NAME:
   climada_EDS_ED_per_category_report
 PURPOSE:
   Write out ED per category for one EDS structures into xls file
   previous call: climada_EDS_calc, or climada_EDS_ED_at_centroid_report_xls
 CALLING SEQUENCE:
   output_report = climada_EDS_ED_per_category_report(entity,EDS,xls_file,sheet)
 EXAMPLE:
   output_report = climada_EDS_ED_per_category_report(entity,climada_EDS_calc(entity,hazard))
 INPUTS:
   entity: climada entity structure, with fields entity.assets.Category and entity.assets.Unit
   EDS: either an event damage set, as e.g. returned by climada_EDS_calc or
       a file containing such a structure
       SPECIAL: we also accept a structure which contains an EDS, like
       measures_impact.EDS
       if EDS has the field annotation_name, the legend will show this
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   xls_file: filename (and path) to save the report to (as .xls), if
       empty, prompted for.Can be set to 'NO_xls_file' to omit creation of
       xls file instead only creates the cell &quotoutput_report&quot
   sheet: sheet name for xls file, if empty, default excel name is &quotSheet1&quot
   summary: Shortens teh code and suppresses some outputs, so it can be used by salvador_results_overview  
 OUTPUTS:
   output_report: cell including header and ED values
   report file written as .xls
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150806, init
 Lea Mueller, muellele@gmail.com, 20150831, introduce benefit_flag to calculate benefit (difference AED with measure and AED without measure)
 Lea Mueller, muellele@gmail.com, 20150831, rename climada_assets_select from salvador_assets_select
 Lea Mueller, muellele@gmail.com, 20150831, enhance to cope with multiple EDS
 Lea Mueller, muellele@gmail.com, 20150910, enhance to cope with Category names (cell) instead of numbers
 Lea Mueller, muellele@gmail.com, 20150915, add assets_flag to write out sum of entity.assets.Value per category, as specified in EDS(EDS_i).assets.filename
 Lea Mueller, muellele@gmail.com, 20150922, add filenames (entity.assets, entity.damagefunctions, entity.discount, entity.measures and EDS.hazard)
 Lea Mueller, muellele@gmail.com, 20150924, set silent_mode for climada_assets_select
 Jacob Anz,   j.anz@gmail.com,    20150929, add summary input so it can be executed with salvador_results_overview   
 Lea Mueller, muellele@gmail.com, 20151106, rename to climada_EDS_ED_per_category_report from salvador_EDS_ED_per_category_report
 Lea Mueller, muellele@gmail.com, 20151106, move to core
 Lea Mueller, muellele@gmail.com, 20151117, add try statement for filenames of assets, damagefunction, etc.
 Lea Mueller, muellele@gmail.com, 20151217, get category_criterium from entity.assets.Category_name
View <A HREF=file:../../climada/code/helper_functions/climada_EDS_ED_per_category_report.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_combine">
<H2>climada_EDS_combine</H2></A>
<font color="blue">function [EDS,ok]=climada_EDS_combine(EDS,EDS2,force_combination,verbose) </font>
 climada EDS combine
 MODULE:
   core
 NAME:
   climada_EDS_combine
 PURPOSE:
   Combine two event damage sets (EDS), i.e. add damages. You can either
   pass one array of EDSs in EDS, in which case all matching EDSs within are
   combined (even if they are not stored at subsequent positions), or you
   can pass EDS and EDS2, in which case the code first combines any
   matching EDSs in EDS and then adds from EDS2.
   In this latter case, please make sure the 'main' peril(s) are
   in EDS (e.g. TC in EDS, TS in EDS2). Note that ONLY damages are
   added, we do NOT add Value/assets, as most often the sub-peril is on
   the same asset base. Hence edit the resulting EDS yourself in case
   Value should be additive.

   call before: climada_EDS_calc, e.g.
       EDS(1)=climada_EDS_calc, EDS(2)=climada_EDS_calc ...
   see also: country_risk_EDS_combine (climada module country_risk)
 CALLING SEQUENCE:
   [EDS,ok]=climada_EDS_combine(EDS,EDS2,force_combination,verbose)
 EXAMPLE:
   EDS=climada_EDS_combine(EDS)
 INPUTS:
   EDS: a climada EDS (as returned eg by climada_EDS_calc)
       if EDS is in fact an array of EDS(i), the code will combine all
       matching EDSs within (e.g. TC and TS, if damage vector is of same length)
       This way, climada_EDS_combine can be called once to sum up all
       matching EDSs.
       If EDS is empty on input, EDS2 gets processed, i.e. same as calling
       climada_EDS_combine(EDS2). This can be useful to start summing up
       an EDS in a loop EDS_c=climada_EDS_combine(EDS_c,EDS)...
 OPTIONAL INPUT PARAMETERS:
   EDS2: a climada EDS (as returned eg by climada_EDS_calc)
       if EDS2 is an array of EDS2(i), the code will recursively treat
       them. Please note that more complex cases need to be treated using
       only EDS (e.g. sub-perils not following each other in sequence in
       the EDS).
   force_combination: also combine if ok=0 upon return when combining
       recursively. Default=1, Set =0 to only combine EDSs that match
       perfectly (i.e. same reference_year and event_ID)
   verbose: =1 print information about combining to stdout, =0 only print
       errors, othwerwise silent
 OUTPUTS:
   EDS: the combined EDS
       Please note that assets are just taken from the first EDS(i) of each
       (sub) hazard. 
   ok: =1 if combination successful, =0 otherwise, also if the basic
       combination worked (same length of damage vector), but some issues
       with either ED_at_centroid, reference_year, frequency or event_ID
       occurred. In some instances, it might still be justified to use the
       combined EDS, even if ok=0 upon return.
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150114, initial
 David N. Bresch, david.bresch@gmail.com, 20150203, array of EDSs and empty EDS2 allowed
 David N. Bresch, david.bresch@gmail.com, 20150215, Value taken from EDS, not added
 David N. Bresch, david.bresch@gmail.com, 20151231, major overhaul, mastering complex cases, like many sub-perils at once
 David N. Bresch, david.bresch@gmail.com, 20170726, allow for EDS to be empty on input
View <A HREF=file:../../climada/code/helper_functions/climada_EDS_combine.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_load">
<H2>climada_EDS_load</H2></A>
<font color="blue">function EDS = climada_EDS_load(EDS) </font>
 climada
 NAME:
   climada_EDS_load
 PURPOSE:
   load a previously saved EDS (just to avoid typing long paths and
   filenames in the cmd window)
 CALLING SEQUENCE:
   EDS = climada_EDS_load(EDS)
 EXAMPLE:
   EDS = climada_EDS_load(EDS)
 INPUTS:
   EDS: the filename with path of a previously saved EDS, see
       climada_EDS_save. If no path provided, default path ../data/results is used
       (and name can be without extension .mat)  
       &ampgt promted for if not given
       OR: a EDS structure, in which case it is just returned (to allow
       calling climada_EDS_load anytime, see e.g. climada_DFC_fit)
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   EDS: a struct, see e.g. climada_EDS_calc for details
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091230
 David N. Bresch, david.bresch@gmail.com, 20130316, ELS-&ampgtEDS...
 Lea Mueller, muellele@gmail.com, 20160307, enhance to work with complete EDS as input, similar to climada_hazard_load
View <A HREF=file:../../climada/code/helper_functions/climada_EDS_load.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_save">
<H2>climada_EDS_save</H2></A>
<font color="blue">function climada_EDS_save(EDS,EDS_save_file,EDS_default) </font>
 climada
 NAME:
   climada_EDS_save
 PURPOSE:
   save an EDS to a .mat file (just to avoid typing long paths and
   filenames in the cmd window)
 CALLING SEQUENCE:
   climada_EDS_save(EDS,EDS_save_file)
 EXAMPLE:
   climada_EDS_save(EDS,EDS_save_file)
 INPUTS:
   EDS: the event damage set (EDS), see e.g. climada_EDS_calc
   EDS_save_file: the filename to save the EDS in
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   EDS saved to a .mat file
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091230
 David N. Bresch, david.bresch@gmail.com, 20130316, ELS-&ampgtEDS...
View <A HREF=file:../../climada/code/helper_functions/climada_EDS_save.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_stats">
<H2>climada_EDS_stats</H2></A>
<font color="blue">function EDS = climada_EDS_stats(EDS, EDS_save_file, return_period, check_plot) </font>
 calculating return periods with their corresponding EL
 NAME:
   climada_EDS_stats
 PURPOSE:
   calculating return periods with their corresponding event damage from the EDS
   file
 CALLING SEQUENCE:
   EDS_stats = climada_EDS_stats(EDS, EDS_save_file, return_period)
 EXAMPLE:
   EDS_stat=climada_EDS_stats(EDS,EDS_stat.mat,50)
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   EDS: Event damage set, see climada_EDS_calc(entity, hazard)
       &ampgt promted for if not given
   EDS_save_file: the name of the EDS return periods file
       &ampgt promted for if not given
   return_period: user defined return periods
       &ampgt calculates predefined return periods if not given
   check_plot: whether we show a check plot (=1) or not (=0), default=0
 OUTPUTS:
   EDS, the event damage set with:
       reference_year   : the year the damages are references to
       event_ID(event_i): the unique ID for each event_i
       damage(event_i)    : the damage amount for event_i
       Value            : the sum of allValues used in the calculation (to e.g. express
                          damages in percentage of total Value)
       frequency(event_i)      : the per occurrence event frequency for each event_i
       orig_event_flag(event_i): whether an original event (=1) or a
                                 probabilistic one (=0)
       hazard           : itself a structure, with:
                          .filename: the filename of the hazard event set
                          .comment : a free comment
       comment          : a free comment, contains time for calculation
       assets.filename  : the filename of the assets
       damagefunctions.filename: the filename of the damagefunctions
       annotation_name  : a kind of default title (sometimes empty)
       .AEL             : annual expected damage for the event set 
       .damage_sort       : downward sorted damages
       .damage_ori_sort   : downward sorted damages for original events 
       .R               : corresponding return periods for damage_sort 
       .R_ori           : corresponding return periods for damage_sort_orig
       .R_fit           : specified return periods
       .damage_fit        : damages for specified return periods
       .damage_fit_ori    : damages for specified return periods
 
 MODIFICATION HISTORY:
 Reto Stockmann, 20120813  
 Lea Mueller, 20120816
 David N. Bresch, david.bresch@gmail.com, 20130316, ELS-&ampgtEDS...
View <A HREF=file:../../climada/code/helper_functions/climada_EDS_stats.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_ED_plot">
<H2>climada_ED_plot</H2></A>
<font color="blue">function climada_ED_plot(EDS, percentage_of_value_flag,currency,unit_exp,logscale_check,schematic_check) </font>
 visualize Annual Expected Damage per centroid as a map
 NAME:
   climada_ED_plot
 PURPOSE:
   plot annual expected damage
 CALLING SEQUENCE:
   climada_ED_plot(EDS, percentage_of_value_flag)
 EXAMPLE:
   climada_ED_plot(EDS, percentage_of_value_flag)
 INPUTS:
   EDS, the event damage set with fields:
       reference_year: the year the losses are references to
       event_ID(event_i): the unique ID for each event_i
       damage(event_i): the loss amount for event_i
       Value: the sum of allValues used in the calculation (to e.g. express
           losses in percentage of total Value)
       frequency(event_i): the per occurrence event frequency for each event_i
       orig_event_flag(event_i): whether an original event (=1) or a
           probabilistic one (=0)
       comment: a free comment, contains time for calculation
       hazard: itself a structure, with:
           filename: the filename of the hazard event set
           comment: a free comment
       assets: struct with lon, lat, value and filename of assets
       damagefunctions.filename: the filename of the damage functions
       annotation_name: a kind of default title (sometimes empty)
 OPTIONAL INPUT PARAMETERS:
   percentage_of_value_flag: Set to 1 if you wish to plot damages as
                             percentage of asset values
   currency:   specify the currency unit, can be any string, e.g. 'EUR',
               default is 'USD'
   unit_exp:   specify the unit of the data (i.e. are the values in the 
               EDS struct in 10^3, 10^7 etc. The function automatically
               displays numbers in the best order of magnitude
 OUTPUTS:
   figure
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091228
 Gilles Stassen, gillesstassen@hotmail.com, 20150519 - update and cleanup
 Gilles Stassen, gillesstassen@hotmail.com, 20150528 - currency, unit_exp input args added
 Gilles Stassen, gillesstassen@hotmail.com, 20150528 - logscale_check added
 Gilles Stassen, gillesstassen@hotmail.com, 20150619 - sum damages at non-unique coords, caxis for logscale bug fix
 Gilles Stassen, gillesstassen@hotmail.com, 20150629 - schematic_check added
View <A HREF=file:../../climada/code/helper_functions/climada_ED_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_IFC_plot">
<H2>climada_IFC_plot</H2></A>
<font color="blue">function climada_IFC_plot(IFC,hist_check,check_log,color_index,new_figure) </font>
 climada
 NAME:
   climada_IFC_plot
 PURPOSE:
   Plots the intensity frequency curve of a given hazard set. See
   climada_hazard2IFC to create the IFC structure to be plotted from a
   climada hazard set.

   See also: climada_hazard_stats to plot reuturn period maps

   Previous call: climada_hazard2IFC
 CALLING SEQUENCE:
   climada_IFC_plot(IFC,hist_check,prob_check,Gumbel_check,check_log,color_index)
 EXAMPLE:
   climada_IFC_plot(IFC,1,1,0,3)
   climada_IFC_plot(climada_hazard2IFC)
 INPUTS:
   IFC:  An intensity frequency curve structure, created using
       climada_hazard2IFC. Either one IFC or an array of structures, i.e. IFC(i)
 OPTIONAL INPUT PARAMETERS:
   hist_check: Whether to plot the historical data points  (default = 1)
   check_log: Whether to use logarithmic x (return period) axis (default = 0)
   color_index: Specify the color pair:
       1:  Red/orange
       2:  Blue/light blue
       3:  Green/light green
       4:  Violet/light violet
       5:  Dark orange/golden
       6:  Black/gray
   new_figure: =1 (default) create new figure, =0 create none
 OUTPUTS:
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150130
 David N. Bresch, david.bresch@gmail.com, 20150309, bugfixes
 Lea Mueller, muellele@gmail.com, 20150318, changes according to hazard2IFC
 David N. Bresch, david.bresch@gmail.com, 20150405, IFC as struct array, white background
 Lea Mueller, muellele@gmail.com, 20160308, bugfix if no historical data
 david.bresch@gmail.com, 20160609, bugfix if no historical data improved
 david.bresch@gmail.com, 20160916, new figure added, helpful if called as climada_IFC_plot(climada_hazard2IFC)
 david.bresch@gmail.com, 20161010, make sure max x and y work
View <A HREF=file:../../climada/code/helper_functions/climada_IFC_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_NPV">
<H2>climada_NPV</H2></A>
<font color="blue">function NPV=climada_NPV(values,discount_rates) </font>
 climada NPV
 NAME:
   climada_NPV
 PURPOSE:
   calculate net present value (NPV) of a temporal (yearly) series of
   values (e.g. costs)
 CALLING SEQUENCE:
   NPV=climada_NPV(values,discount_rates)
 EXAMPLE:
   NPV=climada_NPV([10 10 10],[0.02 0.02 0.02])
 INPUTS:
   values: the vector with values (any currency)
       value(1) corresponds to todays's value, value(end) to the
       futuremost value.
   discount_rates: the vector with discount rates (decimal)
       if not give, a zero discount rate is used
       if only a single number is given, this is used as the discount rate
       for all years
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   NPV: the net present value of values after application of the discount rates
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20100221
View <A HREF=file:../../climada/code/helper_functions/climada_NPV.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_admin0_fix">
<H2>climada_admin0_fix</H2></A>
<font color="blue">function [shapes,admin0_info]=climada_admin0_fix(shapes,check_plot) </font>
 climada
 NAME:
   climada_admin0_fix
 PURPOSE:
   read a shape file (with admin0 shapes) and return shapes structure. Fix
   some issues with countries (i.e. France and DOM/TOM as separate shapes.

   See code for detials, especially the parameter section. All matching
   within this code happens via 3-digit ISO code (to avoid ambiguities).
   See e.g. climada_country_name to obtain the matching code(s).

   for each shape, we chekc for NaNs (separating segments) and then check
   whether these segments are indeed stand-alone admin regions. There is
   no global consensus, hence this code solves this issue with some
   pragmatism.

   See PARAMETERS in the code for any further information.

   This code usually treats the shape file ne_10m_coastline.shp obtained from
   www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/...
       cultural/ne_10m_admin_0_countries.zip
   which comes witht he climada country risk module:
   https://github.com/davidnbresch/climada_module_country_risk)

   Usually called from shapes=climada_shaperead('SYSTEM_ADMIN0')
 CALLING SEQUENCE:
   [shapes,admin0_info]=climada_admin0_fix(shapes,check_plot)
 EXAMPLE:
   shapes=climada_shaperead('.../ne_10m_coastline/ne_10m_coastline.shp');
   [shapes,admin0_info]=climada_admin0_fix(shapes,1)
 INPUTS:
   shapes: s shapes strcuture, as returned by climada_shaperead
 OPTIONAL INPUT PARAMETERS:
   check_plot: whether we show a check plot (=1, default) or not (=0)
 OUTPUTS:
   shapes: same as input, with two additions:
       in each shapes(i), there are two new variables, X_ALL and Y_ALL,
       the original Y and Y.
       at the end of the original shapes, the (sub) shapes of new admin0
       are appended, but only their key fields (NAME, ,X,Y) are
       propulated.
   admin0_info: a strcut with 
       ADM0_A3{i}: the ISO3 code for each shape, search e.g. using
           strmatch('CUW',admin0_info.ADM0_A3)
       NAME{i}: the name for each shape, search e.g. using
           strmatch('United States',admin0_info.NAME)
       BoundingBox{i}: the bounding box for each shape (to ease some
           triage when searching geographically)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161008, initial, taken out of climada_shaperead
View <A HREF=file:../../climada/code/helper_functions/climada_admin0_fix.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_admin1_get_shapes">
<H2>climada_admin1_get_shapes</H2></A>
<font color="blue">function admin1_shape_selection = climada_admin1_get_shapes(admin0_name,admin1_name) </font>
 climada select shapes that belong to one or more admin1_name
 MODULE:
   climada/code/helper_functions
 NAME:
   climada_admin1_get_shapes
 PURPOSE:
   Get a selection of admin1_shapes based on admin1_name or select on a
   map. If you select the admin1 on the map, press &quotEnter&quot in the command
   line to complete the selection on the map. Invokes
   climada_admin1_select_on_map. Hint: If admin1_name is 'all', the entire
   admin1_shape is returned.
 CALLING SEQUENCE:
   admin1_shape_selection = climada_admin1_get_shapes(admin0_name,admin1_name)
 EXAMPLE:
   admin1_shape_selection = climada_admin1_get_shapes;
   admin1_shape_selection = climada_admin1_get_shapes('Vietnam');
   admin1_shape_selection = climada_admin1_get_shapes('Vietnam','Y??n B??i');
   admin1_shape_selection = climada_admin1_get_shapes('Vietnam',{'VNM-5483' 'VNM-458'});
   admin1_shape_selection = climada_admin1_get_shapes('','all'); % get all admin1_shapes
   admin1_shape_selection = climada_admin1_get_shapes('Vietnam','all'); % get all admin1_shapes in Vietnam
 INPUTS:
   admin0_name: the country name, either full or ISO3
       &ampgt If empty, a list dialog lets the user select (default)
   admin1_name: or admin1_code, if passed on, do not prompt for admin1 name
       &ampgt If empty, a list dialog lets the user select (default), if is set
       to 'all', the admin1_shape is returned. 
 OPTIONAL INPUT PARAMETERS:
   none
 OUTPUTS:
   admin1_shape_selection: shape file (admin1_shapes) with selected admin1 only
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20160224, init
 Lea Mueller, muellele@gmail.com, 20160229, add functionality 'all' to return the entire admin1_shape set
 Lea Mueller, muellele@gmail.com, 20160229, move to climada/helper_functions, rename to climada_admin1_get_shapes
 Lea Mueller, muellele@gmail.com, 20160316, make sure admin1_name is a cell
 Lea Mueller, muellele@gmail.com, 20160429, bugfix in input
 Lea Mueller, muellele@gmail.com, 20160429, add functionality 'all' to return the all admin1 for a given country
 Lea Mueller, muellele@gmail.com, 20160509, use case-insensitive ismember to compare admin1_names
View <A HREF=file:../../climada/code/helper_functions/climada_admin1_get_shapes.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_admin1_select_on_map">
<H2>climada_admin1_select_on_map</H2></A>
<font color="blue">function listbox = climada_admin1_select_on_map(admin0_name,admin0_shapes,admin1_shapes) </font>
 climada select admin1 on a map
 MODULE:
   climada/code/helper_functions
 NAME:
   climada_admin1_select_on_map
 PURPOSE:
   Select admin1 or a multiple admin1 on a map for a given admin0_name
 CALLING SEQUENCE:
   listbox = climada_admin1_select_on_map(admin0_name)
 EXAMPLE:
   listbox = climada_admin1_select_on_map;
   listbox = climada_admin1_select_on_map('Vietnam');
   admin1_name = get(listbox,'UserData'); % use to identify the selected admin1_name
 INPUTS:
   admin0_name: admin0_name, e.g. 'Switzerland', 'Vietnam', prompted for
       if empty
 OPTIONAL INPUT PARAMETERS:
   none
 OUTPUTS:
   listbox: a listbox handle, from where we can identify the selected
   admin1_name using
   admin1_name = get(listbox,'UserData')
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20160224, init
 Lea Mueller, muellele@gmail.com, 20160229, move to climada/helper_functions, rename to climada_admin1_select_on_map
 Lea Mueller, muellele@gmail.com, 20160426, loop over single segments of polygons divided by nan
 Lea Mueller, muellele@gmail.com, 20160601, horizontal alignment of text in center
View <A HREF=file:../../climada/code/helper_functions/climada_admin1_select_on_map.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_arrow">
<H2>climada_arrow</H2></A>
<font color="blue">function [h,yy,zz] = climada_arrow(varargin) </font>
 ARROW  Draw a line with an arrowhead.

  ARROW(Start,Stop) draws a line with an arrow from Start to Stop (points
        should be vectors of length 2 or 3, or matrices with 2 or 3
        columns), and returns the graphics handle of the arrow(s).

        A copy of arrow, just to fix the following 'bug':
        Undefined function 'arrow' for input arguments of type 'double'
        The present version does read double...

  ARROW uses the mouse (click-drag) to create an arrow.

  ARROW DEMO &amp ARROW DEMO2 show 3-D &amp 2-D demos of the capabilities of ARROW.

  ARROW may be called with a normal argument list or a property-based list.
        ARROW(Start,Stop,Length,BaseAngle,TipAngle,Width,Page,CrossDir) is
        the full normal argument list, where all but the Start and Stop
        points are optional.  If you need to specify a later argument (e.g.,
        Page) but want default values of earlier ones (e.g., TipAngle),
        pass an empty matrix for the earlier ones (e.g., TipAngle=[]).

  ARROW('Property1',PropVal1,'Property2',PropVal2,...) creates arrows with the
        given properties, using default values for any unspecified or given as
        'default' or NaN.  Some properties used for line and patch objects are
        used in a modified fashion, others are passed directly to LINE, PATCH,
        or SET.  For a detailed properties explanation, call ARROW PROPERTIES.

        Start         The starting points.                     B
        Stop          The end points.                         /|\           ^
        Length        Length of the arrowhead in pixels.     /|||\          |
        BaseAngle     Base angle in degrees (ADE).          //|||\\        L|
        TipAngle      Tip angle in degrees (ABC).          ///|||\\\       e|
        Width         Width of the base in pixels.        ////|||\\\\      n|
        Page          Use hardcopy proportions.          /////|D|\\\\\     g|
        CrossDir      Vector || to arrowhead plane.     ////  |||  \\\\    t|
        NormalDir     Vector out of arrowhead plane.   ///    |||    \\\   h|
        Ends          Which end has an arrowhead.     //&amplt-----&ampgt||      \\   |
        ObjectHandles Vector of handles to update.   /   base |||        \  V
                                                    E    angle||&amplt--------&ampgtC
  ARROW(H,'Prop1',PropVal1,...), where H is a                 |||tipangle
        vector of handles to previously-created arrows        |||
        and/or line objects, will update the previously-      |||
        created arrows according to the current view       --&ampgt|A|&amplt-- width
        and any specified properties, and will convert
        two-point line objects to corresponding arrows.  ARROW(H) will update
        the arrows if the current view has changed.  Root, figure, or axes
        handles included in H are replaced by all descendant Arrow objects.

  A property list can follow any specified normal argument list, e.g.,
  ARROW([1 2 3],[0 0 0],36,'BaseAngle',60) creates an arrow from (1,2,3) to
  the origin, with an arrowhead of length 36 pixels and 60-degree base angle.

  The basic arguments or properties can generally be vectorized to create
  multiple arrows with the same call.  This is done by passing a property
  with one row per arrow, or, if all arrows are to have the same property
  value, just one row may be specified.

  You may want to execute AXIS(AXIS) before calling ARROW so it doesn't change
  the axes on you; ARROW determines the sizes of arrow components BEFORE the
  arrow is plotted, so if ARROW changes axis limits, arrows may be malformed.

  This version of ARROW uses features of MATLAB 6.x and is incompatible with
  earlier MATLAB versions (ARROW for MATLAB 4.2c is available separately);
  some problems with perspective plots still exist.
 Copyright (c)1995-2009, Dr. Erik A. Johnson &ampltJohnsonE@usc.edu&ampgt, 5/20/2009
 http://www.usc.edu/civil_eng/johnsone/
 Lea Mueller, muellele@gmail.com, 20160428, update to version 2015
View <A HREF=file:../../climada/code/helper_functions/climada_arrow.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_asci2hazard">
<H2>climada_asci2hazard</H2></A>
<font color="blue">function hazard = climada_asci2hazard(asci_file, row_count, utm_transformation) </font>
 climada_asci2hazard
 MODULE:
   climada core
 NAME:
   climada_asci2hazard
 PURPOSE:
   read hazard event asci files and transform to climada hazard structure, 
   asci files can be saved in climada/data/hazard/external_model_output or 
   climada/data/hazard/myfolder and named asci_filename1.asc, asci_filename2.asc,...
   Please manually add the following fields: .peril_ID, .units, .comment, 
   .orig_years, .frequency, .yyyy and .datenum. Default: Every event is set to one year, starting
   with 1-Jan-0001, 1-Jan-0002,...
 CALLING SEQUENCE:
   hazard=climada_asci2hazard(asci_file)
 EXAMPLE:
   hazard=climada_asci2hazard
 INPUTS: 
 OPTIONAL INPUT PARAMETERS:
   asci_file: prompted for if not given. Asci file is delimited by tabs
   (\t) and has 6 rows of information (ncols, nrows, xllcorner, yllcorner,
   cellsize, NODATA_value).
   utm_transformation: special case 'barisal' and 'salvador' to enable
   local coordinate system transformation to utm lat lon coordinates.
 OUTPUTS: hazard
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150313, init
 Lea Mueller, muellele@gmail.com, 20150326, changes for generalisation
 Lea Mueller, muellele@gmail.com, 20150511, row_count input added, 10 if empty
 Lea Mueller, muellele@gmail.com, 20150617, utm_tranformation added, to
              specific for barisal coordinate transformation and salvador
 Lea Mueller, muellele@gmail.com, 20150623, bugfix if not tranfomration needed
 Lea Mueller, muellele@gmail.com, 20150815, special case for San Salvador, where we get lon/lat min/max 
                                            directly from Maxime/GFA, thus ignoring xllorner and yllcorner
 Lea Mueller, muellele@gmail.com, 20150815, replace .asc with ext, so that txt-files can be processed as well
View <A HREF=file:../../climada/code/helper_functions/climada_asci2hazard.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_ascii_read">
<H2>climada_ascii_read</H2></A>
<font color="blue">function output = climada_ascii_read(asci_file,save_file,check_plot,delim) </font>
 climada_ascii_read
 MODULE:
   climada core
 NAME:
   climada_ascii_read
 PURPOSE:
   read asci file and store as struct with the following fields: .lon,
   .lat, .value, .comment
 CALLING SEQUENCE:
   output = climada_ascii_read(asci_file,save_file,check_plot,delim)
 EXAMPLE:
   output = climada_ascii_read(asci_file)
 INPUTS: 
 OPTIONAL INPUT PARAMETERS:
   asci_file: prompted for if not given. Asci file is delimited by tabs
   (\t) and has 6 rows of information (ncols, nrows, xllcorner, yllcorner,
   cellsize, NODATA_value).
 OUTPUTS: output structure with fields .lon, .lat, .value, .comment
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150511, init
View <A HREF=file:../../climada_modules/_barisal_demo/code/helper_functions/climada_ascii_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_assets_category_ID">
<H2>climada_assets_category_ID</H2></A>
<font color="blue">function assets = climada_assets_category_ID(assets) </font>
 climada_assets_category_ID
 MODULE:
   core/helper_functions
 NAME:
   climada_assets_category_ID
 PURPOSE:
   Do NOT use this function any more, since entity does already contain
   Category_ID, not category and more [david.bresch@gmail.com, 20160917].

   Create category IDs (assets.Category_name, assets.Category_ID) and
   overwrite assets.Category with IDs. This is saves memory space.
 CALLING SEQUENCE:
   assets = climada_assets_category_ID(assets)
 EXAMPLE:
   assets = climada_assets_category_ID
   assets = climada_assets_category_ID('entity_template.xlsx')
   assets = climada_assets_category_ID(assets)
 INPUTS:
   assets: a climada assets structure (included in entity), contains
   fields .lon, .lat, .Value, .Category. If .Category is not given, this
   function does nothing. 
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151207, init
 Lea Mueller, muellele@gmail.com, 20151208, add Category_name and Category_ID also if field Category does not exist (.Category_name = 'All categories'; .Category_ID = ''; .Category = '';)
 Lea Mueller, muellele@gmail.com, 20151217, make sure assets.Category_name is a cell
View <A HREF=file:../../climada/code/helper_functions/climada_assets_category_ID.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_assets_complete">
<H2>climada_assets_complete</H2></A>
<font color="blue">function assets = climada_assets_complete(assets) </font>
 climada assets read import check complete
 NAME:
   climada_assets_complete
 PURPOSE:
   check for completeness of an assets structure, i.e. that all
   fields are there and populated with default values (this speeds up all
   later cimada calls, as we do not need to run many isfield commands
   etc). This code also makes sure all arrays in assets are 1xN (they come
   as Nx1 from Excel read).

   This code is kept as a separate function (i.e. called from but not part of
   climada_assets_read) in order to allow calling it for assets not read
   from an Excel file, e.g. if a user constructs the entity structure
   him/herself.

   called from: climada_assets_read
 CALLING SEQUENCE:
   assets = climada_assets_complete(assets)
 EXAMPLE:
   assets = climada_assets_complete(assets)
 INPUTS:
   assets: the assets structure of entity.assets, see climada_entity_read
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
    assets: same as input, with fields completed
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20160918, initial
View <A HREF=file:../../climada/code/helper_functions/climada_assets_complete.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_assets_encode">
<H2>climada_assets_encode</H2></A>
<font color="blue">function entityORassets = climada_assets_encode(entityORassets,hazard,max_encoding_distance_m) </font>
 climada assets encode
 NAME:
   climada_assets_encode
 PURPOSE:
   encode an entity (an already read assets file)
   eoncoding means: map read data points to calculation centroids of
   hazard event set
   
   Accepts both entity or assets as well as hazard or centroids as input,
   output i therefore either entity (if entity on input) or assets (if
   assets on input)

   normally called from: climada_entity_read
   see also: climada_assets_encode_check
 CALLING SEQUENCE:
   entityORassets=climada_assets_encode(entityORassets,hazard,max_encoding_distance_m)
 EXAMPLE:
   assets=climada_assets_encode(climada_entity_load)
 INPUTS:
   entityORassets: an assets structure (such as entity.assets), see
       climada_entity_read. Or just the full entity (with assets in entity.assets)
       &ampgt prompted for if empty (promting for an entity, the assets within
       are then taken - in this case, instead of assets, the entity is
       returned in 'assets')
   hazard: either a hazard set (struct) or a hazard set file (.mat with a
       struct) or a centroid struct (as returned by climada_centroids_load or
       climada_centroids_read). hazard needs to have fields hazard.lon and
       hazard.lat, centroids fields centroids.lon and centroids.lat  
       &ampgt promted for if not given (select either a hazard event set or a
       centroids .mat file)
       if set to 'SKIP', do not encode, return original assets (used for
       special cases, where this way no need for if statements prior to
       calling climada_assets_encode)
       SPECIAL: centroids with centroid_ID&amplt0 (in either hazard.centroid_ID
       or centroids.centroid_ID) are not used in encoding.
       (this way the user can e.g. temporarily 'disable' centroids prior
       to passing them to climada_assets_encode by simply setting their
       centroid_ID=-1)
       NOTE: if isfield(centroids,'peril_ID') and FL some special rules apply
 OPTIONAL INPUT PARAMETERS:
   max_encoding_distance_m: the maximum distance to encode an asset
       location to a centroid (in meters, e.g. 1e5 for 100km). Default
       is climada_global.max_encoding_distance_m, or, if there is a field
       hazard.max_encoding_distance_m.
 OUTPUTS:
   the encoded assets, means locations mapped to calculation centroids
       new field assets.centroid_index added
       NOTE: in case an entity instead of assets was passed on input, the
       output is also the entity
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091227
 David N. Bresch, david.bresch@gmail.com, 20100107, revised, changed from entity.assets to assets
 David N. Bresch, david.bresch@gmail.com, 20141127, allows for assets OR entity as input
 David N. Bresch, david.bresch@gmail.com, 20141127, allows for hazard OR centroids as input
 Lea Mueller, muellele@gmail.com, 20150511, only for unique lon/lat values, essential speedup
 David N. Bresch, david.bresch@gmail.com, 20150610, Lea's speedup fixed
 Lea Mueller, muellele@gmail.com, 20150617, speedup works for both dimensions of entity.lats and .lons (1xn and nx1)
 David N. Bresch, david.bresch@gmail.com, 20150618, Lea's speedup fixed 2nd time (line 134)
 Lea Mueller, muellele@gmail.com, 20150805, define a maximum distance to hazard, otherwise centroid_index is set to 0 and no damage wil be calculated (see climada_EDS_calc)             
 David N. Bresch, david.bresch@gmail.com, 20150825, bug-fix to use centroids instead of hazard
 Lea Mueller, muellele@gmail.com, 20150915, set max_encoding_distance_m as input variable
 Lea Mueller, muellele@gmail.com, 20150916, add max_distance in waitbar text
 David N. Bresch, david.bresch@gmail.com, 20160606, max_distance_to_hazard renamed to max_encoding_distance_m and speedup
 David N. Bresch, david.bresch@gmail.com, 20161120, (waitbar) comments removed
 David N. Bresch, david.bresch@gmail.com, 20170228, progress to stdout fewer times
View <A HREF=file:../../climada/code/helper_functions/climada_assets_encode.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_assets_encode_check">
<H2>climada_assets_encode_check</H2></A>
<font color="blue">function climada_assets_encode_check(assets,hazard) </font>
 climada assets encode
 NAME:
   climada_assets_encode_check
 PURPOSE:
   check an encoded assets or entity structure, i.e. whether the
   coordinates in the structure map well to the hazard centroids

   eoncoding means: map read data points to calculation centroids of
   hazard event set, see climada_assets_encode
 CALLING SEQUENCE:
   assets=climada_assets_encode_check(assets)
 EXAMPLE:
   climada_assets_encode_check(climada_entity_load)
 INPUTS:
   assets: a read assets OR an entity structure, see climada_entity_read
       &ampgt prompted for if empty (promting for an entity, the assets within
       are then taken)
 OPTIONAL INPUT PARAMETERS:
   hazard: a hazard to check against (optional, since the code tries to
       use the hazard as specified in assets.hazard.filename). If hazard
       is passed, assets.hazard.filename is ignored
       Default is no hazard on input, using assets.hazard.filename
 OUTPUTS:
   a plot, showing the encoding
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141219, initial
 David N. Bresch, david.bresch@gmail.com, 20141230, hazard as input option added
 David N. Bresch, david.bresch@gmail.com, 20150716, logical (line 72) fixed
 David N. Bresch, david.bresch@gmail.com, 20160606, small error in plot fixed
View <A HREF=file:../../climada/code/helper_functions/climada_assets_encode_check.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_assets_read">
<H2>climada_assets_read</H2></A>
<font color="blue">function assets = climada_assets_read(assets_filename,hazard) </font>
 climada assets read import
 NAME:
   climada_assets_read
 PURPOSE:
   read assets with Longitude (lon), Latitude (lat) and Values (the
   mandatory fields, all other fields are automatically added if needed). 
   See climada_entity_read for a comprehensive description of output fields.

   climada_assets_complete and climada_assets_encode are automatically invoked.
   usually called from climada_entity_read, see climada_entity_read for
   more information.

   The code invokes climada_spreadsheet_read to really read the data,
   which implements .xls, .xlsx and .ods files. For .xls, the sheet names
   are dynamically checked, for .ods, the sheet names are hard-wired (see
   code), means for .ods, the sheet 'assets' needs to exist.

   called from: climada_entity_read
 CALLING SEQUENCE:
   assets = climada_assets_read(assets_filename,hazard)
 EXAMPLE:
   assets = climada_assets_read;
 INPUTS:
   assets_filename: the filename of the Excel (or .ods) file with the assets
       If no path provided, default path ../data/entities is used
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       &ampgt promted for if not given (out of climada_assets_encode)
       ='NOENCODE' or 'noencode': do not encode assets, see climada_assets_encode
 OUTPUTS:
    assets: a structure, with
           Latitude: the latitude of the values
           Longitude: the longitude of the values
           Value: the total insurable value
           Deductible: the deductible
           Cover: the cover
           DamageFunID: the damagefunction curve ID
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151117, init from climada_entity_read to read only assets
 David Bresch, david.bresch@gmail.com, 20151119, bugfix for Octave to try/catch xlsinfo
 Lea Mueller, muellele@gmail.com, 20151127, add assets.region and assets.refence_year
 Lea Mueller, muellele@gmail.com, 20151207, return if already a complete assets structure as input
 Lea Mueller, muellele@gmail.com, 20151207, invoke climada_assets_category_ID
 david.bresch@gmail.com, 20160603, make sure we have 1xN arrays
 david.bresch@gmail.com, 20160916, see remark in code
 david.bresch@gmail.com, 20160917, Category treatment removed, since Category_ID new in Excel
 david.bresch@gmail.com, 20160917, Region_ID and Value_unit added, assets_save_file removed
 david.bresch@gmail.com, 20160918, climada_assets_complete added
 david.bresch@gmail.com, 20160919, assets.reference_year moved to climada_names_read
View <A HREF=file:../../climada/code/helper_functions/climada_assets_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_assets_select">
<H2>climada_assets_select</H2></A>
<font color="blue">function [is_selected,peril_criterum,unit_criterium,category_criterium] = climada_assets_select(entity,peril_criterum,unit_criterium,category_criterium,silent_mode) </font>
  Create a selection array to select a subset of asset locations
 MODULE:
   climada core
 NAME:
   climada_assets_select
 PURPOSE:
   Create a selection array to select a subset of asset locations, that
   match a peril, a unit and a category (e.g. FL, USD, Category 7). Selected assets must fullfil ALL
   criterias. However empty criterium will select all assets.
 CALLING SEQUENCE:
   is_selected = climada_assets_select(entity,peril_criterum,unit_criterium, category_criterium)
 EXAMPLE:
   is_selected = climada_assets_select(entity,'FL','USD',6)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   entity:  climada entity structure, with fields entity.assets.Value_unit
            and entity.damagefunctions.peril_ID
   peril_criterum: a string, e.g. 'FL' or 'TC'
   unit_criterium: a string, e.g. 'USD' or 'people'
   category_criterium: a string or a number, e.g. 7
   silent_mode: set to 1 if no fprintf output
 OUTPUTS:
   is_selected   : a logical array that points to the selected asset locations
   peril_criterum: a string or a cell, e.g. 'FL' or 'TC'
   unit_criterium: a string or a cell, e.g. 'USD' or 'people'
   category_criterium: a string, cell or a number, e.g. 7
View <A HREF=file:../../climada/code/helper_functions/climada_assets_select.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_calibrate">
<H2>climada_calibrate</H2></A>
<font color="blue">function [res,params]=climada_calibrate(entity,hazard,damage_data,params) </font>
 climada template
 MODULE:
   module name
 NAME:
   climada_template
 PURPOSE:
   calibrate one single peril for a given set of assets (e.g. within a
   country or region) and a set of reported damages.

   Since the code is quite versatile, the input damage_data can be of
   different from (mapped to events, unmapped but with hazard index or
   with unique ID, unmapped and just to be used 'bulk'). See description
   of damage_data and please read once the whole.

   previous call: many
   next call: climada_EDS_calc, see also: climada_DFC_compare
 CALLING SEQUENCE:
   res=climada_calibrate(entity,hazard,damage_data,params)
 EXAMPLE:
   p.hazard_file='GLB_0360as_TC_hist';entity=isimip_gdp_entity('USA',p);
   entity=climada_entity_load('USA_0360as_entity');
   damage_data=isimip_damage_read('','',entity.hazard.ID_no);
   pos=strmatch('USA',damage_data.ISO);damage_data=climada_subarray(damage_data,pos);  
   res=climada_calibrate(entity,[],damage_data);
   params=climada_calibrate('params'); % return default parameters
 INPUTS:
   entity: an entity structure or an entity .mat file, see climada_assets_encode(climada_assets_read)
       If a file and no path provided, default path ../data/entities is
       used (and name can be without extension .mat)
       &ampgt promted for if not given
       SPECIAL: entity might contain hazard in entity.hazard 
       SPECIAL: entity might contain damage_data in entity.damage_data
       if ='params', just return default parameters, in res, i.e. the
           first output, already.
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       If a file and no path provided, default path ../data/hazards is
       used (and name can be without extension .mat). If hazard is empty
       and entity contains hazard in entity.hazard, this hazard is used.
       Minimum fileds of hazard struct are: 
       peril_ID, event_ID, centroid_ID, intensity and frequency 
   damage_data: a structure with damage data, mapped onto single events to
       match with hazard, four options:
     damage data mapped to events already:
       damage(record_i): the reported damage for event i, which
           corresponds to event_i in the hazard, i.e. to
           hazard.event_ID(event_i) etc., with damage(event_i)=0 for all
           events with no damage.
       NOTE: if length of damage_data.damage and number of events in
       hazard is exactly the same, we assume this option to be the case.
     damage with a mapping table:
       damage(i): damage for record i
       hazard_index(i): index into hazard.*(hazard_index(i))
     damage with a unique ID as in the hazard
       damage(i): damage for record i
       ID_no(i): ID which corresponds to hazard.ID_no
     just a set of damages, not associated with hazard events:
       damage(i): damage of damage record i, not mapped to any event
     for all three options, we have the following additional field(s)
       n_years: the number of years the damage records represent (prio 1),
           as this can be more years than between min/max(year) OR
       year(i): year of record i (prio 2). If present, we can at least
           macth by year and compare simulated vs reported annual damage
       frequency(i): occurence frequency of damage record i
       NOTE: if none of n_years, year or frequency is provided, we assume
           the same timespan as for hazard, i.e. hazard.frequency
 OPTIONAL INPUT PARAMETERS:
   params: a structure with fields (see also entity='params' above):
    log10: if =1 (default, show log10(damages), linear else (=0)
 OUTPUTS:
   res: the output, empty if not successful
       =params, if entity='params' on input
   params: as on input, plus some information
    damage_data_type: which type of mapping reorted with simulated damages
       has been used.
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170315, initial
View <A HREF=file:../../climada/code/helper_functions/climada_calibrate.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_centroids_cleanup">
<H2>climada_centroids_cleanup</H2></A>
<font color="blue">function ok=climada_centroids_cleanup </font>
 climada cleanup centroids
 MODULE:
   core
 NAME:
   climada_centroids_cleanup
 PURPOSE:
   moves all centroid files into centroid folder
   (in the past, they were stored in system folder)

   Note: this code is currently invoked ONCE by climada_init_vars. There,
   a small file ../system/climada_centroids_cleanup_done.txt is written to
   indicate successful execution. We will remove this cleanup in winter
   2015 latest.
 CALLING SEQUENCE:
   ok=climada_centroids_cleanup
 EXAMPLE:
   ok=climada_centroids_cleanup
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   ok: =1 if all done, see error messages else
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150819
View <A HREF=file:../../climada/code/helper_functions/climada_centroids_cleanup.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_centroids_load">
<H2>climada_centroids_load</H2></A>
<font color="blue">function centroids=climada_centroids_load(centroids) </font>
 climada
 NAME:
   climada_centroids_load
 PURPOSE:
   load previously saved centroids (just to avoid typing long paths and
   filenames in the cmd window)
   Works also if the file contains an entity.

   Previous call: climada_centroids_read
 CALLING SEQUENCE:
   centroids_out=climada_centroids_load(centroids_file)
 EXAMPLE:
   centroids_out=climada_centroids_load(centroids_file)
 INPUTS:
   entity: the filename (and path, optional) of a previously saved centroids
       structure. If no path provided, default path ../data/centroids is used
       (and name can be without extension .mat or even without _entity.mat)
       &ampgt promted for if empty
       OR: a centroids structure, in which cas it is just returned (to allow
       calling climada_centroids_load anytime, see e.g. climada_EDS_calc)
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   centroids_out: a struct, see e.g. climada_centroids_read for details
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20130719
 david.bresch@gmail.com, 20150804, allow for name without path on input
 david.bresch@gmail.com, 20150817, climada_global.centroids_dir
 david.bresch@gmail.com, 20160516, allow for filename without _centroids
 david.bresch@gmail.com, 20160528, fix for .mat extension
 david.bresch@gmail.com, 20160703, same full flexibility as climada_entity_load
View <A HREF=file:../../climada/code/helper_functions/climada_centroids_load.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_centroids_plot">
<H2>climada_centroids_plot</H2></A>
<font color="blue">function climada_centroids_plot(centroids,country_name,plot_all) </font>
 plot centroids on a map, differentiate for coastal land areas,
 bufferzone, and further away (more inland and on sea)
 NAME:
   climada_centroids_plot
 PURPOSE:
   plot centroids on a map, differentiate for coastal land areas,
   bufferzone, and further away (more inland and on sea)
   next: diverse
 CALLING SEQUENCE:
   climada_centroids_plot(centroids,country_name)
 EXAMPLE:
   climada_centroids_plot(climada_centroids_load)
 INPUTS:
   centroids: centroids structure
       &ampgt prompts for already read centroids if empty
   country_name: name of the country (cell or string)
       Only used to label the plot
 OPTIONAL INPUT PARAMETERS:
   plot_all: if =1, plot all centroids (also grid) (default=0)
 OUTPUTS:
   plot
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20140205
 David N. Bresch, david.bresch@gmail.com, 20150203, renamed from climada_plot_centroids to climada_centroids_plot
 David N. Bresch, david.bresch@gmail.com, 20160514, plot_all added
View <A HREF=file:../../climada/code/helper_functions/climada_centroids_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_centroids_read">
<H2>climada_centroids_read</H2></A>
<font color="blue">function centroids = climada_centroids_read(centroids_filename, centroids_save_file, visualize, add_regular_grid) </font>
 climada measures read import
 NAME:
   climada_centroids_read
 PURPOSE:
   read the Excel file with the list of measures
 CALLING SEQUENCE:
   centroids = climada_centroids_read(centroids_filename)
 EXAMPLE:
   centroids = climada_centroids_read
   centroids = climada_centroids_read('','',1) % to plot
 INPUTS:
   centroids_filename: the filename of the Excel file with the centroids
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   centroids_save_file: filename for saving of centroids in
       ...\climada\system\... (default is Excel filename with ext .mat)
       'NO_SAVE' to suppress saving centroids
       'PROMPT' to prompt for via file dialog
   visualize: whether we plot the centroids on a map (=1) or not (=0, default)
   add_regular_grid: add a regular grid for plotting purposes (default=1)
 OUTPUTS:
   centroids: a structure, with (at least)
       lon  (1,:): the longitudes   
       lat   (1,:): the latitudes   
       centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091229
 Lea Mueller, 20110718
 David N. Bresch, david.bresch@gmail.com, 20120505, cleanup
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir and add_regular_grid as input parameter
 David N. Bresch, david.bresch@gmail.com, 20160514, lon/lat in header description updated
View <A HREF=file:../../climada/code/helper_functions/climada_centroids_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_check_matfile">
<H2>climada_check_matfile</H2></A>
<font color="blue">function [ok,mat_filename]=climada_check_matfile(source_filename,mat_filename) </font>
 climada
 NAME:
   climada_check_matfile
 PURPOSE:
   check for existence of the .mat file (binary) version of the source
   file (source_filename, usually a .xls) and check for the .mat file
   being more recent than the source

   The code does NOT re-read the source_file, as this is context specific
   and the .mat file might contain more than the raw content of the source
   file
 CALLING SEQUENCE:
   ok=climada_check_matfile(source_filename,mat_filename)
 EXAMPLE:
   ok=climada_check_matfile
 INPUTS:
   source_filename: the source filename, most likely a .xls file that gets
       imported into climada and saved as .mat (binary)
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   mat_filename: check for the given filename of the binary file
       if empty, use the source_filename with its extension replaced by
       .mat to check against
 OUTPUTS:
   ok: =1 if .mat file exists and is more recent than source file
       =0 if .mat file does not exist or if source file is more recent
   mat_filename: the .mat filename
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141104
 David N. Bresch, david.bresch@gmail.com, 20141208, datenum_mat-datenum_source&ampgt=0
 Lea Mueller, muellele@gmail.com, 20150305, datenum taken automatically
 from file (for source and mat_file), due to problems with German version
 David N. Bresch, david.bresch@gmail.com, 20170224, mat_filename output
View <A HREF=file:../../climada/code/helper_functions/climada_check_matfile.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_circle_plot">
<H2>climada_circle_plot</H2></A>
<font color="blue">function climada_circle_plot(values,lon,lat,title_str,circle_diam,circle_format,marker_size,marker_format,overlay_plot,axis_range,max_value) </font>
 climada catos event damage hazard probabilistic stochastic
 NAME:
   climada_circle_plot
 PURPOSE:
   plot circles with diameters scaled by values
   in the range min(values)..max(values)
   the routine does not open a new figure if one exists

   see climada_circle_plot_legend for a legend to this plot

   %% precedes a switched off option, not a comment

 CALLING SEQUENCE:
   climada_circle_plot(values,lon,lat,title_str,circle_diam,circle_format,marker_size,marker_format,overlay_plot,axis_range,max_value);
 EXAMPLE:
   climada_circle_plot('Test',lon,lat,values,10)
 INPUTS:
   values(i): the values to display
   lon(i),lat(i): the coordinates of the values (same length as values)
   title_str: plot title
 OPTIONAL INPUT PARAMETERS:
   circle_diam: max diameter of the circles, default=10
   circle_format: format as in plot, like 'or' for red circles, default='or'
   marker_size: size of markers denoting centers, default=2
   marker_format: format as in plot, default='+b'
   overlay_plot: if set to 1, only do an overlay, no country borders...,
       default=0
   axis_range: if set [min(lon) max(lon) min(lat) max(lat)], otherwise
       determined in the function
   max_value: if set, use this value to scale circle diameters, otherwise
       max(values) is used
 OUTPUTS:
   figure
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120430
 David N. Bresch, david.bresch@gmail.com, 20141213, plot zooms to relevant area
 David N. Bresch, david.bresch@gmail.com, 20150206, cleanup
View <A HREF=file:../../climada/code/helper_functions/climada_circle_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_code_copy">
<H2>climada_code_copy</H2></A>
<font color="blue">function climada_code_copy(verbose) </font>
 climada code copy
 NAME:
   climada_code_copy
 PURPOSE:
   Copy all climada code and code of all active modules into a new folder
   structure for easy exchange (e.g. to be zipped and sent by email).
   Overwrites any existing climada_code_bucket folder (in order to have a
   clean code version, delete any possibly existing climada_code_bucket
   folder before calling)

   It's mainly intended to be used to support users unable to get git
   installed. That's why there is no 'code extract' or the like, as the
   local names of the user's repositories might differ etc.

   see also climada_git_pull_repositories (recommended for all with local
   git installed, since much more comprehensive, user-friendly etc.)
   
   and climada_code_update, which updated local code based on the
   climada_code_bucket created by climada_code_copy
 CALLING SEQUENCE:
   climada_code_copy(verbose)
 EXAMPLE:
   climada_code_copy
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   verbose: if =1, lost copied files to stdout
       if =2, only list filenames, without folder
       if =0, silent, only notify errors (default)
 OUTPUTS:
   writes a folder [climada_global.root_dir]\climada_code_bucket with code
       for core climada and modules as sub-folders
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141105
 David N. Bresch, david.bresch@gmail.com, 20141107, cleanup (on flight to Dubai)
View <A HREF=file:../../climada/code/helper_functions/climada_code_copy.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_code_optimizer">
<H2>climada_code_optimizer</H2></A>
<font color="blue">function climada_code_optimizer(code_file) </font>
 climada
 NAME:
   climada_code_optimizer
 PURPOSE:
   optimize climada code by removing waitbars etc. Very simple mechanisms,
   just any line which comprises the tag % CLIMADA_OPT is removed
   so the optimization is fully controlled by the programmer
 CALLING SEQUENCE:
   climada_code_optimizer(code_file)
 EXAMPLE:
   climada_code_optimizer
 INPUTS:
   code_file: the code file to be optimized
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   the optimized, code, _OPT added at the end (prior to the suffix)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091228
View <A HREF=file:../../climada/code/helper_functions/climada_code_optimizer.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_code_update">
<H2>climada_code_update</H2></A>
<font color="blue">function climada_code_update(code_bucket_folder) </font>
 Import the latest climada code update
 NAME:
	climada_code_update
 PURPOSE:
   Automate the import of updated climada code files.

   NOTE: For this routine to work, it is assumed that the existing
   climada module directories are of the form climada_module_x_x. The code
   in these directories should be stored in a subfolder named 'code'.
   Finally, this function relies on the fact that the name of the climada
   module dirs, i.e. climada_module_x_x, is contained within the name of
   the respective folder in climada_code_bucket.

   See climada_code_copy, which copies all climada code and code of all
   active modules into a new folder structure for easy exchange (e.g. to
   be zipped and sent by email).
 CALLING SEQUENCE:
   climada_code_update(code_bucket_folder)
 EXAMPLE:
   climada_code_update(code_bucket_folder)
   climada_code_update
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   code_bucket_folder: Specify the path of the unzipped climada code
       bucket, containing the code files to be extracted and copied into
       the climada code folders.
 OUTPUTS:
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com 20141124
 David N. Bresch, david.bresch@gmail.com, 20141125, reference to climada_code_copy added
View <A HREF=file:../../climada/code/helper_functions/climada_code_update.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_collect_measures_impact">
<H2>climada_collect_measures_impact</H2></A>
<font color="blue">function impact_collected=climada_collect_measures_impact(impact1,impact2) </font>
climada
 NAME:
   climada_collect_measures_impact
 PURPOSE:
   collect impact files for two hazards created by climada_measures_impact
   next step: climada_adaptation_cost_curve

   1. sum up benefit (loss averted) for shared measures
   2. cost of shared measures - take higher costs if costs not the same --&ampgt WARNING
   3. It is assumed that the two hazards are insured separately, therefore
       make sure to not use the same name for both hazards e.g. risk_transfer_rain
       and risk_transfer_wind. If one insurance covers both hazards sum up the losses
       of both hazards, apply the risk transfer and calculate the NPV of
       the benefits and the premium

 CALLING SEQUENCE:
   impact_collected=climada_collect_measures_impact(impact1,impact2))
 INPUTS:
   impact: 2 struct files with impact on ELS of differnet adaptation measures
   see climada_measures_impact
       &ampgt promted for if not given
 OUTPUTS:
   impact_collected: struct file which includes the impact of both shared
   and unique measures.

   -   new cost benefit ratios: for shared measures the benefits
       were summed up and the costs taken only once (if costs are not the
       same the higher ones are taken -&ampgtwarning)

   -   Risk transfer was not changed asuming that the two hazards are
       insured separately.

   EL(measure_i): the annual expected loss to the assets under measure_i
   benefit(measure_i):NPV of the benefit of measure_i
   cb_ratio(measure_i):initial cost or NPV of insurance premium (for risk transfer only)
                       divided by NPV of benefit (averted loss) of measure_i
   measures: just a copy of measures, so we have all we need together
   risk_transfer: NPV of insurance rate (risk transfer costs)
   NPV_total_climate_risk: NPV of loss without measures
   EL: annual unmitigated loss (no measures)
   title_str: a meaningful title stating the two collected impacts

 MODIFICATION HISTORY:
 Martin Heynen, 20120313
 david.bresch@gmail.com, 20140804, GIT update
 david.bresch@gmail.com, 20141020, moved from tc_rain to core climada
View <A HREF=file:../../climada/code/helper_functions/climada_collect_measures_impact.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_color_plot">
<H2>climada_color_plot</H2></A>
<font color="blue">function fig = climada_color_plot(values,lon,lat,figure_name,title_str,plot_method,interp_method,npoints,plot_centroids,caxis_range,cmap,stencil_ext) </font>
 color plot
 NAME:
   climada_color_plot
 PURPOSE:
   helper function to make nice color plot
   does only show values in the vicinity of the hazard zone centroids

   for speed up, if one gives the npoints negative, the mask is stored

   %% precedes a switched off option, not a comment

 CALLING SEQUENCE:
   climada_color_plot(values,lon,lat,figure_name,title_str,plot_method,interp_method,npoints)
 EXAMPLE:
   climada_color_plot(mean(hazard.intensity,2),hazard.lon,hazard.lat)
 INPUTS:
   values(i): values
   lon(i),lat(i): coordinates of values, same length as values
   interactive_mode: 'interactive' allows for GUIs
 OPTIONAL INPUT PARAMETERS:
   figure_name: name of the figure window, if set to 'none', no figure is opened
   title_str:plot title
   plot_method: 'pcolor', 'contour', 'plotclr', default is matrix
   interp_method: method in griddata, like 'linear', 'cubic',...
   npoints: the number of points used
   plot_centroids: =1 plor centroids, =0 not (default)
   caxis_range: [min max] data values for constant color bars
   stencil_ext: to extend the stencil range (in units of the target grid,
       default=0
 OUTPUTS:
   makes new figure
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120430
 Lea Mueller, muellele@gmail.com, 20151124, add fig output
 Lea Mueller, muellele@gmail.com, 20151130, add plotclr option
 Lea Mueller, muellele@gmail.com, 20151130, set marker to '' so it is taken from climada_global.marker
 Lea Mueller, muellele@gmail.com, 20150226, correct type (contourF instead of contour)
 Lea Mueller, muellele@gmail.com, 20160229, introduce climada_global.admin1_plot, if 1, show all admin1 lines
 Lea Mueller, muellele@gmail.com, 20160229, rename to climada_shapeplotter from shape_plotter
 Lea Mueller, muellele@gmail.com, 20160314, add figure scale (climada_figure_scale_add)
 Lea Mueller, muellele@gmail.com, 20160314, add caxis_range (also for contourf)
View <A HREF=file:../../climada/code/helper_functions/climada_color_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_colormap">
<H2>climada_colormap</H2></A>
<font color="blue">function [cmap, c_ax] = climada_colormap(peril_ID, steps10) </font>
 climada color map
 NAME:
   climada_colormap
 PURPOSE:
   a helper function, returns a color map for specified perils, if empty
   peril ID cmap jet is returned
 CALLING SEQUENCE:
   cmap = climada_colormap(peril_ID)
 EXAMPLE:
   cmap = climada_colormap('TC')
 INPUTS:
   peril_ID: a 2-digit char peril ID, currently implemented are 'TC',
   'TS', 'TR', 'FL', 'LS', 'FS' (factor of safety), see code for latest.
       Or some (very) specific color maps, like:
       ='assets','damage','schematic' or 'benefit'
       ='colorbrewer_sequential' for a colormap for sequential data that
       prints well in b/w and even when photocopied (http://colorbrewer2.org)
       ='colorbrewer_diverging': if values range -x..o..y        
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141121, raw documentation
 Lea Mueller, muellele@gmail.com, 20140429, add colormaps for damage and schematic
 Lea Mueller, muellele@gmail.com, 20140429, add waterfall colormap
 Lea Mueller, muellele@gmail.com, 20150522, add mudslides (MS) colormap
 Lea Mueller, muellele@gmail.com, 20150607, add benefit colormap (grey-green) for averted damage in climada_MI_plot
 Lea Mueller, muellele@gmail.com, 20150713, add LS colormap
 Lea Mueller, muellele@gmail.com, 20150720, add FS (factor of safety) colormap
 Lea Mueller, muellele@gmail.com, 20150729, add assets colormap
 Lea Mueller, muellele@gmail.com, 20150729, add measures colormap
 Lea Mueller, muellele@gmail.com, 20150922, add benefit for adaptation bar chart colormap
 Lea Mueller, muellele@gmail.com, 20150924, special case if only one colour is required
 Lea Mueller, muellele@gmail.com, 20151201, update benefit colors (grey, yellow, green, turqoise)
 Lea Mueller, muellele@gmail.com, 20160201, add excess or rain (XR), lack of rain (LR) and lack of greenness (LG)
 Lea Mueller, muellele@gmail.com, 20160314, for TS and XR use only 8 colors (3 green, 5 blue)
 Lea Mueller, muellele@gmail.com, 20160316, add separate lack of greenness (LG) colormap (brown - yellow - green)
 Lea Mueller, muellele@gmail.com, 20160426, finetune lack of greenness colors
 Lea Mueller, muellele@gmail.com, 20160816, set number of colours to step10, in schematic, landslide and factor of safety
 David N. Bresch, david.bresch@gmail.com, 20170728, http://colorbrewer2.org maps  added
View <A HREF=file:../../climada/code/helper_functions/climada_colormap.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_concatenate_lon_lat">
<H2>climada_concatenate_lon_lat</H2></A>
<font color="blue">function lonlat = climada_concatenate_lon_lat(lon, lat) </font>
 climada_concatenate_lon_lat
 MODULE:
   climada core
 NAME:
   climada_concatenate_lon_lat
 PURPOSE:
   Concatenate two vectors lon and lat into one matrice with lonlat 
 CALLING SEQUENCE:
   lonlat = climada_concatenate_lon_lat(lon, lat)
 EXAMPLE:
   lonlat = climada_concatenate_lon_lat(lon, lat)
 INPUTS: 
   lon            : a vector, either 1xn or nx1
   lat            : a vector, either 1xn or nx1, must be same numel as lon
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:      
   lonlat         : a matrix containing lonlat information, where
                    lonlat(:,1) = lon and lonlat(:,2) = lat
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150724, init
 Lea Mueller, muellele@gmail.com, 20151106, move to core
View <A HREF=file:../../climada/code/helper_functions/climada_concatenate_lon_lat.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_country_name">
<H2>climada_country_name</H2></A>
<font color="blue">function [country_name,country_ISO3,shape_index] = climada_country_name(input_name) </font>
 check country name ISO3
 MODULE:
   core climada
 NAME:
   climada_country_name
 PURPOSE:
   check for valid country name or valid ISO3 country code and return both
   (hence it can also be used to get the respective code or full name)
 CALLING SEQUENCE:
   [country_name,country_ISO3,shape_index] = climada_country_name(input_name)
 EXAMPLE:
 	[country_name,country_ISO3,shape_index] = climada_country_name('Switzerland')
   climada_country_name % to return a list of all valid country names (and their ISO3 codes)
 INPUTS:
   input_name: name of country (string) or an ISO3 code (needs to be uppercase, like 'CHE')
       if ='ALL' or empty, write all country names and the corresponding
       ISO3 codes to stdout and return the full name, ISO and index list
       if ='all', as 'ALL', but do not write the list to stdout
       if ='Single' or 'Multiple', select single country or multiple
       countries from a list dialog
 OUTPUTS:
   country_name: country name(s), empty string if no match
   country_ISO3: country ISO3 code(s) (like 'CHE'), empty if no match
   shape_index: index(s) of the corresponding shapes (of the file as in climada_global.map_border_file
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20141016
 David N. Bresch, david.bresch@gmail.com, 20141209, ISO3 country code added
 David N. Bresch, david.bresch@gmail.com, 20141211, switched to admin0 instead of world*.gen
 Lea Mueller, muellele@gmail.com, 20141016, compare with strcmpi to find valid country names
View <A HREF=file:../../climada/code/helper_functions/climada_country_name.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_csvread">
<H2>climada_csvread</H2></A>
<font color="blue">function res=climada_csvread(csv_filename,delimiter,noheader) </font>
 climada read csv
 MODULE:
   core
 NAME:
   climada_template
 PURPOSE:
   climada read comma (or other) separated file, use first row to define
   variable names (see noheader)

   ERROR caption does indicate whether it is a numerical (num) or string
   (str) variable that lesds to an issue, it displays just the number of
   and full line content causing the error and (if possible) the single
   element to convert in (..) at the end. Usual suspects are delimiters
   within fields (eg if delimiter is comma (,) one cannot use commas in
   fields; Pure number entries in fields which are alphanumerical in the
   first data line (which defines the receiving field as cellstr).

   a csv test file (test.csv) might contain
    name,val1,val2,val_descr
    A,1,2,undef
    B,3.4,5.6,def

   it gets stored into
    res.name: {'A' 'B'}
    res.val1: [1 2]
    res.val2: [3.4 5.6]
    res.val_descr: {'undef' 'def'}

 CALLING SEQUENCE:
   res=climada_csvread(csv_filename,delimiter,noheader)
 EXAMPLE:
   res=climada_csvread('test.csv',',');
 INPUTS:
   csv_filename: name and path of .csv file
       &ampgt promted for if not given
   OPTION param1: a structure with the fields...
       this way, parameters can be passed on a fields, see below
 OPTIONAL INPUT PARAMETERS:
   delimiter: the delimiter, default is climada_global.csv_delimiter,
       usually thus , or ;
   noheader: if =1, assume no header, just return values (calls cvsread)
       otherwise (default, =0), use header row to define variable names
 OUTPUTS:
   res: the output, empty if not successful
       a structure with variable names as in first row of csv file
       (or named var{i} if noheader=1)
       Be very careful to use the output if ERRORs occurred
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161203, initial
 David N. Bresch, david.bresch@gmail.com, 20170121, CollapseDelimiters
 David N. Bresch, david.bresch@gmail.com, 20170125, empty lines skipped
 David N. Bresch, david.bresch@gmail.com, 20170217, ERROR catch
View <A HREF=file:../../climada/code/helper_functions/climada_csvread.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_damage_exceedence">
<H2>climada_damage_exceedence</H2></A>
<font color="blue">function [sorted_damage,exceedence_freq,cumulative_probability,sorted_freq,event_index_out]=climada_damage_exceedence(event_damage,event_freq,event_index,return_damage_RP_clean) </font>
 climada event damage hazard probabilistic stochastic
 NAME:
   climada_damage_exceedence
 PURPOSE:
   sort the damages descendingly
   calculate the exceedence frequency
   calculate the cumulative probability

   previous call: climada_EDS_calc
   next call: see e.g. climada_EDS2DFC
 CALLING SEQUENCE:
   [sorted_damage,exceedence_freq,cumulative_probability,sorted_freq,event_index_out]=...
       climada_damage_exceedence(event_damage,event_freq,event_index,return_damage_RP_clean)
 EXAMPLE:
   [damage,exceedence_freq,cumulative_probability]=climada_damage_exceedence([10 1000 100],[0.1 0.001 0.01]);
 INPUTS:
   event_damage: event damages (array), e.g. EDS.damage
   event_freq: occurrence frequency of each event damage (array), 
       e.g. EDS.frequency( see climada_EDS_calc)
 OPTIONAL INPUT PARAMETERS:
   event_index: the event_ID for each event_damage
   return_damage_RP_clean: if =1, return damage and return period, only
       non-zero damages, such that one can readily plot(exceedence_freq,sorted_damage)
       Default=0, note that this switches the meaning of an output freq -&ampgt RP (!)
 OUTPUTS:
   sorted_damage:   sorted damages (descendingly)
   exceedence_freq: exceedence frequency for each damage
   cumulative_probability: cumulative probability of each damage
   sorted_freq: frequency sorted as event damages
   event_index_out: event_index sorted as damages (only if provided input)
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120430
 David N. Bresch, david.bresch@gmail.com, 20170727, return_damage_RP_clean added
View <A HREF=file:../../climada/code/helper_functions/climada_damage_exceedence.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_damagefunctions_check">
<H2>climada_damagefunctions_check</H2></A>
<font color="blue">function entity_out = climada_damagefunctions_check(entity,hazard,silent_mode) </font>
 climada_damagefunctions_check
 NAME:
   climada_damagefunctions_check
 PURPOSE:
   Given an entity.damagefunctions structure we check that we have defined 
   MDD and PAA values for occurring hazard intensities. If MDD and PAA are
   only defined for smaller intensity values, entity.damagefunction fields
   are enlarged by an additional line (for .Intentiy, .MDD, .PAA, etc.)

   can be called from: climada_EDS_calc if set to sanity_check
 CALLING SEQUENCE:
   entity = climada_damagefunctions_check(entity,hazard)
 EXAMPLE:
   entity = climada_damagefunctions_check(entity,hazard)
 INPUTS:
   entity: an entity structure or an entity .mat file, see climada_assets_encode(climada_assets_read)
       If a file and no path provided, default path ../data/entities is
       used (and name can be without extension .mat)
       &ampgt promted for if not given
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       If a file and no path provided, default path ../data/hazards is
       used (and name can be without extension .mat)
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   entity with enlarged entity.damagefunctions fields (.Intentiy, .MDD, .PAA, etc.)
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150907, init
View <A HREF=file:../../climada/code/helper_functions/climada_damagefunctions_check.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_damagefunctions_complete">
<H2>climada_damagefunctions_complete</H2></A>
<font color="blue">function damagefunctions = climada_damagefunctions_complete(damagefunctions) </font>
 climada damagefunctions read import check complete
 NAME:
   climada_damagefunctions_complete
 PURPOSE:
   check for completeness of an damagefunctions structure, i.e. that all
   fields are there and populated with default values (this speeds up all
   later cimada calls, as we do not need to run many isfield commands
   etc). This code also makes sure all arrays in damagefunctions are 1xN (they come
   as Nx1 from Excel read).

   This code is kept as a separate function (i.e. called from but not part of
   climada_damagefunctions_read) in order to allow calling it for damagefunctions not read
   from an Excel file, e.g. if a user constructs the entity structure
   him/herself.

   called from: climada_damagefunctions_read
 CALLING SEQUENCE:
   damagefunctions = climada_damagefunctions_complete(damagefunctions)
 EXAMPLE:
   entity.damagefunctions=climada_damagefunctions_complete(entity.damagefunctions)
 INPUTS:
   damagefunctions: the damagefunctions structure of entity.damagefunctions, 
       see climada_entity_read
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
    damagefunctions: same as input, with fields completed
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20160918, initial
View <A HREF=file:../../climada/code/helper_functions/climada_damagefunctions_complete.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_damagefunctions_generate">
<H2>climada_damagefunctions_generate</H2></A>
<font color="blue">function [damagefunctions,dmf_info_str]=climada_damagefunctions_generate(intensity,dmf_min_intens,dmf_exp,dmf_max,dmf_shape,peril_ID,check_plot,dmf_max_intens) </font>
 climada_damagefunctions_generate
 MODULE:
   core
 NAME:
   climada_damagefunctions_generate
 PURPOSE:
   Generate damagefunctions

   See also: climada_damagefunctions_map and _plot ...
 CALLING SEQUENCE:
   damagefunction=climada_damagefunctions_generate(intensity,dmf_min_intens,dmf_exp,dmf_max,dmf_shape,peril_ID,check_plot,dmf_max_intens)
 EXAMPLE:
   damagefunction=climada_damagefunctions_generate(0:10:120,20,3,1,'exp','TC')
   damagefunction=climada_damagefunctions_generate([],20,1,0.5,'s-shape','TC',1)
 INPUTS:
   intensity: the hazard intensity scale, i.e. the horizontal axis of the
       damage function. Any vector of intensities, ascending in value,
       such as 1:10:100
   dmf_min_intens: minimum intensity for MDD and PPA &ampgt0, default=0
   dmf_exp: the exponent of the damage function, see also shape
   dmf_max: the maximum value of MDD (and PAA), default=1
   dmf_shape: the shape of the damage function, implemented are (the
   damagefunction are always normalized such that MDD(max intensity=1):
       'exp' for expoential shape, i.e.
       MDD=(intensity-dmf_min_intens)^dmf_exp
       's-shape' for an S-shaped damage function, satrting a
       dmf_min_intens and 'skewed by dmf_exp
   peril_ID: the 2-digit peril_ID, such as 'TC','EQ',...
 OPTIONAL INPUT PARAMETERS:
   check_plot: =1 to show a check plot (using
       climada_damagefunction_plot) or not (=0, default)
       plots on the same plot on subsequent calls to allow for easy
       comparison of say two options
 OUTPUTS:
   damagefunction: a structure with
       filename: just for information, here 'climada_damagefunctions_generate'
       Intensity(i): the hazard intensity (a vector)
       DamageFunID(i): =ones(1,length(Intensity)
       peril_ID{i}: a cell array with peril_ID
       MDD(i): the mean damage degree value for Intensity(i)
       PAA(i): the percentage of affected assets for Intensity(i)
   dmf_info_str: the parameters returned as a string (e.g. for annotation),
       in the form 'shape dmf_max*(i-dmf_min_intens)^dmf_exp'
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150211, initial
 Lea Mueller, muellele@gmail.com, 20160212, rename to climada_damagefunctionS_generate instead of without s
 David N. Bresch, david.bresch@gmail.com, 20170305, dmf_max_intens
View <A HREF=file:../../climada/code/helper_functions/climada_damagefunctions_generate.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_damagefunctions_map">
<H2>climada_damagefunctions_map</H2></A>
<font color="blue">function entity=climada_damagefunctions_map(entity,damagefunctions,damagefunctions_map) </font>
 climada
 NAME:
   climada_damagefunctions_map
 PURPOSE:
   Given an encoded entity, map damagefunctions, e.g. after reading
   alternative damagefunctions with climada_damagefunction_read

   If only entity is entered, the current DamageFunIDs in entity.assets
   and entity.damagefunctions are shown.

   If both entity and damagefunctions are passed, but no map,
   the DamageFunIDs in both entity and damagefunctions are shown.

   Only if a valid damage function map is passed, the mapping effectively
   happens. After mapping, the consistency is checked (a damagefunction
   definition for each DamageFunID). Please note that the mapping occurs
   independent of peril_ID (this is correct, since this alows to analyze
   the same assets with different perils).

   See also climada_damagefunctions_read and climada_damagefunctions_plot
   and climada_damagefunctions_replace
 CALLING SEQUENCE:
   entity=climada_damagefunctions_map(entity,damagefunctions,damagefunctions_map)
 EXAMPLE:
   entity=climada_damagefunctions_map(entity,damagefunctions,'1to3;2to4');
   entity=climada_damagefunctions_map(entity,'1to3;2to4');
 INPUTS:
   entity: an entity, see climada_entity_read
       &ampgt promted for if not given (calling climada_entity_load, not
       climada_entity_read)
 OPTIONAL INPUT PARAMETERS:
   damagefunctions: see climada_damagefunctions_read, a struct with damage
       functions. If one does not need to pass on new damage functions,
       one can also pass the damagefunctions_map in this variable (see 2nd
       EXAMPLE above). This option comes handy, if one stores several
       damagefunctions in entity.damagefunctions and uses this code to
       switch between.
   damagefunctions_map: the damagefunction map, either
       - a string with the mappings, e.g.
       '1to3;2to4', as in the entity.measures.damagefunctions_map
       - or a structure as in entity.measures.damagefunctions_mapping with
       fields map_from and map_to, such that we map map_from(i) to map_to(i)
       If empty, the DamageFunIDs in both entity and damagefunctions are
       shown, but no mapping actually occurs.
 OUTPUTS:
   entity: the entity with damagefunctions mapped (and damagefunction
       definitions taken from damagefunctions, if passed)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141121, ICE
 David N. Bresch, david.bresch@gmail.com, 20141212, ID format switched to 3.3i
View <A HREF=file:../../climada/code/helper_functions/climada_damagefunctions_map.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_damagefunctions_plot">
<H2>climada_damagefunctions_plot</H2></A>
<font color="blue">function res=climada_damagefunctions_plot(entity,unique_ID_sel) </font>
 climada
 NAME:
   climada_damagefunctions_plot
 PURPOSE:
   Plot the damage functions within entity (if a damagefunctions struct is
   passed, it works, too).

   See also climada_damagefunctions_read and climada_damagefunctions_generate
 CALLING SEQUENCE:
   climada_damagefunctions_plot(entity,unique_ID_sel)
   climada_damagefunctions_plot(climada_damagefunctions_read)
 EXAMPLE:
   climada_damagefunctions_plot
 INPUTS:
   entity: an entity, see climada_entity_read
       &ampgt promted for if not given (calling climada_entity_load, not
       climada_entity_read)
       Works also, if just a damagefunctions structure is passed (i.e. the
       same as in entity.damagefunctions, as returned by
       climada_damagefunctions_read)
 OPTIONAL INPUT PARAMETERS:
   unique_ID_sel: a single unique ID or the first n characters of an ID to
       plot only selected damage function(s), as in the case of an entity
       containing many functions, the single panes of the plot might get
       too small). It is recommended to run climada_damagefunctions_plot 
       first without specifying a unique_ID_sel and inspect the single 
       sub-plot headers. Examples are:
       unique_ID_sel='TC 001' % print only the one curve
       unique_ID_sel='TC'     % print all TC curves
 OUTPUTS:
   a figure
   res: a structure with the last (and only the last) damagefunction, with
       fields Intensity, MDD, PAA, MDR for further use. Hence res only
       make sense when called with one unique ID.
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141121, ICE
 David N. Bresch, david.bresch@gmail.com, 20141214, unique_ID_sel added
 David N. Bresch, david.bresch@gmail.com, 20141221, MDR calculated locally and unique_ID_sel improved
 David N. Bresch, david.bresch@gmail.com, 20150206, res returned
 David N. Bresch, david.bresch@gmail.com, 20150225, datenum added
 David N. Bresch, david.bresch@gmail.com, 20160920, damagefunctions.name added
 David N. Bresch, david.bresch@gmail.com, 20160929, damagefunctions.Intensity_unit added
 David N. Bresch, david.bresch@gmail.com, 20170211, using the exact same data to plot as returned in res
View <A HREF=file:../../climada/code/helper_functions/climada_damagefunctions_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_damagefunctions_read">
<H2>climada_damagefunctions_read</H2></A>
<font color="blue">function [damagefunctions,entity] = climada_damagefunctions_read(damagefunction_filename,entity) </font>
 climada damage function vulnerability read import
 NAME:
   climada_damagefunctions_read
 PURPOSE:
   read a file with damage functions (vulnerabilities), usually called in
   climada_entity_read, which reads a full entity file, i.e. assets, 
   damagefunctions, discount and measures. The field &quotIntensity&quot is
   mandatory otherwise damagefunctions are not read.
   See climada_entity_read for a comprehensive description of output fields.

   The code invokes climada_spreadsheet_read to really read the data,
   which implements .xls and .ods files

   For .xls, the sheet names are dynamically checked, for .ods, the sheet
   names are hard-wired (see code), means for .ods, all the sheets
   'assets','damagefunctions','measures' and 'discount' need to exist.

   NOTE: For backward compatibility, the code does read OLD files
   with a tab vulnerability (instead of damagefunctions) and VulnCurveID ...
   It renames respective fields in the resulting structure.

   See also climada_damagefunction_map and climada_damagefunctions_plot
 CALLING SEQUENCE:
   damagefunctions = climada_damagefunctions_read(damagefunction_filename)
 EXAMPLE:
   damagefunctions = climada_damagefunctions_read
 INPUTS:
   damagefunction_filename: the filename of the Excel file with the assets
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   entity: if an entity is passed, it's entity.damagefunctions is replaced
       by the newly imported damagefunctions (EXPERT use, as the
       DamageFunID have to be consistent, the code warns at least). 
       See also climada_damagefunctions_map
 OUTPUTS:
   damagefunctions: a structure, with
           DamageFunID: the damagefunction curve ID
           Intensity: the hazard intensity
           MDD: the mean damage degree
   entity: the entity (as on input, with exchanged damagefuncions)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141121, ICE initial
 David N. Bresch, david.bresch@gmail.com, 20141221, damagefunctions.MDR removed
 Lea Mueller, muellele@gmail.com, 20151016, delete nans if there are invalid entries
 Lea Mueller, muellele@gmail.com, 20151119, read first sheet if sheet &quotdamagefunctions&quot is not found
 David Bresch, david.bresch@gmail.com, 20151119, bugfix for Octave to try/catch xlsinfo
 David Bresch, david.bresch@gmail.com, 20160918, climada_damagefunctions_complete
View <A HREF=file:../../climada/code/helper_functions/climada_damagefunctions_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_damagefunctions_replace">
<H2>climada_damagefunctions_replace</H2></A>
<font color="blue">function entity=climada_damagefunctions_replace(entity,damagefunctions) </font>
 climada
 NAME:
   climada_damagefunctions_replace
 PURPOSE:
   Given an encoded entity, replace select damagefunctions with the ones
   provided. The code does in fact NOT delete any damage function, but set
   the DamageFunID of the one replaced to a new number.

   If entity contains a damage function with peril_ID 'TC' and
   DamageFunID=1 and damagefunctions also contains a damage function with
   peril_ID 'TC' and DamageFunID=1, the damage function in damagefunctions
   is added to entity damagefunctions and the previous damagefunction
   TC_001 is moved to TC_nnn, where nnn is a not yet used DamageFunID. But
   in case all MDD and PAA values of the existing damagefunction are
   exactly the same, the curve is NOT replaced (ensures we do not
   endlessly increase the number of damagefunctions on subsequent calls
   unnecessarily).

   See also climada_damagefunctions_read, climada_damagefunctions_generate
   and climada_damagefunctions_plot
 CALLING SEQUENCE:
   entity=climada_damagefunctions_replace(entity,damagefunctions)
 EXAMPLE:
   entity=climada_damagefunctions_replace(entity,damagefunctions);
 INPUTS:
   entity: an entity, see climada_entity_read
       &ampgt promted for if not given (calling climada_entity_load, not
       climada_entity_read)
   damagefunctions: see climada_damagefunctions_read, a struct with damage
       functions. If one does not need to pass on new damage functions,
       one can also pass the damagefunctions_map in this variable (see 2nd
       EXAMPLE above). This option comes handy, if one stores several
       damagefunctions in entity.damagefunctions and uses this code to
       switch between.
       No way to prompt for, hence aborted if not provided
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   entity: the entity with damagefunctions added (and DamageFunID of
       previous - replaced - damage functions set to a new number)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150212, initial
 David N. Bresch, david.bresch@gmail.com, 20150225, datenum added
View <A HREF=file:../../climada/code/helper_functions/climada_damagefunctions_replace.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_data_check">
<H2>climada_data_check</H2></A>
<font color="blue">function update_flag=climada_data_check(TEST_mode) </font>
 climada git data check
 MODULE:
   core
 NAME:
   climada_data_check
 PURPOSE:
   check content of climada_data folder for consistency with core
   climada's climada/data folder content.

   Files which are older in the local data folder should be replaced by the
   newer ones from the core data folder. Currently, the code ONLY takes
   action if TEST_mode=-1 (to avoid automatic overwrite).

   previous call: climada_git_clone and/or climada_git_pull 
   (both invoke climada_data_check)
   next call: e.g. climada_demo_step_by_step
 CALLING SEQUENCE:
   climada_data_check
 EXAMPLE:
   climada_data_check(1)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   TEST_mode: =1 show also files that are newer on local (user to decide what to do)
       =2 show also files that are identical (no action, just to
       show complete information)
       =0 (default), run as stated above, list only files that need
       attention
       =-1: do replace files which are older on local with newer ones from
       core data folder. BE CAREFUL, this options overwrites files in your
       local data folder
 OUTPUTS:
   update_flag: =0 if no need to update
       =1 if at least one file on local is older than in core
   all messaging to stdout
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20170106, initial
View <A HREF=file:../../climada/code/helper_functions/climada_data_check.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_dateline_resolve">
<H2>climada_dateline_resolve</H2></A>
<font color="blue">function lon=climada_dateline_resolve(lon,hemisphere,margin) </font>
 climada template
 MODULE:
   module name
 NAME:
   climada_dateline_resolve
 PURPOSE:
   Resolves dateline issue in Longitude coordinates, re-coding them either
   all W (hence values &amplt-180 possible) or all East (values &ampgt180 possible,
   default). By default, a margin of 20 degrees is used, such that if
   hemisphere='E', a value of -161 gets converted to +199, 
   while -160 remains.

   For Fiji for example, after creating the entity and/or centroids (e.g.
   using climada_GDP_entity, see module country_risk), run:
       entity.assets.lon=climada_dateline_resolve(entity.assets.lon);
       centroids.lon=climada_dateline_resolve(centroids.lon);
   and save these 'clean' structures for further use.

   For tropical cyclone tracks in the dateline region, similarly (after
   e.g. using tc_track=climada_tc_read_unisys_track)
       tc_track.lon=climada_dateline_resolve(tc_track.lon);
 CALLING SEQUENCE:
   lon=climada_dateline_resolve(lon,hemisphere,margin)
 EXAMPLE:
   tc_track.lon=climada_dateline_resolve(tc_track.lon)
 INPUTS:
   lon: a (vector of) longitude values (in degrees) to be resolved
 OPTIONAL INPUT PARAMETERS:
   hemisphere: whether we convert all to 'E' for Eastern or 'W' for
       Western hemisphere. Default ='E'
   margin: the margin for wich values are converted, i.e. for what range
       around the dateline the correction applied. Default =20, such that
       if hemisphere='E', a value of -161 gets converted to +199, while
       -160 remains.  
 OUTPUTS:
   lon: same as on input, with values 'mapped' as described
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160221
View <A HREF=file:../../climada/code/helper_functions/climada_dateline_resolve.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_demo_adapt_cost_curve">
<H2>climada_demo_adapt_cost_curve</H2></A>
<font color="blue">function [impact_present, impact_future, insurance_benefit, insurance_cost] = climada_demo_adapt_cost_curve(climada_demo_params,omit_plot, scaled_AED, nice_numbers, reverse_cb) </font>
 climada
 NAME:
   climada_demo_adapt_cost_curve
 PURPOSE:
   update the demo entity etc. to reflect parameter changes
   (first time, it reads the demo entity from the Excel file demo_present.xls)
   run the calculations and call climada_adaptation_cost_curve for the
   visualization (all in one, hence easy to call from the GUI)
   
   see also: climada_demo_gui, normally called therefrom
 CALLING SEQUENCE:
   [impact_present,impact_future]=climada_demo_adapt_cost_curve(climada_demo_params,omit_plot);
 EXAMPLE:
   climada_demo_params.growth=0.02;climada_demo_params.scenario=1;climada_demo_params.measures.beachnourish=1;
   climada_demo_params.measures.mangroves=1;climada_demo_params.measures.seawall=1;
   climada_demo_params.measures.quality=1;climada_demo_params.measures.insurance_deductible=0;
   [impact_present,impact_future]=climada_demo_adapt_cost_curve(climada_demo_params);
 INPUTS:
   climada_demo_params: a structure with the climada parameters the demo GUI allows to edit:
       growth: the percentage, decimal (0.02 means 2% CAGR until 2030)
       scenario: 0, 1 or 2 for no, moderate and high climate change
       discount_rate: the discount rate used to discount damages
       measures, a sub-structure with
          beachnourish: the level of investment 0..1
          mangroves: 0..1
          seawall: 0..1, costs non-linear (power 4)
          quality: 0..1, costs non-linear (power 4)
          insurance_deductible: 0..1, costs dealt with also in EDS
      &ampgt ususally set in GUI, hard-coded for testing (if nothing handed over or empty)
 OPTIONAL INPUT PARAMETERS:
   omit_plot: if =1, omit plotting (faster), degfault=0 (do plot)
 OUTPUTS:
   impact_present: impact structure, see climada_measures_impact
   impact_future: impact structure, see climada_measures_impact
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20110623, Ashdown Park
 David N. Bresch, david.bresch@gmail.com, 20130328, vuln_MDD_impact -&ampgt MDD_impact...
 David N. Bresch, david.bresch@gmail.com, 20140516, reverse_cb added
 David N. Bresch, david.bresch@gmail.com, 20140816, automatic update if entity changed
 Lea Mueller, muellele@gmail.com, 20150902, rename to hazard_intensity_impact_b from hazard_intensity_impact
View <A HREF=file:../../climada/code/helper_functions/climada_demo_adapt_cost_curve.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_demo_parameter_table">
<H2>climada_demo_parameter_table</H2></A>
<font color="blue">function climada_demo_parameter_table(csv_filename) </font>
 climada
 NAME:
   climada_demo_parameter_table
 PURPOSE:
   based on climada_demo_gui, create a (extensive) parameter table
   for use by applications which cannot truly simulate the risk
   such applications will have to interpolate (linearly) between
   lookup points.

   NOTE: This code takes more than 10 hours to run:
   for each line of output, it simulates 15*13'000 events (takes a few sec)
   number of lines in the output file: 3*11*11*n_measures*parameter_resolution

   measure names etc. are currently hard-wired, could be made dynamic
 CALLING SEQUENCE:
   climada_demo_parameter_table(csv_filename)
 EXAMPLE:
   climada_demo_parameter_table
 INPUTS:
   csv_filename:
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
	parameters written to file csv_filename
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20110628, sur TGV Paris-Mulhouse
View <A HREF=file:../../climada/code/helper_functions/climada_demo_parameter_table.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_demo_parameter_table_full">
<H2>climada_demo_parameter_table_full</H2></A>
<font color="blue">function climada_demo_parameter_table(csv_filename) </font>
 climada
 NAME:
   climada_demo_parameter_table
 PURPOSE:
   based on climada_demo_gui, create a (extensive) parameter table
   for use by applications which cannot truly simulate the risk
   such applications will have to interpolate (linearly) between
   lookup points.

   This code might need several hours to run:
   for each line of output, it simulates 15*13'000 events (takes a few sec)
   number of lines in the output file: 3*6*6*(parameter_resolution^n_measures)

   measure names etc. are currently hard-wired, could be made dynamic
 CALLING SEQUENCE:
   climada_demo_parameter_table(csv_filename)
 EXAMPLE:
   climada_demo_parameter_table
 INPUTS:
   csv_filename: 
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
	parameters written to file csv_filename
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20110628, sur TGV Paris-Mulhouse
View <A HREF=file:../../climada/code/helper_functions/climada_demo_parameter_table_full.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_demo_waterfall_graph">
<H2>climada_demo_waterfall_graph</H2></A>
<font color="blue">function [risk_today,risk_econ_growth,risk_climate_change]=climada_demo_waterfall_graph(climada_demo_params,omit_plot,nice_numbers) </font>
 climada
 NAME:
   climada_demo_waterfall_graph
 PURPOSE:
   produce the waterfall graph for the climada GUI
   (first time, it reads the demo entity from the Excel file demo_today.xls)
   run the calculations and show the waterfall graph

   see also: climada_demo_gui, normally called therefrom
 CALLING SEQUENCE:
   climada_demo_waterfall_graph(climada_demo_params,omit_plot);
 EXAMPLE:
   climada_demo_params.growth=0.02;climada_demo_params.scenario=1;
   climada_demo_waterfall_graph(climada_demo_params);
 INPUTS:
   climada_demo_params: a structure with the climada parameters the demo GUI allows to edit:
       growth: the percentage, decimal (0.02 means 2% CAGR until 2030)
       scenario: 0, 1 or 2 for no, moderate and high climate change
      &ampgt ususally set in GUI, hard-coded for testing (if nothing handed over or empty)
 OPTIONAL INPUT PARAMETERS:
   omit_plot: if =1, omit plotting (faster), degfault=0 (do plot)
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20110625
 David N. Bresch, david.bresch@gmail.com, 20130316, ELS-&ampgtEDS...
 David N. Bresch, david.bresch@gmail.com, 20150402, area compatibility with version 8 (R2014...)
 David N. Bresch, david.bresch@gmail.com, 20150805, entity re-read from Excel if Excel edited (to allow for experimentation)
 David N. Bresch, david.bresch@gmail.com, 20150805, entity and hazard set files defined in climada_init_vars
 David N. Bresch, david.bresch@gmail.com, 20140816, automatic update if entity changed
View <A HREF=file:../../climada/code/helper_functions/climada_demo_waterfall_graph.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_digit_set">
<H2>climada_digit_set</H2></A>
<font color="blue">function [digit, digit_str, result_str] = climada_digit_set(data,data2) </font>
 set digit and digit string for a given data set
 NAME:
   climada_digit_set
 PURPOSE:
   Set digit (10 to the power of digit) and digit string for a given data 
   set, e.g. for an input of 1'000'000, digit = 6 and digit_str =
   'million', result_str = '1.00 million'
 CALLING SEQUENCE:
   [digit, digit_str, result_str] = climada_digit_set(data,data2)
 EXAMPLE:
   [digit, digit_str, result_str] = climada_digit_set(1000000,20)
 INPUTS:
   data: an array or matrix of data
   data2: an array or matrix of data
 OPTIONAL INPUT PARAMETERS:
   data2: a second array or matrix of data
 OUTPUTS:
   digit: an array defining 10 to the power of digit, e.g. 6 for million,
   9 for billion
   digit_str: a char, e.g 'million', 'billion'
   result_str: a char, containing the maximum of the data, e.g '4.21 million' 
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20150924, init
 Lea Mueller, 20150928, delete s in million, billion, etc
 Lea Mueller, 20151202, add result_str
 Lea Mueller, 20160816, delete k option (1'000)
View <A HREF=file:../../climada/code/helper_functions/climada_digit_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_discount_read">
<H2>climada_discount_read</H2></A>
<font color="blue">function discount = climada_discount_read(discount_filename) </font>
 climada discount read import
 NAME:
   climada_discount_read
 PURPOSE:
   read discount sheet with .yield_ID, .year, .discount_rate. 
   usually called from climada_entity_read, see climada_entity_read for
   more information. The field &quotdiscount_rate&quot is mandatory otherwise discount is not read.
   See climada_entity_read for a comprehensive description of output fields.

   The code invokes climada_spreadsheet_read to really read the data,
   which implements .xls and .ods files
   For .xls, the sheet names are dynamically checked, for .ods, the sheet
   names are hard-wired (see code), means for .ods, the sheet 'discount' 
   needs to exist.
 CALLING SEQUENCE:
   [discount,discount_save_file] = climada_discount_read(discount_filename)
 EXAMPLE:
   discount = climada_discount_read;
 INPUTS:
   discount_filename: the filename of the Excel (or .ods) file with the
   discount information
       If no path provided, default path ../data/entities is used
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
    discount: a structure, with
           .yield_ID: yield ID
           .year: year
           .discount_rate: discount_rate per year
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151117, init from climada_entity_read to read only discount
 David Bresch, david.bresch@gmail.com, 20151119, bugfix for Octave to try/catch xlsinfo
View <A HREF=file:../../climada/code/helper_functions/climada_discount_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_distance2coast_km">
<H2>climada_distance2coast_km</H2></A>
<font color="blue">function [distance_km,lon,lat]=climada_distance2coast_km(lon,lat,check_plot,force_beyond_1000km,check_inpolygon) </font>
 climada distance km coast
 NAME:
   climada_distance2coast
 PURPOSE:
   calculate distance to coast in km (approx.)

   NOTE: this code listens to climada_global.parfor for substantial
   speedup, about n workers faster

   NOTE: for speedup, max distance is 1'000km, i.e. distances larger than
   approx 1'000km are set to 1'000km (speeds up by st least factor ten). See the
   try/catch statement to switch to calculation of all distances (even
   beyond 1'000 km)

   Run climada_shaperead('SYSTEM_COASTLINE') in case the coastline does
   not exist (requires the climada module country_risk from
   https://github.com/davidnbresch/climada_module_country_risk
 CALLING SEQUENCE:
   distance_km=climada_distance2coast_km(lon,lat,check_plot)
 EXAMPLE:
   distance_km=climada_distance2coast_km(lon,lat)
 INPUTS:
   lon: vector of longitues
   lat: vector of latitudes
 OPTIONAL INPUT PARAMETERS:
   check_plot: =1: show circle plot for check (default=0). Works only for
       less than 50'000 points, if you want to plot more, use check_plot=2
   force_beyond_1000km: =1 to claculate all distances precisely, even for
       points &ampgt1000km from coast (default=0)
   check_inpolygon: if=1, set distance negative if inside the polygon (i.e. on land)
       if check_inpolygon&amplt0, only the points closer than
       abs(check_inpolygon) [km] are checked and returned (see oputput
       arguments lon lat in this case. This options speeds up the
       inpolygon search substantially
 OUTPUTS:
   distance_km: distance to coast in km for each lat/lon
   lon and lat: same as on input, except for check_inpolygon&amplt0, whre only
       the points closer than abs(check_inpolygon) [km] are returned
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141225, initial
 David N. Bresch, david.bresch@gmail.com, 20150514, progress indication for more than 1000 points added
 David N. Bresch, david.bresch@gmail.com, 20150514, speedup factor ten or more implemented
 David N. Bresch, david.bresch@gmail.com, 20150515, check_inpolygon implemented
 David N. Bresch, david.bresch@gmail.com, 20170208, parfor implemented
View <A HREF=file:../../climada/code/helper_functions/climada_distance2coast_km.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_distance_km">
<H2>climada_distance_km</H2></A>
<font color="blue">function dist_km=climada_distance_km(lon1,lat1,lon2,lat2) </font>
 climada
 NAME:
   climada_distance_km
 PURPOSE:
   calculate distance between two points or a point and a series of points
 CALLING SEQUENCE:
   climada_distance_km(lon1,lat1,lon2,lat2);
 EXAMPLE:
   climada_distance_km(0.0,45.0,1.0,45.0); % two points
   climada_distance_km(0.0,45.0,[1.0 2.0 2.0],[45.0 45.0 46.0]); % point and a series of points
 INPUTS:
   lon1,lat1: longitude and latitude of first point
   lon2,lat2: longitude and latitude of second point
       or, if vectors of the same length, series of points
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   dist_km: distance(s) between points in km
 MODIFICATION HISTORY:
 David N. Bresch, david_bresch@gmail.com, 20130328
View <A HREF=file:../../climada/code/helper_functions/climada_distance_km.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_distribution_lon_lat">
<H2>climada_distribution_lon_lat</H2></A>
<font color="blue">function climada_distribution_lon_lat(tc_track, check_printplot, check_printplot_2) </font>
 distribution of start point longitude and latitude and difference in
 longitude and latitude
 NAME:
   climada_distribution_lon_lat
 PURPOSE:
   plot to visually control distribution of probabilistic to historical
   track data
 CALLING SEQUENCE:
   climada_distribution_lon_lat(tc_track_prob, check_printplot, check_printplot_2)
 EXAMPLE:
   climada_distribution_lon_lat
   climada_distribution_lon_lat([],1,1)
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   tc_track_prob  :  probabilistic track set, if not given prompted for
   check_printplot:  if set to 1 will print (save) figure, default 0
 OUTPUTS:
   plot
 MODIFICATION HISTORY:
 Lea Mueller, 20110715
 david.bresch@gmail.com, 20120407, load(colormap) fixed, but still some Q.
View <A HREF=file:../../climada/code/helper_functions/climada_distribution_lon_lat.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_distribution_v0_vi">
<H2>climada_distribution_v0_vi</H2></A>
<font color="blue">function [mu, sigma, A] = climada_distribution_v0_vi(tc_track, output_unit, check_visible, check_printplot) </font>
 distribution of initial wind speed v0 and change in in wind speed vi
 tc_track has to be recorded at 6h intervals with wind speed in kn
 NAME:
   climada_distribution_v0_vi
 PURPOSE:
   fit normal distribution to inital wind speed from tc tracks and 
   fit normal distribution to 
   previous:   .....
   next:       ....
 CALLING SEQUENCE:
   [mu, sigma] = climada_distribution_v0_vi(tc_name, check_printplot)
 EXAMPLE:
   [mu, sigma] = climada_distribution_v0_vi('all', 1);
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   tc_track:     historical tc tracks, prompted for if not given
   output_unit:      output unit of mu and sigma, e.g. 'kn' for knots or
   'm/s' for m/s, default m/s
   check_visible:    if set to 1 will show figure, default 1
   check_printplot:  if set to 1 will print (save) figure, default 0
 OUTPUTS:
   mu and sigma, mean and standard deviation of fitted normal distribution
   mu:     mean for initial wind speed v0 mu(1) and difference in wind
   speed vi mu(2)
   sigma:  standard deviation for initial wind speed v0 sigma(1) and difference in wind
   speed vi sigma(2)
 MODIFICATION HISTORY:
 Lea Mueller, 20110616
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_distribution_v0_vi.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_ellipse">
<H2>climada_ellipse</H2></A>
<font color="blue">function h=climada_ellipse(ra,rb,ang,x0,y0,C,Nb) </font>
 Ellipse adds ellipses to the current plot

 ELLIPSE(ra,rb,ang,x0,y0) adds an ellipse with semimajor axis of ra,
 a semimajor axis of radius rb, a semimajor axis of ang, centered at
 the point x0,y0.

  A copy of ellipse, just to fix the following 'bug':
  Undefined function 'ellipse' for input arguments of type 'double'
  The present version does read double...

 The length of ra, rb, and ang should be the same. 
 If ra is a vector of length L and x0,y0 scalars, L ellipses
 are added at point x0,y0.1
 If ra is a scalar and x0,y0 vectors of length M, M ellipse are with the same 
 radii are added at the points x0,y0.
 If ra, x0, y0 are vectors of the same length L=M, M ellipses are added.
 If ra is a vector of length L and x0, y0 are  vectors of length
 M~=L, L*M ellipses are added, at each point x0,y0, L ellipses of radius ra.

 ELLIPSE(ra,rb,ang,x0,y0,C)
 adds ellipses of color C. C may be a string ('r','b',...) or the RGB value. 
 If no color is specified, it makes automatic use of the colors specified by 
 the axes ColorOrder property. For several circles C may be a vector.

 ELLIPSE(ra,rb,ang,x0,y0,C,Nb), Nb specifies the number of points
 used to draw the ellipse. The default value is 300. Nb may be used
 for each ellipse individually.

 h=ELLIPSE(...) returns the handles to the ellipses.

 as a sample of how ellipse works, the following produces a red ellipse
 tipped up at a 45 deg axis from the x axis
 ellipse(1,2,pi/8,1,1,'r')

 note that if ra=rb, ELLIPSE plots a circle


 written by D.G. Long, Brigham Young University, based on the
 CIRCLES.m original 
 written by Peter Blattner, Institute of Microtechnology, University of 
 Neuchatel, Switzerland, blattner@imt.unine.ch
View <A HREF=file:../../climada/code/helper_functions/climada_ellipse.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_check">
<H2>climada_entity_check</H2></A>
<font color="blue">function entity = climada_entity_check(entity,fieldname,silent_mode,called_from) </font>
 climada_entity_check
 NAME:
   climada_entity_check
 PURPOSE:
   Given an assets, damagefunction or measures structure delete NaN lines
 
   can be called from: climada_entity_read, climada_damagefunction_read,
   climada_measures_read
 CALLING SEQUENCE:
   entity_out = climada_entity_check(entity,fieldname)
 EXAMPLE:
   entity_out = climada_entity_check(entity,fieldname)
 INPUTS:
   entity: an entity structure or an entity .mat file, see climada_assets_encode(climada_assets_read)
       If a file and no path provided, default path ../data/entities is
       used (and name can be without extension .mat)
       &ampgt promted for if not given
   fieldname: fieldname to specify where to look for NaNs
       default is 'lon'
 OPTIONAL INPUT PARAMETERS:
   silent_mode: =1 to omit warnings to stdout, default=0
   called_from: the calling routine name or any other info to issue with
       each warning message
 OUTPUTS:
   entity cleaned up, deleted rows with nans
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151016, init
 david.bresch@gmail.com, 20160918, values=getfield(entity,fieldname) replaced with values=entity.(fieldname)
 david.bresch@gmail.com, 20160918, called_from added
View <A HREF=file:../../climada/code/helper_functions/climada_entity_check.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_combine">
<H2>climada_entity_combine</H2></A>
<font color="blue">function [entity,entity_save_file] = climada_entity_combine(entity,entity2,entity_save_file,purge_flag) </font>
 climada entity import, read assets, damagefunctions, discount and measures
 NAME:
   climada_entity_combine
 PURPOSE:
   Combine two climada entities, just appends assets, keeps everything
   else the same.

   previous steps: climada_entity_read, climada_entity_load
   next step: likely climada_ELS_calc
 CALLING SEQUENCE:
   [entity,entity_save_file] = climada_entity_combine(entity,entity2,entity_save_file)
 EXAMPLE:
   entity = climada_entity_combine(entity,entity2)
 INPUTS:
   entity: a climada entity structure, as returned by climada_entity_read
       If entity is empty on input, entity2 is returned. This can be
       useful to start summing up entities in a loop
       entity_c=climada_EDS_combine(entity_c,entity)...  
   entity2: a climada entity structure, as returned by climada_entity_read
 OPTIONAL INPUT PARAMETERS:
   entity_save_file: the filename to save the combined entity to
       NOT asked if not provided, as in this case, the combined entity is
       NOT saved back to disk
   purge_flag: =1 delete array entries where entity.assets.Value=0 in
       combinded assets, =0 keep all (default)
 OUTPUTS:
   entity: an entity structure, see climada_entity_read
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160120, initial
 David N. Bresch, david.bresch@gmail.com, 20161008, small fix
 David N. Bresch, david.bresch@gmail.com, 20170726, allow for EDS to be empty on input
View <A HREF=file:../../climada/code/helper_functions/climada_entity_combine.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_save">
<H2>climada_entity_save</H2></A>
<font color="blue">function climada_entity_save(entity,entity_file) </font>
 climada
 NAME:
   climada_entity_save
 PURPOSE:
   save an entity to a .mat file (just to avoid typing long paths and
   filenames in the cmd window)
 CALLING SEQUENCE:
   climada_entity_save(entity,entity_file)
 EXAMPLE:
   climada_entity_save(climada_assets_encode(climada_assets_read))
 INPUTS:
   entity: the entity struct to be saved, see e.g. climate_assets_encode
   entity_file: the filename (with path, optional) to save the entity in
       If no path provided, default path ../data/entities is used
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   entity saved to a .mat file
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091230
 David N. Bresch, david.bresch@gmail.com, 20150804, allow for name without path on input
 David N. Bresch, david.bresch@gmail.com, 20150820, filename checked
View <A HREF=file:../../climada/code/helper_functions/climada_entity_save.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_value_GDP_adjust">
<H2>climada_entity_value_GDP_adjust</H2></A>
<font color="blue">function entity_adjusted=climada_entity_value_GDP_adjust(entity_file_regexp,mode_selector) </font>
 scale up asset values
 MODULE:
   country_risk
 NAME:
   climada_entity_value_GDP_adjust
 PURPOSE:
   Scale up asset values based on a country's estimated total asset value.
   The total asset value is derived as follows:
       - normalize the asset values
       - multiply with the country's GDP
       - multiply with a factor that depends on a country's income
         group, i.e., its GDP per capita. This last factor is the KEY
         ASSUMPTION here, see income_group_factors in PARAMETERS in code

   If an entity has a field entity.assets.Value_today, the code calculates
   the factor to entity.assets.Value and applies this factor after GDP
   adjustment (this way, the code does not scale _future entities back to
   today).

   The entities' asset values are first normalized and then
   multiplied by a factor that depends on a country's income group (low,
   lower middle, upper middle, or high). The choice of this factor is
   based on a comparison of climada entities to estimates for total asset
   values in countries where such data are available. This comparison
   showed that in general, adjusting the Climada asset values requires a
   higher multiplication factor the wealthier a country is. Thus, as a
   rule of thumb, the value of all assets in a country can be estimated by
       Total_asset_value = GDP * (1+income_group_factor)
   where GDP is the country's gross domestic product, and
   income_group_factor ranges from 2 for low income countries to 5 for
   high income countries.

   Caution: as soon as the entity has a field entity.assets.admin0_ISO3 or
   entity.assets.admin0_name, it is adjusted, unless there are non-empty
   fields entity.assets.admin1_name or entity.assets.admin1_code, in which
   case it skips adjustment.

   Note: to avoid any troubles, Cover is set equal to Value.

   Calls climada_entity_value_GDP_adjust_one

   Prior calls: e.g. climada_nightlight_entity, country_risk_calc
   Next calls: e.g. country_risk_calc
 CALLING SEQUENCE:
   entity_adjusted=climada_entity_value_GDP_adjust(entity_file_regexp,mode_selector)
 EXAMPLE:
   entity_adjusted=climada_entity_value_GDP_adjust('../data/*.mat') % put .. in
   entity_adjusted=climada_entity_value_GDP_adjust('BEL_Belgium_entity.mat')
 INPUT:
   entity_file_regexp: the full filename of the entity to be scaled up
       or a regexp expression, e.g. for all entities:
       entity_file_regexp=[climada_global.data_dir filesep 'entities' filesep '*.mat']
 OPTIONAL INPUT PARAMETERS:
   mode_selector: =1, print step-by-step to stdout, =0, not (default)
       If =2, do not care for Value_today, just adjust to GDP*income_group_factors
       If =3, use GDP_future instead of GDP_today (if this column is in
       the economic_indicators_mastertable.xls, otherwise throw an error).
       In this case, ignore Value_today, just scale with GDP_future.
 OUTPUTS:
   entity_adjusted: entity with adjusted asset values, also stored as .mat
       file (only last entity if entity_file_regexp covers more than one)
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150121, initial
 David N. Bresch, david.bresch@gmail.com, 20150121, cleanup
 David N. Bresch, david.bresch@gmail.com, 20150122, mode_selector added
 David N. Bresch, david.bresch@gmail.com, 20150122, mode_selector=3 added
 David N. Bresch, david.bresch@gmail.com, 20150204, processing moved to climada_entity_value_GDP_adjust_one
 David N. Bresch, david.bresch@gmail.com, 20160907, fprintf when saving shortened
View <A HREF=file:../../climada/code/helper_functions/climada_entity_value_GDP_adjust.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_value_GDP_adjust_one">
<H2>climada_entity_value_GDP_adjust_one</H2></A>
<font color="blue">function entity=climada_entity_value_GDP_adjust_one(entity,mode_selector) </font>
 scale up asset values GDP
 MODULE:
   country_risk
 NAME:
   climada_entity_value_GDP_adjust_one
 PURPOSE:
   Scale up asset values based on a country's estimated total asset value.
   The total asset value is derived as follows:
       - normalize the asset values
       - multiply with the country's GDP
       - multiply with a scaleup factor that depends on a country's income
         group, i.e., its GDP per capita. This last factor is the KEY
         ASSUMPTION here, see income_group_factors in PARAMETERS in code

   See also climada_entity_value_GDP_adjust, which allows to process a
   series of entity .mat files

   If an entity has a field entity.assets.Value_today, the code calculates
   the factor to entity.assets.Value and applies this factor after GDP
   adjustment (this way, the code does not scale _future entities back to
   today).

   The entities' asset values are first normalized and then
   multiplied by a factor that depends on a country's income group (low,
   lower middle, upper middle, or high). The choice of this factor is
   based on a comparison of climada entities to estimates for total asset
   values in countries where such data are available. This comparison
   showed that in general, adjusting the Climada asset values requires a
   higher multiplication factor the wealthier a country is. Thus, as a
   rule of thumb, the value of all assets in a country can be estimated by
       Total_asset_value = GDP * (1+income_group_factor)
   where GDP is the country's gross domestic product, and
   income_group_factor ranges from 2 for low income countries to 5 for
   high income countries.

   Caution: as soon as the entity has a field entity.assets.admin0_ISO3 or
   entity.assets.admin0_name, it is adjusted, unless there are non-empty
   fields entity.assets.admin1_name or entity.assets.admin1_code, in which
   case it skips adjustment.

   Note: to avoid any troubles, Cover is set equal to Value.

   Prior calls: e.g. climada_nightlight_entity, country_risk_calc
   Next calls: e.g. country_risk_calc
 CALLING SEQUENCE:
   entity_adjusted=climada_entity_value_GDP_adjust_one(entity,mode_selector)
 EXAMPLE:
   entity_adjusted=climada_entity_value_GDP_adjust_one(climada_entity_load)
 INPUT:
   entity: an entity structure, see e.g. climada_entity_load and
       climada_entity_read
 OPTIONAL INPUT PARAMETERS:
   mode_selector: =1, print step-by-step to stdout, =0, not (default)
       If =2, do not care for Value_today, just adjust to GDP*income_group_factors
       If =3, use GDP_future instead of GDP_today (if this column is in
       the economic_indicators_mastertable.xls, otherwise throw an error).
       In this case, ignore Value_today, just scale with GDP_future.
 OUTPUTS:
   entity_adjusted: entity with adjusted asset values, also stored as .mat
       file (only last entity if entity_file_regexp covers more than one)
       adds the fields entity.assets.GDP_value and entity.assets.scale_up_factor
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150204, switched to one entity, see also climada_entity_value_GDP_adjust
 David N. Bresch, david.bresch@gmail.com, 20150927, economic_indicators_mastertable from climada_global.system_dir
 David N. Bresch, david.bresch@gmail.com, 20160911, entity.assets.GDP_value and entity.assets.scale_up_factor to output
 David N. Bresch, david.bresch@gmail.com, 20161008, bugfix for some error messages
View <A HREF=file:../../climada/code/helper_functions/climada_entity_value_GDP_adjust_one.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_event_damage_animation">
<H2>climada_event_damage_animation</H2></A>
<font color="blue">function res=climada_event_damage_animation(animation_data_file,params) </font>
 climada event animation movie
 MODULE:
   core
 NAME:
   climada_event_damage_animation
 PURPOSE:
   Animation of event damage - as an .mp4 movie

   This code does the visualization (rendering), see e.g.
   climada_event_damage_data_tc to calculate all the data first. You might
   also consider to write your own version of climada_event_damage_data_tc
   (e.g for another peril than TC).

   As one often needs to play with visualization parameters, the process is split.
   Threrefor call climada_event_damage_animation without any argument to return the
   default parameters (same as calling climada_event_damage_animation('params')

   Note that this code does not (yet) run in Octave, as video support is
   limited (see &amplthttp://octave.sf.net/video/&ampgt) and the present code uses
   latest MATLAB videowriter (better performance than avifile...).

   Soemtimes, it is faster to edit fields in hazard instead of re-running
   climada_event_damage_data_tc, like: for i=1:length(hazard.event_name),...
   hazard.event_name{i}=strrep(hazard.event_name{i},'NNN 1200706','Sidr');end
   (obviously, you first load and then save animation_data.mat)

   prior calls: climada_event_damage_data_tc or similar to prepare the
       event damage information

   NOTE: please consider to rename and edit/tune your local version
 CALLING SEQUENCE:
   climada_event_damage_animation(animation_data_file,params)
 EXAMPLE:
   climada_event_damage_animation
   climada_event_damage_animation('ask'); % prompt for both input data and output animation filename
   climada_event_damage_animation('check'); % fast check

   params=climada_event_damage_animation('params') % return default parameters
   climada_event_damage_animation('colors') % check color maps
 INPUTS:
   animation_data_file: the data file (.mat) with hazard set which
       includes event damage information, see e.g. climada_event_damage_data_tc
       If specified without path, searched for in ../results and extension .mat
       If empty, use the default file, i.e. ../results/animation_data.mat
       If ='ask', prompt for
       If ='params', return all default parameters in res, abort
       If ='colors', check color maps, abort
       If ='check', run three frames about 70% into the animation to
       briefly check
 OPTIONAL INPUT PARAMETERS:
   params: a structure with fields:
    animation_mp4_file: the filename of the resulting .mp4 movie
       If specified without path, stored in ../results with extension
       according to VideoWriter (see params.video_profile)
       If empty, use default ../results/animation_movie.mp4 (or other ext)
       If ='ask', prompt for (if cancel pressed, the movie frames are
       not written to file - useful for test)
    focus_region: the region we're going to show [minlon maxlon minlat maxlat]
       if empty, automatically determined by area of entity lat/lon, i.e.
       hazard.assets.lat/lon
       Default: use the region as stored in hazard.focus_region
    FontSize: the size for legend and title, default=18 (good readability
       on animation)
    asset_markersize: the size of the 'dots' to plot entity and damage,
       default=5
    npoints: the resolution of the hazard intensity plot (since
       re-gridded), default =599 points (the higher the more time consuming)
    schematic_tag: if =1 (default), use (old) schematic intensity colortable
    Position: the figure position, as in figure
       =[1 5 1310 1100] screen at home
       =[1 5 2560 1340] screen in the office
       =[1 1 3840 2160] 4K
    frame_start: frame to start with (default=1). Sometimes useful to
       shorten animation without re-generating animation_data.mat
    frame_end: last frame to process (default=last frame on animation_data.mat)
    jump_step: the steps to jump (in order to first check, e.g. only show
       every 5th frame by setting jump_step=5, default=1 (all steps).
    plot_tc_track: show tc track as a black dotted line (default=1, plot it).
       the value of plot_tc_track is the MarkerSize of the dots, use e.g.=5
    video_profile: the video profile (see help VideoWriter), default is ='MPEG-4'
       if this fails, try ='Motion JPEG AVI'
       If strcmpi(computer,'GLNXA64') the code uses 'Motion JPEG AVI' as
       default already
    check_colors: if =1, check color maps, then abort, default=0
    check_mode: if =1, run three frames about 70% into the animation to
       briefly check, default=0
    plot_assets: whether we plot assets (=1, default) or not (=0)
       can be useful to show only hazard animation first
    plot_damage: whether we plot damage (=1, default) or not (=0)
       can be useful to show only hazard animation first
    axis_equal: whether we scale axes equally, default=1, 0 otherwise
 OUTPUTS:
   the .mp4 animation file in res.animation_mp4_file
   res: the parameter structure params as used (helpful to obtain all default
       values, see animation_data_file='params')
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150118, initial
 David N. Bresch, david.bresch@gmail.com, 20150119, hazard translucent, entity blue, damage red
 Lea Mueller, muellele@gmail.com, 20150202, schematic tag, exponential circle size for assets
 David N. Bresch, david.bresch@gmail.com, 20150220, show_plots added
 David N. Bresch, david.bresch@gmail.com, 20150220, focus_region added
 David N. Bresch, david.bresch@gmail.com, 20150318, save as text debugged
 David N. Bresch, david.bresch@gmail.com, 20150804, switched from 'Uncompressed AVI' to 'MPEG-4' (no AVI coded on Mac)
 David N. Bresch, david.bresch@gmail.com, 20150915, schematic_tag=2 implemented, i.e. asset distribution shown as in climada_entity_plot
 David N. Bresch, david.bresch@gmail.com, 20150916, speedup plotting map borders directly (avoid climada_plot_world_borders)
 David N. Bresch, david.bresch@gmail.com, 20160516, filenames without path allowed
 David N. Bresch, david.bresch@gmail.com, 20170103, params introduced, easier to introduce new features going forward, colorscale adjusted
 David N. Bresch, david.bresch@gmail.com, 20170104, clean up
 David N. Bresch, david.bresch@gmail.com, 20170105, frame_start, frame_end and plot_tc_track, video_profile
 David N. Bresch, david.bresch@gmail.com, 20170228, npoints in params, schematic_tag removed, lots of old stuff removed
 David N. Bresch, david.bresch@gmail.com, 20170301, 'check' option added
 David N. Bresch, david.bresch@gmail.com, 20170508, plot_assets and plot_damage options added
 David N. Bresch, david.bresch@gmail.com, 20170515, check_mode and axis_equal options added
View <A HREF=file:../../climada/code/helper_functions/climada_event_damage_animation.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_event_damage_data_tc">
<H2>climada_event_damage_data_tc</H2></A>
<font color="blue">function hazard=climada_event_damage_data_tc(tc_track,entity,check_mode,params,segment_i) </font>
 climada tc animation
 MODULE:
   core
 NAME:
   climada_event_damage_data_tc
 PURPOSE:
   The FAST version of climada_event_damage_data_tc. See also
   climada_event_damage_data_tc for some special cases. While the present
   version of the code runs parallel of climada_global.parfor=1, best
   speedup is achieved by running segemnts of tc_track parallel, i.e. to
   call climada_event_damage_data_tc(tc_track(i1:i2),entity,0,params,i1)
   and to run these calls in an (outer) parfor. Print to stdout does
   include the segment number, hence one can even keep track of parallel
   processing.

   Animation of climada cyclone impact for illustration - this code
   calculates all the data. See climada_event_damage_animation for nice
   plots and movie generation.

   See HINT below in description of OUTPUTS for use by other visualization projects

   Usual steps:

   0: load your tc_track and entity with
     &ampgt&ampgt tc_track=climada_tc_track_load
     &ampgt&ampgt entity=climada_entity_load
   1. run once with default parameters to check, i.e. for track 777
     &ampgt&ampgt climada_event_damage_data_tc(tc_track(777),entity);
   2. run again, now to silently generate data on higher resolution, e.g.
     &ampgt&ampgt climada_event_damage_data_tc(tc_track(777),entity,0); % no plot
   3. generate the movie, use
     &ampgt&ampgt climada_event_damage_animation % generate the .mp4 movie

   Note: as one often needs to set some of the paramers, call
   climada_event_damage_data_tc without any argument to return the
   default parameters (same as calling climada_event_damage_data_tc('params')

   Example for global (do NOT try this first ;-):
   entity=climada_entity_load('GLB_isimip_entity'); % full globe
   load([climada_global.data_dir filesep 'tc_tracks' filesep 'ibtracs' filesep 'ibtracs.mat']); % all track 1950..2016
   params.show_all_tracks=1;params.focus_region=[-180 180 -60 60];
   params.hazard_density=0.001;
   climada_event_damage_data_tc(tc_track,entity,0,params);

   Example for Sidr in Bangladesh:
   &ampgt&ampgt tc_track=climada_tc_read_unisys_database('nio');tc_track=tc_track(173);tc_track.name='Sidr';
   &ampgt&ampgt tc_track.MaxSustainedWind(end-1)=80;tc_track.MaxSustainedWind(end)=40; % 2nd and last timestep far over land, weakened
   &ampgt&ampgt entity=climada_entity_load('BGD_Bangladesh');
   %  previous line the entity for Bangladesh if it does not yet exist:
   %  entity=climada_nightlight_entity('Bangladesh');
   &ampgt&ampgt climada_event_damage_data_tc(tc_track,entity,2); % run with ...,0) for full resolution
   &ampgt&ampgt climada_event_damage_animation

   Example for Andrew in Florida:
   &ampgt&ampgt tc_track=climada_tc_read_unisys_database('atl');tc_track=tc_track(1170);tc_track.name='Andrew';
   &ampgt&ampgt entity=climada_entity_load('USA_UnitedStates_Florida_entity');
   &ampgt&ampgt params.focus_region=[-84 -78 23 29];
   &ampgt&ampgt climada_event_damage_data_tc(tc_track,entity,0,params);
   &ampgt&ampgt climada_event_damage_animation

   Example for all historic tracks in Bangladesh which generate damage:
   &ampgt&ampgt tc_track=climada_tc_track_load('nio_hist'); % all historic tracks
   &ampgt&ampgt hazard=climada_hazard_load('BGD_Bangladesh_nio_TC_hist'); % historic hazard
   &ampgt&ampgt entity=climada_entity_load('BGD_Bangladesh_HR_entity'); % high-res
   &ampgt&ampgt entity=climada_assets_encode(entity,hazard);
   &ampgt&ampgt EDS=climada_EDS_calc(entity,hazard);
   &ampgt&ampgt pos=find(EDS.damage&ampgt0);tc_track=tc_track(pos); % only damageing tracks
   &ampgt&ampgt climada_event_damage_data_tc(tc_track,entity,0);
   &ampgt&ampgt params.plot_tc_track=1;climada_event_damage_animation('',params);

   Example for all historic tracks in Florida which generate damage:  
   entity=climada_entity_load('USA_UnitedStates_Florida_01x01');
   entity.assets=climada_subarray(entity.assets,find(entity.assets.Value&ampgt0));
   tc_track=climada_tc_read_unisys_database('atl'); % all historic
   hazard=climada_hazard_load('USA_UnitedStates_atl_TC_hist');
   entity=climada_assets_encode(entity,hazard);EDS=climada_EDS_calc(entity,hazard);
   tc_track=tc_track(find(EDS.damage(logical(hazard.orig_event_flag))&ampgt0));
   p.focus_region=[-88 -79 23 32];p.tc_track_timestep=1;p.DamageFun_exponent=7;
   climada_event_damage_data_tc(tc_track,entity,0,p);
   climada_event_damage_animation

   Example for all historic tracks in Florida which generate damage:
   &ampgt&ampgt tc_track=climada_tc_read_unisys_database('atl'); % all historic
   &ampgt&ampgt entity=climada_entity_load('USA_UnitedStates_Florida_entity');
   &ampgt&ampgt hazard_prob=climada_hazard_load('USA_UnitedStates_atl_TC');
   &ampgt&ampgt entity=climada_assets_encode(entity,hazard_prob); % encode
   &ampgt&ampgt EDS=climada_EDS_calc(entity,hazard_prob); % calculate damage for all events
   &ampgt&ampgt % find non-zero damage of historic events:
   &ampgt&ampgt pos=find(EDS.damage(logical(hazard_prob.orig_event_flag))&ampgt0);
   &ampgt&ampgt tc_track=tc_track(pos); % restrict to historic damageing tracks
   &ampgt&ampgt params.focus_region=[-84 -78 23 29];
   &ampgt&ampgt climada_event_damage_data_tc(tc_track,entity,2,params);
   &ampgt&ampgt climada_event_damage_animation

   Instead of using a track from any of the ../data/tc_tracks databases,
   you might also just download a single track from
   weather.unisys.com/hurricane (click trough to a single track, then
   save the 'tracking information' as .dat file, i.e. right click and save
   as...) and then load with tc_track=climada_tc_read_unisys_track (in
   contrast to climada_tc_read_unisys_database, this reads one single
   track from a single track .dat file).

   The code produces all the step-by-step data to produce a damage
   animation. Instead of single events, the resulting hazard event set
   contains single time steps of the one event and the corresponding
   damage is also stored as a field into hazard (hazard.damage). If the
   flag params.show_footprint=0 (default), the intensity shows the
   instanteneous hazard intensity, while hazard.damage is the cumulated
   damage. For ease of use, the tc_track and the assets are also stored to
   hazard, see HINT in description of OUTPUTS below.

   The code determines the plot area based on entity. See
   params.focus_region in case you'd like to hard-wire the region.

   prior calls: none necessarily, consider climada_tc_track_info to obtain
       information about all tracks in an ocean basin
   next call: climada_event_damage_animation
 CALLING SEQUENCE:
   hazard=climada_event_damage_data_tc(tc_track,entity,check_mode,params)
 EXAMPLE:
   tc_track=climada_tc_read_unisys_database('atl');tc_track=tc_track(1170);
   entity=climada_entity_load('USA_UnitedStates_Florida');
   hazard=climada_event_damage_data_tc(tc_track,entity); % check
   hazard=climada_event_damage_data_tc(tc_track,entity,0); % high-res
   climada_event_damage_animation % create the movie

   params=climada_event_damage_data_tc % return default parameters

 INPUTS:
   tc_track: a tc_track structure, as returned by
       climada_tc_read_unisys_database or climada_tc_read_unisys_tc_track
       Note: if a tc_track struct with more than one track is passed, the
       code does render one after the other of the tracks within, keeping
       the damaged pixels colored.
       If ='params', just return the default parameters params in hazard
       If ='TEST', run test case (TC Sidr in Bangladesh)
       SPECIAL: if a previosuly generated hazard is passed, the
           non-mandatory fields for animation purposes are cleared and the
           'clean up' hazard is retuned.
   entity: a climada entity, see climada_entity_read (skip hazard set
       selection to encode to) or climada_entity_load
       &ampgt promted for if not given
       Note: for speedup, consider creating an entity covering only the
       region you'd like to focus on, e.g. avoid full contiguous US if
       you'd like to animate a TC hitting Floriday, i.e consider
       entity=climada_nightlight_entity('USA','Florida')
 OPTIONAL INPUT PARAMETERS:
   check_mode: =2: (default) show plots, use 2h timestep (fast check)
       =1: show plots, use 1h timestep (pretty detailed check)
       =0: no plots, 20 min timestep (params.tc_track_timestep=1/3) (the
       best option to generate the data pretty fast).
   parameters: a structure with fields (see also tc_track='params' above):
    animation_data_file: the file where animation data is stored (not the
       animation itself). If not provided, set to ../results/animation_data.mat
    extend_tc_track: if =1 (default) extend/extrapolate TC track by one node
    wind_threshold: threshold above which we calculate the windfield,
       Default =15 [m/s]. See also DamageFun_threshold.
       If you set wind_threshold to too high a number, not much of the windfield
       will be shown any more...
    focus_region: the region we're going to show [minlon maxlon minlat maxlat]
       default=[], automatically determined by area of entity lat/lon
       SPECIAL: if =1, use the region around the tc_track, NOT around the entity
       E.g. for Salvador (Lea, 20150220) focus_region = [-91.5 -86 12 15.5];
    focus_track_region: if =1, focus on track region instead of focus_region
    show_footprint: whether we show single steps (=0, default) or the footprint (=1)
    tc_track_timestep: the timestep (in hours or fractions thereof)
       between nodes, 0.1 means 6 min, good movie resolution, used if check_mode=0
    damage_scale: the scale for plots, such that
       max_damage=max(entity.assets.Value)*damage_scale, default =1/100
    label_track_nodes: if =1 label track nodes along track, default=0
    grid_add: add regular (coarse) grid to better show hazard intensity
       offshore. Default=1, set=0 if centroids cover eg water points already
    grid_delta: the regular encompassing grid spacing in degrees,
       default=0.2, see grid_add.
    hazard_density: very technical, set to rather too large a
       number, default=0.1.
    show_all_tracks: show all tracks (default =1), or only the ones
       affecting the focus region (=0)
    damage_cumsum: if =1, store the cumulative damage, If=0, store the
       momentaneous damage (for each step/node) - which case the
       visiulaization needs to sum up (advantage if due to huge size,
       chunks of data need to be processed).
    trim_assets: if =1, reduce assets to centroids with Value&ampgt0 (default)
       This is usually ok, since grid_add=1 by default.
       set =0 to keep all centroids from the entity (also eg water points)
    DamageFun_exponent: use a simple exponent to convert intensity (I) and
       asset value (V) to damage (D), i.e. D=V*I^DamageFun_exponent, scaled
       such that max intensity (about 120 m/s) leads to 100% damage.
       Default=0 (use proper EDS calculation). &ampgt1 convex, &amplt1 concave, Good start=7
    DamageFun_threshold: the intensity threshould, below which no damage
       occurrs. Default=15 [m/s]. Only active if abs(DamageFun_exponent)&ampgt0
       Please check wind_threshold, too, easiest to set
       DamageFun_threshold=wind_threshold (as done per default).
   segment_i: to allow for storage of (large) animation data in segments
       rather than one file. segment_i starts with the track(segment_i).
       Default=[]. This option apends _%4.4i to the filename passed in
       animation_data_file, e.g. animation_data.mat becomes animation_data_0001.mat
 OUTPUTS:
   hazard: a hazard structure (as usual) with additional fields:
       tc_track_node(i): the node i (tc_track.lon(i)...) for which the other
       tc_track: the TC track (see climada_tc_read_unisys_database for
           description of fields)
       max_damage: the maximum damage at each centroid (useful to scale or
           normalize, can also be calculated as =full(max(hazard.damage,[],1));
       in case of hazard=climada_event_damage_data_tc('params'), hazard
       contains the default parameters

 	HINT: for data to be directly used by other visualization projects, you
 	need to consider the following fields:
   hazard.intensity(time_i,centroid_i): the hazard intensity (here m/s
       wind speed) for timestep_i at centroid i
   hazard.damage(time_i,centroid_i): the (cumulative) damage (here in USD)
       for timestep_i at centroid i. See params.damage_cumsum, default=0
   hazard.lon(centroid_i): the longitude of centroid i
   hazard.lat(centroid_i): the latitude of centroid i
   hazard.event_name{time_i}: then name (with time stamp) of time step i
   hazard.focus_region(4): the region for which the data is valid
       [minlon maxlon minlat maxlat]
   hazard.assets.Value(year_i,centroid_j): the asset Value (USD) for year i
       at centroid j, if first dimension=1, constant/static assets values
   hazard.assets.lon(centroid_j): the longitude of centroid j
   hazard.assets.lat(centroid_j): the latitude of centroid j
   hazard.assets.Values_yyyy(year_i): the actual year for year i (=1 if
       constant/static assets value
   hazard.assets.Value(year_i,centroid_j): the asset Value (USD) for year i
       at centroid j, if first dimension=1, constant/static assets values
   hazard.tc_track(track_i): the tropical cyclone track data, where:
       hazard.tc_track(hazard.tc_track_number(time_i)).lon(hazard.tc_track_node(time_i))
       hazard.tc_track(hazard.tc_track_number(time_i)).lat(hazard.tc_track_node(time_i))
       is the longitude and latitude of the track node at time step i
   hazard.tc_track_number(time_i): the track_i of time step i, i.e.
       hazard.tc_track(hazard.tc_track_number(time_i)) is the track
   hazard.tc_track_node(time_i): the track node of time step i, i.e.
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170222, intial, started from climada_event_damage_data_tc
 David N. Bresch, david.bresch@gmail.com, 20170224, massive speedup
 David N. Bresch, david.bresch@gmail.com, 20170225, clean up
 David N. Bresch, david.bresch@gmail.com, 20170225, segment_i added
 David N. Bresch, david.bresch@gmail.com, 20170227, simple damage approximation added
 David N. Bresch, david.bresch@gmail.com, 20170228, further massive speedup, use i,j,v of sparse array
View <A HREF=file:../../climada/code/helper_functions/climada_event_damage_data_tc.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_excel_hazard_set">
<H2>climada_excel_hazard_set</H2></A>
<font color="blue">function hazard=climada_excel_hazard_set(excel_file,hazard_set_file,visualize) </font>
 climada excel hazard event set generate
 NAME:
   climada_excel_hazard_set
 PURPOSE:
   generate a hazard event set based on Excel input. The Excel sheet
   contains all the event footprints. 

   An easy method to use climada with a finite (small) number of
   predefined events (more hazard event scenarios then a full
   probabilistic set). 

   NOTE: no consistency checks performed, user to ensure that number of
   events equals number of frequencies, events defined at all centroids...
   
   see also: e.g. climada_tc_hazard_set
   next: diverse
 CALLING SEQUENCE:
   hazard=climada_excel_hazard_set(excel_file,hazard_set_file,visualize)
 EXAMPLE:
   hazard=climada_excel_hazard_set('','',1)
 INPUTS:
   excel_file: an Excel file with the centroid and hazard information
       required tabs: centroids, hazard_intensity and hazard_frequency
       centroids, required columns: centroid_ID, Longitude, Latitude
       hazard_intensity, required columns: centroid_ID, event001, event002, ...
       hazard_frequency, required columns: event_ID, frequency, orig_event_flag
       &ampgt promted for if not given
       See file ../data/hazards/Excel_hazard.xls which contains a small
       example (for Mozambique).
 OPTIONAL INPUT PARAMETERS:
   hazard_set_file: the name of the hazard set file
       &ampgt promted for if not given
   visualize: whether we plot the centroids on a map (=1) or not (=0,default)
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
       tropical cyclone or 'ET' for extratropical cyclone
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       intensity(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event
       matrix_density: the density of the sparse array hazard.intensity
       windfield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20110328
 David N. Bresch, david.bresch@gmail.com, 20141217, climada_hazard_cleanup added
View <A HREF=file:../../climada/code/helper_functions/climada_excel_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_figure_axis_limits_equal_for_lat_lon">
<H2>climada_figure_axis_limits_equal_for_lat_lon</H2></A>
<font color="blue">function climada_figure_axis_limits_equal_for_lat_lon(ax_limits) </font>
 set axis limits and set equal aspect ratio for maps (based on distance in km)
 MODULE:
   core/helper_functions
 NAME:
   climada_figure_axis_limits_equal_for_lat_lon
 PURPOSE:
   set axis limits and set equal aspect ratio for maps (based on distance in km)
   so that distance in x- and y-direction correspond to the same distance
   in km. This is necessary for coordinates in lat/lon as 1 degree in lat
   and lon are not the same distance in km. E.g. in Switzerland (47N,
   8E) 1 lon are 75km, and 1lat are 111km.
 CALLING SEQUENCE:
   climada_figure_axis_limits_equal_for_lat_lon(ax_limits)
 EXAMPLE:
   climada_figure_axis_limits_equal_for_lat_lon([-89 -90 14 15])
 INPUTS: 
   ax_limits: an array with 4 elements, specifying x_min, x_max, y_min,
              y_max
 OUTPUTS:      
   figure axis limits are set and data aspect ratio set to equal
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150730, init
 Lea Mueller, muellele@gmail.com, 20151106, move to advanced
 Lea Mueller, muellele@gmail.com, 20151106, move to core/helper_functions
 Lea Mueller, muellele@gmail.com, 20160310, workaround if ax_limits is only one lat/lon
View <A HREF=file:../../climada/code/helper_functions/climada_figure_axis_limits_equal_for_lat_lon.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_figure_scale_add">
<H2>climada_figure_scale_add</H2></A>
<font color="blue">function climada_figure_scale_add(fig_axes,left_corner,bottom_corner) </font>
 add figure scale to a figure 
 MODULE:
   climada core
 NAME:
   climada_figure_scale_add
 PURPOSE:
   Add figure scale to a figure, in km
 CALLING SEQUENCE:
   climada_figure_scale_add(fig_axes,left_corner,bottom_corner)
 EXAMPLE:
   climada_figure_scale_add
   climada_figure_scale_add('',1,1) % to position first from left and bottom
   climada_figure_scale_add('',-1,-1) % to position first from right and top
 INPUTS: 
 OPTIONAL INPUT PARAMETERS:
   fig_axes: axes of figures 
   left_corner: position of scale in the figure, default is 1, scale is 
       positioned on first x-grid from the left, set to -1 to start from the right
   bottom_corner: position of scale in the figure, default is 1, scale is 
       positioned on first y-grid from the bottom, set to -1 to start from the top
 OUTPUTS:      
   scale with km information appears on the current axis
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150724, init
 Lea Mueller, muellele@gmail.com, 20150729, return if x_tick is empty
 Lea Mueller, muellele@gmail.com, 20150729, add option for utm (no conversion to lat/lon)
 Lea Mueller, muellele@gmail.com, 20150729, limit top_corner and right_corner to maximum number of tick elements
 Lea Mueller, muellele@gmail.com, 20151106, move to core
 Lea Mueller, muellele@gmail.com, 20160311, start from the left and bottom
 Lea Mueller, muellele@gmail.com, 20160404, only half of the x-tick length
 david.bresch@gmail.com, 20170721, lifted a bit
View <A HREF=file:../../climada/code/helper_functions/climada_figure_scale_add.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_figuresize">
<H2>climada_figuresize</H2></A>
<font color="blue">function fig = climada_figuresize(height, width) </font>
 figure size for printing/saving pdf figures
 NAME:
   climada_figuresize
 PURPOSE:
   create figure so that pdf not A4 but customed to matlab figure
   and set default axes font size, line width, marker line width and text
   font size bigger, so that approriate for export
 CALLING SEQUENCE:
   fig = climada_figuresize(height, width)
 EXAMPLE:
   fig = climada_figuresize(0.4, 0.5)
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   height: percentage of height of screen
   width:  percentage of height of screen
 %   width:  percentage of width of screen
 OUTPUTS:
   figure with handle fig with requested height and width
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20110616
View <A HREF=file:../../climada/code/helper_functions/climada_figuresize.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_find_most_severe_event">
<H2>climada_find_most_severe_event</H2></A>
<font color="blue">function event_ii = climada_find_most_severe_event(hazard,event_i) </font>
 climada find most severe hazard event
 MODULE:
   climada/helper_functions
 NAME:
   climada_find_most_severe_event
 PURPOSE:
   find most severe hazard event (or second most or third most severe)
   among others to be used in climada_map_plot
 CALLING SEQUENCE:
   event_ii = climada_find_most_severe_event(hazard,event_i)
 EXAMPLE:
   event_ii = climada_find_most_severe_event(hazard,-1) % identify most severe event
 INPUTS:
   hazard: hazard structure
       &ampgt prompted for if empty
   event_i: the i-th event in the hazard event set to be displayed
       if event_i=0, the maximum intensity at each centroid is shown
       if event_i=-i, the i-th 'largest' event (sum of intensities) is shown
           e.g. for event_i=-2, the second largest event is shown
       default=-1 (just to get something on the screen ;-)
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   event_ii, an index that points to the identified event
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20160129, init
View <A HREF=file:../../climada/code/helper_functions/climada_find_most_severe_event.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_geo_distance">
<H2>climada_geo_distance</H2></A>
<font color="blue">function dist_m = climada_geo_distance(lon1,lat1,lon2,lat2) </font>
 calculate distance between to points in meters
 NAME:
   climada_geo_distance
 PURPOSE:
   calculate distance between two points or a point and a series of points
 CALLING SEQUENCE:
   dist_m=climada_geo_distance(lon1,lat1,lon2,lat2);
 EXAMPLE:
   dist_m=climada_geo_distance(0.0,45.0,1.0,45.0); % two points
   dist_m=climada_geo_distance(0.0,45.0,[1.0 2.0 2.0],[45.0 45.0 46.0]); % point and a series of points
 INPUTS:
   lon1,lat1: longitude and latitude of first point
   lon2,lat2: longitude and latitude of second point
       or, if vectors of the same length, series of points
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   dist_m: distance(s) between points in [m]
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091227
 David N. Bresch, david.bresch@gmail.com, 20160606, degree2km used
View <A HREF=file:../../climada/code/helper_functions/climada_geo_distance.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_git_clone">
<H2>climada_git_clone</H2></A>
<font color="blue">function climada_git_clone(TEST_mode) </font>
 climada git clone
 MODULE:
   core
 NAME:
   climada_git_clone
 PURPOSE:
   clone (most) climada modules (eases installation from scratch).

   once you have core climada installed, run this code to get all other
   modules installed (as sub-folders in climada_modules).
   This code then creates the folder climada_data and copies
   content of core climada's data into it.

   Hint: If you encounter troubles on cluster, start matlab with matlab -nojvm
   See also git command in MATLAB and http://git-scm.com/documentation

   previous call: startup (usually already executed)
   next call: climada_git_pull 
 CALLING SEQUENCE:
   climada_git_clone
 EXAMPLE:
   climada_git_clone(1)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   TEST_mode: =1 only show which modules will be processed, do not create
       default=0, i.e. run as stated above
 OUTPUTS:
   all messaging to stdout
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20161013, initial
 david.bresch@gmail.com, 20161109, most modules switched on
 david.bresch@gmail.com, 20170106, climada_data_check
View <A HREF=file:../../climada/code/helper_functions/climada_git_clone.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_git_pull">
<H2>climada_git_pull</H2></A>
<font color="blue">function climada_git_pull(TEST_mode) </font>
 climada git pull
 MODULE:
   core
 NAME:
   climada_git_pull
 PURPOSE:
   git pull for climada, first the core module, then all installed modules

   avoids all modules where name starts with '_' or which contain 'TEST',
   like _local_module, _local_TEST or local_TEST

   Note: climada_git_push is not implemented, as this might cause
   trouble, i.e. as it might automatically check in (large) .mat files or
   other stuff one did not check. For the time, use a git tool or operate
   git add, git commit and gut push on the command line yourself.

   Hint: If you encounter troubles on cluster, start matlab with matlab -nojvm
   See also git command in MATLAB and http://git-scm.com/documentation

   OLD VERSION: there is still climada_git_pull_repositories, which used a
   c-shell (csh) to issue the git commands (hence needed a local git
   installation). Please do NOT use climada_git_pull_repositories any
   more.

   previous call: startup (usually already executed)
   next call: climada_data_check, see also Note above
 CALLING SEQUENCE:
   climada_git_pull
 EXAMPLE:
   climada_git_pull(1) % to TEST first
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   TEST_mode: =1 only show which paths will be processed, do not pull
       default=0, i.e. run git pull
 OUTPUTS:
   all messaging to stdout
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20160606, initial
 david.bresch@gmail.com, 20160609, added remark about old climada_git_pull_repositories
 david.bresch@gmail.com, 20160616, pathsep
 david.bresch@gmail.com, 20161013, note about error on cluster added
 david.bresch@gmail.com, 20170106, using simple system command, not git.m (had some troubles e.g. on cluster)
 david.bresch@gmail.com, 20170523, try..catch in module update
View <A HREF=file:../../climada/code/helper_functions/climada_git_pull.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_git_pull_repositories">
<H2>climada_git_pull_repositories</H2></A>
<font color="blue">function climada_git_pull_repositories(TEST_mode,git_pull_command) </font>
 climada
 NAME:
   climada_git_pull_repositories
 PURPOSE:
   Execute a git pull on core climada and all repositories

   NEW version: see climada_git_pull. The code here just calls
   climada_git_pull, the rest of it kept for backward compatiblility (old
   MATLAB version, which had no built-in git support)

   OLD VERSION: this is the OLD approach, using a c-shell (csh) to issue
   the git commands (hence needed a local git installation). Please do NOT
   use climada_git_pull_repositories any more.  

   Automatically updates all local repositories' code, including core
   climada. Only prerequisite: git installed locally (such that the system
   command 'git pull' is valied, see OPTIONAL INPUT git_pull_command)

   On some machines, the MATLAB system command seems not to execute
   properly. In this case, the code writes a csh (C-Shell) script and
   tries to execute it. If that fails again, it leaves the script there
   and informs the user to execute it himself.

   see also climada_code_copy
 CALLING SEQUENCE:
   climada_git_pull_repositories(TEST_mode,git_pull_command)
 EXAMPLE:
   climada_git_pull_repositories
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   TEST_mode: idf =1, do not execute any system command, just lost them to
       stdout, =0, execute (default)
   git_pull_command: the local operating system's &ampltgit pull&ampgt command
       default ='git pull'
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141102, initial
 David N. Bresch, david.bresch@gmail.com, 20141107, TEST_mode added
 David N. Bresch, david.bresch@gmail.com, 20150305, csh script option added
 David N. Bresch, david.bresch@gmail.com, 20160609, switch to climada_git_pull
View <A HREF=file:../../climada/code/helper_functions/climada_git_pull_repositories.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_gridded_VALUE">
<H2>climada_gridded_VALUE</H2></A>
<font color="blue">function [X, Y, gridded_VALUE] = climada_gridded_VALUE(values,centroids,interp_method,npoints,stencil_ext) </font>
 NAME:
   climada_gridded_VALUE
 PURPOSE:
   gridded data of wind speed in hazard.intensity
   for creating color plot
 CALLING SEQUENCE:
   climada_gridded_VALUE(values,centroids,interp_method,npoints,stencil_ext)
 EXAMPLE:
   climada_gridded_VALUE(values,centroids)
 INPUTS:
   values
   centroids
 OPTIONAL INPUT PARAMETERS:
   interp_method: method in griddata, like 'linear', 'cubic',...
   npoints: the number of points used, default =499
   stencil_ext: to extend the stencil range (in units of the target grid,
       default=0
 OUTPUTS:
   X, Y, gridded Value
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120430
 Lea Mueller, muellele@gmail.com, 20110517
 David N. Bresch, david.bresch@gmail.com, 20161006, npoints default=499
View <A HREF=file:../../climada/code/helper_functions/climada_gridded_VALUE.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard2IFC">
<H2>climada_hazard2IFC</H2></A>
<font color="blue">function [IFC,geo_locations] = climada_hazard2IFC(hazard,geo_locations,return_period,check_plot,annotation_name) </font>
 climada
 MODULE:
   climada/helper_functions
 NAME:
   climada_hazard2IFC
 PURPOSE:
   Obtains the intensity frequency curve (IFC) of a given hazard set.
   See climada_IFC_plot to plot the IFC structure.

   Subsequent call: climada_IFC_plot
 CALLING SEQUENCE:
   [IFC,geo_locations] = climada_hazard2IFC(hazard,geo_locations,return_period,check_plot,annotation_name)
 EXAMPLE:
   climada_hazard2IFC(hazard,[23 94 51]) % pass centroid_IDs
   geo_locations.lon=14.426;geo_locations.lat=40.821; % pass lat/lon
   climada_hazard2IFC('',geo_locations)
 INPUTS:
   hazard: A climada hazard set.
 OPTIONAL INPUT PARAMETERS:
   geo_location: if not given, centroid ID is set to 1.
       Can be either: a 1xN vector of centroid_IDs;  Or a structure with
       fields .lon and .lat to specificy coordinates of interest, i.e.
       geo_locations.lon=14.426;geo_locations.lat=40.821;
   return_period: a list of return period at which we calculate the intensities
   check_plot: set to 1 to show plot, default is 1
   annotation_name: an annotation name, sued e.g in climada_IFC_plot,
       default=filename of the hazard set, i.e. as in hazard.filename 
       (without path)
 OUTPUTS:
   IFC(i): A structure (array of) to be used as input to climada_IFC_plot,
       containing information about the intensity-frequency
       properties of a given hazard. Fields are:
       .hazard_comment: string
       .peril_ID: the peril ID, string
       .centroid_ID: the (integer) centroid ID
       .intensity(n): hazard intensty for all n events
       .return_periods(n): hazard return period for each of the n events
       .fit_return_periods(m): the m return periods for the fit (m&amplt&ampltn)
       .intensity_fit(m): the m intensities for the fit
       .polyfit(2): the polyfit parameters, see code
       .hist_intensity(N): the N historic intensities (if orig_event_flag...)
       .hist_return_periods: hazard return period for each of the N historic events
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150130
 David N. Bresch, david.bresch@gmail.com, 20150309, bugfixes
 Lea Mueller, muellele@gmail.com, 20150318, fit parameters only for positive intensity values
 David N. Bresch, david.bresch@gmail.com, 20150405, IFC as struct array
 Lea Mueller, muellele@gmail.com, 20150504, variable intensity threshold depending on peril_ID
 Gilles Stassen, gillesstassen@hotmail.com, 20150615, check_plot and 'SELECT' option added, bug fix order of isstruct/isvector(geo_loc)
 Lea Mueller, muellele@gmail.com, 20160308, introduce return_period as input
 Lea Mueller, muellele@gmail.com, 20160314, bugfix if hazard has only one lat/lon
 david.bresch@gmail.com, 20160609, bugfix if no historical data
View <A HREF=file:../../climada/code/helper_functions/climada_hazard2IFC.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard2ge">
<H2>climada_hazard2ge</H2></A>
<font color="blue">function climada_hazard2ge(hazard,google_earth_save,schematic_tag) </font>
 climada
 MODULE:
   core cliamda
 NAME:
   climada_hazard2ge
 PURPOSE:
   hazard footprints visualisation in google earth
 CALLING SEQUENCE:
   climada_hazard2ge(hazard,google_earth_save,schematic_tag)
 EXAMPLE:
   climada_hazard2ge
 INPUTS:
   hazard: structure
       &ampgt promted for if not given
   google_earth_save: the filename of the resulting .kmz google earth file
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   schematic_tag: set to 1 if schematic plot (no colorbar, indicative
   colorscale). if set to 0, e.g. tc wind color scale is yellow
   (20-30 m/s), orange (30-40 m/s), dark orange (40-50 m/s), etc...
 OUTPUTS:
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150313, initial
View <A HREF=file:../../climada/code/helper_functions/climada_hazard2ge.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard2octave">
<H2>climada_hazard2octave</H2></A>
<font color="blue">function hazard=climada_hazard2octave(hazard) </font>
 climada template
 MODULE:
   core
 NAME:
   climada_hazard2octave
 PURPOSE:
   In case the .mat file whch contains hazard has been saved with option
   -v7.3, in Octave, hazard.intensity contains sub-fields jc, ir and data
   There might be a more elegant way, but the present one is an explicit
   conversion back into a sparse matrix in Octave.

   Call this code whenever you access to hazard.intensity and would like
   to make sure the code works in Octave for large(r) hazard event sets,
   too.

   Calling the code in MATLAB has most likely (almost certainly) no effect
   and does take a few femptoseconds ;-)

   called from e.g. climada_EDS_calc
 CALLING SEQUENCE:
   hazard=climada_hazard2octave(hazard)
 EXAMPLE:
   hazard=climada_hazard2octave(hazard)
 INPUTS:
   hazard: a climada hazard event set structure, see e.g.
       climada_tc_hazard_set
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   hazard: a climada hazard event set structure, with hazard.intensity a
       sparse array
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150112, initial
 David N. Bresch, david.bresch@gmail.com, 20150114, speedup
View <A HREF=file:../../climada/code/helper_functions/climada_hazard2octave.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_check">
<H2>climada_hazard_check</H2></A>
<font color="blue">function res=climada_hazard_check(hazard,input_res) </font>
 climada hazard check
 MODULE:
   core
 NAME:
   climada_hazard_check
 PURPOSE:
   check a climada hazard set

   previous call: e.g. climada_tc_hazard_set
   next call: climada_EDS_calc
 CALLING SEQUENCE:
   res=climada_hazard_check(hazard)
 EXAMPLE:
   res =climada_hazard_check(hazard)      % show stats for hazard
   res2=climada_hazard_check(hazard2,res) % compare with hazard2
 INPUTS:
   hazard: a climada hazard event set
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   input_res: the output from a previous call, allows to compare two hazard sets
 OUTPUTS:
   res: the output, empty if not successful, with fields
       bin: the bins
       N: the percentage of intensity values within bins
       units: the units of hazard.intensity
       legend: the legend
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161205
View <A HREF=file:../../climada/code/helper_functions/climada_hazard_check.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_cleanup">
<H2>climada_hazard_cleanup</H2></A>
<font color="blue">function hazard=climada_hazard_cleanup(hazard_file) </font>
 climada
 NAME:
   climada_hazard_cleanup
 PURPOSE:
   Check a hazard event set for full climada compatibility, i.e.
   - switch from hazard.arr to hazard.intensity
   - check for orientation of vectors and matrices (speedup)
   - check consistency (e.g. hazard.event_count)

   We decided 20141017 to switch from hazard.arr to hazard.intensity,
   since this fieldname is more telling.

 CALLING SEQUENCE:
   hazard=climada_hazard_cleanup(hazard_file)
 EXAMPLE:
   hazard=climada_hazard_cleanup % prompts for
 INPUTS:
   hazard_file: the filename with path of an existing hazard event set
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   hazard: a struct, see e.g. climada_tc_hazard_set
       the cleaned hazard is saved back to the original .mat file
   file
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141017
 David N. Bresch, david.bresch@gmail.com, 20141121, hazard.lon check added
 David N. Bresch, david.bresch@gmail.com, 20141123, converted to full check
View <A HREF=file:../../climada/code/helper_functions/climada_hazard_cleanup.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_clim_scen">
<H2>climada_hazard_clim_scen</H2></A>
<font color="blue">function hazard = climada_hazard_clim_scen(hazard,hazard_clim_file,frequency_screw,intensity_screw,intensity_shift) </font>
 climada
 NAME:
   climada_template
 PURPOSE:
   starting from a given hazard event set (hazard), construct the
   climate scenario hazard event set (hazard_clim_file)

   Modifications done in code, so please visit/edit the code prior to use,
   please check the PARAMETERS section below, e.g. for
       frequency_screw, intensity_screw
       hazard_reference_year: the reference year for the hazard set
 CALLING SEQUENCE:
   hazard=climada_tc_hazard_clim_scen(hazard,hazard_clim_file)
 EXAMPLE:
   hazard=climada_tc_hazard_clim_scen
 INPUTS:
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   hazard_clim_file: the filename of the new climate scenario hazard event set
       &ampgt promted for if not given
 OUTPUTS:
   hazard: the hazard event set for the climate scenario, also stored to hazard_clim_file
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090920
 Lea Mueller, 20110720
 Reto Stockmann 20120719
 David N. Bresch, david.bresch@gmail.com, 20150906, allow for name without path on input
 Lea Mueller, muellele@gmail.com, 20151021, add intensity shift
 Lea Mueller, muellele@gmail.com, 20151022, bugfix in fprintf
View <A HREF=file:../../climada/code/helper_functions/climada_hazard_clim_scen.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_plot">
<H2>climada_hazard_plot</H2></A>
<font color="blue">function res=climada_hazard_plot(hazard,event_i,label,caxis_range,plot_centroids,entity) </font>
 climada plot single hazard event footprint
 NAME:
   climada_hazard_plot
 PURPOSE:
   plot hazard event as contour on a map, works for all perils

   see also climada_plot_tc_footprint (works for TC only)
   and the high-resolution version climada_hazard_plot_hr

   See also climada_hazard_plot_nogrid (later to be merged all in one)
 CALLING SEQUENCE:
   res=climada_hazard_plot(hazard,event_i,label,caxis_range,plot_centroids,entity)
 EXAMPLE:
   climada_hazard_plot(climada_hazard_load,1); % plot first event
   climada_hazard_plot; % prompt for hazard event set, plot largest event
 INPUTS:
   hazard: hazard structure
       &ampgt prompted for if empty
   event_i: the i-th event in the hazard event set to be displayed
       if event_i=0, the maximum intensity at each centroid is shown
       if event_i=-i, the i-th 'largest' event (sum of intensities) is shown
           e.g. for event_i=-2, the second largest event is shown
       default=-1 (just to get something on the screen ;-)
       Different meaning in case you pass entity (see optional parameters)
 OPTIONAL INPUT PARAMETERS:
   label: a struct with a label to add on the plot (i.e. a place)
       longitude: the longitude (decimal)
       latitude: the latitude (decimal)
       name: the label itself, like 'gaga'
   caxis_range: [minval maxval], the range of the color axis, e.g. [20 40]
       to show colors for values brtween 20 and 40
   plot_centroids: =1, plot centroids, =0 no (default)
   entity: if provided, do not show 'biggest' hazard in terms of itensity,
       but regarding resulting damage based on entity
       Only makes sense for event_i&amplt0, as it shows the i-th largest damage
 OUTPUTS:
   creates a figure
   res, a structure with the core data, i.e. X,Y and VALUE as shown
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20140302
 David N. Bresch, david.bresch@gmail.com, 20150114, Octave compatibility for -v7.3 mat-files
 David N. Bresch, david.bresch@gmail.com, 20150225, res instead of [X,Y,gridded_VALUE]
 Lea Mueller, muellele@gmail.com, 20150424, colormap according to peril_ID
 Lea Mueller, muellele@gmail.com, 20150427, higher resolution, npoints set to 2000 (instead of 199)
 Lea Mueller, muellele@gmail.com, 20150512, switched to griddata instead of climada_gridded_Value
 David N. Bresch, david.bresch@gmail.com, cleanup
 David N. Bresch, david.bresch@gmail.com, 20160930, legend added, if centroids are plotted
 David N. Bresch, david.bresch@gmail.com, 20170110, entity added
 David N. Bresch, david.bresch@gmail.com, 20170611, FontSize in PARAMETERS for plots
 David N. Bresch, david.bresch@gmail.com, 20170706, hint to climada_hazard_plot_nogrid added
 David N. Bresch, david.bresch@gmail.com, 20170721, cleanup for title_str
View <A HREF=file:../../climada/code/helper_functions/climada_hazard_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_plot_hr">
<H2>climada_hazard_plot_hr</H2></A>
<font color="blue">function fig = climada_hazard_plot_hr(hazard,event_i,label,caxis_range,plot_centroids,hist_check) </font>
 climada plot single hazard event footprint
 NAME:
   climada_hazard_plot_hr
 PURPOSE:
   plot hazard event as high resolution contour on a map, works for all perils

   See also the low-resolution version climada_hazard_plot
 CALLING SEQUENCE:
   climada_hazard_plot_hr(hazard,event_i,label,caxis_range,plot_centroids,hist_check)
 EXAMPLE:
   climada_hazard_plot_hr(hazard,1); % plot first event
   climada_hazard_plot_hr; % prompt for hazard event set, plot largest event
 INPUTS:
   hazard: hazard structure
       &ampgt prompted for if empty
   event_i: the i-th event in the hazard event set to be displayed
       if event_i=0, the maximum intensity at each centroid is shown
       if event_i=-i, the i-th 'largest' event (sum of intensities) is shown
           e.g. for event_i=-2, the second largest event is shown
       default=-1 (just to get something on the screen ;-)
 OPTIONAL INPUT PARAMETERS:
   label: a struct with a label to add on the plot (i.e. a place)
       longitude: the longitude (decimal)
       latitude: the latitude (decimal)
       name: the label itself, like 'gaga'
   caxis_range: [minval maxval], the range of the color axis, e.g. [20 40]
       to show colors for values brtween 20 and 40
   plot_centroids: =1, plot centroids, =0 no (default)
   hist_check: if =1, plot historic events only, =0 all (default)
 OUTPUTS:
   creates a figure and returns figure handle
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150206
 David N. Bresch, david.bresch@gmail.com, 20150313, synchronized with climada_hazard_plot
 Gilles Stassen, 20150428, special plotting routine for MS hazard added
 Gilles Stassen, 20150703, &quot**1st&quot, &quot**2nd&quot &quot**3rd&quot etc. added in title
 Lea Mueller, muellele@gmail.com, 20150713, add LS special case (intensity = 1-1/cutoff*distance_m)
View <A HREF=file:../../climada/code/helper_functions/climada_hazard_plot_hr.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_stats">
<H2>climada_hazard_stats</H2></A>
<font color="blue">function hazard = climada_hazard_stats(hazard,return_periods,check_plot,fontsize) </font>
 NAME:
   climada_hazard_stats
 PURPOSE:
   plot hazard intensity maps for different return periods, based on the
   probabilistic (and historic) data set. On output, the statistics are
   available, directly added to the hazard structure.

   If called with the output hazard on subsequent calls, only the plotting
   needs to be done (e.g. to further improve plots). I.e. to repeat
   calculation of the maps, delete hazard.map

   See also climada_IFC_plot for a local hazard intensity/frequency plot

   NOTE: this code listens to climada_global.parfor for substantial speedup

   previous call: e.g. climada_tc_hazard_set
 CALLING SEQUENCE:
   climada_hazard_stats(hazard,return_periods,check_plot)
 EXAMPLE:
   hazard=climada_hazard_stats
   climada_hazard_stats(hazard,[],-1) % show historic events only
 INPUTS:
   hazard: hazard structure, as generated by e.g. climada_tc_hazard_set
       &ampgt prompted for if not given
 OPTIONAL INPUT PARAMETERS:
   return_periods: vector containing the requested return periods
       (default=[1 5 10 25 50 100 500 1000])
   check_plot: default=1, draw the intensity maps for various return
       periods for the full hazard set. Set=0 to omit plot
       =-1: calculate and plot the return period maps based on historic
       events only (needs hazard.orig_event_flag to exist)
   fontsize: default =12
 OUTPUTS:
   the field hazard.map is added to the hazard structure, with
       map.return_period(rp_i): return period rp_i
       map.intensity(rp_i,c_i): intensity for return period rp_i at centroid c_i
           based either on all (check_plot&ampgt0) or only on historic events
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20110623
 David N. Bresch, david.bresch@gmail.com, 20130317 cleanup
 David N. Bresch, david.bresch@gmail.com, 20140411 fixed some non-TC issues
 David N. Bresch, david.bresch@gmail.com, 20150114, Octave compatibility for -v7.3 mat-files
 Lea Mueller, muellele@gmail.com, 20150607, change tc max int. value to 80 instead of 100m/s
 Lea Mueller, muellele@gmail.com, 20150607, add cross for San Salvador in plot, for San Salvador only
 Lea Mueller, muellele@gmail.com, 20150716, add landslides option (LS) with specific colormap, intensities from 0 to 1
 David N. Bresch, david.bresch@gmail.com, 20160527, complete overhaul, new field hazard.map
 David N. Bresch, david.bresch@gmail.com, 20160529, otherwise in colorscale selection fixed
 David N. Bresch, david.bresch@gmail.com, 20160529, new default return periods (6)
 David N. Bresch, david.bresch@gmail.com, 20161006, minimum thresholds set for some perils
 David N. Bresch, david.bresch@gmail.com, 20170202, parallelized
 David N. Bresch, david.bresch@gmail.com, 20170216, small issue in line 274 (not fixed yet)
 David N. Bresch, david.bresch@gmail.com, 20170518, small fix for EQ (caxis_max)
View <A HREF=file:../../climada/code/helper_functions/climada_hazard_stats.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_stats_figure">
<H2>climada_hazard_stats_figure</H2></A>
<font color="blue">function fig = climada_hazard_stats_figure(hazard,return_periods,intensity_xtick,plot_method) </font>
 NAME:
   climada_hazard_stats_figure
 PURPOSE:
   plot hazard intensity maps for different return periods
   based on statistics 
     .intensity_fit_ori
     .intensity_fit
     .R_fit (requested return periods)
   previous withing climada_hazard_stats
 PREVIOUS STEP:
   climada_hazard_stats
 CALLING SEQUENCE:
   fig = climada_hazard_stats_figure(hazard,return_periods)
 EXAMPLE:
   climada_hazard_stats_figure
   climada_hazard_stats_figure(climada_hazard_stats(hazard),[10 50],[0:20:100],'contourf')
 INPUTS:
   hazard with hazard stats (.intensity_fit, .R)
 OPTIONAL INPUT PARAMETERS:
   hazard: hazard structure, if not given, prompted for
       generated by e.g. climada_tc_hazard_set
   return_periods: vector containing the requested return periods
       (e.g. [1 5 10 25 50 100 500 1000])
       if empty, taken from default as defined in climada_init_vars
   intensity_xtick: set xtick of intensity values
   plot_method: 'contourf', 'pcolor', 'plotclr', default is contourf
 OUTPUTS:
   a figure with the intensity per return period
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150914, separate from climada_hazard_stats
 Lea Mueller, muellele@gmail.com, 20160226, add intensity_xtick and plot_method
 Lea Mueller, muellele@gmail.com, 20160314, add climada_global.admin1_plot, bugfix
View <A HREF=file:../../climada/code/helper_functions/climada_hazard_stats_figure.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazards">
<H2>climada_hazards</H2></A>
<font color="blue">function hazard_info=climada_hazards(entity,peril_ID,check_plots) </font>
 climada template
 MODULE:
   core
 NAME:
   climada_hazards
 PURPOSE:
   generate the standard probabilistic hazard event sets for a given
   entity (tiehr one country or any combination or...). If the hazard
   set(s) already exist, they are NOT regenerated.

   just a caller for centroids_generate_hazard_sets

   Note: to speed up hazard set generation, you might set climada_global.patfor=1

   previous call (usually): entity=climada_entity_country
   next call: EDS=climada_EDS_calc(entity,hazard)
 CALLING SEQUENCE:
   res=climada_template(param1,param2);
 EXAMPLE:
   climada_template(param1,param2);
 INPUTS:
   entity: an entity, see climada_entity_country or
       climada_entity_read or climada_entity_load. Only assets.lat/lon
       and (if present) distance2coast_km are used.
       &ampgt prompted for if empty
 OPTIONAL INPUT PARAMETERS:
   peril_ID: if not empty, generate hazard set only for specified peril
       peril_ID can be 'TC','TS','TR','EQ','VQ','WS'..., default='' for all
   check_plots: if =1, show figures to check hazards etc.
       If =0, skip figures (default)
 OUTPUTS:
   stores the hazard sets in climada_global.hazards_dir
   centroids_hazard_info: a structure with hazard information, with fields
       res.hazard(hazard_i) with
           peril_ID: 'TC' or ...
           hazard_set_file: the full filename of the hazard set generated
           data_file: for TC only: the file sused to generste the event set
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170624
View <A HREF=file:../../climada/code/helper_functions/climada_hazards.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_init_folders">
<H2>climada_init_folders</H2></A>
<font color="blue">function ok=climada_init_folders(root_folder) </font>
 init variables global
 NAME:
	climada_init_folders
 PURPOSE:
	initialize basic folder structure (eg in modules)

 CALLING SEQUENCE:
	ok=climada_init_folders(root_folder)
 EXAMPLE:
	ok=climada_init_folders
 INPUTS:
 OPTIONAL INPUT PARAMETERS:

 OUTPUTS:
	ok: =1 if no troubles, 0 else
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20140825, initial release
View <A HREF=file:../../climada/code/helper_functions/climada_init_folders.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_inpolygon">
<H2>climada_inpolygon</H2></A>
<font color="blue">function in=climada_inpolygon(xq,yq,xv,yv,check_plot) </font>
 climada template
 MODULE:
   core
 NAME:
   climada_inpolygon
 PURPOSE:
   wrapper for inpolygon to work with octave in case of segmented polygons
   (segments separated by NaNs, see EXAMPLE)

   NOTE: for complex cases, still use inpolygon in MATLAB (as it can handle more
   complex intersecting shapes etc.). I.e. call climada_inpolygon only if
   climada_global.octave_mode=1. But some places, we call
   climada_inpolygon, as this way, one can, once Octave has fixed the
   issues, just make the chnage here in climada_inpolygon once.
 CALLING SEQUENCE:
   in=climada_inpolygon(xq,yq,xv,yv,TEST_mode)
 EXAMPLE:
   xv = [1 2 2 1 1 NaN 2.5 2.5 3 3 2.5];yv = [1 1 2 2 1 NaN 2.5 3 3 2.5 2.5];
   xv = [1 2 2 1 1 NaN 2.5 2.5 3 3 2.5 NaN NaN];yv = [1 1 2 2 1 NaN 2.5 3 3 2.5 2.5 NaN NaN];
   xq = rand(500,1)*5;yq = rand(500,1)*5;
   in=climada_inpolygon(xq,yq,xv,yv,1)
 INPUTS:
   xq,yq,xv,yv: see help inpolygo
 OPTIONAL INPUT PARAMETERS:
   check_plot: =1 to shown the result (default=0)
 OUTPUTS:
   in: the indices of the points within the polygon (see help inpolygon)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161002, initial
View <A HREF=file:../../climada/code/helper_functions/climada_inpolygon.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_interp1">
<H2>climada_interp1</H2></A>
<font color="blue">function varargout = climada_interp1(varargin) </font>
INTERP1 1-D interpolation (table lookup)

   SPECIAL: copy of original interp1 with some checks removed for speedup,
   since called thousands of times from climada_EDS_calc
   In case you encounter troubles, just replace calls of climada_interp1
   with interp1 in climada_EDS_calc. 
   20150320, david.bresch@gmail.com

   Some features of INTERP1 will be removed in a future release.
   See the R2012a release notes for details.

   Vq = INTERP1(X,V,Xq) interpolates to find Vq, the values of the
   underlying function V=F(X) at the query points Xq. X must
   be a vector of length N.
   If V is a vector, then it must also have length N, and Vq is the
   same size as Xq.  If V is an array of size [N,D1,D2,...,Dk], then
   the interpolation is performed for each D1-by-D2-by-...-Dk value
   in V(i,:,:,...,:).
   If Xq is a vector of length M, then Vq has size [M,D1,D2,...,Dk].
   If Xq is an array of size [M1,M2,...,Mj], then Vq is of size
   [M1,M2,...,Mj,D1,D2,...,Dk].

   Vq = INTERP1(V,Xq) assumes X = 1:N, where N is LENGTH(V)
   for vector V or SIZE(V,1) for array V.

   Interpolation is the same operation as &quottable lookup&quot.  Described in
   &quottable lookup&quot terms, the &quottable&quot is [X,V] and INTERP1 &quotlooks-up&quot
   the elements of Xq in X, and, based upon their location, returns
   values Vq interpolated within the elements of V.

   Vq = INTERP1(X,V,Xq,METHOD) specifies alternate methods.
   The default is linear interpolation. Use an empty matrix [] to specify
   the default. Available methods are:

     'nearest'  - nearest neighbor interpolation
     'linear'   - linear interpolation
     'spline'   - piecewise cubic spline interpolation (SPLINE)
     'pchip'    - shape-preserving piecewise cubic interpolation
     'cubic'    - same as 'pchip'
     'v5cubic'  - the cubic interpolation from MATLAB 5, which does not
                  extrapolate and uses 'spline' if X is not equally
                  spaced.

   Vq = INTERP1(X,V,Xq,METHOD,'extrap') uses the interpolation algorithm
   specified by METHOD to perform extrapolation for elements of Xq outside
   the interval spanned by X.

   Vq = INTERP1(X,V,Xq,METHOD,EXTRAPVAL) replaces the values outside of the
   interval spanned by X with EXTRAPVAL.  NaN and 0 are often used for
   EXTRAPVAL.  The default extrapolation behavior with four input arguments
   is 'extrap' for 'spline' and 'pchip' and EXTRAPVAL = NaN (NaN +NaNi for 
   complex values) for the other methods.

   PP = INTERP1(X,V,METHOD,'pp') will use the interpolation algorithm specified
   by METHOD to generate the ppform (piecewise polynomial form) of V. The
   method may be any of the above METHOD except for 'v5cubic'. PP may then
   be evaluated via PPVAL. PPVAL(PP,Xq) is the same as
   INTERP1(X,V,Xq,METHOD,'extrap').

   For example, generate a coarse sine curve and interpolate over a
   finer abscissa:
       X = 0:10; V = sin(X); Xq = 0:.25:10;
       Vq = climada_interp1(X,V,Xq); plot(X,V,'o',Xq,Vq)

   For a multi-dimensional example, we construct a table of functional
   values:
       X = [1:10]'; V = [ X.^2, X.^3, X.^4 ];
       Xq = [ 1.5, 1.75; 7.5, 7.75]; Vq = climada_interp1(X,V,Xq);

   creates 2-by-2 matrices of interpolated function values, one matrix for
   each of the 3 functions. Vq will be of size 2-by-2-by-3.

   Class support for inputs X, V, Xq, EXTRAPVAL:
      float: double, single

   See also INTERP1Q, INTERPFT, SPLINE, PCHIP, INTERP2, INTERP3, INTERPN, PPVAL.
   Copyright 1984-2012 The MathWorks, Inc.
   $Revision: 5.41.4.25 $  $Date: 2012/10/29 19:19:25 $
   david.bresch@gmail.com, 20150301, copied as climada_interp1 for speedup (but limited functionality compared to interp1)
View <A HREF=file:../../climada/code/helper_functions/climada_interp1.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_load">
<H2>climada_load</H2></A>
<font color="blue">function [struct_data, struct_name] = climada_load(struct_file,struct_type,silent_mode) </font>
 climada
 MODULE:
   core/helper_functions
 NAME:
   climada_load
 PURPOSE:
   Load any climada struct (entity, EDS, hazard, centroids) and set
   variable_name yourself with struct_data. Identify variable type.
 CALLING SEQUENCE:
   [struct_data, struct_name] = climada_load(struct_file,struct_type)
 EXAMPLE:
   [struct_data, struct_name] = climada_load(struct_file,struct_type)
   entity = climada_load('demo_today')
   measures_impact = climada_load('','measures_impact')
   hazard = climada_load('TCNA_today_small')
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   struct_file: the filename (with path, optional) of a previously saved
       climada structure
       If no path provided, default path ../data/... is used (and
       name can be without extension .mat)
       &ampgt promted for if not given
   struct_type: a string to define the type of a climada struct, i.e 
       'entity', 'hazard', 'measures_impact'. If no struct_file given, the
       prompt will reflect the appropiate folder (data/entities, or
       data/results, ...)
   silent_mode: suppress any output, default=0 (output to command window), =1: no output
 OUTPUTS:
   struct_data: a struct, i.e. hazard, entity, EDS, centroids, etc.
   struct_name: a char that contains the name of the struct, i.e.
   'hazard', 'entity', etc.
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151124, init from climada_entity_load
 Lea Mueller, muellele@gmail.com, 20151130, move to climada/code/helper_functions
 Lea Mueller, muellele@gmail.com, 20151202, enhance to work with multiple variables within one matfile
 Lea Mueller, muellele@gmail.com, 20151207, identify any given struct_file as input, identify entity with .ED field
 Lea Mueller, muellele@gmail.com, 20160203, identify centroids with .centroid_ID
View <A HREF=file:../../climada/code/helper_functions/climada_load.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_location_sum">
<H2>climada_location_sum</H2></A>
<font color="blue">function [lon_unique, lat_unique, values_sum]= climada_location_sum(lon, lat, values) </font>
 MODULE:
   core/helper_functions
 NAME:
   climada_location_sum
 PURPOSE:
   Sum of values per unique locations
 CALLING SEQUENCE:
   [lon_unique, lat_unique, values_sum]= climada_location_sum(lon, lat, values)
EXAMPLE
   [lon_unique, lat_unique, values_sum]= climada_location_sum([1 1], [2 2], [5 5])
 INPUT:
   lon: a list of longitude coordinates
   lat: a list of latitude coordinates
   value: a list of the same lenght as lon and lat with values                
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   lon_unique: unique longitude coordinates
   lat_unique: unique longitude coordinates
   values_sum: summed values per unique location
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150212, init based on climada_assets_sum
View <A HREF=file:../../climada/code/helper_functions/climada_location_sum.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_longitude_unify">
<H2>climada_longitude_unify</H2></A>
<font color="blue">function lon=climada_longitude_unify(lon,maxlon,consistent) </font>
 climada longitude conversion
 MODULE:
   core
 NAME:
   climada_longitude_unify
 PURPOSE:
   make sure longitudes are either all -180..180 or 0..360
 CALLING SEQUENCE:
   lon=climada_longitude_unify(lon,maxlon)
 EXAMPLE:
   climada_longitude_unify(180+10,180) % results in -170
 INPUTS:
   lon: longitude, either scalar or vector
 OPTIONAL INPUT PARAMETERS:
   maxlon: the maximum longitude, either =180 (range -180..180) or =360 (range 0..360)
   consistent: only convert, if all elements are converted the same way
       (i.e. for maxlon=180, if all elements are &ampgt180, convert them)
 OUTPUTS:
   lon: the longitude in range
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161008
View <A HREF=file:../../climada/code/helper_functions/climada_longitude_unify.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_lonlat_cleanup">
<H2>climada_lonlat_cleanup</H2></A>
<font color="blue">function ok=climada_lonlat_cleanup </font>
 climada template
 MODULE:
   core
 NAME:
   climada_lonlat_cleanup
 PURPOSE:
   cleans up old entities and centroids in renaming fields
   .Latitude to .lat and .Longitude to .lon, i.e.:
   entity.assets.Longitude/Latitude -&ampgt entity.assets.lon/lat
   centroids.Longitude/Latitude -&ampgt centroids.lon/lat

   Note: this code is currently invoked ONCE by climada_init_vars. There,
   a small file ../system/climada_lonlat_cleanup_done.txt is written to
   indicate successful execution. We will remove this cleanup in summer
   2015 latest.
 CALLING SEQUENCE:
   ok=climada_lonlat_cleanup
 EXAMPLE:
   ok=climada_lonlat_cleanup
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   ok: =1 if all done, see error messages else
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150203
 David N. Bresch, david.bresch@gmail.com, 20150819, centroids folder added
View <A HREF=file:../../climada/code/helper_functions/climada_lonlat_cleanup.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_map_plot">
<H2>climada_map_plot</H2></A>
<font color="blue">function [input_structure, fig] = climada_map_plot(input_structure,fieldname_to_plot,plot_method,event_no,category_criterium) </font>
 Generate a map plot
 MODULE:
   core/helper_functions
 NAME:
   climada_map_plot
 PURPOSE:
   create a map, for a selected input structure and a fieldname, i.e.
   'elevation_m' of centroids, 'Value' of entity.assets, 'intensity' of
   hazard
 PREVIOUS STEP:
   multiple
 CALLING SEQUENCE:
   [input_structure, fig] = climada_map_plot(input_structure,fieldname_to_plot,plot_method,event_no,category_criterium)
 EXAMPLE:
   [input_structure, fig] = climada_map_plot
   hazard = climada_map_plot('TCNA_today_small','','contourf',7121);
   climada_map_plot(entity,'Value')
   climada_map_plot(centroids,{'elevation_m' 'slope_deg'})
   climada_map_plot(EDS(3),'ED_at_centroid','',1,'Residential') % plot AED at residential houses from EDS(3)
   climada_map_plot('m_demotoday_TCNA2030highsmall',{'ED_at_centroid' 'benefit'},'',2) % plot AED and benefit for measure no 2
 INPUTS:
   input_structure:  a climada stucture, i.e. centroids, entity,
        entity.assets, hazard, EDS, can also be the filename of a saved
        struct, i.e. TCNA_today_small
   fieldname_to_plot: string or cell, i.e. 'Value', or {'elevation_m' 'slope_deg'}
 OPTIONAL INPUT PARAMETERS:
   plot_method: a string, default is 'plotclr', can also be 'contourf'
   event_no: an array, only important to select a specific event for
   'intensity', or number of measure for measures_impact
   category_criterium: a string or cell, e.g. {'Agriculture' 'Residential'}
   to select a subset of assets that will be shown
 OUTPUTS:
   input_structure:  a climada stucture, i.e. centroids, entity,
        entity.assets, hazard, EDS
   fig: handle on the figure with a map displaying the selected field 
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151124, init
 Lea Mueller, muellele@gmail.com, 20151130, enhance to work with measures_impact and plot benefit
 Lea Mueller, muellele@gmail.com, 20151202, enhance to select only one or multiple categories (.assets.Category)
 Lea Mueller, muellele@gmail.com, 20151203, delete struct_no
 Lea Mueller, muellele@gmail.com, 20151207, invoke climada_load to identify input structure
 Lea Mueller, muellele@gmail.com, 20151207, invoke climada_assets_category_ID to identify input structure
 Lea Mueller, muellele@gmail.com, 20151207, do not create a new figure, so we can use it in climada_viewer (gui)
 Lea Mueller, muellele@gmail.com, 20151217, return if ED_at_centroid control and measure do not have same dimension
 Lea Mueller, muellele@gmail.com, 20160107, add workaround to avoid prctile that uses statistics toolbox
 Lea Mueller, muellele@gmail.com, 20160129, invoke climada_find_most_severe_event
 Lea Mueller, muellele@gmail.com, 20160219, bugfix for hazard
 Lea Mueller, muellele@gmail.com, 20160226, start title_str with uppercase
 Lea Mueller, muellele@gmail.com, 20160303, plot damagemap if strfind(damage) somewhere in the fieldname_to_plot
 Lea Mueller, muellele@gmail.com, 20160303, add date of event in title for hazard
 Lea Mueller, muellele@gmail.com, 20160314, add climada_global.caxis_range
 Lea Mueller, muellele@gmail.com, 20160316, set nans to 0
 Lea Mueller, muellele@gmail.com, 20160330, add fprintf if no field to show found
 -
View <A HREF=file:../../climada/code/helper_functions/climada_map_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measure_regional_scope">
<H2>climada_measure_regional_scope</H2></A>
<font color="blue">function EDS = climada_measure_regional_scope(EDS_in,within_scope,EDS_control) </font>
 climada
 NAME:
   climada_measure_regional_scope
 PURPOSE:
   Limit impact of measure to a given regional scope, correct
   EDS.ED_at_centroid and EDS.ED.
   Note: EDS.damage now holds an incorrect value, and should not be used anyore
   to be called in climada_measures_impact
 CALLING SEQUENCE:
   EDS = climada_measure_regional_scope(EDS_in,regional_scope,EDS_control)
 EXAMPLE:
   EDS = climada_measure_regional_scope(EDS_in,regional_scope,EDS_control)
 INPUTS:
   EDS_in: a climada EDS structure with .ED_at_centroid
   within_scope: an logical array defining the regional scope
   EDS_control: a climada EDS structure with .ED_at_centroid with original damage values without measure
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   EDS: a climada EDS structure with corrected damages depening on regional impact of measure
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150908, init
View <A HREF=file:../../climada/code/helper_functions/climada_measure_regional_scope.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_assets_change">
<H2>climada_measures_assets_change</H2></A>
<font color="blue">function assets = climada_measures_assets_change(measures,measure_i) </font>
 climada
 NAME:
   climada_measures_assets_change
 PURPOSE:
   Read new assets from excel if defined so in measures.assets_file
   If measures.assets_file{measure_i} is 'nil', assets remains empty
   Note: assets are not yet encoded
   to be called in climada_measures_impact
 CALLING SEQUENCE:
   assets = climada_measures_assets_change(measures,measure_i)
 EXAMPLE:
   assets = climada_measures_assets_change(measures,measure_i)
 INPUTS:
   measures: a measures structure
   measire_i: an array between 1 and n_measures
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   assets: an asset structure with
       .lon, .lat, .Value, etc. not encoded
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150908, init
 Lea Mueller, muellele@gmail.com, 20150930, save assets.filename with .mat as extension
 Lea Mueller, muellele@gmail.com, 20151117, call climada_assets_read instead of climada_entity_read
View <A HREF=file:../../climada/code/helper_functions/climada_measures_assets_change.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_attach_measures">
<H2>climada_measures_attach_measures</H2></A>
<font color="blue">function measures = climada_measures_attach_measures(measures1,measures2,silent_mode) </font>
 climada measures attach another measures
 MODULE:
   core/helper_functions
 NAME:
   climada_measures_impact_attach_measures_impact
 PURPOSE:
   Attach/enlarge measures with another measures, so that the new measures
   structure contains all measures (.name, .cost.,
   .hazard_intensity_impact_a, ...)

 CALLING SEQUENCE:
   measures = climada_measures_attach_measures(measures1,measures2,silent_mode)
 EXAMPLE:
   measures = climada_measures_attach_measures((measures1,measures2,silent_mode)
 INPUTS:
   measures1: a climada measures, as read from climada_measures_read;
   measures2: a climada measures, as read from climada_measures_read;
 OPTIONAL INPUT PARAMETERS:
   silent_mode: default is 0, set to 1, if you do not want command line output
 OUTPUTS:
   measures: the measures containing all information
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151217, init 
View <A HREF=file:../../climada/code/helper_functions/climada_measures_attach_measures.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_check">
<H2>climada_measures_check</H2></A>
<font color="blue">function measures = climada_measures_check(measures, assets) </font>
 climada_measures_check
 NAME:
   climada_measures_check
 PURPOSE:
   Check measures (just a check, but no changes/improvements) to be aware
   if the measures decrease or (accidentally) increase the damage
   can be called from: climada_measures_read

   See climada_measures_complete not only to check but also to complete a
   measures structure, then call climada_measures_encode to convert some
   of the human-readable fields (such as damagefunction mapping '1to3').
 CALLING SEQUENCE:
   climada_measures_check(measures)
 EXAMPLE:
   climada_measures_check(measures)
 INPUTS:
   measures: a measures structure 
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   none, just stdout information
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150907, init
 Lea Mueller, muellele@gmail.com, 20150909, check if a measure implies to use a differerent assets file
 Lea Mueller, muellele@gmail.com, 20150915, check that regional_scope matrix has the correct dimension 
 Lea Mueller, muellele@gmail.com, 20150916, shorten or enlarge regional_scope if needed 
 Lea Mueller, muellele@gmail.com, 20150921, hand back corrected measures
 Lea Mueller, muellele@gmail.com, 20151117, correct fprintf
View <A HREF=file:../../climada/code/helper_functions/climada_measures_check.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_complete">
<H2>climada_measures_complete</H2></A>
<font color="blue">function measures = climada_measures_complete(measures) </font>
 climada measures read import check complete
 NAME:
   climada_measures_complete
 PURPOSE:
   check for completeness of an measures structure, i.e. that all
   fields are there and populated with default values (this speeds up all
   later cimada calls, as we do not need to run many isfield commands
   etc). This code also makes sure all arrays in measures are 1xN (they come
   as Nx1 from Excel read). Run climada_measures_encode afterwards to
   convert some of the human-readable fields (such as damagefunction
   mappting '1to3').  

   special: the field damagefunctions is NOT mandatory, one of the few
   fields we check for in climada_measures_impact.

   This code is kept as a separate function (i.e. called from but not part of
   climada_measures_read) in order to allow calling it for measures not read
   from an Excel file, e.g. if a user constructs the entity structure
   him/herself.

   called from: climada_measures_read
   next call: climada_measures_encode (recommended)
 CALLING SEQUENCE:
   measures = climada_measures_complete(measures)
 EXAMPLE:
   entity.measures=climada_measures_complete(entity.measures)
 INPUTS:
   measures: the measures structure of entity.measures, 
       see climada_entity_read
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
    measures: same as input, with fields completed
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20160918, initial
 david.bresch@gmail.com, 20160920, fix for bug in number of measures for assets_file
View <A HREF=file:../../climada/code/helper_functions/climada_measures_complete.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_encode">
<H2>climada_measures_encode</H2></A>
<font color="blue">function measures=climada_measures_encode(measures) </font>
 climada
 NAME:
   climada_measures_encode
 PURPOSE:
   encode measures, i.e. process the damagefunctions_map to convert it
   into a damagefunctions_mapping, which allows climada_measures_impact to
   switch damagefunctions for specific measures. Also convert color
   triples as string into RGB color triplets. Plus some sanity checks.

   Previous call: climada_entity_read (usually called in there,
   climada_measures_encode is a low-level function). It is strongly
   recommended to call climada_measures_complete prior to
   climada_measures_encode 

   See also climada_damagefunctions_read and climada_damagefunctions_map
 CALLING SEQUENCE:
   measures=climada_measures_encode(measures);
 EXAMPLE:
   measures=climada_measures_encode(climada_measures_read);
 INPUTS:
   measures: a structure, with the measures as read in climada_entity_read
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   measures: a structure, with the measures as input, plus the fields
       color_RGB: the RGB triples (each element range 0..1), default all
       yellow, if troubles arise converting measures.color (the
       triple, but as text, often troubles if read in Octave)
   damagefunctions_mapping: the damagefunctions_map converted into a
       direct index, i.e. from damagefunctions_map(i)='1to3;4to7' to a mapping
       damagefunctions_mapping(i).map_from(i)=[1 4]
       damagefunctions_mapping(i).map_to(i)=[3 7] etc.
   hazard_intensity_impact_b: older entities
       might still have hazard_intensity_impact and hence we rename it to
       hazard_intensity_impact_b. See excel_template.xls and the comment
       for column 'hazard intensity impact' in tab 'measures'.
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20100107
 David N. Bresch, david.bresch@gmail.com, 20141121, using only damagefunctions_map information
 David N. Bresch, david.bresch@gmail.com, 20150103, some checks for .ods imported entities
 David N. Bresch, david.bresch@gmail.com, 20150518, safety checkin
 Lea Mueller, muellele@gmail.com, 20150902, rename to hazard_intensity_impact_b from hazard_intensity_impact
 David N. Bresch, david.bresch@gmail.com, 20150907, keep color_RGB if provided on input
View <A HREF=file:../../climada/code/helper_functions/climada_measures_encode.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_impact2EDS_waterfall">
<H2>climada_measures_impact2EDS_waterfall</H2></A>
<font color="blue">function [EDS1, EDS2, EDS3, is_today, is_eco, is_cc] = climada_measures_impact2EDS_waterfall(measures_impact,measure_no,category_selected,silent_mode) </font>
 climada measures impact combine scenario
 MODULE:
   core/helper_functions
 NAME:
   climada_measures_impact2EDS_waterfall
 PURPOSE:
   Extract 3 EDS from measures_impact that contains 3 or more
   structs/scenarios to plot waterfall (in the next step)
   
   invokes: climada_scenario_identify if more than 3 structs given
 NEXT: climada_waterfall_graph
 CALLING SEQUENCE:
   [EDS1, EDS2, EDS3, is_today, is_eco, is_cc] = climada_measures_impact2EDS_waterfall(measures_impact,measure_no,category_selected,silent_mode)
 EXAMPLE:
   [EDS1, EDS2, EDS3] = climada_measures_impact2EDS_waterfall(measures_impact)
 INPUTS:
   measures_impact: a climada measures_impact structure (as returned eg 
       by climada_measures_impact). Holds at least three structs (one for
       today, one for econ. development, one for climate change).
 OPTIONAL INPUT PARAMETERS:
   measure_no: default is end/control scenario, but can also be a specific measure
   category_selected: a string or a cell, e.g. 'Houses', or {'Houses' 'Public'},  if empty all assets will be selected
   silent_mode: default =0
 OUTPUTS:
   EDS1: a climada EDS struct for scenario today, with EDS.ED summed for a
      specific category
   EDS2: same as above but for scenario economic development
   EDS3: same as above but for scenario climate change
   is_today: a number pointing to the order in which the original EDS was
      located within measurse_impact
   is_eco: a number pointing to the order in which the original EDS was
      located within measurse_impact
   is_cc: a number pointing to the order in which the original EDS was
      located within measurse_impact
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151202, init
 Lea Mueller, muellele@gmail.com, 20151202, add option silent_mode
 Lea Mueller, muellele@gmail.com, 20151217, bugfix if no scenarios identified
View <A HREF=file:../../climada/code/helper_functions/climada_measures_impact2EDS_waterfall.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_impact_attach_measures_impact">
<H2>climada_measures_impact_attach_measures_impact</H2></A>
<font color="blue">function measures_impact = climada_measures_impact_attach_measures_impact(measures_impact1,measures_impact2,silent_mode) </font>
 climada measures attach another measures_impact
 MODULE:
   core/helper_functions
 NAME:
   climada_measures_impact_attach_measures_impact
 PURPOSE:
   Attach/enlarge a measure impact structure with another one. I.e.
   if you have calculated two measures_impact based on two different
   entity.measures, add both into one structure (does not add up benefits
   or damages, but enlarges the structure).

 CALLING SEQUENCE:
   measures_impact = climada_measures_impact_attach_measures_impact(measures_impact1,measures_impact2,silent_mode)
 EXAMPLE:
   measures_impact = climada_measures_impact_attach_measures_impact(measures_impact1,measures_impact2,silent_mode)
 INPUTS:
   measures_impact1: a climada measures_impact structure (as returned eg 
       by climada_measures_impact).
   measures_impact2: a climada measures_impact structure (as returned eg 
       by climada_measures_impact) if measures_impact2 is an array of 
       measures_impact2(i), the code will find the matching scenario
 OPTIONAL INPUT PARAMETERS:
   silent_mode: default is 1, set to 0, if you want command line output
 OUTPUTS:
   measures_impact: the combined measures_impact
       Please note that assets are likely not meaningful, since just taken
       from measures_impact1 (in order to allow to store resulting measures_impact back into an
       array of measures_impacts if needed)
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151217, init 
View <A HREF=file:../../climada/code/helper_functions/climada_measures_impact_attach_measures_impact.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_impact_combine">
<H2>climada_measures_impact_combine</H2></A>
<font color="blue">function measures_impact=climada_measures_impact_combine(measures_impact1,measures_impact2,combine_modus,silent_mode) </font>
 climada measures impact combine
 MODULE:
   core/helper_functions
 NAME:
   climada_measures_impact_combine
 PURPOSE:
   Combine two measure impact structures, i.e. add averted damages. The 
   codes in essence takes measures_impact=measures_impact1 and then adds 
   relevant fields (benfit, ED_benefit) from measures_impact2. Hence 
   please make sure the 'main' peril is in measures_impact1 (e.g. TC in 
   measures_impact1, TS in measures_impact2). Note that ONLY averted 
   damages/benefits are added, we do NOT add costs, as most often the cost 
   of the measures include the total costs. Hence edit the resulting 
   measures_impact yourself in case costs should be additive.

   call before: climada_adaptation_cost_curve
 CALLING SEQUENCE:
   measures_impact=climada_measures_impact_combine(measures_impact1,measures_impact2,combine_modus,silent_mode)
 EXAMPLE:
   measures_impact=climada_measures_impact_combine(measures_impact1,measures_impact2,combine_modus,silent_mode)
 INPUTS:
   measures_impact1: a climada measures_impact structure (as returned eg 
       by climada_measures_impact).
   measures_impact2: a climada measures_impact structure (as returned eg 
       by climada_measures_impact) if measures_impact2 is an array of 
       measures_impact2(i), the code will recursively treat them
 OPTIONAL INPUT PARAMETERS:
   combine_modus: a string, either 'add_measures' or 'delete_measures' to
   add impacts from measures that only exist in measures_impact1 or
       measures_impact2, or to delete measures that do not exist in both
       measures_impacts
 OUTPUTS:
   measures_impact: the combined measures_impact
       Please note that assets are likely not meaningful, since just taken
       from measures_impact1 (in order to allow to store resulting measures_impact back into an
       array of measures_impacts if needed)
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150617, init based on climada_EDS_combine
 Lea Mueller, muellele@gmail.com, 20151202, combine also EDS, add 'delete_measures' option
 Lea Mueller, muellele@gmail.com, 20151202, add option silent_mode
 Lea Mueller, muellele@gmail.com, 20151217, attach/enlarge ED_at_centroid, assets.lon, .lat, .Category... if different locations
View <A HREF=file:../../climada/code/helper_functions/climada_measures_impact_combine.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_impact_combine_scenario">
<H2>climada_measures_impact_combine_scenario</H2></A>
<font color="blue">function measures_impact = climada_measures_impact_combine_scenario(measures_impact1,measures_impact2,measures_impact3,peril_list,silent_mode) </font>
 climada measures impact combine scenario
 MODULE:
   core/helper_functions
 NAME:
   climada_measures_impact_combine
 PURPOSE:
   Combine measure impact structures for a given scenario, i.e. add
   damages and averted damages for a list of selected perils, so that we have an
   overall impact of averted damage per scenario. Needs
   measures_impact.scenario field.

   invokes: climada_measures_impact_combine
 CALLING SEQUENCE:
   measures_impact=climada_measures_impact_combine_scenario(measures_impact1,measures_impact2,measures_impact3,peril_list,silent_mode)
 EXAMPLE:
   measures_impact=climada_measures_impact_combine_scenario(measures_impact1,'','',{'TC' 'FL'})
 INPUTS:
   measures_impact1: a climada measures_impact structure (as returned eg 
       by climada_measures_impact).
   measures_impact2: a climada measures_impact structure (as returned eg 
       by climada_measures_impact) if measures_impact2 is an array of 
       measures_impact2(i), the code will recursively treat them
    measures_impact3: a climada measures_impact structure (as returned eg 
       by climada_measures_impact) if measures_impact3 is an array of 
       measures_impact3(i), the code will recursively treat them
    peril_list: a cell with list of peril IDs, i.e. {'TC' 'FL'}
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   measures_impact: the combined measures_impact, summed up all perils per
       scenario
       Please note that assets are likely not meaningful, since just taken
       from measures_impact1 (in order to allow to store resulting measures_impact back into an
       array of measures_impacts if needed)
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151202, init
 Lea Mueller, muellele@gmail.com, 20151202, add option silent_mode
View <A HREF=file:../../climada/code/helper_functions/climada_measures_impact_combine_scenario.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_impact_discount">
<H2>climada_measures_impact_discount</H2></A>
<font color="blue">function measures_impact = climada_measures_impact_discount(entity,measures_impact,measures_impact_reference,unit_or_cat_flag,criterium) </font>
 climada
 NAME:
   climada_measures_impact_discount
 PURPOSE:
   calculate the benefit-cost ratio based on discounted benefits and costs
   for series of measures on a given set measures_impact.EDS
   called from climada_measures_impact
   can also be called separately in order to calculate benefit-cost ratio
   only for a selection of assets (e.g. only for USD, or category 7)
   previous step: climada_measures_impact
 CALLING SEQUENCE:
   measures_impact = climada_measures_impact_discount(entity,measures_impact,measures_impact_reference,unit_or_cat_flag,criterium)
 EXAMPLE:
   measures_impact = climada_measures_impact_discount(entity,measures_impact,'no')
   measures_impact = climada_measures_impact_discount(entity,measures_impact,'no','unit','USD')
   measures_impact = climada_measures_impact_discount(entity,measures_impact,'no','category',2)
 INPUTS:
   entity: a read and encoded assets and damagefunctions file, see climada_assets_encode(climada_assets_read)
       &ampgt promted for if not given
   measures_impact: measures impact structure (e.g. portfolio future and measures future)
       with only the following fields .EDS, .measures and .risk_transfer
 OPTIONAL INPUT PARAMETERS:
   measures_impact_reference: reference measures (e.g. portfolio today and
       measures today). Used to properly calculate the net present values
       of future impacts
       set to 'no' if you would not like to be asked for a reference
   unit_or_cat_flag: a string, either 'unit' or 'category'
   criterium: a string or an array to define the unit or category for the 
       subselection of asset values, e.g. 'USD', 'people', 2
 OUTPUTS:
   measures_impact: a structure with
       ED(measure_i): the annual expected damage to the assets under measure_i,
           last one ED(end) for no measures
       benefit(measure_i): the benefit of measure_i
       cb_ratio(measure_i): the cost/benefit ratio of measure_i
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150902, separate function to be called in climada_measures_impact
 Lea Mueller, muellele@gmail.com, 20150924, set to silent mode in climada_assets_select
 Lea Mueller, muellele@gmail.com, 20150925, correct discounting if reference scenario is provided
View <A HREF=file:../../climada/code/helper_functions/climada_measures_impact_discount.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_impact_load">
<H2>climada_measures_impact_load</H2></A>
<font color="blue">function measures_impact=climada_measures_impact_load(measures_impact_file,time_estimate) </font>
 climada
 MODULE:
   climada core
 NAME:
   climada_measures_impact_load
 PURPOSE:
   load a previously saved measures_impact (just to avoid typing long paths and
   filenames in the command window)
 CALLING SEQUENCE:
   measures_impact_out=climada_measures_impact_load(measures_impact_file)
 EXAMPLE:
   measures_impact_out=climada_measures_impact_load(measures_impact_file)
 INPUTS:
   measures_impact_file: the filename (with path, optional) of a previously saved
       measures_impact, see salvador_calc_measures
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   measures_impact_out: a struct, see e.g. salvador_calc_measures for details
 MODIFICATION HISTORY:
 Jacob Anz, j.anz@gmx.net, 20151106, init
 Lea Mueller, muellele@gmail.com, 20151127, enhance to work with complete measures_impact as input
 Jacob Anz, j.anz@gmx.net, 20151202, enable the loading of variables which are internally not exactly named measures_impact
 and add loading time estimate
View <A HREF=file:../../climada/code/helper_functions/climada_measures_impact_load.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_impact_read">
<H2>climada_measures_impact_read</H2></A>
<font color="blue">function measures_impact = climada_measures_impact_read(measures) </font>
 climada measures impact read (from measures-xls file)
 NAME:
   climada_measures_impact_read
 PURPOSE:
   Create measures_impact struct from measures.cost and
   measures.benefit, read from the excel file. Works only if field
   &quotbenefit&quot is given in the measures-xls file.
   
   Plot adaptation cost curve directy with measures-xls field instead of
   calculation benefits with climada_measures_impact
 CALLING SEQUENCE:
  measures_impact = climada_measures_impact_read(measures)
 EXAMPLE:
    measures_impact = climada_measures_impact_read
    measures_impact = climada_measures_impact_read('measures_impact_xls.xls')
 INPUTS:
   measures: the measures as read from climada_measures_read or the 
       filename of the Excel file with the measures
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   measures_impact: a structure that can be plotted with climada_adaptation_cost_curve,
       i.e. with fields .benefit, .cb_ratio, .measures, etc.
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20160523, init
 Lea Mueller, muellele@gmail.com, 20160531, NVP_total_climate_risk is an array instead of a vector
 Lea Mueller, muellele@gmail.com, 20160624, add .Value_unit and .cost_unit
View <A HREF=file:../../climada/code/helper_functions/climada_measures_impact_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_impact_report">
<H2>climada_measures_impact_report</H2></A>
<font color="blue">function output_report = climada_measures_impact_report(measures_impact,xls_file,sheet) </font>
 MODULE:
   climada core
 NAME:
   climada_measures_impact_report
 PURPOSE:
   Write out measures_impact report (discounted benefits over time horizon, costs, benefit/cost ratio)
 CALLING SEQUENCE:
   output_report = climada_measures_impact_report(measures_impact,xls_file,sheet)
 EXAMPLE:
   output_report = climada_measures_impact_report
 INPUTS:
   measures_impact: climada measures_impact structure, with fields 
       .benefit, .cb_ratio, measures.cost, .measures.name 
       can hold multiple measures_impact files
 OPTIONAL INPUT PARAMETERS:
   xls_file: filename (and path) to save the report to (as .xls), if
       empty, prompted for.Can be set to 'NO_xls_file' to omit creation of
       xls file instead only creates the cell &quotoutput_report&quot
   sheet: sheet name for xls file, if empty, default excel name is &quotSheet1&quot
 OUTPUTS:
   output_report: cell including header and ED values
   report file written as .xls
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150907, init
 Lea Mueller, muellele@gmail.com, 20150909, add NPV total climate risk
 Lea Mueller, muellele@gmail.com, 20150924, enhance to cope with multiple measures_impact's
 Lea Mueller, muellele@gmail.com, 20151106, move to core
View <A HREF=file:../../climada/code/helper_functions/climada_measures_impact_report.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_read">
<H2>climada_measures_read</H2></A>
<font color="blue">function [measures, measures_impact] = climada_measures_read(measures_filename) </font>
 climada measures read import
 NAME:
   climada_measures_read
 PURPOSE:
   read the Excel file with the list of measures, usually called from
   climada_entity_read. The field &quotcost&quot is mandatory otherwise measures are not read.
   See climada_entity_read for a comprehensive description of output fields.

   This code allows single Excel files with measures
   (and, if a tab damagefunctions exists, damage functions, and if a tab 
   assets exists, regional_scope of measures) to be read
   The user will then have to 'switch' measures in an already read and
   encoded entity with the measures read here.
 CALLING SEQUENCE:
   measures = climada_measures_read(measures_filename)
 EXAMPLE:
   measures = climada_measures_read;
 INPUTS:
   measures_filename: the filename of the Excel file with the measures
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   measures: a structure, with the measures, including .regional_scope if
   assets tab found wich specifies the regional_scope of a measure
 MODIFICATION HISTORY:
 David N. Bresch,  david.bresch@gmail.com, 20091228
 David N. Bresch,  david.bresch@gmail.com, 20130316, vulnerability-&ampgtdamagefunctions...
 Jacob Anz, j.anz@gmx.net, 20150819, use try statement to check for damagefunctions in excel sheet
 Lea Mueller, muellele@gmail.com, 20150907, add measures sanity check
 Lea Mueller, muellele@gmail.com, 20150915, add read the &quotassets&quot tab which defines the regional scope of one or more measures
 Lea Mueller, muellele@gmail.com, 20150916, omit nans in regional_scope 
 Lea Mueller, muellele@gmail.com, 20151016, delete nans in measures.name if there are invalid entries
 Lea Mueller, muellele@gmail.com, 20151119, use climada_assets_read, use spreadsheet_read instead of xls_read
 David Bresch, david.bresch@gmail.com, 20151119, bugfix for Octave to try/catch xlsinfo
 Jacob Anz, j.anz@gmx.net, 20151204, remove measures.damagefunctions if empty
 Lea Mueller, muellele@gmail.com, 20160523, complete extension, if missing
 Lea Mueller, muellele@gmail.com, 20160523, add measures_impact, invoke climada_measures_impact_read
 David Bresch, david.bresch@gmail.com, 20160917, re-calling encode disabled
View <A HREF=file:../../climada/code/helper_functions/climada_measures_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_names_read">
<H2>climada_names_read</H2></A>
<font color="blue">function names = climada_names_read(names_filename) </font>
 climada names read import
 NAME:
   climada_names_read
 PURPOSE:
   read names sheet with .item, .ID, .name
   usually called from climada_entity_read, see climada_entity_read for
   more information. Not a mandatory tab, hence very tolerant (i.e. it
   just returns empty in case of troubles). See climada_entity_read for a
   comprehensive description of output fields.

   The names tab can alos contain definitions for climada_global
   parameters, see ADVANCED use in code (and manual).

   The code invokes climada_spreadsheet_read to really read the data,
   which implements .xls and .ods files
   For .xls, the sheet names are dynamically checked, for .ods, the sheet
   names are hard-wired (see code), means for .ods, the sheet 'names'
   needs to exist (if not, no problem, it returns with []).
 CALLING SEQUENCE:
   names = climada_names_read(names_filename)
 EXAMPLE:
   names = climada_names_read;
 INPUTS:
   names_filename: the filename of the Excel (or .ods) file with the
       names information
       If no path provided, default path ../data/entities is used
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
    names: a structure, with fields
       Item: the name of the item to assign a speaking name, default
           ={'Category_ID' 'Region_ID'}'
       ID: the ID, default=[1 1]'
       name: the speaking name, default={'Category 1' 'Region 1'}'
 MODIFICATION HISTORY:
 David Bresch, david.bresch@gmail.com, 20160919, initial
View <A HREF=file:../../climada/code/helper_functions/climada_names_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_nightlight_entity">
<H2>climada_nightlight_entity</H2></A>
<font color="blue">function entity=climada_nightlight_entity(admin0_name,admin1_name,parameters) </font>
 country admin0 admin1 entity high resolution
 MODULE:
   core
 NAME:
	climada_nightlight_entity
 PURPOSE:
   Construct an entity file based on high-resolution (1km!) or
   mid-resolution (10km) night light data.

   NOTE: this code really belongs to the country risk module, but we moved
   it to the core module to allow for easy generation of admin0 (country)
   entities at 10km resolution. See
   https://github.com/davidnbresch/climada_module_country_risk for details. 

   Reads an image file with nightlight density and matches it to the local
   geography, then scales to proxy for asset values.

   Prompts for country (admin0) and state/province (admin1, optional),
   obtains the high-resolution (or mid-resolution) night lights for this
   area and constrains the active centroids (with values&ampgt0) to the
   selected country or admin1 (see input parameter selections) plus a
   surrounding buffer and saves the entity, optionally adding distance to
   coast (im km) and elevation (in m) for each centroid, too.

   The original nightlight intensities are first scaled to the range
   [0..1], then transformed using a polynomial (see
   parameters.nightlight_transform_poly), then scaled such that all values
   sum to to one (normalized).

   If admin0 (whole country) is selected, the values are scaled to sum up
   to GDP*(income_group+1) as a good proxy for the 'real' asset value (see
   code climada_entity_value_GDP_adjust_one). 

   If admin1,is requested, no automatic scaling or allocation of GDP to
   centroids is performed.

   If the high-resolution night light image is stored locally (about 700MB
   as tiff, after first call about 24MB as .mat), the code works from
   there.
   See http://ngdc.noaa.gov/eog/dmsp/downloadV4composites.html#AVSLCFC3
   to obtain the file
   http://ngdc.noaa.gov/eog/data/web_data/v4composites/F182012.v4.tar
   and unzip the file F182012.v4c_web.stable_lights.avg_vis.tif in there
   to the /data folder of country_risk module. As the .tif is so much
   larger, the climada module country_risk comes with the .mat file, but
   does not contain the original (.tif).

   If the high-resolution night light image is stored locally, it fetches
   the tile of night light density from www (i.e. asks the user to enter a
   specific URL, to locally store the respective file) and works from
   there. (See also http://maps.ngdc.noaa.gov/viewers/dmsp_gcv4/ to obtain
   a specific 'tile' of the global high res via a web-GUI (but method with
   the code suggesting the URL is strongly recommended, this option only
   for users with strong memory limits).

   Programmer's remark: The code deals with a lot of admin stuff to get
   the nightlight file, the admin0 and admin1 names etc. Key code sections
   are marked with ***********
   See fetch_mapserver_ngdc_noaa_gov_gcv4 at the bottom of the code, which
   could in theory fetch the tile from www

   Note: the code uses climada_inpolygon instead of inpolygon.

   See also older version like climada_create_GDP_entity and climada_hybrid_entity
   See also climada_nightlight2cdf to store as netCDF (e.g. for isimip)
   See climada_nightlight_global_entity to generate a global entity with
       all countries scaled etc.
 CALLING SEQUENCE:
   entity=climada_nightlight_entity(admin0_name,admin1_name,parameters)
 EXAMPLE:
   entity=climada_nightlight_entity('Italy'); % good for test, as shape of Italy is well-known
   climada_entity_plot(entity,[],1); % visual check
   p.resolution_km=1;entity=climada_nightlight_entity('CHE','',p); % Switzerland 1km resolution
   entity=climada_nightlight_entity('USA','Florida');
   entity=climada_nightlight_entity % all interactive
   climada_entity_plot(entity) % to check the content of the final entity
   [counry_name,country_ISO3]=climada_country_name();
   for i=1:length(country_ISO3),climada_nightlight_entity(country_ISO3{i});end % all (!!)
   parameters=climada_nightlight_entity('parameters') % return all default parameters
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   admin0_name: the country name, either full or ISO3
       &ampgt If empty, a list dialog lets the user select (default)
       Instead of explicit country names, one can also use ISO3 country
       codes (like DEU, CHE). Note that the entity filename will use the
       full country name, but ISO3 is stored in entity.assets.admin0_ISO3
       See parameter selections, especially if you want to select a whole
       country.
       If you leave admin1_name empty, a country will be processed. Set
       admin1_name='ask' in case you'd like to be prompted for admin1.
       Also useful if a img_filename is passed in parameters
       and thus if admin0_name is defined, the respective country is cut out.
       If ='parameters' or 'params', return all default parameters
   admin1_name: if passed on, do not prompt for admin1 name
       &ampgt If empty together with admin0_name, a list dialog lets the user select (default)
       Most useful for subsequent calls, i.e. once one knows the exact
       admin1 name. Also useful if a img_filename is passed in parameters
       and thus if admin1_name is defined, the respective admin1 is cut out.
       NOTE: Still an issue with some characters, i.e. Zrich does not work
       if entered as admin1_name, please use the admin1_code, also shown
       behind the | in the list dialog, e.g. for Zurich, the call hence is
       entity=climada_nightlight_entity('CHE','CHE-176'). Note that the
       admin1_name is kept as on input, i.e. 'CHE-176' in the example, not
       'Zrich'.
   parameters: a structure to pass on parameters, with fields as
       (run parameters=climada_nightlight_entity('parameters') to obtain
       all default values)
       resolution_km: the resuting resolution, either =1 or =10
           It is often advisable to first TEST with resolution=10 for
           speed reasons. If a fully country is selected, default=10, else
           =1 for admin1
       restrict_Values_to_country: whether we restrict the values to
           within the country (=1, default) or not (=0, faster, but less useful)
       grid_spacing_multiplier: the spacing of regular grid outside of the
           area requested. Default=5, hence approx every 5th point as outer
           grid.
       nightlight_transform_poly: the polynomial coefficients to transform
           the nightlight intensity (usually in the range 0..60) to proxy
           asset values. Evaluated using polyval, i.e.
           value=polyval(parameters.nightlight_transform_poly,nightlight_intensity)
           Default=[0 1 0 0], which means Value=nightlight_intensity^2
           After this Values are normalized to sum up to 1.
           Note that if a whole country is requested, Values are then
           scaled to sum up to GDP*(income_group+1).
       value_threshold: if empty or =0, all centroids (also those with zero
           value) are kept in the entity (default). If set to a value,
           only centroids with entity.Value&ampgtvalue_threshold are kept (note
           that this way, one can specify an asset value threshold, reduce
           the number of points to be dealt with).
           One might often want to avoid all truly tero points, i.e. 
       add_distance2coast_km: if =1, add distance to coast, default=0
       add_elevation_m: if =1, add elevation, default=0
       img_filename: the filename of an image with night light density, as
           created using the GUI at http://maps.ngdc.noaa.gov/viewers/dmsp_gcv4/
           and select Satellite F18, 2010, avg_lights_x_pct, then 'Download
           data' and enter the coordinates
           The filename has to be of form A_B_C_D_{|E_F}*..lzw.tiff with A,B,C and D
           the min lon, min lat, max lon and max lat (integer), like
           87_20_94_27_F182010.v4c.avg_lights_x_pct.lzw.tiff and E and F the
           country (admin0) and state/province (admin1) name, like
           -88_24_-79_32_United States of America_Florida_high_res.avg_lights.lzw.tiff

           If empty (eg run the code without any argument), it prompts for country
           and admin1 name and constructs the URL to get the corresponding
           tile from the nightlight data, e.g. a string such as:
           http://mapserver.ngdc.noaa.gov/cgi-bin/public/gcv4/F182010.v4c.
               avg_lights_x_pct.lzw.tif?request=GetCoverage&ampservice=WCS&amp
               version=1.0.0&ampCOVERAGE=F182010.v4c.avg_lights_x_pct.lzw.tif&amp
               crs=EPSG:4326&ampformat=geotiff&ampresx=0.0083333333&ampresy=0.0083333333&amp
               bbox=-88,24,-79,32

           ='ASK' prompt for an image file (without first asking for country
           where one has to press 'Cancel') to get the to filename prompt
       save_entity: whether we save the entity (=1, default) or nor (=0).
       entity_filename: the filename to save the entity to, default is a
           long one with ISO3, country name, admin1 name, geo coord and
           resolution. Not used if save_entity=0
       check_plot: if =1: plot nightlight data with admin0 (countries)
           superimposed, if=2 also admin1 (country states/provinces)
           =0: no plot (default). If=3, plot the resulting asset Values
       verbose: whether we printf progress to stdout (=1, default) or not (=0)
 OUTPUTS:
   entity: a full climada entity, see climada_entity_read, plus the fields
       entity.assets.distance2coast_km(i): distance to coast in km (both on-
           and offshore) for each centroid
       entity.assets.elevation_m(i): elevation in m for each centroid,
           negatove for ocean depth (needs climada module etopo, just skips
           this if module not installed)
       entity.assets.admin0_name: country name
       entity.assets.admin0_ISO3: country ISO3 code
       entity.assets.admin1_name: state/province name (if restricted to
           admin1)
       entity.assets.admin1_code: state/province code (if restricted to
           admin1)
       entity.assets.nightlight_transform_poly: the polynomial
           coefficients that have been used to transform the nightlight
           intensity.
       entity.assets.isgridpoint: =1 for the regular grid added 'around'
           the assets, =0 for the 'true' asset centroids
       see e.g. climada_entity_plot to check
 RESTRICTIONS:
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20141202, initial, see now climada_nightlight_entity_OLD
 david.bresch@gmail.com, 20160907, complete overhaul
 david.bresch@gmail.com, 20160911, GDP and population from shape file not added (not even for info) any more
 david.bresch@gmail.com, 20160918, str2num replaced by str2double
 david.bresch@gmail.com, 20160928, value_threshold added
 david.bresch@gmail.com, 20160929, entity_filename without spaces
 david.bresch@gmail.com, 20160929, entity.assets.isgridpoint added
 david.bresch@gmail.com, 20161002, using climada_inpolygon
 david.bresch@gmail.com, 20161005, added option climada_nightlight_entity('parameters')
 david.bresch@gmail.com, 20170120, default squared, not cubed any more
 david.bresch@gmail.com, 20170323, core functionality to work also when called in core module
 david.bresch@gmail.com, 20170515, looks for country_risk module for high resolution
 david.bresch@gmail.com, 20170626, calling climada_assets_complete
View <A HREF=file:../../climada/code/helper_functions/climada_nightlight_entity.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_nonspheric_distance_m">
<H2>climada_nonspheric_distance_m</H2></A>
<font color="blue">function [fDistance_km,GridVect] = climada_nonspheric_distance_m(fLon1,fLat1,fLon2,fLat2,CUID, inreach) </font>
 This function calculates the distance for each individual gridpoint from
 the TC center. Distance differences in x direction, depending on
 latitude, are normalized in the whole inreach-box with the value at the
 TC-Center

View <A HREF=file:../../climada/code/helper_functions/climada_nonspheric_distance_m.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_octave">
<H2>climada_octave</H2></A>
<font color="blue">function ok=climada_octave </font>
 climada octave
 MODULE:
   core
 NAME:
   climada_octave
 PURPOSE:
   Sourced at the end of climada_init_vars if the system we're running on
   is Octave instead of MATLAB

   This way, we can handle any specifics at startup

   Currently, Octave specifc are:
   - admin0.mat contains non-ASCII characters, remedied for Octave
   - climada_global.map_border_file is set to
     climada_global.coastline_file, since Octave takes about 6 sec to plot
     borders based on admin0.mat, compared to only 0.1 sec if based on
     coastline.mat. WARNING: it could be somebody uses map_border_file in
     a specific sense, in which case this shortcut might trigger problems.

   Octave might need to be started from a shell, e.g. 
   /Applications/Octave.app/Contents/Resources/usr/bin/octave &amp

 CALLING SEQUENCE:
   ok=climada_octave
 EXAMPLE:
   ok=climada_octave
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   ok: =1, if running on Octave
       =0, if MATLAB (the default)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141231, initial
 David N. Bresch, david.bresch@gmail.com, 20170403, shell hint added
View <A HREF=file:../../climada/code/helper_functions/climada_octave.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_odsread">
<H2>climada_odsread</H2></A>
<font color="blue">function res=climada_odsread(interactive_mode,ods_file,ods_sheet,silent_mode) </font>
 climada ods (open data spreadsheet) data import read
 NAME:
   climada_odsread
 PURPOSE:
   read one ods sheet from an ods file and return the content in a
   structure. Mainly a wrapper to invoke loadods and then sort into a 
   struct as uased in climada. 
   Limited functionality compared to climada_xlsread
   
   The sheet might contain as  many columns as you like, the first row (1)
   is interpreted as header and converted into field names, the data in.
   Empty columns are skipped

   HINT: Sometimes, not all columns of an .ods sheet are read, just
   copy/paste as values in ods, it often helps. It looks as if columns
   with results of functions are skiped... therefore, copy/paste as values

 CALLING SEQUENCE:
   res=climada_odsread(interactive_mode,ods_file,ods_sheet);
 EXAMPLE:
   res=climada_odsread(interactive_mode,ods_file,ods_sheet);
 INPUTS:
   interactive_mode: 'interactive' or 'no'. If interactive, the user gets
       prompted for the sheet in the Excel file
       (Currently hard-wired to interactive)
   ods_file: the Excel file to read, prompted for if not given
   ods_sheet: the ods sheet to read in the ods_file
       given the simplicity of the ods implementation, the sheet name is
       needed, the oce fails if not given (does not even read the first
       sheet, sorry)
 OPTIONAL INPUT PARAMETERS:
   silent_mode: if =1, do not write messages to stdout, default=0, means writing
 OUTPUTS:
   res: a structure holding the data from the selected Excel sheet
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20130401
View <A HREF=file:../../climada/code/helper_functions/climada_odsread.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_ACE">
<H2>climada_plot_ACE</H2></A>
<font color="blue">function tc_track = climada_plot_ACE(tc_track, name_tag, check_printplot) </font>
 ---------------------------------------------
% ACCUMULATED CYCLONE ENERGY ACE
 % The ACE of a season is calculated by 
 % summing the squares of the estimated maximum sustained velocity of
 % - every active tropical storm (wind speed 35 knots (65 km/h) or higher),
 % - at six-hour intervals. 
 ---------------------------------------------

 plot histograms of Accumulated Cyclone Energy ACE, No. of storms per
 seasons, No. of hurricanes and No. of major hurricanes per season of
 probabilistic tracks, with historical tracks indicated with dotted black
 lines
 NAME:
   climada_plot_ACE
 PURPOSE:
   given a probabilistic tc_track structure, histograms of ACE, No. storms,
   hurricanes and major hurricanes per season and compare with historical
   histograms (black dotted lines), check distributions
   ACE of a season is calculated by summing the squares of the estimated 
   maximum sustained velocity of
   - every active tropical storm (wind speed 35 knots (65 km/h) or higher),
   - at six-hour intervals. 
 
   previous step:  generation of probabilistic tracks, 
   tc_track_prob = climada_tc_random_walk_position_windspeed;
   next step:      
 CALLING SEQUENCE:
   climada_plot_ACE(tc_track, name_tag, check_printplot)
 EXAMPLE:
   climada_plot_ACE(tc_track_prob, '4480', 1)
 INPUTS:
   tc_track: probabilistic tc track set (random walk of wind speed, 
   longitude and latitude), wind speed in knots, nodes every six hours
 OPTIONAL INPUT PARAMETERS:
   name_tag:        string that will be used for name of printed pdf
   check_printplot: if set to 1 will print (save) figure
 OUTPUTS:
   figure, printout of figure if requested
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20110621
 davids.bresch@gmail.com, 20120407
View <A HREF=file:../../climada/code/helper_functions/climada_plot_ACE.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_IFC_return">
<H2>climada_plot_IFC_return</H2></A>
<font color="blue">function climada_plot_IFC_return(hazard,centroids,important_centroid,check_printplot) </font>
 climada intensity vs return period for multiple centroids
 based on probabistic hazard set
 NAME:
   climada_plot_IFC_return
 PURPOSE:
   find all wind speed greater zero that hit important centroid
   (historical and probabilistic storms)
   calculate the exceedence frequency and return period
   fit a gumbel distribution for requested return period and extrapolate
   according wind speed values
   plot wind speed vs return period
 CALLING SEQUENCE:
   climada_plot_IFC_return(hazard,centroids,important_centroid,check_printplot);
 EXAMPLE:
   climada_plot_IFC_return
 INPUTS:
   hazard: probabilistic hazard set (structure)
   centroids
   important_centroid: index number of one or multiple centroids (scalar or array)
 OPTIONAL INPUT PARAMETERS:
   check_printplot: if set to 1 will print (save) figure
 OUTPUTS:
   none
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 Lea Mueller, 19.05.2011
 David N. Bresch, david.bresch@gmail.com, 20141222, bugfix to make it work again
View <A HREF=file:../../climada/code/helper_functions/climada_plot_IFC_return.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_probabilistic_wind_speed_map">
<H2>climada_plot_probabilistic_wind_speed_map</H2></A>
<font color="blue">function climada_plot_probabilistic_wind_speed_map(tc_track, track_req) </font>
 plot historical tc track (Longitude, Latitude) in world map according to
 saffir-simpson hurrican scale. Add plot of probabilistic generated sister
 storms. Historical tracks has black lines around markers to identify as
 original track.
 NAME:
   climada_plot_probabilistic_wind_speed_map
 PURPOSE:
   analyse visually historical tc track and its generated probabilistic
   sister storms. Check Longitude, Latitude and wind speed category
   (saffir-simpson hurricane scale) 
 CALLING SEQUENCE:
   climada_plot_probabilistic_wind_speed_map(tc_track)
 EXAMPLE:
   climada_plot_probabilistic_wind_speed_map
 INPUTS:
   tc_track: probabilistic tc track set (random walk of wind speed, 
   longitude and latitude), wind speed in knots, nodes every six hours, if
   not given, prompted for
 OPTIONAL INPUT PARAMETERS:
   track_req:  number of specific historical track to be displayed with
   its probabilistic sister storms, prompts for input 
   p:          to print figure
   x:          to exit
   41:         or any other track number. will be rounded to the nearest 
               historical track.
   enter:      to continue.
 OUTPUTS:
   figure, printout of figure if requested
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20110628
 Lea Mueller, muellele@gmail.com, 20150319, only every 6h a node
View <A HREF=file:../../climada/code/helper_functions/climada_plot_probabilistic_wind_speed_map.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_tc_track_season">
<H2>climada_plot_tc_track_season</H2></A>
<font color="blue">function climada_plot_tc_track_season(tc_track, season, markersize, check_printplot, invisible) </font>
 plot historical tc tracks for one specific season (year) in colors 
 according to saffir-simpson hurricane scale
 NAME:
   climada_plot_tc_track_season
 PURPOSE:
   plot tc tracks for one specific season in colors according to saffir-simpson
   hurricane scale
   provide handle of tc_track
 CALLING SEQUENCE:
   [h] = climada_plot_tc_track_season(tc_track,season,markersize,check_printplot,invisible)
 EXAMPLE:
   [h] = climada_plot_tc_track_season(tc_track,1980,10,1,1)
 INPUTS:
	tc_track:       one or more tc_tracks (structure)
   season:         specific season (scalar or vector) for tc tracks to be plotted,
                   e.g. 2012, or 2000:2012
 OPTIONAL INPUT PARAMETERS:
   markersize:     markersize of tc_track nodes, default 7   
   check_printplot:if set to 1 figure is saved in folder
                   \results\mozambique\tc_tracks\tracks_1978.pdf
   invisible:      if set to 1 figure is not visible on screen
 OUTPUTS:
   h:               handle of tc_track nodes
 Lea Mueller, 20110606
View <A HREF=file:../../climada/code/helper_functions/climada_plot_tc_track_season.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_tc_track_stormcategory">
<H2>climada_plot_tc_track_stormcategory</H2></A>
<font color="blue">function  [h] = climada_plot_tc_track_stormcategory(tc_track, markersize, check_legend, linewidth) </font>
 plot tc track in colors according to saffir-simpson hurricane scale
 NAME:
   climada_plot_tc_track_stormcategory
 PURPOSE:
   plot tc track in colors according to saffir-simpson hurricane scale
   provide handle of tc_track
 CALLING SEQUENCE:
   [h] =
   climada_plot_tc_track_stormcategory(tc_track,markersize,check_legend)
 EXAMPLE:
   [h] =
   climada_plot_tc_track_stormcategory(tc_track(1),10,1)
 INPUTS:
	tc_track:        one or more tc_tracks (structure)
 OPTIONAL INPUT PARAMETERS:
   markersize:      markersize of tc_track nodes, default 7   
   check_legend:    if set to 1 legend of saffir-simpson hurricane scale
   in upper left corner
 OUTPUTS:
   h:               handle of tc_track nodes
 Lea Mueller, 20110603
View <A HREF=file:../../climada/code/helper_functions/climada_plot_tc_track_stormcategory.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_world_borders">
<H2>climada_plot_world_borders</H2></A>
<font color="blue">function climada_plot_world_borders(linewidth,check_country,map_shape_file,keep_boundary,country_color,border_color) </font>
 world border map country political
 NAME:
	climada_plot_world_borders
 PURPOSE:
   plot (world) borders for map in lat/lon

   Reads the file with border information (.mat or the original .shp) and
   plots it (line plot) in existing figure (do not forget hold on before)
   or create new one. Allows to color (a set of) countries

   The first time the shape file is read, all shapes are read into a
   second structure for fast plotting, see climada_shaperead(*,1,1).
   It uses the .mat file written by climada_shaperead with the borders
   info in subsequent calls for speedup.

   Called from many plot functions, e.g. climada_entity_plot
   See also: climada_shaperead

   Programmers hint:
   In case you only need the borders (quick&ampdirty, order of 10 times faster),
   you might consider the following code bit instead of
   climada_plot_world_borders (especially in subsequent calls, as
   climada_plot_world_borders does also set up the .mat file if missing etc.)

       shapes=climada_shaperead(climada_global.map_border_file,1,1); % reads .mat
       border.X=[];for i=1:length(shapes),border.X=[border.X shapes(i).X];end
       border.Y=[];for i=1:length(shapes),border.Y=[border.Y shapes(i).Y];end
       plot(border.X,border.Y,'-k')

 CALLING SEQUENCE:
   climada_plot_world_borders(linewidth,check_country,map_shape_file,keep_boundary,country_color,border_color);
 EXAMPLE:
   climada_plot_world_borders
   climada_plot_world_borders(1,'','',1) % most often used that way
   climada_plot_world_borders(0.8,'United States (USA)')
   climada_plot_world_borders(0.8,{'Canada' 'Germany'})
   climada_plot_world_borders(1,'','ASK') % prompt for shape file
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   linewidth: line width of borders, default is 1
       if negative, fill land with border_color
       SPECIAL: if =-999, just check for shape file(s) to exist, do not
       plot anything (called by e.g. country_risk_prep to 
   check_country: name (field in shapes named 'NAME') of one or multiple
       countries, e.g. 'Germany' or {'Germany' 'Ghana'},that will be gray
       shaded in the world plot, default is no shading of countries.
       Note that 'United States (USA)' is used, hence both 'United States' and 'USA' work.
       ='LABEL': label all countries, but do NOT use for coloring
   map_shape_file: filename and path to a *.shp shapes file
       if set to 'ASK', prompt for the .shp file. If empty, set to the
       file as defined in climada_global.map_border_file (default).
   keep_boundary: to keep the map area (as it looks on input)
   country_color: a [R G B] triple, see PARAMETERS in code, default is
       [255 236 139]/255 (yellow).
       Currently, it does not color the shape, only draws the boundary.
   border_color: a [R G B] triple, see PARAMETERS in code, default is
       [ 81  81  81]/255 for dark gray
 OUTPUTS:
   plot borders as line plot
 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141211, initial, supersedes old version (which read a .gen file)
 David N. Bresch, david.bresch@gmail.com, 20141223, fill debugged
 David N. Bresch, david.bresch@gmail.com, 20150916, hint for speedup in header added
 David N. Bresch, david.bresch@gmail.com, 20151230, links in ERROR prompts referenced
 David N. Bresch, david.bresch@gmail.com, 20160514, border_color and fill land (linewidth negative) added
 David N. Bresch, david.bresch@gmail.com, 20161023, ocean color set to nicer blue
 David N. Bresch, david.bresch@gmail.com, 20161027, ISO3 as country_name accepted, too
View <A HREF=file:../../climada/code/helper_functions/climada_plot_world_borders.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_processed2assets">
<H2>climada_processed2assets</H2></A>
<font color="blue">function assets=climada_processed2assets(processed_file) </font>
 climada
 NAME:
   climada_processed2assets
 PURPOSE:
   converts a processed (encoded) file into the essential information as
   needed by climada
 CALLING SEQUENCE:
   assets=climada_processed2assets(processed_file)
 EXAMPLE:
   assets=climada_processed2assets(processed_file)
 INPUTS:
   processed_file: filename of a processed (encoded) file
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   assets: a climada asset structure, but more important, a .csv file (to
   be converted into xls) with the same information is generated
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091229
View <A HREF=file:../../climada/code/helper_functions/climada_processed2assets.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_progress2stdout">
<H2>climada_progress2stdout</H2></A>
<font color="blue">function climada_progress2stdout(event_i,n_events,mod_step,msg_str) </font>
 climada template
 MODULE:
   core
 NAME:
   climada_template
 PURPOSE:
   show progress on stdout

 CALLING SEQUENCE:
   climada_progress2stdout(event_i,n_events,mod_step,msg_str)
 EXAMPLE:
   climada_progress2stdout          % init
   climada_progress2stdout(-1,[],1) % init with mod_step 1 insted of 10 (default)
   n_events=10000;
   for i=1:n_events
       a=cos(pi*i)
       climada_progress2stdout(i,n_events,100,'events');
   end % i
   climada_progress2stdout(0); % terminate
 INPUTS:
   event_i: the current event, if =-1 (or not provided) init the counter
   n_events: to total number of events in the loop
 OPTIONAL INPUT PARAMETERS:
   mod_step: the number of steps between reporting to stdout, default=10
   msg_str: the string message in the reporting line, i.e.
       est.  XXX sec left (10/10000 {msg_str}), default: =''
 OUTPUTS:
   res: the output, empty if not successful
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170212
 David N. Bresch, david.bresch@gmail.com, 20170216 all fine
View <A HREF=file:../../climada/code/helper_functions/climada_progress2stdout.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_scenario_name">
<H2>climada_scenario_name</H2></A>
<font color="blue">function scenario = climada_scenario_name(entity,hazard) </font>
 climada set scenario name
 NAME:
   climada_scenario_name
 PURPOSE:
   given an entity and a hazard, define a scenario name, based on
   assets.reference_year, assets.region, hazard.reference_year,
   hazard.scenario

 CALLING SEQUENCE:
   scenario = climada_scenario_name(entity,hazard)
 EXAMPLE:
   scenario = climada_scenario_name(entity,hazard)
   scenario = climada_scenario_name;
 INPUTS:
   entity: an entity structure or an entity .mat file, see climada_assets_encode(climada_assets_read)
       If a file and no path provided, default path ../data/entities is
       used (and name can be without extension .mat)
       &ampgt promted for if not given
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       If a file and no path provided, default path ../data/hazards is
       used (and name can be without extension .mat)
       &ampgt promted for if not given
 OUTPUTS:
   scenario, a structure with fields
       .name: a string, e.g. Assets 2014, Hazard 2014 no climate change, Florida
              or Assets 2014, Hazard 2030 moderate climate change, Florida
       .name_simple: a string with a simplified version of the scenario name,
              e.g., 2014, no climate change, Florida, or 2030 moderate
              climate change, Florida
       .assets_year: 2014, 2030, 2040, 2050, etc.
       .region: DISABLED, as Region is not supported any more
               a string, read from assets in excel, e.g. Florida, San Salvador, etc.
       .hazard_year: 2014, 2030, 2040, 2050, taken from hazard.refence_year
       .hazard_scenario: a string, taken from hazard.scenario, e.g. no climate change,
              moderate climate change, extreme climate change
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151127, init
 david.bresch@gmail.com, 20160916, see remark in code, cleaned up, region removed
View <A HREF=file:../../climada/code/helper_functions/climada_scenario_name.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_scenario_waterfall_identify">
<H2>climada_scenario_waterfall_identify</H2></A>
<font color="blue">function [is_today, is_eco, is_cc] = climada_scenario_waterfall_identify(measures_impact) </font>
 climada identify scenarios today, eco and climate change
 NAME:
   climada_scenario_waterfall_identify
 PURPOSE:
   Given a measures_impact with multiple scenarios, identify scenario
   today, economic development and climate change.
 
 CALLING SEQUENCE:
   [is_today, is_eco, is_cc] = climada_scenario_waterfall_identify(measures_impact)
 EXAMPLE:
   [is_today, is_eco, is_cc] = climada_scenario_waterfall_identify(measures_impact)
 INPUTS:
   measures_impact: a climate measures_impact structure with field
    .scenario. 
       &ampgt promted for if not given
 OUTPUTS:
   is_today: a number pointing to the order in which the today's scenario
       is located within measurse_impact 
   is_eco: a number pointing to the order in which the economic scenario
       is located within measurse_impact
   is_cc: a number pointing to the order in which the climate change scenario
       is located within measurse_impact
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151127, init
View <A HREF=file:../../climada/code/helper_functions/climada_scenario_waterfall_identify.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_shape_selector">
<H2>climada_shape_selector</H2></A>
<font color="blue">function shapes = climada_shape_selector(fig,n_shapes,smooth_factor,hold_shapes,min_dist_frac,shape_file,disco_mode) </font>
 select shapes
 MODULE:
   climada core
 NAME:
   climada_shape_selector
 PURPOSE:
   select shapes in plot
 CALLING SEQUENCE:
   shapes = climada_shape_selector(fig,N,hold_shapes,min_dist_frac)
 EXAMPLE:
   shapes = climada_shape_selector(2,5,1,0.01)
   shapes = climada_shape_selector
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   fig:    figure handle of figure in which you want to select shapes.
           if not given, existing figure with largest handle number is
           chosen. If no figures exist, climada_plot_world_borders is
           called
   n_shapes:       number of shapes you wish to draw
   hold_shapes:    whether to keep plot of shapes on figure or remove
                   them. Remove by default (=0)
   min_dist_frac:  radius of circle within which a click would close the
                   polygon (default = 2% of axis lims)
 OUTPUTS:
   shapes:     structure array with fields X and Y defining the coordinates
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150729 init
 Gilles Stassen, gillesstassen@hotmail.com, 20150827, V2.0 :-)
 Lea Mueller, muellele@gmail.com, 20150915, set disco_mode to 0
 Lea Mueller, muellele@gmail.com, 20151106, move to core
 Lea Mueller, muellele@gmail.com, 20160314, rename to n_shapes from N, change input order
View <A HREF=file:../../climada/code/helper_functions/climada_shape_selector.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_shapeplotter">
<H2>climada_shapeplotter</H2></A>
<font color="blue">function climada_shapeplotter(shapes,label_att,lon_fieldname,lat_fieldname,varargin) </font>
 climada_shapeplotter
 MODULE:
   climada/code/helper_functions
 NAME:
   climada_shapeplotter
 PURPOSE:
   easily plot shape structs containing multiple shapes
 CALLING SEQUENCE:
   climada_shapeplotter(shapes,label_att,varargin)
 EXAMPLE:
   climada_shapeplotter(shapes,'attribute name','X','Y','linewidth',2,'color','r')
   climada_shapeplotter(shapes,'attribute name','x','y','linewidth',2,'color','r','plot3_level',500)
 INPUTS: 
   shapes         : struct with shape file info must have fields X and Y
 OPTIONAL INPUT PARAMETERS:
   label_att      : the fieldname containing the string with which you wish to
                    label each shape
   lon_fieldname  : specify fieldname where to take lon information, default &quot.X&quot
   lat_fieldname  : specify fieldname where to take lat information, default &quot.Y&quot
   varargin       : any property value pair compatible with Matlab's plot func
 OUTPUTS:
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 18052015, init
 Lea Mueller, muellele@gmail.com, 20150607, add lon_fieldname and lat_fieldname to specify fieldnames of lon/lat coordinates
 Lea Mueller, muellele@gmail.com, 20160229, use plot instead of plot3
 Lea Mueller, muellele@gmail.com, 20160229, rename to climada_shapeplotter from shape_plotter and move to climada/core/helper_functions
 Lea Mueller, muellele@gmail.com, 20160314, try both, .X and .Y as well as .lon and .lat
 Lea Mueller, muellele@gmail.com, 20160314, add &quotplot3_level&quot to plot lines as plot3 on a certain plot3_level
View <A HREF=file:../../climada/code/helper_functions/climada_shapeplotter.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_shaperead">
<H2>climada_shaperead</H2></A>
<font color="blue">function [shapes,whole_world_borders]=climada_shaperead(shape_filename,mat_save_flag,create_world_borders,force_reread,silent_mode) </font>
 climada
 NAME:
   climada_shaperead
 PURPOSE:
   read a shape file and return shapes structure. See shaperead (likely in
   mapping toolbox)

   See climada module country_risk for e.g. a global admin0 (country) and
   admin1 (state/prvince) shape file.

   Note that this code requires the mapping toolbox, that's why the binary
   version of the admin0 shapes is stored as ../data/system/admin0.mat

   Stores a .mat binary file with shapes for subsequent fast access
 CALLING SEQUENCE:
   shapes=climada_shaperead(shape_filename,mat_save_flag,create_world_borders,force_reread,silent_mode);
 EXAMPLE:
   shapes=climada_shaperead(shape_filename);
   shapes=climada_shaperead('SYSTEM_ADMIN0');    % re-create ../data/system/admin0.mat
   shapes=climada_shaperead('SYSTEM_COASTLINE'); % re-create ../data/system/coastline.mat
 INPUTS:
   shape_filename: filename (with path) of a shapefile
       &ampgt promted for if not given

       Special case: if set to 'SYSTEM_ADMIN0', the core climada
       admin0.mat file is re-created (requires country_risk module).
       Note that in this case, country names are unified, see
       reference_ISO3_country_name in PARAMETERS in code)
       Note that in this case, some shapes are reduced to the comestic
       part of the countries, namely for France, Netherlands, Norway, New
       Zealand, Portugal, Russia and United States (see special_shape in
       PARAMETERS in code and also see SYSTEM_ADMIN0 flag in code)

       Special case: if set to 'SYSTEM_COASTLINE', the core climada
       coastline.mat file is re-created (requires country_risk module).
       The coastline is saved as one large 'Point' structure, in order to
       speed up calculations in climada_distance2coast_km
       That's currently the key use of the coastline. Since segments are
       still separated by NaN, one can use plot(shapes.X,shapes.Y,'-r') to
       show the coastline as line. In order to get the original shapes,
       one needs to read the source .shp file again (see PARAMETERS in
       code and also see SYSTEM_ADMIN0 flag in code, since the source file
       is defined relative to the country_risk module and hence done only
       if requested).
 OPTIONAL INPUT PARAMETERS:
   mat_save_flag: =1: do save as .mat file (default)
       =0: do not save as .mat file
   create_world_borders: =1: create whole_world_borders which contains all
       shapes in one structure for fast (global) plotting (no loop needed)
       =0: do not do so (default)
       See code, currently DISABLED, since it doubles the size of the .mat
       file but plotting world borders only takes 0.35 sec compared to 0.25
       sec. But kept in code (commented, as this might matter for even
       higher border shape resolution)
   force_reread: =1 force re-reading the original shape file
       =0: use the .mat file if existing
   silent_mode: =1, do not print anything, do not show plots
       =0: print shape filename and show plot for admin0 check (default)
 OUTPUTS:
   shapes: a shapes structure, containing one element for each non-null
       geographic feature in the shapefile. shapes is a &quotmapstruct&quot geographic
       data structure array and combines coordinates/geometry, expressed in
       terms of map X and Y, with non-spatial feature attributes.
   whole_world_borders: a simpler structure with all shapes in one for
       fast plotting, see e.g. climada_plot_world_borders (only genersted
       if create_world_borders=1). DISABLED, see above.
       In case you need whole_world_borders, add the following lines to
       your code:
           load(climada_global.map_border_file);
           whole_world_borders.lon = [];
           whole_world_borders.lat = [];
           for i=1:length(shapes)
               whole_world_borders.lon = [whole_world_borders.lon; shapes(i).X'];
               whole_world_borders.lat = [whole_world_borders.lat; shapes(i).Y'];
           end
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141211, initial
 David N. Bresch, david.bresch@gmail.com, 20141212, SYSTEM_ADMIN0 added
 David N. Bresch, david.bresch@gmail.com, 20141221, restriction to domestic for SYSTEM_ADMIN0
 David N. Bresch, david.bresch@gmail.com, 20141225, SYSTEM_COASTLINE added
 Lea Mueller, muellele@gmail.com, 20160229, add semicolon
 David N. Bresch, david.bresch@gmail.com, 20161007, missing (sub) countries searched for and added
 David N. Bresch, david.bresch@gmail.com, 20161008, sub country treatement moved to climada_admin0_fix
View <A HREF=file:../../climada/code/helper_functions/climada_shaperead.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_sparse_interp">
<H2>climada_sparse_interp</H2></A>
<font color="blue">function res = climada_sparse_interp(matrix) </font>
 climada event damage hazard probabilistic stochastic damagefunctions
 NAME:
   climada_sparse_interp
 PURPOSE:

   SOON TO BE DECOMMISSIONED, only used in climada_EDS_calc_OLD

   helper-function to allow for very efficient execution of the
   mapping from the hazard-array to the MDD-matrix
   since the hazard-array is sparse, we cannot directly apply interp1
   but do this only on the non-zero elements by use of a function handle
   to the present routine climada_sparse_interp, but before, we pass the other
   two arguments of interp1 as global variables:

   global interp_x_table
   global interp_y_table
   MDD=spfun(@climada_sparse_interp,hazard_arr);

   see climada_EDS_calc about further details (in the code)

 CALLING SEQUENCE:
   res=climada_sparse_interp(matrix)
 EXAMPLE:
   res=climada_sparse_interp(matrix)
   see climada_EDS_calc
 INPUTS:
   matrix: any matrix to be interpolated based upon the relation
       defined by (interp_x_table,interp_y_table), passed as global variables
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   the interpolated matrix res of same dimensions as matrix
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20091228
View <A HREF=file:../../climada/code/helper_functions/climada_sparse_interp.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_spreadsheet_read">
<H2>climada_spreadsheet_read</H2></A>
<font color="blue">function res=climada_spreadsheet_read(interactive_mode,spreadsheet_file,spreadsheet_sheet,silent_mode) </font>
 climada spreadhseet data import read
 NAME:
   climada_spreadsheet_read
 PURPOSE:
   a wrapper that reads spreadsheet data

   currently implemented are climada_xlsread and climada_odsread

   see all further details in mentioned implementations, the wrapper just
   passes all variables over to them
 CALLING SEQUENCE:
   res=climada_spreadsheet_read(interactive_mode,spreadsheet_file,spreadsheet_sheet,silent_mode);
 EXAMPLE:
   res=climada_spreadsheet_read
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   interactive_mode: 'interactive' or 'no'. If interactive, the user gets
       prompted for the sheet in the Excel file
       (Currently hard-wired to interactive)
   spreadsheet_file: the spreadsheet file to read
   spreadsheet_sheet: the sheet to read in the spreadsheet file
   silent_mode: if =1, do not write messages to stdout, default=0, means writing
 OUTPUTS:
   res: a structure holding the data from the selected Excel sheet
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20130330
View <A HREF=file:../../climada/code/helper_functions/climada_spreadsheet_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_subarray">
<H2>climada_subarray</H2></A>
<font color="blue">function [S,untreated_fields]=climada_subarray(S,pos,silent_mode) </font>
 climada template
 MODULE:
   core
 NAME:
   climada_subarray
 PURPOSE:
   given a typical climada structure S, perform S.a=S.a(1,pos) 
   for all a of dimensions 1xn

 CALLING SEQUENCE:
   [S,untreated_fields]=climada_subarray(S,pos,silent_mode)
 EXAMPLE:
   S.a=1:10;S.b=1:10;S.c='gaga';S.d=7;S.e=repmat({'abc'},1,10);
   S=climada_subarray(S,3:6)
   entity.assets=climada_subarray(entity.assets,find(entity.assets.Value&ampgt0))
 INPUTS:
   S: a structure
   pos: the positions to keep
 OPTIONAL INPUT PARAMETERS:
   silent_mode: if =1, do not warn etc, default=0
 OUTPUTS:
   S: S restricted to pos
   untreated_fields: a structre, the list with the fieldnames without
       application of pos 
 MODIFICATION HISTORY
 David N. Bresch, david.bresch@gmail.com, 20161023, initial
 David N. Bresch, david.bresch@gmail.com, 20170212, untreated_fields
 David N. Bresch, david.bresch@gmail.com, 20170221, silent_mode
 David N. Bresch, david.bresch@gmail.com, 20170224, a must be 1xn
View <A HREF=file:../../climada/code/helper_functions/climada_subarray.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_add_timestep">
<H2>climada_tc_add_timestep</H2></A>
<font color="blue">function tc_track=climada_tc_add_timestep(tc_track) </font>
 climada tc track timestep
 NAME:
   climada_tc_add_timestep
 PURPOSE:
   add TimeStep [hours] to a TC track, which contains only date (yyyymmdd and time
   in hours) of each node. TimeStep is defined between nodes (thus one
   element shorter than nodes)

 CALLING SEQUENCE:
   tc_track=climada_tc_add_timestep(tc_track)
 EXAMPLE:
   tc_track=climada_tc_add_timestep(tc_track)
 INPUTS:
   tc_track: a TC structure, e.g. as returned by climada_read_unisys_database
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   tc_track: a TC structure, with added TimeStep
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120430
 David N. Bresch, david.bresch@gmail.com, 20150103, datenum added, too
View <A HREF=file:../../climada/code/helper_functions/climada_tc_add_timestep.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_equal_timestep">
<H2>climada_tc_equal_timestep</H2></A>
<font color="blue">function tc_track=climada_tc_equal_timestep(tc_track,default_min_TimeStep) </font>
 tropical cyclone track timstep datenum
 NAME:
   climada_tc_equal_timestep
 PURPOSE:
   Interpolate tc_track to equal timestep, usually 1h

   Uses linear interpolation for all fields (for speedup) and removes the
   (anyway unused) field 'extratrop' (of the form '****..EEE')

   Works to interpolate on any timestep between first and last node,
   timestep measured in hours. Note that time step shall 'fit' within
   start and end, e.g. 0:6:24 -&ampgt [0 6 12 18 24], but 0:5:24 -&ampgt [0 5 10 15 20]

 CALLING SEQUENCE:
   tc_track=climada_tc_equal_timestep(tc_track,default_min_TimeStep)
 EXAMPLE:
   tc_track=climada_tc_equal_timestep(tc_track)
 INPUTS:
   tc_track: a tc_track structure (a single track or many), eg as returned
       by climada_tc_read_unisys_database or climada_tc_read_unisys_track 
 OPTIONAL INPUT PARAMETERS:
   default_min_TimeStep: the default minimum TimeStep in hours
       (default=1 hour as defined in climada_global.tc.default_min_TimeStep)
 OUTPUTS:
   tc_track: a tc_track structure, with equal timesteps and copy of
       time-independent fields
 MODIFICATION HISTORY:
 David N. Bresch, david_bresch@gmail.com, 20040911, 20081006
 Mathias Hauser, 20120507
 Lea Mueller, 20121203
 David N. Bresch, david_bresch@gmail.com, 20040911, new version of MATLAB does not like adding empty stuff
 David N. Bresch, david_bresch@gmail.com, 20141231, datevecmx replaced
 David N. Bresch, david_bresch@gmail.com, 20150103, simplified (a lot) and about five times faster
 David N. Bresch, david_bresch@gmail.com, 20150119, lat/lon interpolation switched to spline
 David N. Bresch, david_bresch@gmail.com, 20161204, RadiusMaxWind and EnvironmentalPressure added
 David N. Bresch, david_bresch@gmail.com, 20170225, Celerity,cos_lat, node_dx, node_dy and node_len added
View <A HREF=file:../../climada/code/helper_functions/climada_tc_equal_timestep.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_event_damage_ens">
<H2>climada_tc_event_damage_ens</H2></A>
<font color="blue">function [damage,track_filename,err_msg]=climada_tc_event_damage_ens(UNISYS_regi,UNISYS_year,UNISYS_name,n_tracks,auto_sel_assets,call_from_GUI) </font>
 MODULE:
   advanced
 NAME:
   climada_tc_event_damage_ens
 PURPOSE:
   Given a single track file, calculate the damage for all countries
   posibbly hit (i.e. at least one node within country boders)

   Plus generate ensemble 'forecast' damage

   Fetches data from: weather.unisys.com/hurricane, but since the format
   and layout of the webpage changed, it only works back to about 2006...
   earier years will,likely lead to errors. In such cases, retrieve the TC
   track file manually and run the code by passing the track file in the
   first variable (UNISYS_regi)

   See also climada_tc_event_damage_ens_gui
 CALLING SEQUENCE:
   [damage,track_filename]=climada_tc_event_damage_ens(UNISYS_regi,UNISYS_year,UNISYS_name,n_tracks,auto_sel_assets,call_from_GUI)
 EXAMPLE:
   damage=climada_tc_event_damage_ens('w_pacific','2015','KOPPU',5)
   [damage,track_filename]=climada_tc_event_damage_ens('','NONE','NONE',5) % prompt for track file
 INPUTS:
   UNISYS_regi: the UNISYS region, i.e. 'atlantic','e_pacific','w_pacific'
       's_pacific','s_indian' or 'n_indian'
       SPECIAL: if a TC track filename (with path) is passed instead of a region
       and UNISYS_year and UNISYS_name are both set to 'NONE', the track file
       is used. This way, any TC track file can be passed as input.
   UNISYS_year: the year yyyy (as string). Note that years before 2006
       likely do not work properly (since UNISYS changed the layout of
       their webpage and the code reads the html source to figure the
       event names...). If set to 'NONE' together with UNISYS_name, the
       user gets prompted for the TC track file
   UNISYS_name: the name of the event (without Hurricane-1 ..., usually uppercase).
       If set to 'NONE' together with UNISYS_year, the user gets prompted
       for the TC track file.
   &ampgt   if all three parameters above are empty: Select the region and event
       from selection lists, the single TC track file is downloaded from
       UNISYS and processed
   n_tracks: number of tracks (incl original one), default=100
   auto_sel_assets: whether the code automatically selects assets 
       (=1, default) or not (=0)
   call_from_GUI: switch to direct to the correct axes
       if empty, not called from GUI, otherwise contains the axes handles
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   damage: the vector with the calculated damages, damage(1) is the one
       for the reported track, all following ones for ensemble members
   track_filename: the TC track filename with path
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20151009, initial
 David N. Bresch, david.bresch@gmail.com, 20151018, automatic country detection
 David N. Bresch, david.bresch@gmail.com, 20151019, converted into a function, see also climada_tc_event_damage_ens_gui
 David N. Bresch, david.bresch@gmail.com, 20151021, special case for no web access added
 David N. Bresch, david.bresch@gmail.com, 20161009, massive speedup using only assets in vicinity of track
 David N. Bresch, david.bresch@gmail.com, 20161009, auto_sel_assets added
View <A HREF=file:../../climada/code/helper_functions/climada_tc_event_damage_ens.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_event_damage_ens_gui">
<H2>climada_tc_event_damage_ens_gui</H2></A>
<font color="blue">function varargout = climada_tc_event_damage_ens_gui(varargin) </font>
 CLIMADA_TC_EVENT_DAMAGE_ENS_GUI MATLAB code for climada_tc_event_damage_ens_gui.fig
      CLIMADA_TC_EVENT_DAMAGE_ENS_GUI, by itself, creates a new CLIMADA_TC_EVENT_DAMAGE_ENS_GUI or raises the existing
      singleton*.

      H = CLIMADA_TC_EVENT_DAMAGE_ENS_GUI returns the handle to a new CLIMADA_TC_EVENT_DAMAGE_ENS_GUI or the handle to
      the existing singleton*.

      CLIMADA_TC_EVENT_DAMAGE_ENS_GUI('CALLBACK',hObject,eventData,handles,...) calls the local
      function named CALLBACK in CLIMADA_TC_EVENT_DAMAGE_ENS_GUI.M with the given input arguments.

      CLIMADA_TC_EVENT_DAMAGE_ENS_GUI('Property','Value',...) creates a new CLIMADA_TC_EVENT_DAMAGE_ENS_GUI or raises the
      existing singleton*.  Starting from the left, property value pairs are
      applied to the GUI before climada_tc_event_damage_ens_gui_OpeningFcn gets called.  An
      unrecognized property name or invalid value makes property application
      stop.  All inputs are passed to climada_tc_event_damage_ens_gui_OpeningFcn via varargin.

      *See GUI Options on GUIDE's Tools menu.  Choose &quotGUI allows only one
      instance to run (singleton)&quot.

 See also: GUIDE, GUIDATA, GUIHANDLES
View <A HREF=file:../../climada/code/helper_functions/climada_tc_event_damage_ens_gui.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_get_unisys_databases">
<H2>climada_tc_get_unisys_databases</H2></A>
<font color="blue">function climada_tc_get_unisys_databases(tc_tracks_folder,read_it) </font>
 climada
 NAME:
   climada_tc_get_unisys_databases
 PURPOSE:
   get UNISYS databases from www, i.e. all the ocean basin files from 
   http://weather.unisys.com/hurricane/index.html

   next step: see climada_tc_read_unisys_database (see also read_it here)
 CALLING SEQUENCE:
   climada_tc_get_unisys_databases
 EXAMPLE:
   climada_tc_get_unisys_databases
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   tc_tracks_folder: the place to store the data files to
       default the climada core /data/tc_tracks folder
   read_it: if =1, do read the database and save as .mat file
 OUTPUTS:
   into .../tc_tracks folder
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20140715
 David N. Bresch, david.bresch@gmail.com, 20161023, read_it added
View <A HREF=file:../../climada/code/helper_functions/climada_tc_get_unisys_databases.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_hazard_clim_scen">
<H2>climada_tc_hazard_clim_scen</H2></A>
<font color="blue">function hazard = climada_tc_hazard_clim_scen(hazard,hazard_clim_file,frequency_screw,intensity_screw,tc_track,category_thres) </font>
 climada
 NAME:
   climada_template
 PURPOSE:
   starting from a given hazard event set (hazard), construct the
   climate scenario hazard event set (hazard_clim_file)

   Modifications done in code, so please visit/edit the code prior to use,
   please check the PARAMETERS section below, e.g. for
       frequency_screw, intensity_screw
       hazard_reference_year: the reference year for the hazard set
 CALLING SEQUENCE:
   hazard=climada_tc_hazard_clim_scen(hazard,hazard_clim_file)
 EXAMPLE:
   hazard=climada_tc_hazard_clim_scen
 INPUTS:
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   hazard_clim_file: the filename of the new climate scenario hazard event set
       if set to 'no', the modified hazard event set is not saved
       &ampgt promted for if not given
	tc_track: The storm track information.
	category_thres: Only adjust frequency and intensity of storms equal and above certain Saffir-Simpson Scale.
	Speficy a number, if no input, then alter storms of all categories.
   -1 tropical depression
    0 tropical storm
    1 Hurrican category 1
    2 Hurrican category 2
    3 Hurrican category 3
    4 Hurrican category 4
    5 Hurrican category 5
 OUTPUTS:
   hazard: the hazard event set for the climate scenario, also stored to hazard_clim_file
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090920
 Lea Mueller, 20110720
 Reto Stockmann 20120719
 David N. Bresch, david.bresch@gmail.com, 20160829, option hazard_clim_file='no'
 Martin Stolpe, 20170409, include tc_track and category_thres. Only influence storms above a category threshold.
View <A HREF=file:../../climada/code/helper_functions/climada_tc_hazard_clim_scen.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_hurdat_read">
<H2>climada_tc_hurdat_read</H2></A>
<font color="blue">function [tc_track,tc_track_hist_file]=climada_tc_hurdat_read(hurdat_filename,check_plot) </font>
 climada template
 MODULE:
   core
 NAME:
   climada_tc_hurdat_read
 PURPOSE:
   Read HURDAT database, www.nhc.noaa.gov/data

   The code does check for at least 3 nodes (see parameter min_nodes) and
   sets missing CentralPressure and negative MaxWInd to NaN.

   Atlantic hurricane database (HURDAT2) 1851-2014:
   www.nhc.noaa.gov/data/hurdat/hurdat2-1851-2014-060415.txt

   Northeast and North Central Pacific hurricane database (HURDAT2)
   1949-2013: www.nhc.noaa.gov/data/hurdat/hurdat2-nencpac-1949-2013-070714.txt

   for format and details, see www.nhc.noaa.gov/data/hurdat/hurdat2-format-atlantic.pdf

   For debugging, there is a simple try/catch which stops and shows the
   line number and its content in case of trouble.

   next step: see climada_tc_random_walk and climada_tc_hazard_set

   See also climada_tc_read_unisys_database and climada_tc_jtwc_fetch
 CALLING SEQUENCE:
   tc_track=climada_tc_hurdat_read(hurdat_filename)
 EXAMPLE:
   tc_track=climada_tc_hurdat_read;
 INPUTS:
   hurdat_filename: name (and path) of the HURDAT2 text file
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   check_plot: =1, plot for check, =0, no plot (default)
 OUTPUTS:
   tc_track: a structure with the track information for each cyclone i and
           data for each node j (times are at 00Z, 06Z, 12Z, 18Z):
       tc_track(i).lat(j): latitude at node j of cyclone i
       tc_track(i).lon(j): longitude at node j of cyclone i
       tc_track(i).MaxSustainedWind(j): Maximum sustained (1 minute)
           surface (10m) windspeed in knots (in general, these are to the nearest 5 knots).
       tc_track(i).MaxSustainedWindUnit, almost always 'kn'
           (others allowed: 'mph', 'm/s' or 'km/h')
       tc_track(i).CentralPressure(j): optional
       tc_track(i).CentralPressureUnit: 'mb'
       tc_track(i).yyyy: 4-digit year, optional
       tc_track(i).mm: month, optional
       tc_track(i).dd: day, optional
       tc_track(i).hh: hours
       tc_track(i).datenum:  matlab notation for date and time (see function datestr)
       tc_track(i).TimeStep(j)=time step [h] from this to next node
           Nearly all HURDAT2 records correspond to the synoptic times of 0000, 0600, 1200, and 1800.
           Recording best track data to the nearest minute became available within the b-decks
           beginning in 1991 and some tropical cyclones since that year have the landfall best track to the nearest minute.
       tc_track(i).ID_no: unique ID, optional
       tc_track(i).name: name, optional
       tc_track(i).orig_event_flag: whether it is an mother(=1) or daugther(=0) storm

       PLUS: optional field (only in HURDAT)
       tc_track(i).WindRadii(j,1:12): wind radii maximum extent (in
           nautical miles) for quadrants:
           tc_track(i).WindRadii(j,1): northeastern quadrant
                    2): southeastern quadrant
                    3): southwestern quadrant
                    4): northwestern quadrant
                    5): northeastern quadrant
                    6): southeastern quadrant
                    7): southwestern quadrant
                    8): northwestern quadrant
                    9): northeastern quadrant
                   10): southeastern quadrant
                   11): southwestern quadrant
                   12): northwestern quadrant

       To really start from the raw text file again, please delete the
       binary file (*_hist.mat).

   tc_track_hist_file: the filename with path to the binary file
       tc_track is stored in (see NOTE above)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150730, intial
 David N. Bresch, david.bresch@gmail.com, 20150824, made fully consistent with unisys and jtwc
View <A HREF=file:../../climada/code/helper_functions/climada_tc_hurdat_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_interp">
<H2>climada_tc_interp</H2></A>
<font color="blue">function y = climada_tc_interp(x,sample_rate) </font>
 TC new event set windfield calculation
 NAME:
   climada_tc_interp
 PURPOSE:
   increase resolution of any data by linear interpolation between nodes
 CALLING SEQUENCE:
   y = climada_tc_interp(x,sample_rate)
 EXAMPLE:
   y = climada_tc_interp([1 2 3],1); y = [1 1.5 2 2.5 3];
 INPUTS:
   x: one-dimensional vector to be interpolated between nodes
   sample_rate: number of interpolation points between nodes
       =0 returns x unchanged
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   y: the resampled vector x
 RESTRICTIONS:
 MODIFICATION HISTORY:
 srzdnb, 29.4.2003
View <A HREF=file:../../climada/code/helper_functions/climada_tc_interp.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_jtwc_fetch">
<H2>climada_tc_jtwc_fetch</H2></A>
<font color="blue">function [tc_track,tc_track_hist_file]=climada_tc_jtwc_fetch(check_plot) </font>
 climada_tc_jtwc_fetch
 MODULE:
   core
 NAME:
   climada_tc_jtwc_fetch
 PURPOSE:
   fetch TC track files from web, as (very) cumbersome for TC Southern
   Hemisphere, and convert into tc_track structure. See
   www.usno.navy.mil/NOOC/nmfc-ph/RSS/jtwc/best_tracks/shindex.php

   See parameter Pacific_centric in code, with sets longitudes such that
   event set generation works for South Psacific ocean (most likely use,
   as there is no UNISYS data for this region). Set Pacific_centric=0 in
   case you'd like to use jtwc data for South Indian ocean.

   Note: we do NOT store empty (no wind nor pressure) or too short (less
   than 3 nodes) tracks in tc_track, as any subsequent climada code would
   struggle to use it anyway.

   next step: see climada_tc_random_walk and climada_tc_hazard_set

   See also climada_tc_read_unisys_database and climada_tc_hurdat_read
 CALLING SEQUENCE:
   [tc_track,tc_track_hist_file]=climada_tc_jtwc_fetch(check_plot)
 EXAMPLE:
   tc_track=climada_tc_jtwc_fetch(1)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   check_plot: =1, plot for check, =0, no plot (default)
 OUTPUTS:
   tc_track: a structure with the track information for each cyclone i and
           data for each node j (times are at 00Z, 06Z, 12Z, 18Z):
       tc_track(i).lat(j): latitude at node j of cyclone i
       tc_track(i).lon(j): longitude at node j of cyclone i
       tc_track(i).MaxSustainedWind(j): Maximum sustained (1 minute)
           surface (10m) windspeed in knots (in general, these are to the nearest 5 knots).
       tc_track(i).MaxSustainedWindUnit, almost always 'kn'
           (others allowed: 'mph', 'm/s' or 'km/h')
       tc_track(i).CentralPressure(j): optional
       tc_track(i).CentralPressureUnit: 'mb'
       tc_track(i).yyyy: 4-digit year, optional
       tc_track(i).mm: month, optional
       tc_track(i).dd: day, optional
       tc_track(i).hh: hours
       tc_track(i).datenum:  matlab notation for date and time (see function datestr)
       tc_track(i).TimeStep(j)=time step [h] from this to next node
           Nearly all HURDAT2 records correspond to the synoptic times of 0000, 0600, 1200, and 1800.
           Recording best track data to the nearest minute became available within the b-decks
           beginning in 1991 and some tropical cyclones since that year have the landfall best track to the nearest minute.
       tc_track(i).ID_no: unique ID, optional
       tc_track(i).name: name, optional
       tc_track(i).orig_event_flag: whether it is an mother(=1) or daugther(=0) storm
   tc_track_hist_file: the filename with path to the binary file
       tc_track is stored in (see NOTE above)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150823
 David N. Bresch, david.bresch@gmail.com, 20150824, made fully consistent with unisys and hurdat
View <A HREF=file:../../climada/code/helper_functions/climada_tc_jtwc_fetch.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_overview_table">
<H2>climada_tc_overview_table</H2></A>
<font color="blue">function climada_tc_overview_table(tc_track,csv_filename) </font>
 climada
 NAME:
   climada_tc_overview_table
 PURPOSE:
   write key information of tracks into .csv file
 CALLING SEQUENCE:
   climada_tc_overview_table(tc_track)
 EXAMPLE:
   climada_tc_overview_table
 INPUTS:
   tc_track: a tc_track structure, as returned eg by climada_tc_read_unisys_database
       &ampgt promted for if not given
   csv_filename: the name of the file to write to
       &ampgt promted for if not given (well, prompted for a binary file that
       contains a tc_track structure)
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20110307
View <A HREF=file:../../climada/code/helper_functions/climada_tc_overview_table.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_random_walk_position_windspeed">
<H2>climada_tc_random_walk_position_windspeed</H2></A>
<font color="blue">function tc_track_prob = climada_tc_random_walk_position_windspeed(tc_track , tc_track_save, ens_size, ens_amp, Maxangle,... </font>
   check_plot, check_printplot)
View <A HREF=file:../../climada/code/helper_functions/climada_tc_random_walk_position_windspeed.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_read_unisys_track">
<H2>climada_tc_read_unisys_track</H2></A>
<font color="blue">function [tc_track,track_filename] = climada_tc_read_unisys_track(track_filename,check_plot) </font>
 climada unisys TC track
 NAME:
   climada_tc_read_unisys_track
 PURPOSE:
   read a single track data file as downloaded from
   http://www.weather.unisys.com/hurricane/
   can be used to add to existing tc_track structure like:
   tc_track(end+1)=climada_tc_read_unisys_track

   Note that identical (double entry) and backward timesteps are removed.
   In such cases, you better inspect the tc_track file (source) and remove
   using an editor. 

   See also e.g. climada_event_damage_data_tc
 CALLING SEQUENCE:
   tc_track=climada_tc_read_unisys_track(filename,check_plot)
 EXAMPLE:
   tc_track=climada_tc_read_unisys_track
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   track_filename: the filename with path of a UNISYS *.dat file
       &ampgt user gets prompted for if not specified
       If no path provided the default tc_track dir is used. If _track is
       not provided in the filename, it is added, too. I fno extension is
       provided, .dat is assumed.
   check_plot: =1 show track on map, =0 not (default)
 OUTPUTS:
   tc_track: a TC track structure, see climada_tc_read_unisys_database
   track_filename: the track_filename (usefeul if prompted for)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20110429
 Lea Mueller, 20110718
 David N. Bresch, david.bresch@gmail.com, 20150220, init_vars reset removed
 David N. Bresch, david.bresch@gmail.com, 20151018, forecast file added to output and automatic removal of backward timesteps
 David N. Bresch, david.bresch@gmail.com, 20151102, allow for name without path on input
 David N. Bresch, david.bresch@gmail.com, 20161009, append _track.dat if necessary
View <A HREF=file:../../climada/code/helper_functions/climada_tc_read_unisys_track.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_season">
<H2>climada_tc_season</H2></A>
<font color="blue">function  [tc_track, seasons] = climada_tc_season(tc_track) </font>
 add season for every tc track (former climada_add_tc_track_season)
 NAME:
   climada_tc_season
 PURPOSE:
   add season for every tc track 
 CALLING SEQUENCE:
   [tc_track, seasons] = climada_tc_season(tc_track)
 EXAMPLE:
   [tc_track, seasons] = climada_tc_season(tc_track)
 INPUTS:
	tc_track:    one or more tc_tracks (structure)
 OPTIONAL INPUT PARAMETERS:
   none
 OUTPUTS:
   tc_track:    tc_track with tc_track.season (array)
 Lea Mueller, 20110620
View <A HREF=file:../../climada/code/helper_functions/climada_tc_season.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_stormcategory">
<H2>climada_tc_stormcategory</H2></A>
<font color="blue">function  tc_track = climada_tc_stormcategory(tc_track) </font>
 add  Saffir Simpson category for every tc track (former
 climada_add_tc_track_stormcategory)
 NAME:
   climada_tc_stormcategory
 PURPOSE:
   add storm category for every tc track according to saffir-simpson
   hurricane scale
   -1 tropical depression
    0 tropical storm
    1 Hurrican category 1
    2 Hurrican category 2
    3 Hurrican category 3
    4 Hurrican category 4
    5 Hurrican category 5
 CALLING SEQUENCE:
   [tc_track] = climada_tc_stormcategory(tc_track)
 EXAMPLE:
   [tc_track] = climada_tc_stormcategory(tc_track)
 INPUTS:
	tc_track:    one or more tc_tracks (structure)
 OPTIONAL INPUT PARAMETERS:
   none
 OUTPUTS:
   tc_track:    tc_track with tc_track.category (array)
 Lea Mueller, 20110614
 Martin Stolpe, 20170408, if wind speed not in knots then convert to knots
View <A HREF=file:../../climada/code/helper_functions/climada_tc_stormcategory.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_track_info">
<H2>climada_tc_track_info</H2></A>
<font color="blue">function [tc_track,info]=climada_tc_track_info(tc_track,check_plot,boundary_rect,centroids,manual_select) </font>
 climada tc track info
 MODULE:
   core
 NAME:
   climada_tc_track_info
 PURPOSE:
   Prints information of tracks to stdout (name, date....) and shows
   (nice) plots of historic (and probabilistic) tracks

   Prior call: climada_tc_read_unisys_tc_track, climada_tc_track_quality_check
   Possible subsequent call: hold on;climada_entity_plot
 CALLING SEQUENCE:
   [tc_track,info]=climada_tc_track_info(tc_track)
 EXAMPLE:~
   [~,info]=climada_tc_track_info('tracks.she_hist.mat',2,[140 180 -40 -10]); % historic
   [~,info]=climada_tc_track_info('tracks.she_prob.mat',1,[140 180 -40 -10]); % also probabilistic
 INPUTS:
   tc_track: a tc_track structure, as returned by
       climada_tc_read_unisys_database or climada_tc_read_unisys_tc_track
       &ampgt promted for (.mat) if not given
       If a .mat filename is passed, the content is loaded
 OPTIONAL INPUT PARAMETERS:
   check_plot: if =1, show checkplot (default),
       =0 no plot, no print to stdout
       =-1: check plot and print info to stdout (can be long)
       =-99: only print info to stdout (can be long)
       =2: only check plot and only historic events (to create the e.g.
       the slide to show hist/prob, see boundary_rect also)
   boundary_rect: the boundary to plot [minlon maxlon minlat maxlat]
       default is whole globe
   centroids: a structure with centroids.lon, centroids.lat
       if provided, only show tracks intersecting centroids
   manual_select: if =1, alow for user to define point(s) on the map to
       select tracks in vicinity (press enter after clicking on the map)
       Best use is to define a 'gate', i.e. two points on the left and
       right of the track to select.
 OUTPUTS:
   tc_track: the tc_track structure, restricted to centroids, if passed
       and cleaned up, if check_plot=-99. Otherwise same as input tc_track
   info contains some information, but to stdout is main purpose of this
       routine
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150118, initial
 David N. Bresch, david.bresch@gmail.com, 20160515, check_plot and boundary_rect added
 David N. Bresch, david.bresch@gmail.com, 20160528, centroids and manual_select added
 David N. Bresch, david.bresch@gmail.com, 20170125, climada_tc_track_quality_check
 David N. Bresch, david.bresch@gmail.com, 20170201, check_plot simplified, climada_tc_track_quality_check removed
View <A HREF=file:../../climada/code/helper_functions/climada_tc_track_info.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_track_load">
<H2>climada_tc_track_load</H2></A>
<font color="blue">function tc_track=climada_tc_track_load(tc_track_filename,check_plot) </font>
 climada tc track load
 MODULE:
   core
 NAME:
   climada_tc_track_load
 PURPOSE:
   Load a previously generated tc_track strcuture

   Prior call: climada_tc_read_unisys_tc_track
   Possible subsequent call: climada_tc_track_info
 CALLING SEQUENCE:
   tc_track=climada_tc_track_load(tc_track_filename,check_plot)
 EXAMPLE:
   tc_track=climada_tc_track_load(tc_track_filename)
 INPUTS:
   tc_track_filename: a filename of a .mat file containign a tc_track
       structure, as returned by climada_tc_read_unisys_database or
       climada_tc_read_unisys_tc_track
       If only a filename is given, the default path (../tc_tracks) is
       presumed, and if only a basin is given (e.g. atl_hist or atl_prob),
       the filename is completed (to tracks.atl_hist.mat). But 'atl' is
       not sufficient, since it could mean atl_hist or atl_prob.
       &ampgt promted for (.mat) if not given
 OPTIONAL INPUT PARAMETERS:
   check_plot: if =1, show checkplot, =0 not (default)
       =-1; ONLY check plot, do not print info to stdout
       =-2; only check plot and only historic events (to create the e.g.
       the slide to show hist/prob, see boundary_rect also)
       Info: this just calls climada_tc_track_info(tc_track,check_plot)
 OUTPUTS:
   tc_track: a tc_track structure, as returned by
       climada_tc_read_unisys_database or climada_tc_read_unisys_tc_track
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160516, initial
 David N. Bresch, david.bresch@gmail.com, 20160528, more filename completion options
 David N. Bresch, david.bresch@gmail.com, 20170108, filename completion options clarified
View <A HREF=file:../../climada/code/helper_functions/climada_tc_track_load.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_track_nodes">
<H2>climada_tc_track_nodes</H2></A>
<font color="blue">function [tc_track_nodes,tc_track_nodes_file]=climada_tc_track_nodes(tc_track_mat_file) </font>
 climada tc track nodes
 MODULE:
   core
 NAME:
   climada_tc_track_nodes
 PURPOSE:
   Given a .mat file with tc_track(i), usually named *_hist.mat 
   (for historic, see climada_tc_read_unisys_database), 
   construct the nodes file, usually named *_nodes.mat, i.e. the
   file containing tc_track_nodes.lon(j) and tc_track_nodes.lat(j)

   previous call: 
   called from: centroids_generate_hazard_sets and climada_event_damage_data_tc
 CALLING SEQUENCE:
   [tc_track_nodes,tc_track_nodes_file]=climada_tc_track_nodes(tc_track_mat_file)
 EXAMPLE:
   [tc_track_nodes,tc_track_nodes_file]=climada_tc_track_nodes(tc_track_mat_file)
 INPUTS:
   tc_track_mat_file: the mat file containing tc_track(i), most likely a
       file *_hist.mat (but one can also use _prob.mat, in wich case the
       output is named *_prob_nodes.mat instead of *_nodes.mat)
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   tc_track_nodes: a structure with all nodes of TC tracks, i.e.
       lon(j): the node j
       lat(j): the node j
       track_no(j): the track number, tc_track(tc_track_nodes.track_no(j))
           is the track node j comes from
   tc_track_nodes_file: the name of the .mat file (*_nodes.mat) containing
       tc_track_nodes
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150128, initial
View <A HREF=file:../../climada/code/helper_functions/climada_tc_track_nodes.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_track_quality_check">
<H2>climada_tc_track_quality_check</H2></A>
<font color="blue">function tc_track=climada_tc_track_quality_check(tc_track) </font>
 climada tc track info
 MODULE:
   core
 NAME:
   climada_tc_track_quality_check
 PURPOSE:
   run quality check, i.e. reject tracks moving too fast (&ampgt10 degrees in
   one timestep, see delta_node_dlonlat in PARAMETERS in code) and fix
   dateline issue. Report fixed and spotted issues to stdout (for
   dateline, just report the number of tracks that needed fixing).

3684: nodes too far apart (11&ampgt10 degree)
1442: nodes too far apart (14&ampgt10 degree)
476: nodes too far apart (14&ampgt10 degree)
   Prior call: climada_tc_track_info
   Possible subsequent call: hold on;climada_entity_plot
 CALLING SEQUENCE:
   tc_track=climada_tc_track_quality_check(tc_track)
 EXAMPLE:
   tc_track=climada_tc_read_unisys_database('tracks.atl.txt');
 INPUTS:
   tc_track: a tc_track structure, as returned by
       climada_tc_read_unisys_database or climada_tc_read_unisys_tc_track
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   tc_track: the tc_track structure, quality checked and cleaned up.
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170125, initial, moved from climada_tc_track_info to a separate routine
View <A HREF=file:../../climada/code/helper_functions/climada_tc_track_quality_check.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_windfield_nodes">
<H2>climada_tc_windfield_nodes</H2></A>
<font color="blue">function [gust_i,gust_j,gust_v,gust_n,n_nodes,n_centroids] = climada_tc_windfield_nodes(tc_track,centroids,wind_threshold,arr_density,return_max) </font>
 TC windfield calculation
 MODULE:
   core
 NAME:
   climada_tc_windfield_nodes
 PURPOSE:
   stripped-down version of climada_tc_windfield, see climada_tc_windfield
   treats extratropical transition. NO argument check for speedup.

   Key difference: this code does return the single-step windfields for
   each node of the track, i.e. gust is of dimension n_nodes x n_centroids
   (while climada_tc_windfield just returns the max gust over all nodes).

   The code returns i,j,v to construct a sparse array (see OUTPUTS).

   to TEST this code, uncomment all the TEST section at the beginning and
   the end of the code. There is a switch in the PARAMETERS section, in
   order to allow easy on/off during TESTs. But commenting all TEST out
   makes the code slightly faster in fully operational mode (very
   millisecond counts if called millions of times...).

   Do NOT use this code except wehn calling from climada_event_damage_data_tc
 CALLING SEQUENCE:
   [gust_i,gust_j,gust_v,gust_n,n_nodes,n_centroids]=climada_tc_windfield_nodes(tc_track,centroids,wind_threshold,arr_density,return_max)
 EXAMPLE:
   see climada_event_damage_data_tc, in essence
   [gust_i,gust_j,gust_v,gust_n,n_nodes,n_centroids]=climada_tc_windfield_nodes(tc_track,centroids,15,0.01,0)
   gust=sparse(gust_i,gust_j,gust_v,n_nodes,n_centroids);
 INPUTS:
   tc_track: a structure with the single track information (length(tc_track)!=1)
       see e.g. climada_tc_read_unisys_tc_track
       tc_track.Azimuth and/or tc_track.Celerity calculated, if not existing
       but climada_tc_equal_timestep mist have been run and
       tc_track.MaxSustainedWind must exist on input
    PLUS fields Celerity, cos_lat, node_dx, node_dy and node_len need to
       exist (see climada_event_damage_data_tc_viz, for speedup resons)
   centroids: a structure with the centroids information (see e.g.
       climada_centroids_read):
       centroids.lat: the latitude of the centroids
       centroids.lon: the longitude of the centroids
   wind_threshold: threshold above which we calculate the windfield,
       best set to 15 [m/s]. For speedup, we do no default setting or
       the like here.
   arr_density: the density of the sparse array, i.. to estimate the
       non-zero elements, a good starting value is 0.01, but it depends on the
       geographical scope and density of centroids vis-a-vis the extent of the
       wind field.
   return_max: if =1, return only the maximum windspeed at each centroid.
       Default=0, to return windspeed for all nodes (i.a. all times)
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   gust_i: i-index of non-zero gust elements, empty if no node had any
       wind above wind_threshold at any centroid
   gust_j: j-index of non-zero gust elements
   gust_v: value of non-zero gust elements, gust windfield in [m/s] at
       node gust_i for centroid gust_j
   gust_n: the number of elements in gust_i,gust_j and gust_v each
       =length(gust_i), but faster to pass on
   n_nodes: number of nodes
   n_centroids: number of centroids
   -&ampgt convert output to sparse array by:
      gust=sparse(gust_i,gust_j,gust_v,n_nodes,n_centroids);
 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170225, copy from climada_tc_windfield
 David N. Bresch, david.bresch@gmail.com, 20170227, massive speedup, explicit construction of sparse array
 David N. Bresch, david.bresch@gmail.com, 20170228, further speedup, return i,j,v of sparse array
View <A HREF=file:../../climada/code/helper_functions/climada_tc_windfield_nodes.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_template">
<H2>climada_template</H2></A>
<font color="blue">function res=climada_template(param1,param2) </font>
 climada template
 MODULE:
   module name
 NAME:
   climada_template
 PURPOSE:
   &ampltdescribe purpose and use here&ampgt

   NOTE: this template also contains the use of climada_progress2stdout

   previous call: &ampltnote the most usual previous call here&ampgt
   next call: &ampltnote the most usual next function call here&ampgt
 CALLING SEQUENCE:
   res=climada_template(param1,param2);
 EXAMPLE:
   climada_template(param1,param2);
 INPUTS:
   param1:
       &ampgt promted for if not given
   OPTION param1: a structure with the fields...
       this way, parameters can be passed on a fields, see below
 OPTIONAL INPUT PARAMETERS:
   param2: as an example
 OUTPUTS:
   res: the output, empty if not successful
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160603
 David N. Bresch, david.bresch@gmail.com, 20170212, climada_progress2stdout
 David N. Bresch, david.bresch@gmail.com, 20170313, reverted from erroneous save under another name
View <A HREF=file:../../climada/code/helper_functions/climada_template.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tif2assets">
<H2>climada_tif2assets</H2></A>
<font color="blue">function assets = climada_tif2assets(tif_file,check_plot,verbose) </font>
 climada_tif2assets
 MODULE:
   climada code/helperfunctions
 NAME:
   climada_tif2assets
 PURPOSE:
   create climada assets structure from a tif-file, create .lon, .lat,
   .Values as given in tif-file, transform transform tif-units to Values
   with weights given in tif_file.tif_value and tif_file.asset_weights
 CALLING SEQUENCE:
   assets = climada_tif2assets(tif_file,check_plot,verbose)
 EXAMPLE:
   assets = climada_tif2assets
 INPUTS: 
 OPTIONAL INPUT PARAMETERS:
   tif_file: a struct with the following fields, prompted for if not given
   .filename: prompted for if not given. Tif_file is the filename, the file
           contains raster data information.
   .lon_lat_min_max: i.e. [99 100 2 3], define lon min, lon max, lat min, 
           lat max for the gridded data. 
   .lon_lat_min_max_selection: i.e. [99 99.5 2 2.5], define the subset of 
           the data that you want with lon min, lon max, lat min, lat max
   .NODATA_value: i.e. -9999, this data will be overwritten with 0
   .tif_value: i.e. [0 1 2 3], values as given in tif-file
   .asset_weights: i.e. [0 5 80 15]/100, these are the weights assigned to
           the tif-file values, i.e. 5% for 1, 80% for 2 and 15 for 3.
   check_plot: set to 1 to see a figure, default is 0
   verbose: get fprint information in the command line, default is 0
 OUTPUTS: 
   a climada assets structure, with fields .lon, .lat, .Value,
       .Deductible, etc
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20160408, init
View <A HREF=file:../../climada/code/helper_functions/climada_tif2assets.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_waterfall_graph_advanced">
<H2>climada_waterfall_graph_advanced</H2></A>
<font color="blue">function climada_waterfall_graph_advanced(return_period, check_printplot, EDS1, EDS2, EDS3, EDS4, EDS5, EDS6) </font>
 climada water fall plot adapatation cost
 NAME:
   climada_waterfall_graph
 PURPOSE:
   waterfall figure, expected loss for specified return period for
   - today,
   - increase from economic growth,
   - increase from high climate change, total expected loss 2030
   for the n EDS passed on
 CALLING SEQUENCE:
   climada_waterfall_graph(return_period,check_printplot,EDS1, EDS2, EDS3,...)
 EXAMPLES:
   climada_waterfall_graph_advanced('AEL',0,EDS_2014,EDS_2030)
 INPUTS:
   return_period:  requested return period for according expected loss (e.g. =100),or
                   annual expted loss (='AEL'), prompted if not given
   check_printplot:if set to 1, figure saved, default 0.
 OPTIONAL INPUT PARAMETERS:
   EDSn: Event damage set, see e.g. climada_EDS_calc
 OUTPUTS:
   waterfall graph
 MODIFICATION HISTORY:
 Lea Mueller, 20110622
 Martin Heynen, 20120307
 david.bresch@gmail.com, 20140804, GIT update
 david.bresch@gmail.com, 20141020, moved from tc_rain to core climada
View <A HREF=file:../../climada/code/helper_functions/climada_waterfall_graph_advanced.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_waterfall_graph_animation">
<H2>climada_waterfall_graph_animation</H2></A>
<font color="blue">function climada_waterfall_graph_animation(EDS1, EDS2, EDS3) </font>
 waterfall figure, expected damage for specified return period for 
 - today,
 - increase from economic growth, 
 - increase from high climate change, total expected damage 2030
 for the three EDS quoted above
 NAME:
   climada_waterfall_graph_animation
 PURPOSE:
   plot expected damage for specific return period
 CALLING SEQUENCE:
   climada_waterfall_graph_animation(EDS1, EDS2, EDS3)
 EXAMPLE:
   climada_waterfall_graph_animation
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   EDS:            three event damage sets 
                   - today
                   - economic growth
                   - cc combined with economic growth, future       
 OUTPUTS:
   waterfall graph animation
 MODIFICATION HISTORY:
 Lea Mueller, 20110622
 David N. Bresch, david.bresch@gmail.com, 20130316, ELS-&ampgtEDS...
View <A HREF=file:../../climada/code/helper_functions/climada_waterfall_graph_animation.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_workshop_step_by_step">
<H2>climada_workshop_step_by_step</H2></A>
 climada template
 MODULE:
   core
 NAME:
   climada_workshop_step_by_step
 PURPOSE:
   batch file to TEST the climada exercise, first, it calls 
   climada_demo_step_by_step then runs all commands as in
   climada_workshop_step_by_step.docx (.pdf) 

   See also climada_demo_step_by_step

 CALLING SEQUENCE:
   climada_workshop_step_by_step
 EXAMPLE:
   climada_workshop_step_by_step
 INPUTS:
   none, a batch file
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160829, initial
View <A HREF=file:../../climada/code/helper_functions/climada_workshop_step_by_step.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_xlsread">
<H2>climada_xlsread</H2></A>
<font color="blue">function res=climada_xlsread(interactive_mode,excel_file,in_excel_sheet,silent_mode,misdat_value,misdat_out_value) </font>
 climada excel data import read
 NAME:
   climada_xlsread
 PURPOSE:
   read one Excel sheet from an Excel file and return the content in a
   structure.

   Usually, just read each column of the Excel tab into one variable.

   NOTE: for older MATLAB versions, only the array-type input works, not
   the single variables (header) etc.

   OCTAVE: Please install the io package first, ether directly from source
   forge with: pkg install -forge io -auto
   or, (e.g. in case this fails, get the io package first from Octave
   source forge and then install from the downloaded package:
   pkg install {local_path}/io-2.2.5.tar -auto
   Note that it looks like Octave prefers .xlsx files

   The sheet might contain as many single variables (a header)
   and in the second part (data) as many columns as you like.
   % preceedes rows used for comment
   * denotes single variables (scalars) all read as text, the string after
       the asterix is used as variable name and the next right cell as value.
       Any further cells to the right are not processed (eg used for comments,
       as shown below)
   the last row before the data section is used to label the data columns

   an Excel sheet of eg the following form will be processed:

 %climada post event TC trackdata sheet, fill in at least the bold data, either MaxSustainedWind or Pressure?
 *event_date	20030906	the date as yyyymmdd
 *event_name	Isabel	    the name
 *MaxSustainedWindUnit	kn	either kn (also use kn for kt), mph, km/h or m/s
 *CentralPressureUnit	mb	mb or hPa
 *CelerityUnit	kn	        either kn, mph, km/h or m/s
 *track_timestep	6	    in hours, used in Celerity calculation if Celerity and/or time not given below
 *unique_ID	0	        default=0
 *MaxSaffSimp	4	        maximum Safir Simson scale reached
 *record_date	20030919	date of this record
 *comment	test	        free comment
 %follows the track data (next line are headers, fill in as much as you know, do NOT change headers!)
 lat	lon	                MaxSustainedWind	CentralPressure	Celerity	SaffSimp	time	yyyy	mm	dd
 14	-34	61.775			0	                                                            13	2003	9	6
 13.6	-34.5	61.775	    0	                                                            15	2003	9	6
   ...
 13.4	-35.4	79.425		0	                                                            21	2003	9	6

   and returned in a structure like:

   res.event_date='20030906'
   res.event_name='Isabel'
   ...
   res.comment='test'
   res.lat the vector hold all latitudes
   res.lon the vector holding all longitides
   res.MaxSustainedWind the windspeed vector
   ...
   res.dd the day number vector

   note that empty columns (like CentralPressure) are skipped
 CALLING SEQUENCE:
   res=climada_xlsread(interactive_mode,excel_file,in_excel_sheet,silent_mode,misdat_value,misdat_out_value)
 EXAMPLE:
   res=climada_xlsread(interactive_mode,excel_file,in_excel_sheet);
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   interactive_mode: 'interactive' or 'no'. If interactive, the user gets
       prompted for the sheet in the Excel file
       (Currently hard-wired to interactive)
   excel_file: the Excel file to read
   in_excel_sheet: the Excel sheet to read in the excel_file
   silent_mode: if =1, do not write messages to stdout, default=0, means writing
   misdat_value: a missing date value, all numeric data of exatly this
       value are ste to NaN, default is no missing data treatment, i.e.
       misdat_value=[].
   misdat_out_value: the value missing data is set to on output,
       default=NaN. Only active if misdat_value is set
 OUTPUTS:
   res: a structure holding the data from the selected Excel sheet. Note
       that colunm headers that contain a number (xxx) are named VALxxx 
       in the structure
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20020901, 20080924
 Lea Mueller, muellele@gmail.com, 20120730, if ~isempty(NUMERIC) also possible
 David N. Bresch, david.bresch@gmail.com, 20141230, misdat_value added
 David N. Bresch, david.bresch@gmail.com, 20150101, simplified if file and sheet provided (no check for sheet to exist)
 David N. Bresch, david.bresch@gmail.com, 20150227, finally, column headers with numbers are named VALxxxx
 Lea Mueller, muellele@gmail.com, 20150505, bugfix for difficult header name
 David N. Bresch, david.bresch@gmail.com, 20160527, misdat_out_value introduced
View <A HREF=file:../../climada/code/helper_functions/climada_xlsread.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="compile_all_function_headers">
<H2>compile_all_function_headers</H2></A>
<font color="blue">function compile_all_function_headers(output_file) </font>
 climada
 NAME:
   compile_all_function_headers
 PURPOSE:
   Crawl through all active climada code and modules and compile a file
   with ALL function headers (comes very handy as a raw documentation).

   Omits modules starting with _ (underscore) and code subfolders
   starting with @

 CALLING SEQUENCE:
   compile_all_function_headers(output_file)
 EXAMPLE:
   compile_all_function_headers
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   output_file: file to write (.txt or .html)
       set to ../climada/docs/code_overview.html by default
 OUTPUTS:
   writes the file ../climada/docs/code_overview.html
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141107, initial (on flight to Dubai)
 David N. Bresch, david.bresch@gmail.com, 20160609, standardized, one sub-code level
 David N. Bresch, david.bresch@gmail.com, 20160609, relative paths for source code
View <A HREF=file:../../climada/code/helper_functions/compile_all_function_headers.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cprintf">
<H2>cprintf</H2></A>
<font color="blue">function count = cprintf(style,format,varargin) </font>
 CPRINTF displays styled formatted text in the Command Window

 Syntax:
    count = cprintf(style,format,...)

 Description:
    CPRINTF processes the specified text using the exact same FORMAT
    arguments accepted by the built-in SPRINTF and FPRINTF functions.

    CPRINTF then displays the text in the Command Window using the
    specified STYLE argument. The accepted styles are those used for
    Matlab's syntax highlighting (see: File / Preferences / Colors /
    M-file Syntax Highlighting Colors), and also user-defined colors.

    The possible pre-defined STYLE names are:

       'Text'                 - default: black
       'Keywords'             - default: blue
       'Comments'             - default: green
       'Strings'              - default: purple
       'UnterminatedStrings'  - default: dark red
       'SystemCommands'       - default: orange
       'Errors'               - default: light red
       'Hyperlinks'           - default: underlined blue

       'Black','Cyan','Magenta','Blue','Green','Red','Yellow','White'

    STYLE beginning with '-' or '_' will be underlined. For example:
          '-Blue' is underlined blue, like 'Hyperlinks';
          '_Comments' is underlined green etc.

    STYLE beginning with '*' will be bold (R2011b+ only). For example:
          '*Blue' is bold blue;
          '*Comments' is bold green etc.
    Note: Matlab does not currently support both bold and underline,
          only one of them can be used in a single cprintf command. But of
          course bold and underline can be mixed by using separate commands.

    STYLE also accepts a regular Matlab RGB vector, that can be underlined
    and bolded: -[0,1,1] means underlined cyan, '*[1,0,0]' is bold red.

    STYLE is case-insensitive and accepts unique partial strings just
    like handle property names.

    CPRINTF by itself, without any input parameters, displays a demo

 Example:
    cprintf;   % displays the demo
    cprintf('text',   'regular black text');
    cprintf('hyper',  'followed %s','by');
    cprintf('key',    '%d colored', 4);
    cprintf('-comment','&amp underlined');
    cprintf('err',    'elements\n');
    cprintf('cyan',   'cyan');
    cprintf('_green', 'underlined green');
    cprintf(-[1,0,1], 'underlined magenta');
    cprintf([1,0.5,0],'and multi-\nline orange\n');
    cprintf('*blue',  'and *bold* (R2011b+ only)\n');
    cprintf('string');  % same as fprintf('string') and cprintf('text','string')

 Bugs and suggestions:
    Please send to Yair Altman (altmany at gmail dot com)

 Warning:
    This code heavily relies on undocumented and unsupported Matlab
    functionality. It works on Matlab 7+, but use at your own risk!

    A technical description of the implementation can be found at:
    &amplta href=&quothttp://undocumentedmatlab.com/blog/cprintf/&quot&ampgthttp://UndocumentedMatlab.com/blog/cprintf/&amplt/a&ampgt

 Limitations:
    1. In R2011a and earlier, a single space char is inserted at the
       beginning of each CPRINTF text segment (this is ok in R2011b+).

    2. In R2011a and earlier, consecutive differently-colored multi-line
       CPRINTFs sometimes display incorrectly on the bottom line.
       As far as I could tell this is due to a Matlab bug. Examples:
         &ampgt&ampgt cprintf('-str','under\nline'); cprintf('err','red\n'); % hidden 'red', unhidden '_'
         &ampgt&ampgt cprintf('str','regu\nlar'); cprintf('err','red\n'); % underline red (not purple) 'lar'

    3. Sometimes, non newline ('\n')-terminated segments display unstyled
       (black) when the command prompt chevron ('&ampgt&ampgt') regains focus on the
       continuation of that line (I can't pinpoint when this happens).
       To fix this, simply newline-terminate all command-prompt messages.

    4. In R2011b and later, the above errors appear to be fixed. However,
       the last character of an underlined segment is not underlined for
       some unknown reason (add an extra space character to make it look better)

    5. In old Matlab versions (e.g., Matlab 7.1 R14), multi-line styles
       only affect the first line. Single-line styles work as expected.
       R14 also appends a single space after underlined segments.

    6. Bold style is only supported on R2011b+, and cannot also be underlined.

 Change log:
    2012-08-09: Graceful degradation support for deployed (compiled) and non-desktop applications; minor bug fixes
    2012-08-06: Fixes for R2012b; added bold style; accept RGB string (non-numeric) style
    2011-11-27: Fixes for R2011b
    2011-08-29: Fix by Danilo (FEX comment) for non-default text colors
    2011-03-04: Performance improvement
    2010-06-27: Fix for R2010a/b; fixed edge case reported by Sharron; CPRINTF with no args runs the demo
    2009-09-28: Fixed edge-case problem reported by Swagat K
    2009-05-28: corrected nargout behavior sugegsted by Andreas G?b
    2009-05-13: First version posted on &amplta href=&quothttp://www.mathworks.com/matlabcentral/fileexchange/authors/27420&quot&ampgtMathWorks File Exchange&amplt/a&ampgt

 See also:
    sprintf, fprintf

 License to use and modify this code is granted freely to all interested, as long as the original author is
 referenced and attributed as such. The original author maintains the right to be solely associated with this work.

 Programmed and Copyright by Yair M. Altman: altmany(at)gmail.com
 $Revision: 1.08 $  $Date: 2012/10/17 21:41:09 $
View <A HREF=file:../../climada/code/helper_functions/cprintf.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="freezeColors">
<H2>freezeColors</H2></A>
<font color="blue">function freezeColors(varargin) </font>
 freezeColors  Lock colors of plot, enabling multiple colormaps per figure. (v2.3)

   Problem: There is only one colormap per figure. This function provides
       an easy solution when plots using different colomaps are desired
       in the same figure.

   freezeColors freezes the colors of graphics objects in the current axis so
       that subsequent changes to the colormap (or caxis) will not change the
       colors of these objects. freezeColors works on any graphics object
       with CData in indexed-color mode: surfaces, images, scattergroups,
       bargroups, patches, etc. It works by converting CData to true-color rgb
       based on the colormap active at the time freezeColors is called.

   The original indexed color data is saved, and can be restored using
       unfreezeColors, making the plot once again subject to the colormap and
       caxis.


   Usage:
       freezeColors        applies to all objects in current axis (gca),
       freezeColors(axh)   same, but works on axis axh.

   Example:
       subplot(2,1,1); imagesc(X); colormap hot; freezeColors
       subplot(2,1,2); imagesc(Y); colormap hsv; freezeColors etc...

       Note: colorbars must also be frozen. Due to Matlab 'improvements' this can
				no longer be done with freezeColors. Instead, please
				use the function CBFREEZE by Carlos Adrian Vargas Aguilera
				that can be downloaded from the MATLAB File Exchange
				(http://www.mathworks.com/matlabcentral/fileexchange/24371)

       h=colorbar; cbfreeze(h), or simply cbfreeze(colorbar)

       For additional examples, see test/test_main.m

   Side effect on render mode: freezeColors does not work with the painters
       renderer, because Matlab doesn't support rgb color data in
       painters mode. If the current renderer is painters, freezeColors
       changes it to zbuffer. This may have unexpected effects on other aspects
	      of your plots.

       See also unfreezeColors, freezeColors_pub.html, cbfreeze.


   John Iversen (iversen@nsi.edu) 3/23/05

   Changes:
   JRI (iversen@nsi.edu) 4/19/06   Correctly handles scaled integer cdata
   JRI 9/1/06   should now handle all objects with cdata: images, surfaces,
                scatterplots. (v 2.1)
   JRI 11/11/06 Preserves NaN colors. Hidden option (v 2.2, not uploaded)
   JRI 3/17/07  Preserve caxis after freezing--maintains colorbar scale (v 2.3)
   JRI 4/12/07  Check for painters mode as Matlab doesn't support rgb in it.
   JRI 4/9/08   Fix preserving caxis for objects within hggroups (e.g. contourf)
   JRI 4/7/10   Change documentation for colorbars

 Hidden option for NaN colors:
   Missing data are often represented by NaN in the indexed color
   data, which renders transparently. This transparency will be preserved
   when freezing colors. If instead you wish such gaps to be filled with
   a real color, add 'nancolor',[r g b] to the end of the arguments. E.g.
   freezeColors('nancolor',[r g b]) or freezeColors(axh,'nancolor',[r g b]),
   where [r g b] is a color vector. This works on images &amp pcolor, but not on
   surfaces.
   Thanks to Fabiano Busdraghi and Jody Klymak for the suggestions. Bugfixes
   attributed in the code.

 Free for all uses, but please retain the following:
   Original Author:
   John Iversen, 2005-10
   john_iversen@post.harvard.edu
View <A HREF=file:../../climada/code/helper_functions/freezeColors.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="gauss_distribution">
<H2>gauss_distribution</H2></A>
<font color="blue">function f = gauss_distribution(x, mu, s) </font>
View <A HREF=file:../../climada/code/helper_functions/gauss_distribution.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="git">
<H2>git</H2></A>
<font color="blue">function git(varargin) </font>
 A thin MATLAB wrapper for Git.
 
   Short instructions:
       Use this exactly as you would use the OS command-line verison of Git.
 
   Long instructions are:
       This is not meant to be a comprehensive guide to the near-omnipotent 
       Git SCM:
           http://git-scm.com/documentation
 
       Common MATLAB workflow: 
 
       % Creates initial repository tracking all files under some root
       % folder
       &ampgt&ampgt cd ~/
       &ampgt&ampgt git init

       % Shows changes made to all files in repo (none so far)
       &ampgt&ampgt git status

       % Create a new file and add some code
       &ampgt&ampgt edit foo.m

       % Check repo status, after new file created
       &ampgt&ampgt git status

       % Stage/unstage files for commit
       &ampgt&ampgt git add foo.m          % Add file to repo or to stage
       &ampgt&ampgt git reset HEAD .       % To unstage your files from current commit area

       % Commit your changes to a new branch, with comments
       &ampgt&ampgt git commit -m 'Created new file, foo.m'
 
       % Other useful commands (replace ellipses with appropriate args)
       &ampgt&ampgt git checkout ...       % To restore files to last commit
       &ampgt&ampgt git branch ...         % To create or move to another branch
       &ampgt&ampgt git diff ...           % See line-by-line changes 

   Useful resources:
       1. GitX: A visual interface for Git on the OS X client
       2. Github.com: Remote hosting for Git repos
       3. Git on Wikipedia: Further reading 
 
 v0.1,     27 October 2010 -- MR: Initial support for OS X &amp Linux,
                               untested on PCs, but expected to work
 
 v0.2,     11 March 2011   -- TH: Support for PCs
 
 v0.3,     12 March 2011   -- MR: Fixed man pages hang bug using redirection
 
 Contributors: (MR) Manu Raghavan
               (TH) Timothy Hansell
 david.bresch@gmail.com, 20161002, more(..) commented to run in Octave
View <A HREF=file:../../climada/code/helper_functions/git.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="hist2d">
<H2>hist2d</H2></A>
<font color="blue">function [X,Y,H] = hist2d(D,Xn,Yn,Xrange,Yrange) </font>
 Calculates and returns the 2 Dimensional Histogram of D.
 D must be a 2 column or 2 row matrix or an array of complex numbers
 Example:
 hist2d([randn(1,10000); randn(1,10000)])

 used for climada_distribution_lon_lat
View <A HREF=file:../../climada/code/helper_functions/hist2d.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isassets">
<H2>isassets</H2></A>
<font color="blue">function ok = isassets(assets) </font>
 check if valid assets struct
 MODULE:
   core
 NAME:
   isassets
 PURPOSE:
   For quick arg checking, defining and standardising assets structs to have the
   minimum required fields
 PREVIOUS STEP:
 CALLING SEQUENCE:
   ok = isassets(assets)
 EXAMPLE:
   ok = isassets(assets)
 INPUTS:
   assets:     any struct
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   ok:         1 if input satisfies the conditions to be an assets struct
               0 otherwise
 MODIFICATION HISTORY:
   Gilles Stassen, gillesstassen@hotmail.com, 20150826 init
View <A HREF=file:../../climada/code/helper_functions/isassets.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="iscentroids">
<H2>iscentroids</H2></A>
<font color="blue">function ok = iscentroids(centroids) </font>
 check if valid centroids struct
 MODULE:
   core
 NAME:
   iscentroids
 PURPOSE:
   For quick arg checking, defining and standardising centroids structs to have the
   minimum required fields
 PREVIOUS STEP:
 CALLING SEQUENCE:
   ok = iscentroids(centroids)
 EXAMPLE:
   ok = iscentroids(centroids)
 INPUTS:
   centroids:     any struct
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   ok:         1 if input satisfies the conditions to be an centroids struct
               0 otherwise
 MODIFICATION HISTORY:
   Gilles Stassen, gillesstassen@hotmail.com, 20150826 init
View <A HREF=file:../../climada/code/helper_functions/iscentroids.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isdamagefunctions">
<H2>isdamagefunctions</H2></A>
<font color="blue">function ok = isdamagefunctions(damagefunctions) </font>
 check if valid damagefunctions struct
 MODULE:
   core
 NAME:
   isdamagefunctions
 PURPOSE:
   For quick arg checking, defining and standardising damagefunctions 
   structs to have the minimum required fields.
 PREVIOUS STEP:
 CALLING SEQUENCE:
   ok = isdamagefunctions(damagefunctions)
 EXAMPLE:
   ok = isdamagefunctions(damagefunctions)
 INPUTS:
   damagefunctions:     any struct
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   ok:         1 if input satisfies the conditions to be an entity struct
               0 otherwise
 MODIFICATION HISTORY:
   Gilles Stassen, gillesstassen@hotmail.com, 20150826 init
View <A HREF=file:../../climada/code/helper_functions/isdamagefunctions.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isentity">
<H2>isentity</H2></A>
<font color="blue">function ok = isentity(entity) </font>
 check if valid entity struct
 MODULE:
   core
 NAME:
   isentity
 PURPOSE:
   For quick arg checking, defining and standardising entity structs to have the
   minimum required fields. For the entity, .assets and .damagefunctions
   are required, function gives warning if entity doesn't contain
   .measures or .discount fields, but still returns 1. Function calls
   isassets and isdamagefunctions
 PREVIOUS STEP:
 CALLING SEQUENCE:
   ok = isentity(entity)
 EXAMPLE:
   ok = isentity(entity)
 INPUTS:
   entity:     any struct
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   ok:         1 if input satisfies the conditions to be an entity struct
               0 otherwise
 MODIFICATION HISTORY:
   Gilles Stassen, gillesstassen@hotmail.com, 20150826 init
View <A HREF=file:../../climada/code/helper_functions/isentity.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="ishazard">
<H2>ishazard</H2></A>
<font color="blue">function ok = ishazard(hazard) </font>
 check if valid hazard struct
 MODULE:
   core
 NAME:
   ishazard
 PURPOSE:
   For quick arg checking, defining and standardising hazard structs to have the
   minimum required fields.
 PREVIOUS STEP:
 CALLING SEQUENCE:
   ok = ishazard(hazard)
 EXAMPLE:
   ok = ishazard(hazard)
 INPUTS:
   hazard:     any struct to be checked
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   ok:         1 if input satisfies the conditions to be a hazard struct
               0 otherwise
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150826 init
 David N. Bresch, david.bresch@gmail.com, 20161008, units, orig_event_flag, yyyy, mm, dd, datenum and reference_year are optional
 David N. Bresch, david.bresch@gmail.com, 20170225, even lon and lat are optional
View <A HREF=file:../../climada/code/helper_functions/ishazard.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="makeColorMap">
<H2>makeColorMap</H2></A>
<font color="blue">function cMap = makeColorMap(varargin) </font>
 MAKECOLORMAP makes smoothly varying colormaps
 a = makeColorMap(beginColor, middleColor, endColor, numSteps);
 a = makeColorMap(beginColor, endColor, numSteps);
 a = makeColorMap(beginColor, middleColor, endColor);
 a = makeColorMap(beginColor, endColor);

 all colors are specified as RGB triples
 numSteps is a scalar saying howmany points are in the colormap

 Examples:

 peaks;
 a = makeColorMap([1 0 0],[1 1 1],[0 0 1],40);
 colormap(a)
 colorbar

 peaks;
 a = makeColorMap([1 0 0],[0 0 1],40);
 colormap(a)
 colorbar

 peaks;
 a = makeColorMap([1 0 0],[1 1 1],[0 0 1]);
 colormap(a)
 colorbar

 peaks;
 a = makeColorMap([1 0 0],[0 0 1]);
 colormap(a)
 colorbar

 Reference:
 A. Light &amp P.J. Bartlein, &quotThe End of the Rainbow? Color Schemes for
 Improved Data Graphics,&quot Eos,Vol. 85, No. 40, 5 October 2004.
 http://geography.uoregon.edu/datagraphics/EOS/Light&ampBartlein_EOS2004.pdf
View <A HREF=file:../../climada/code/helper_functions/makeColorMap.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="mygaussfit">
<H2>mygaussfit</H2></A>
<font color="blue">function [sigma,mu,A] = mygaussfit(x,y,h) </font>

 this function is doing fit to the function
 y = A * exp( -(x-mu)^2 / (2*sigma^2) )

 the fitting is been done by a polyfit
 the lan of the data.

 h is the threshold which is the fraction
 from the maximum y height that the data
 is been taken from.
 h should be a number between 0-1.
 if h have not been taken it is set to be 0.2
 as default.

 used in climada_distribution_v0_vi
View <A HREF=file:../../climada/code/helper_functions/mygaussfit.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="nanmax">
<H2>nanmax</H2></A>
<font color="blue">function [varargout] = nanmax(varargin) </font>
NANMAX Maximum value, ignoring NaNs.
   M = NANMAX(A) returns the maximum of A with NaNs treated as missing. 
   For vectors, M is the largest non-NaN element in A.  For matrices, M is
   a row vector containing the maximum non-NaN element from each column.
   For N-D arrays, NANMAX operates along the first non-singleton
   dimension.

   [M,NDX] = NANMAX(A) returns the indices of the maximum values in A.  If
   the values along the first non-singleton dimension contain more than
   one maximal element, the index of the first one is returned.
  
   M = NANMAX(A,B) returns an array the same size as A and B with the
   largest elements taken from A or B.  Either one can be a scalar.

   [M,NDX] = NANMAX(A,[],DIM) operates along the dimension DIM.

   See also MAX, NANMIN, NANMEAN, NANMEDIAN, NANMIN, NANVAR, NANSTD.
   Copyright 1993-2004 The MathWorks, Inc. 
View <A HREF=file:../../climada/code/helper_functions/nanmax.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="nanmean">
<H2>nanmean</H2></A>
<font color="blue">function m = nanmean(x,dim) </font>
NANMEAN Mean value, ignoring NaNs.
   M = NANMEAN(X) returns the sample mean of X, treating NaNs as missing
   values.  For vector input, M is the mean value of the non-NaN elements
   in X.  For matrix input, M is a row vector containing the mean value of
   non-NaN elements in each column.  For N-D arrays, NANMEAN operates
   along the first non-singleton dimension.

   NANMEAN(X,DIM) takes the mean along dimension DIM of X.

   See also MEAN, NANMEDIAN, NANSTD, NANVAR, NANMIN, NANMAX, NANSUM.
   Copyright 1993-2004 The MathWorks, Inc.
View <A HREF=file:../../climada/code/helper_functions/nanmean.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="parseArgs">
<H2>parseArgs</H2></A>
<font color="blue">function ArgStruct=parseArgs(args,ArgStruct,varargin) </font>
 Helper function for parsing varargin. 


 ArgStruct=parseArgs(varargin,ArgStruct[,FlagtypeParams[,Aliases]])

 * ArgStruct is the structure full of named arguments with default values.
 * Flagtype params is params that don't require a value. (the value will be set to 1 if it is present)
 * Aliases can be used to map one argument-name to several argstruct fields


 example usage: 
 --------------
 function parseargtest(varargin)

 %define the acceptable named arguments and assign default values
 Args=struct('Holdaxis',0, ...
        'SpacingVertical',0.05,'SpacingHorizontal',0.05, ...
        'PaddingLeft',0,'PaddingRight',0,'PaddingTop',0,'PaddingBottom',0, ...
        'MarginLeft',.1,'MarginRight',.1,'MarginTop',.1,'MarginBottom',.1, ...
        'rows',[],'cols',[]); 

 %The capital letters define abrreviations.  
 %  Eg. parseargtest('spacingvertical',0) is equivalent to  parseargtest('sv',0) 

 Args=parseArgs(varargin,Args, ... % fill the arg-struct with values entered by the user
           {'Holdaxis'}, ... %this argument has no value (flag-type)
           {'Spacing' {'sh','sv'}; 'Padding' {'pl','pr','pt','pb'}; 'Margin' {'ml','mr','mt','mb'}});

 disp(Args)




 % Aslak Grinsted 2003
View <A HREF=file:../../climada/code/helper_functions/parseArgs.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="plot_normal">
<H2>plot_normal</H2></A>
<font color="blue">function plot_normal( x,params,hAx,plot_num,fontsize ) </font>
 plot the normal distribution with parameter &quotu&quot and &quotsig2&quot
 
 the distribution is given by:

        p(r) = sqrt(1/2/pi/sig^2)*exp(-((r-u)^2)/(2*sig^2))

 format:   plot_normal( x,params,hAx,plot_num,fontsize )

 input:    x         - X axis, for the plot
           params    - the distribution parameter, RMS error and VAR or CRB
           hAx       - where to plot the distribution curve
           plot_num  - since the curve is added with a text to the axes,
                       this parameter specifies where the text should be displayed
                       and what color to choose for the curve
           fontsize  - size of the font of the text, default 9


 example:  plot_normal( x,fit_ML_normal(data),hAx,3 )
View <A HREF=file:../../climada/code/helper_functions/plot_normal.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="plotclr">
<H2>plotclr</H2></A>
<font color="blue">function [h, h_points] = plotclr(x,y,v, marker, markersize, colorbar_on, miv, mav, map, zero_off, v_exp) </font>
FUNCTION PLOTC(X,Y,V,'MARKER') plots the values of v colour coded
 at the positions specified by x and y, and v (z-axis) in a 3-D axis
 system. A colourbar is added on the right side of the figure.

 The colorbar strectches from the minimum value of v to its
 maximum in 9 steps (10 values).

 The last argument is optional to define the marker being used. The
 default is a point. To use a different marker (such as circles, ...) send
 its symbol to the function (which must be enclosed in '; see example).

 The plot is actually a 3D plot but the orientation of the axis is set
 such that it appears to be a plane 2D plot. However, you can toggle
 between 2D and 3D view either by using the command 'view(3)' (for 3D
 view) or 'view(2)' (for 2D), or by interactively rotating the axis
 system.

 Example:
 Define three vectors
    x=1:10;y=1:10;p=randn(10,1);
    plotc(x,y,p)

    x=randn(100,1);
    y=2*x+randn(100,1);
    p=randn(100,1);
    plotc(x,y,p,'d')
    view(3)

 Uli Theune, University of Alberta, 2004
 modified by Stephanie Contardo, British Oceanographic Data Centre, 2006
 Lea Mueller, muellele@gmail.com, 20150728, plot values above threshold mav 
 Lea Mueller, muellele@gmail.com, 20151130, bugfix colorbar if all values are equal
 Lea Mueller, muellele@gmail.com, 20151207, include climada_global.markersize
 Lea Mueller, muellele@gmail.com, 20151207, include climada_global.marker
 Lea Mueller, muellele@gmail.com, 20161023, plot instead of plot3
View <A HREF=file:../../climada/code/helper_functions/plotclr.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="subaxis">
<H2>subaxis</H2></A>
<font color="blue">function h=subaxis(varargin) </font>
SUBAXIS Create axes in tiled positions. (just like subplot)
   Usage:
      h=subaxis(rows,cols,cellno[,settings])
      h=subaxis(rows,cols,cellx,celly[,settings])
      h=subaxis(rows,cols,cellx,celly,spanx,spany[,settings])

 SETTINGS: Spacing,SpacingHoriz,SpacingVert
           Padding,PaddingRight,PaddingLeft,PaddingTop,PaddingBottom
           Margin,MarginRight,MarginLeft,MarginTop,MarginBottom
           Holdaxis

           all units are relative (e.g from 0 to 1)

           Abbreviations of parameters can be used.. (Eg MR instead of MarginRight)
           (holdaxis means that it wont delete any axes below.)


 Example:

   &ampgt&ampgt subaxis(2,1,1,'SpacingVert',0,'MR',0);
   &ampgt&ampgt imagesc(magic(3))
   &ampgt&ampgt subaxis(2,'p',.02);
   &ampgt&ampgt imagesc(magic(4))

 2001 / Aslak Grinsted  (Feel free to modify this code.)
View <A HREF=file:../../climada/code/helper_functions/subaxis.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="waitbar_toggle">
<H2>waitbar_toggle</H2></A>
<font color="blue">function waitbar_toggle </font>
 climada
 NAME:
   waitbar_toggle
 PURPOSE:
   toggle waitbar (calling once suppresses the waitbar, calling again
   brings it back).

   Simply sets climada_global.waitbar=0, just for ease of use,
   that's why it comes also with a function name without 'climada_'

 CALLING SEQUENCE:
   waitbar_toggle
 EXAMPLE:
   waitbar_toggle
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141123
View <A HREF=file:../../climada/code/helper_functions/waitbar_toggle.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cam_USA_hazard_check">
<H2>cam_USA_hazard_check</H2></A>
<font color="blue">function cam_USA_hazard_check(hazard_set_file,show_plot) </font>
 batch file for CAM analysis
 NAME:
   cam_USA_hazard_check
 PURPOSE:
   check hazard set as generated in the CAM project

   restrict hazard set to 
  
 CALLING SEQUENCE:
   cam_USA_hazard_check(hazard_set_file,show_plot)
 EXAMPLE:
   cam_USA_hazard_check('USA_UnitedStates_Allstorms.ibtracs_all.v03r04_tracfile_TC.mat',0)
   cam_USA_hazard_check('USA_UnitedStates_f.e12.FAMIPC5.ne120_g16.rcp4.5.001_10m_tracfile_TC.mat',0)
   cam_USA_hazard_check('USA_UnitedStates_f.e13.FAMIPC5.ne120_ne120.1979_2012.001_tracfile_TC.mat',0)
   cam_USA_hazard_check('USA_UnitedStates_f.e13.FAMIPC5.ne120_ne120.1979_2012.002_tracfile_TC.mat',0)
   cam_USA_hazard_check('USA_UnitedStates_f.e13.FAMIPC5.ne120_ne120.1979_2012.003_tracfile_TC.mat',0)
   cam_USA_hazard_check('USA_UnitedStates_f.e13.FAMIPC5.ne120_ne120.RCP85_2070_2099_sst3.001_tracfile_TC.mat',0)
   cam_USA_hazard_check('USA_UnitedStates_f.e13.FAMIPC5.ne120_ne120.RCP85_2070_2099.001_tracfile_TC.mat',0)
   cam_USA_hazard_check('USA_UnitedStates_f.e13.FAMIPC5.ne120_ne120.RCP85_2070_2099.002_tracfile_TC.mat',0)
   cam_USA_hazard_check('USA_UnitedStates_f.e13.FAMIPC5.ne120_ne120.RCP85_2070_2099.003_tracfile_TC.mat',0)
   cam_USA_hazard_check('USA_UnitedStates_FAMIPC5_ne120_79to05_03_omp2_10m_tracfile_TC.mat',0)
   cam_USA_hazard_check('USA_UnitedStates_FAMIPC5_ne120_2070to2100_03_omp2_10m_tracfile_TC.mat',0)
 INPUTS:
   hazard_set_file: hazard set filename
 OPTIONAL INPUT PARAMETERS:
   show_plot: if=0, only store as jpg file without showing the plot
       =1: show plot and save as jpg (default)
 OUTPUTS:
   saves jpg files, named accordingly
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 201500806, initial
 David N. Bresch, david.bresch@gmail.com, 201500807, update
View <A HREF=file:../../climada_modules/CAM/code/cam_USA_hazard_check.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cam_batch">
<H2>cam_batch</H2></A>
<font color="blue">function cam_batch(basin_number,cam_dataset) </font>
 batch file for CAM analysis
 NAME:
   cam_batch
 PURPOSE:
   call climdada routines to generate cyclone tracks and loss frequency curves
  
 CALLING SEQUENCE:
   cam_batch(basin_number);
 EXAMPLE:
   cam_batch(1,['wehner'|'present_day'|'rcp45'|'rcp85']);
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   basin_number: the basin numer, see climada_tc_filter_basin
       default=1 for North Atlantic
       currently, only 1 (North Atl) implemetned
 OUTPUTS:
 MODIFICATION HISTORY:  NOTE: SUPERSCEEDED BY cam_batch2.m
 Andrew Gettelman
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir
View <A HREF=file:../../climada_modules/CAM/code/cam_batch.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cam_batch2">
<H2>cam_batch2</H2></A>
<font color="blue">function cam_batch2(basin_number,cam_dataset) </font>
 batch file for CAM analysis
 NAME:
   cam_batch2
 PURPOSE:
   call climdada routines to generate cyclone tracks and loss frequency curves
  
 CALLING SEQUENCE:
   cam_batch(basin_number,cam_dataset);
 EXAMPLE:
   cam_batch(1,['wehner'|'present_day'|'rcp45'|'rcp85']);
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   basin_number: the basin numer, see climada_tc_filter_basin
       default=1 for North Atlantic
       currently, only 1 (North Atl) implemetned
   cam_dataset: ['wehner'|'present_day'|'rcp45'|'rcp85']
 OUTPUTS:
 MODIFICATION HISTORY:
 Andrew Gettelman May 5 2014: based on cam_batch.m  code for original (2012) climada
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir
View <A HREF=file:../../climada_modules/CAM/code/cam_batch2.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cam_batch_multi">
<H2>cam_batch_multi</H2></A>
<font color="blue">function cam_batch_multi(basin_number) </font>
 batch file for CAM analysis
 NAME:
   cam_batch
 PURPOSE:
   call climdada routines to generate cyclone tracks and loss frequency curves
  
 CALLING SEQUENCE:
   cam_batch_multi(basin_number);
 EXAMPLE:
   cam_batch_multi(1);
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   basin_number: the basin numer, see climada_tc_filter_basin
       default=1 for North Atlantic
       currently, only 1 (North Atl) implemetned
 OUTPUTS:
 MODIFICATION HISTORY:
 Andrew Gettelman  May 5, 2014
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
View <A HREF=file:../../climada_modules/CAM/code/cam_batch_multi.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cam_calibrate">
<H2>cam_calibrate</H2></A>
<font color="blue">function cam_calibrate(method,entity_file,hazard) </font>
 climada CAM calibrate damagefunction
 MODULE:
   CAM
 NAME:
   cam_calibrate
 PURPOSE:
   Calibrate damagefunctions for CAM project

   In essence, calc EDS and compare with EM-DAT for the country as in the
   entity. At the moment, only TC (wind) is implemented, only the
   damagefunction definition is peril-dependent, see code below (search
   for PERIL EDIT).

   Standard use: run once with method=0 (checks USA) then run with method=2
   By providing any other 3-digit country ISO code, you can check any
   country by comparison with EM-DAT (see also emdat_read)
   You can check any entitie's damage function(s) with climada_damagefunctions_plot

   Previous call: country_risk_calc('USA',-3) % as for method=0 USA entity
       and TC hazard event set need to exist
 CALLING SEQUENCE:
   cam_calibrate(method,entity_file,hazard)
 EXAMPLE:
   country_risk_calc('USA',-3) % only in case you do not have an entity and hazard set already
   cam_calibrate(0,'USA') % check USA
   cam_calibrate(1,'JPN') % check and save Japan
   cam_calibrate(2,'USA','TC') % calibrate all entities
 INPUTS:
   method: =0 (default), run the calibration for the country as in the entity,
       show results, but do NOT update the damagefunction in the entity
       set =-1 to also show the plot (if=0, the plot is only saved)
       =1: DO update the damagefunction in the entity (i.e. save the
       calibrated damagefunction to the entity) - but do NOT check again
       (use method=0 for this)
       =2: update the damagefunctions in ALL entities. BE CAREFUL, this
       truly OVERWRITES the damagefunctions in ALL entities.
       If run without Xwindows, please pass hazard='TC' in this case
 OPTIONAL INPUT PARAMETERS:
   entity_file: the entity file with assets (today) to be used for calibration
       OR just the 3-digit country code, such as 'USA' - in this case, the
       code also tries to get the hazard filename from entity
       If a filename is given, it needs to be an entity file (with path) NOT entity structure
       &ampgt prompts for file if not given
   hazard: the hzard event set
       Either a hazard set file (with path) or a hazard structure
       &ampgt prompts for file if not given
 OUTPUTS:
   plot, as figure stored to .../results/cam_calibrate_{ISO3}_{peril_ID}.png
       (just saved, not shown, unless method=-1)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150307, initial
View <A HREF=file:../../climada_modules/CAM/code/cam_calibrate.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cam_entity_value_GDP_SSP">
<H2>cam_entity_value_GDP_SSP</H2></A>
<font color="blue">function entity=cam_entity_value_GDP_SSP(entity_file_regexp,target_year,SSP_version) </font>
 scale up asset values
 MODULE:
   CAM
 NAME:
   cam_entity_value_GDP_SSP
 PURPOSE:
   A copy of the original climada_entity_value_GDP_adjust for the CAM
   module. Calls cam_entity_value_GDP_SSP_one, see there for details

   Scale up asset values based on a country's estimated total asset value.

   We first normalize the asset values, then multiply by GDP_value and a
   scale_up_factor based on income group. GDP_value comes from the SSP
   data file (see SSP_data_file in PARAMETER section in code), the
   scale_up_factor from economic_data_file (see PARAMETER section in code)

   Prior calls: e.g. climada_nightlight_entity, country_risk_calc
   Next calls: e.g. country_risk_calc
 CALLING SEQUENCE:
   entity=cam_entity_value_GDP_SSP(entity_file_regexp,target_year,SSP_version)
 EXAMPLE:
   cam_entity_value_GDP_SSP('*_future.mat',2035) % all future for 2035
   cam_entity_value_GDP_SSP('*_*_entity.mat',2015); % all today for 2015
 INPUT:
   entity_file_regexp: the full filename of the entity to be scaled up
       or a regexp expression, e.g. for all entities:
       entity_file_regexp=[climada_global.data_dir filesep 'entities' filesep '*.mat']
       or just a regexp to be evaluated within ../data/entities, such as
       e.g. entity_file_regexp='*future.mat';
 OPTIONAL INPUT PARAMETERS:
   target_year: the year we would like to get the GDP estimates for
       Default=2035, see SSP data file for possible years
   SSP_version: the SSP 3 or 5, hence either 'Ssp3Db' or 'Ssp5Db'. In fact
       this is the name of the tab within the Excel file we read, hence the
       user could also define a new one. Default 'Ssp3Db'
 OUTPUTS:
   entity: entity with adjusted asset values, also stored as .mat file 
   (only last entity if entity_file_regexp covers more than one)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150227, initial
 David N. Bresch, david.bresch@gmail.com, 20150228, finished
View <A HREF=file:../../climada_modules/CAM/code/cam_entity_value_GDP_SSP.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cam_entity_value_GDP_SSP_one">
<H2>cam_entity_value_GDP_SSP_one</H2></A>
<font color="blue">function [entity,ok]=cam_entity_value_GDP_SSP_one(entity,target_year,SSP_version) </font>
 scale up asset values GDP
 MODULE:
   CAM
 NAME:
   cam_entity_value_GDP_SSP_one
 PURPOSE:
   A copy of the original climada_entity_value_GDP_adjust_one for the CAM
   module. Usually called from cam_entity_value_GDP_SSP (which treats a
   series of entities)

   Scale up asset values based on a country's estimated total asset value,
   based on an SSP scenario (SSP_version) and for a target year.

   We first normalize the asset values, then multiply by GDP*PPP*SCL, where
   - GDP comes from the SSP data file, either the Ssp3Db or Ssp5Db tab as
     specified by SSP_version and the column as specified by target_year
     (see SSP_data_file in PARAMETER section in code)
   - PPP, the purchase power parity conversion comes from tab &quotconversion
     rate&quot in SSP_data_file (in PARAMETER section in code)
   - SCL, the scale_up_factor based on income group comes from the core
     climada economic_data_file (see PARAMETER section in code)

   Caution: as soon as the entity has a field entity.assets.admin0_ISO3

   Note: to avoid any troubles, entity.assets.Cover is set equal to entity.assets.Value

   Prior calls: e.g. climada_nightlight_entity, country_risk_calc
   Next calls: e.g. country_risk_calc
 CALLING SEQUENCE:
   entity=cam_entity_value_GDP_SSP_one(entity,target_year,SSP_version)
 EXAMPLE:
   entity=cam_entity_value_GDP_SSP_one(entity,2035,'Ssp3Db')
 INPUT:
   entity: an entity structure, see e.g. climada_entity_load and
       climada_entity_read
 OPTIONAL INPUT PARAMETERS:
   target_year: the year we would like to get the GDP estimates for
       Default=2035, see SSP data file for possible years
   SSP_version: the SSP 3 or 5, hence either 'Ssp3Db' or 'Ssp5Db'. In fact
       this is the name of the tab within the Excel file we read, hence the
       user could also define a new one. Default 'Ssp3Db'
 OUTPUTS:
   entity: on output the entity as on inpit, with adjusted asset values,
       i.e. the sum(entity.assets.Value) now equals GDP*PPP*SCL
       The print statement to stdout does list the factors and states the
       matching ISO3 code for security checks, i.e. would they not all be
       the same (the requested country), there might either be double
       entries in tables or problems elsewhere.
   ok: =1, if successfully scaled, =0 if not
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150227, initial
View <A HREF=file:../../climada_modules/CAM/code/cam_entity_value_GDP_SSP_one.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_analyze_cam">
<H2>climada_tc_analyze_cam</H2></A>
<font color="blue">function climada_tc_analyze_cam(basin_number,cam_dataset) </font>
 climada
 NAME:
   climada_tc_analyze_cam
 PURPOSE:
   analyze CAM tracks for one basin

   present code reads all UNISYS and CAM data automatically, 
   but please see climada_tc_read_cam_database for details
 CALLING SEQUENCE:
   climada_tc_analyze_cam(basin_number,cam_dataset);
 EXAMPLE:
   climada_tc_analyze_cam(1,['wehner'|'present_day'|'rcp45'|'rcp85']);
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   basin_number: the basin numer, see climada_tc_filter_basin
       default=1 for North Atlantic
       currently, only 1 (North Atl) and 3 (West Pacific) are implemented
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120406, 20120407, 20120416
View <A HREF=file:../../climada_modules/CAM/code/climada_tc_analyze_cam.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_analyze_cam_all">
<H2>climada_tc_analyze_cam_all</H2></A>
<font color="blue">function climada_tc_analyze_cam_all(basin_number,cam_dataset) </font>
 climada
 NAME:
   climada_tc_analyze_cam
 PURPOSE:
   analyze CAM tracks for one basin

   present code reads all UNISYS and CAM data automatically, 
   but please see climada_tc_read_cam_database for details
 CALLING SEQUENCE:
   climada_tc_analyze_cam(basin_number,cam_dataset);
 EXAMPLE:
   climada_tc_analyze_cam(1,['wehner'|'present_day'|'rcp45'|'rcp85']);
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   basin_number: the basin numer, see climada_tc_filter_basin
       default=1 for North Atlantic
       1 (North Atl) 
       3 (West Pacific) are implemented
       5 (N. Indian)
       4 (S. Hemisphere (indian &amp Pac)
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120406, 20120407, 20120416
 Andrew Gettelman: added other regions (20140512)
View <A HREF=file:../../climada_modules/CAM/code/climada_tc_analyze_cam_all.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_filter_basin">
<H2>climada_tc_filter_basin</H2></A>
<font color="blue">function tc_track_basin=climada_tc_filter_basin(tc_track,basin_number) </font>
 This function determines the ocean basin of storm tracks in
 structure tc_track.

 NAME:
   climada_tc_filter_basin
 PURPOSE:
   Catagorize storms in 5 different ocean basins
   (North Atlantic, South Atlantic, North Pacific, South Pacific,
   Indian Ocean). Only necessary if global data used as allocated
   in climada_tc_read_gfdl_database.m. The function reduces the
   structure to the specified basin and modifies the ID_no.

   previous call: climada_tc_read_cam_database
 CALLING SEQUENCE:
   tc_track_out=climada_tc_filter_basin(tc_track,basin);
 EXAMPLE:
   tc_track_natl=climada_tc_read_gfdl_database(tc_track,1);
View <A HREF=file:../../climada_modules/CAM/code/climada_tc_filter_basin.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_read_cam_IBTrAC_V01">
<H2>climada_tc_read_cam_IBTrAC_V01</H2></A>
<font color="blue">function tc_track=climada_tc_read_cam_ibtrac_v01(ibtrac_file,starty,endy) </font>
 TC tracks from a CAM high resolution simulation.
 NAME:
   climada_tc_read_cam_ibtrac_v01
 PURPOSE:
   read storm track data from an IBTrAC style netcdf file stored in
   ...climada_additional/CAM/data/track_data_V01
   Data provided by A.Gettleman (andrew.gettelman@env.ethz.ch)

   Note the V01, since there is a newer data format, you might also
   consider using climada_tc_read_cam_database instead

   filter the raw data, namely:
   - a VALID record (=node) is required to have lat, lon and either pressure
     or windspeed (so recrods with only geographical information are skipped)
   - pressure [mb] needs to be in the range 800..1100, otherwise set to
     NaN, windspeeds of zero are also set to NaN
   - longitudes are converted such that east is positive.

   Tracks were  derived with a CAM cyclone tracking algorithm
   developed by Julio Bachmeister.

   NOTE: THIS IS THE FIRST VERSION (V01)

   next step: see climada_tc_filter_basin and then climada_tc_random_walk
 CALLING SEQUENCE:
   tc_track=climada_tc_read_cam_ibtrac_v01(ibtrac_file,starty,endy);
 EXAMPLE:
   tc_track=climada_tc_read_cam_ibtrac_v01(ibtrac_file,1980,2000);
 INPUTS:
   netcdf IBTrAC style file 
       ..climada_additional/data/tc_track/cam
 OPTIONAL INPUT PARAMETERS:
   ibtrac_file: the directory where the CAM data resides (sub-folders with
       year), inside each one file traj_out.txt
       -&ampgt prompted for if not given or passed empty
   starty: the first year (yyyy) of the data to be processed, default
       first sub-folder in ibtrac_file
   endy: the last year (yyyy) of the data to be processed, default
       last sub-folder in ibtrac_file
 OUTPUTS:
   tc_track: a structure with the track information for each cyclone i and
           data for each node j (times are at 00Z, 06Z, 12Z, 18Z):
       tc_track(i).lat(j): latitude at node j of cyclone i
       tc_track(i).lon(j): longitude at node j of cyclone i
       tc_track(i).MaxSustainedWind(j): Maximum sustained (1 minute)
           surface (10m) windspeed in knots (in general, these are to the nearest 5 knots).
       tc_track(i).MaxSustainedWindUnis, almost always 'kn'
           (others allowed: 'mph', 'm/s' or 'km/h')
       tc_track(i).CentralPressure(j): optional
       tc_track(i).CentralPressureUnit: 'mb'
       tc_track(i).yyyy: 4-digit year, optional
       tc_track(i).mm: month, optional
       tc_track(i).dd: day, optional
       tc_track(i).hh: hours
       tc_track(i).datenum:  matlab notation for dat: yyyy,mm,dd,hh
       tc_track(i).TimeStep(j)=time step [h] from this to next node
       tc_track(i).ID_no: unique ID, optional
       tc_track(i).name: name, optional
       tc_track(i).orig_event_flag: whether it is an mother(=1) or daugther(=0) storm

   Save the output tc_track manually (using save) if needed. 

 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120329
 David N. Bresch, david.bresch@gmail.com, 20121024, moved into a module: CAM
 David N. Bresch, david.bresch@gmail.com, 20121026, checked V01
View <A HREF=file:../../climada_modules/CAM/code/climada_tc_read_cam_IBTrAC_V01.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_read_cam_database">
<H2>climada_tc_read_cam_database</H2></A>
<font color="blue">function tc_track=climada_tc_read_cam_database(cam_data_dir,starty,endy) </font>
 TC tracks from a CAM high resolution simulation.
 NAME:
   climada_tc_read_cam_database
 PURPOSE:
   Tracks were  derived with a CAM cyclone tracking algorithm
   http://vis.lbl.gov/~romano/climate/tropicalstorms.html

   read storm track data from annual text files stored in ..CAM/data/track_data/.
   Data provided by A.Gettleman (andrew.gettelman@env.ethz.ch)

   Note that there is a previous version, the V01, in an old data format,
   you might also consider using climada_tc_read_cam_database_V01 instead

   filter the raw data, namely:
   - a VALID record (=node) is required to have lat, lon and either pressure
     or windspeed (so recrods with only geographical information are skipped)
   - pressure [mb] needs to be in the range 800..1100, otherwise set to
     NaN, windspeeds of zero are also set to NaN
   - longitudes are converted such that east is positive.

   next step: see climada_tc_filter_basin and then climada_tc_random_walk
 CALLING SEQUENCE:
   tc_track=climada_tc_read_cam_database(starty,endy);
 EXAMPLE:
   tc_track=climada_tc_read_cam_database(1980,2000);
 INPUTS:
   Text files must be stored in sub-folders (one for each year) in
       ..climada_additional/data/tc_track/cam
 OPTIONAL INPUT PARAMETERS:
   cam_data_dir: the directory where the CAM data resides (sub-folders with
       year), inside each one file traj_out.txt
       -&ampgt prompted for if not given or passed empty
   starty: the first year (yyyy) of the data to be processed, default
       first sub-folder in cam_data_dir
   endy: the last year (yyyy) of the data to be processed, default
       last sub-folder in cam_data_dir
 OUTPUTS:
   tc_track: a structure with the track information for each cyclone i and
           data for each node j (times are at 00Z, 06Z, 12Z, 18Z):
       tc_track(i).lat(j): latitude at node j of cyclone i
       tc_track(i).lon(j): longitude at node j of cyclone i
       tc_track(i).MaxSustainedWind(j): Maximum sustained (1 minute)
           surface (10m) windspeed in knots (in general, these are to the nearest 5 knots).
       tc_track(i).MaxSustainedWindUnis, almost always 'kn'
           (others allowed: 'mph', 'm/s' or 'km/h')
       tc_track(i).CentralPressure(j): optional
       tc_track(i).CentralPressureUnit: 'mb'
       tc_track(i).yyyy: 4-digit year, optional
       tc_track(i).mm: month, optional
       tc_track(i).dd: day, optional
       tc_track(i).hh: hours
       tc_track(i).datenum:  matlab notation for dat: yyyy,mm,dd,hh
       tc_track(i).TimeStep(j)=time step [h] from this to next node
       tc_track(i).ID_no: unique ID, optional
       tc_track(i).name: name, optional
       tc_track(i).orig_event_flag: whether it is an mother(=1) or daugther(=0) storm

   Save the output tc_track manually (using save) if needed.

 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120329
 David N. Bresch, david.bresch@gmail.com, 20121024, moved into a module: CAM
View <A HREF=file:../../climada_modules/CAM/code/climada_tc_read_cam_database.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_read_cam_database_V01">
<H2>climada_tc_read_cam_database_V01</H2></A>
<font color="blue">function tc_track=climada_tc_read_cam_database_V01(cam_data_dir,starty,endy) </font>
 TC tracks from a CAM high resolution simulation.
 NAME:
   climada_tc_read_cam_database
 PURPOSE:
   read storm track data from annual text files stored in
   ...climada_additional/CAM/data/track_data_V01
   Data provided by A.Gettleman (andrew.gettelman@env.ethz.ch)

   Note the V01, since there is a newer data format, you might also
   consider using climada_tc_read_cam_database instead

   filter the raw data, namely:
   - a VALID record (=node) is required to have lat, lon and either pressure
     or windspeed (so recrods with only geographical information are skipped)
   - pressure [mb] needs to be in the range 800..1100, otherwise set to
     NaN, windspeeds of zero are also set to NaN
   - longitudes are converted such that east is positive.

   Tracks were  derived with a CAM cyclone tracking algorithm
   http://vis.lbl.gov/~romano/climate/tropicalstorms.html

   NOTE: THIS IS THE FIRST VERSION (V01), there is a newer code, see
   climada_tc_read_cam_database.m

   next step: see climada_tc_filter_basin and then climada_tc_random_walk
 CALLING SEQUENCE:
   tc_track=climada_tc_read_cam_database_V01(cam_data_dir,starty,endy);
 EXAMPLE:
   tc_track=climada_tc_read_cam_database_V01(cam_data_dir,1980,2000);
 INPUTS:
   Text files must be stored in sub-folders (one for each year) in
       ..climada_additional/data/tc_track/cam
 OPTIONAL INPUT PARAMETERS:
   cam_data_dir: the directory where the CAM data resides (sub-folders with
       year), inside each one file traj_out.txt
       -&ampgt prompted for if not given or passed empty
   starty: the first year (yyyy) of the data to be processed, default
       first sub-folder in cam_data_dir
   endy: the last year (yyyy) of the data to be processed, default
       last sub-folder in cam_data_dir
 OUTPUTS:
   tc_track: a structure with the track information for each cyclone i and
           data for each node j (times are at 00Z, 06Z, 12Z, 18Z):
       tc_track(i).lat(j): latitude at node j of cyclone i
       tc_track(i).lon(j): longitude at node j of cyclone i
       tc_track(i).MaxSustainedWind(j): Maximum sustained (1 minute)
           surface (10m) windspeed in knots (in general, these are to the nearest 5 knots).
       tc_track(i).MaxSustainedWindUnis, almost always 'kn'
           (others allowed: 'mph', 'm/s' or 'km/h')
       tc_track(i).CentralPressure(j): optional
       tc_track(i).CentralPressureUnit: 'mb'
       tc_track(i).yyyy: 4-digit year, optional
       tc_track(i).mm: month, optional
       tc_track(i).dd: day, optional
       tc_track(i).hh: hours
       tc_track(i).datenum:  matlab notation for dat: yyyy,mm,dd,hh
       tc_track(i).TimeStep(j)=time step [h] from this to next node
       tc_track(i).ID_no: unique ID, optional
       tc_track(i).name: name, optional
       tc_track(i).orig_event_flag: whether it is an mother(=1) or daugther(=0) storm

   Save the output tc_track manually (using save) if needed. 

 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120329
 David N. Bresch, david.bresch@gmail.com, 20121024, moved into a module: CAM
 David N. Bresch, david.bresch@gmail.com, 20121026, checked V01
View <A HREF=file:../../climada_modules/CAM/code/climada_tc_read_cam_database_V01.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_read_cam_database_V02">
<H2>climada_tc_read_cam_database_V02</H2></A>
<font color="blue">function tc_track=climada_tc_read_cam_database_V01(cam_data_dir,starty,endy) </font>
 TC tracks from a CAM high resolution simulation.
 NAME:
   climada_tc_read_cam_database
 PURPOSE:
   read storm track data from annual text files stored in
   ...climada_additional/CAM/data/track_data_V01
   Data provided by A.Gettleman (andrew.gettelman@env.ethz.ch)

   Note the V01, since there is a newer data format, you might also
   consider using climada_tc_read_cam_database instead

   filter the raw data, namely:
   - a VALID record (=node) is required to have lat, lon and either pressure
     or windspeed (so recrods with only geographical information are skipped)
   - pressure [mb] needs to be in the range 800..1100, otherwise set to
     NaN, windspeeds of zero are also set to NaN
   - longitudes are converted such that east is positive.

   Tracks were  derived with a CAM cyclone tracking algorithm
   http://vis.lbl.gov/~romano/climate/tropicalstorms.html

   NOTE: THIS IS THE FIRST VERSION (V01), there is a newer code, see
   climada_tc_read_cam_database.m

   next step: see climada_tc_filter_basin and then climada_tc_random_walk
 CALLING SEQUENCE:
   tc_track=climada_tc_read_cam_database_V01(cam_data_dir,starty,endy);
 EXAMPLE:
   tc_track=climada_tc_read_cam_database_V01(cam_data_dir,1980,2000);
 INPUTS:
   Text files must be stored in sub-folders (one for each year) in
       ..climada_additional/data/tc_track/cam
 OPTIONAL INPUT PARAMETERS:
   cam_data_dir: the directory where the CAM data resides (sub-folders with
       year), inside each one file traj_out.txt
       -&ampgt prompted for if not given or passed empty
   starty: the first year (yyyy) of the data to be processed, default
       first sub-folder in cam_data_dir
   endy: the last year (yyyy) of the data to be processed, default
       last sub-folder in cam_data_dir
 OUTPUTS:
   tc_track: a structure with the track information for each cyclone i and
           data for each node j (times are at 00Z, 06Z, 12Z, 18Z):
       tc_track(i).lat(j): latitude at node j of cyclone i
       tc_track(i).lon(j): longitude at node j of cyclone i
       tc_track(i).MaxSustainedWind(j): Maximum sustained (1 minute)
           surface (10m) windspeed in knots (in general, these are to the nearest 5 knots).
       tc_track(i).MaxSustainedWindUnis, almost always 'kn'
           (others allowed: 'mph', 'm/s' or 'km/h')
       tc_track(i).CentralPressure(j): optional
       tc_track(i).CentralPressureUnit: 'mb'
       tc_track(i).yyyy: 4-digit year, optional
       tc_track(i).mm: month, optional
       tc_track(i).dd: day, optional
       tc_track(i).hh: hours
       tc_track(i).datenum:  matlab notation for dat: yyyy,mm,dd,hh
       tc_track(i).TimeStep(j)=time step [h] from this to next node
       tc_track(i).ID_no: unique ID, optional
       tc_track(i).name: name, optional
       tc_track(i).orig_event_flag: whether it is an mother(=1) or daugther(=0) storm

   Save the output tc_track manually (using save) if needed. 

 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20120329
 David N. Bresch, david.bresch@gmail.com, 20121024, moved into a module: CAM
 David N. Bresch, david.bresch@gmail.com, 20121026, checked V01
View <A HREF=file:../../climada_modules/CAM/code/climada_tc_read_cam_database_V02.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_read_cam_ibtrac_v02">
<H2>climada_tc_read_cam_ibtrac_v02</H2></A>
<font color="blue">function [tc_track,tc_track_hist_file]=climada_tc_read_cam_ibtrac_v02(ibtrac_file,check_plot) </font>
 TC tracks from a CAM high resolution simulation.
 NAME:
   climada_tc_read_cam_ibtrac_v01
 PURPOSE:
   read storm track data from an IBTrAC style netcdf file stored in
   ...climada_additional/CAM/data/track_data_V01
   Data provided by A.Gettleman (andrew.gettelman@env.ethz.ch)

   Note the V01, since there is a newer data format, you might also
   consider using climada_tc_read_cam_database instead

   The basic quality check (climada_tc_track_quality_check) gets applied,
   mainly to correct the dateline issue.

   filter the raw data, namely:
   - a VALID record (=node) is required to have lat, lon and either pressure
     or windspeed (so recrods with only geographical information are skipped)
   - pressure [mb] needs to be in the range 800..1100, otherwise set to
     NaN, windspeeds of zero are also set to NaN
   - longitudes are converted such that east is positive.

   Tracks were  derived with a CAM cyclone tracking algorithm
   developed by Julio Bachmeister.

   NOTE: THIS IS THE FIRST VERSION (V01)

   next step: see climada_tc_filter_basin and then climada_tc_random_walk
 CALLING SEQUENCE:
   tc_track=climada_tc_read_cam_ibtrac_v01(ibtrac_file,starty,endy);
 EXAMPLE:
   tc_track=climada_tc_read_cam_ibtrac_v01(ibtrac_file,1980,2000);
 INPUTS:
   netcdf IBTrAC style file
       ..climada_additional/data/tc_track/cam
 INPUTS:
   ibtrac_file: the filename of the ibtrac style cam cyclone file
   see also PARAMETERS section, especially for filters
 OPTIONAL INPUT PARAMETERS:
   check_plot: if =1, show plots, =0 not (default)
       Note that check_plot only makes sense on first call, as 2nd time,
       the data is restored from the .mat file, not read from netCDF again
 OUTPUTS:
   tc_track: a structure with the track information for each cyclone i and
           data for each node j (times are at 00Z, 06Z, 12Z, 18Z):
       tc_track(i).lat(j): latitude at node j of cyclone i
       tc_track(i).lon(j): longitude at node j of cyclone i
       tc_track(i).MaxSustainedWind(j): Maximum sustained (1 minute)
           surface (10m) windspeed in knots (in general, these are to the nearest 5 knots).
       tc_track(i).MaxSustainedWindUnis, almost always 'kn'
           (others allowed: 'mph', 'm/s' or 'km/h')
       tc_track(i).CentralPressure(j): optional
       tc_track(i).CentralPressureUnit: 'mb'
       tc_track(i).yyyy: 4-digit year, optional
       tc_track(i).mm: month, optional
       tc_track(i).dd: day, optional
       tc_track(i).hh: hours
       tc_track(i).datenum:  matlab notation for dat: yyyy,mm,dd,hh
       tc_track(i).TimeStep(j)=time step [h] from this to next node
       tc_track(i).ID_no: unique ID, optional
       tc_track(i).name: name, optional
       tc_track(i).orig_event_flag: whether it is an mother(=1) or daugther(=0) storm

   tc_track_hist_file: the filename with path to the binary file
       tc_track is stored in.

 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150128, _prob renamed to _hist
 David N. Bresch, david.bresch@gmail.com, 20170126, climada_tc_track_quality_check
View <A HREF=file:../../climada_modules/CAM/code/climada_tc_read_cam_ibtrac_v02.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="selected_countries_CAM">
<H2>selected_countries_CAM</H2></A>
 selected_countries_CAM
 climada batch code
 MODULE:
   CAM
 NAME:
   selected_countries_CAM
 PURPOSE:
   Run all CAM project countries, all calculations

   run this code (see PARAMETERS)
   - first with  check_country_names=1;
     &ampgt checks for country list being ok
   - second check_country_names=0
     &ampgt generates all entities (the assets) and hazard event sets and
     calculates damages
   - subsequent calls just repeat the damage calculations (unless you set
     country_risk_calc_force_recalc=1). Thus if you repeat the second step,
     since all hazard sets are stored, it will be fast and easy to play with
     parameters (e.g. damage functions).

   SPECIAL: in order to process CAM files only, the global variable
   climada_global.tc.default_raw_data_ext is set to '.nc' to avoid
   processing the UNISYS ('.txt') files in tc_track, see also code
   centroids_generate_hazard_sets

   In order to TEST this code before having all the netCDF track files
   ready, just set climada_global.tc.default_raw_data_ext='.txt', which
   runs all using UNISYS track data - and produces kind of comparison
   results.

   run as a batch code, such that all is available on command line, all
   PARAMETERS are set in this file, see section below

 CALLING SEQUENCE:
   selected_countries_CAM % a batch code
 EXAMPLE:
   selected_countries_CAM % a batch code
 INPUTS:
   see PARAMETERS in this batch code
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150203, initial (on ICE to Paris)
 David N. Bresch, david.bresch@gmail.com, 20150206, tested, ok
 David N. Bresch, david.bresch@gmail.com, 20150228, tested including asset scaling, ok
 David N. Bresch, david.bresch@gmail.com, 20150301, country liost reduced to SSP listed ones
View <A HREF=file:../../climada_modules/CAM/code/selected_countries_CAM.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_assets_crop">
<H2>climada_assets_crop</H2></A>
<font color="blue">function assets = climada_assets_crop(assets,polygon_focus_area) </font>
 climada_assets_crop
 MODULE:
   advanced
 NAME:
   climada_assets_crop
 PURPOSE:
   Reduce assets to focus only on a given area. Very useful for large assets, 
   where only a speficic area is need. 
   Usually this is the case after climada_nightlight_entity or 
   climada_create_centroids_entity_base. Analogue to climada_hazard_crop.
 CALLING SEQUENCE:
   assets = climada_assets_crop(assets,polygon_focus_area)
 EXAMPLE:
   assets = climada_assets_crop(assets,polygon_focus_area)
 INPUTS: 
   assets: a climada assets structure
   polygon_focus_area: structure with polygon coordinate information in fields
                       .lon and .lat, or .X and .Y that define the focus
                       area, can be multiple polygon_focus_area(2) or more
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:      
   assets: a climada assets structure, with .lon, .lat and .Value,
                        where all coordinates are within the given polygon focus area.
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20160314, init
View <A HREF=file:../../climada_modules/advanced/code/climada_assets_crop.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_centroids_elevation_add">
<H2>climada_centroids_elevation_add</H2></A>
<font color="blue">function centroids = climada_centroids_elevation_add(centroids,centroids_rectangle,check_plot) </font>
 climada 
 NAME:
   climada_centroids_elevation_add
 PURPOSE:
   add elevation to given centroids or create centroids given a rectangle of
   lon/lat. Uses SRTM data (90 m digitial elevation data, climada module dem)
 CALLING SEQUENCE:
   centroids = climada_centroids_elevation_add(centroids,centroids_rectangle)
 EXAMPLE:
   centroids = climada_centroids_elevation_add;
   centroids = climada_centroids_elevation_add(centroids);
   centroids = climada_centroids_elevation_add('',[-89.15 -89.1 13.695 13.73]);
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   centroids: climada centroids with lon,lat but not elevation_m info
   centroids_rectangle: rectangle that indicates the area where centroids
          should be created (on a 90 m resolution, as given by SRTM) 
          including elevation_m field
   if both inputs are empty, the user can choose a country and define a
   rectangle area in a figure
   check_plot: =1, do show check plot 
 OUTPUTS:
   centroids: a climada centroids structure with fields
       .lon, .lat, .elevation_m for elevation in meters
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151123, init
View <A HREF=file:../../climada_modules/advanced/code/climada_centroids_elevation_add.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_centroids_generate">
<H2>climada_centroids_generate</H2></A>
<font color="blue">function centroids = climada_centroids_generate(centroids_rectORcountry_nameORshapes, resolution_km, buffer_check, save_file, check_plot) </font>
 climada generate gridded centroids
 MODULE:
   advanced
 NAME:
   climada_generate_centroids
 PURPOSE:
   Given a rectangle defining the location of interest, generate an evenly
   spaced rectilinear grid of hazard centroids
 CALLING SEQUENCE:
   centroids = climada_generate_centroids(centroids_rectORcountry_nameORshapes, resolution_km, buffer_check, save_file, check_plot)
 EXAMPLE:
   centroids = climada_generate_centroids
   centroids = climada_generate_centroids(centroids_rect, 0.5, 1, 'NO_SAVE', 1)
   centroids = climada_generate_centroids('Netherlands', 1.0, 1, '', 0)
   centroids = climada_generate_centroids(shapes, 1.0, 1, '', 0)
 INPUTS:
   centroids_rectORcountry_nameORshapes [prompted for if not given] 
       can be any one of the following:
       centroids_rect: 4-element row vector defining the longitude and latitude
           limits of the study region [min_lon max_lon min_lat max_lat]
       country_name: the name of a country of interest, or ISO3 code
       shapes: any generic shapes struct, with fields .X and .Y
           defining lat and lon coords of study boundary region respectively.
 OPTIONAL INPUT PARAMETERS:
   resolution_km: specify the centroid resolution (default = 1 km)
   buffer_check: specifies whether a lower resolution grid of centroids 
       is generated outside the boundary defined by shapes,
       or if the high resolution centroids fill the entire
       boudning box (default = 1). Can also be set to -1, for
       centroids that only fill the shape
   save_file: full pathname of save location. If set to 'AUTO',
       centroids are automatically saved in the climada global 
       data directory. If set to 'NO_SAVE', centroids will not 
       be saved. (default = 'AUTO')
 OUTPUTS:
   centroids:      climada centroids struct with fields
                     .Longitude
                     .Latitude
                     .onLand
                     .centroid_ID
                     .countryname - cell array same size as .centroid_ID
                     .admin0_name - country name char array
                     .admin0_ISO3 - ISO 3 country code
                     .comment
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150119
 Gilles Stassen, 20150128, added .comment field
 Gilles Stassen, 20150326, added buffer
 Gilles Stassen, 20150408, increased buffer size
 Gilles Stassen, 20150416, save functionality, general shape input
 Gilles Stassen, 20150423, documentation updated
 Gilles Stassen, 20150703, struct array shape input
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 Lea Mueller, muellele@gmail.com, 20151106, move to advanced
 Lea Mueller, muellele@gmail.com, 20151123, set shapes_check to 0 for centroids_rect
 Lea Mueller, muellele@gmail.com, 20151125, rename to climada_centroids_generate from climada_generate_centroids
 David N. Bresch, david.bresch@gmail.com, 20160122, ISO3 debugged
 David N. Bresch, david.bresch@gmail.com, 20160126, header updated
View <A HREF=file:../../climada_modules/advanced/code/climada_centroids_generate.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_circle_create">
<H2>climada_circle_create</H2></A>
<font color="blue">function circle = climada_circle_create(center_lon,center_lat,radius_deg,check_plot) </font>
 climada create circle polygon
 MODULE:
   climada advanced
 NAME:
   climada_circle_create
 PURPOSE:
   Create a circe polygon (circle.lon, .lat) based on a given center (lon,
   lat) and radius_deg. Hint: 1 is roughly 100km.
 CALLING SEQUENCE:
   circle = climada_circle_create(center_lon,center_lat,radius_deg)
 EXAMPLE:
   circle = climada_circle_create(115,23,0.1)
 INPUTS:
   center_lon: longitude of center point
   center_lat: latitude of center point
   radius_km: radius in km of circle
 OPTIONAL INPUT PARAMETERS:
   check_plot: set to 1 to show a plot
 OUTPUTS:
   circle: a struct with fields .lon, .lat, .center_lon, .center.lat and .radius_deg
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20160509, init
View <A HREF=file:../../climada_modules/advanced/code/climada_circle_create.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_crop">
<H2>climada_entity_crop</H2></A>
<font color="blue">function entity = climada_entity_crop(entity, bounding_box, entity_scale_factor) </font>
 climada
 NAME:
   climada_clip_centroids_entity
 PURPOSE:
   Given an entity struct on country level (generated using 
   climada_create_GDP_entity or climada_nightlight_entity) this function 
   crops the entity struct to a bounding box and/or scales its resolution
   (interpolating values).
 CALLING SEQUENCE:
   entity = climada_entity_crop(entity, bounding_box, [entity_scale_factor])
 EXAMPLE:
 INPUTS:
   entity:         The entity created by climada_create_GDP_entity or
                   climada_nightlight_entity
   bounding_box:   An array of size 4 bounding the region of interest,
                   defined by [min_lon max_lon min_lat max_lat]
 OPTIONAL INPUT PARAMETERS:
   entity_scale_factor: Can be a single number (scales by same factor along 
                   lat and lon), or an array of size 2, such that the first
                   index indicates the lon, and the second the lat scale 
                   factors. Default value is set to 2 along both lat and lon.
 OUTPUTS:
   entity:         Entity struct
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20141121
 Gilles Stassen, gillesstassen@hotmail.com, 20141218 change variable names whole_world_borders.lon/lat -&ampgt shapes.X/Y
 Gilles Stassen, gillesstassen@hotmail.com, 20141223 add check_country input arg.
 Gilles Stassen, gillesstassen@hotmail.com, 20150220 centroids routine removed, new function: climada_clip_centroids_entity -&ampgt climada_entity_crop
 Lea Mueller, muellele@gmail.com, 20151125, move to advanced from flood
View <A HREF=file:../../climada_modules/advanced/code/climada_entity_crop.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_plot_all">
<H2>climada_entity_plot_all</H2></A>
<font color="blue">function res=climada_entity_plot_all </font>
 climada template
 MODULE:
   module name
 NAME:
   climada_entity_plot_all
 PURPOSE:
   plot ALL entities in the current entity folder, does take some time...

   usually rather use: climada_entity_plot
 CALLING SEQUENCE:
   res=climada_entity_plot_all
 EXAMPLE:
   climada_entity_plot_all;
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   res: the output, empty if not successful
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161001
View <A HREF=file:../../climada_modules/advanced/code/climada_entity_plot_all.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_exceedence_freq2freq">
<H2>climada_exceedence_freq2freq</H2></A>
<font color="blue">function event_freq = climada_exceedence_freq2freq(exceedence_freq) </font>
 climada calculate event frequency based on exceedence frequency
 MODULE:
   advanced
 NAME:
   climada_exceedence_freq2freq
 PURPOSE:
   Calculate event frequency based on exceedence frequency. The reverse
   from climada_damage_exceedence.
 CALLING SEQUENCE:
   event_freq = climada_exceedence_freq2freq(exceedence_freq)
 EXAMPLE:
   event_freq = climada_exceedence_freq2freq(1./[70 10])
 INPUTS:
   exceedence_freq: exceedence frequencies, i.e. 1./return_period (array)
 OPTIONAL INPUT PARAMETERS:
   none
 OUTPUTS:
   event_freq: occurrence frequency of each event damage (array)
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20160308, init
View <A HREF=file:../../climada_modules/advanced/code/climada_exceedence_freq2freq.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard2xls">
<H2>climada_hazard2xls</H2></A>
<font color="blue">function climada_hazard2xls(hazard, hazard_xls_file) </font>
 climada hazard save in xls
 MODULE:
   advanced
 NAME:
   climada_hazard2xls
 PURPOSE:
   Save hazard as xls file
 CALLING SEQUENCE:
   climada_hazard2xls(hazard, hazard_xls_file)
 EXAMPLE:
   climada_hazard2xls(hazard)
 INPUTS:
   hazard: hazard strucure to write out in excel file
   hazard_xls_file: the filename of the Excel file to be written
 OUTPUTS:
   excel file
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20160308, init
View <A HREF=file:../../climada_modules/advanced/code/climada_hazard2xls.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_crop">
<H2>climada_hazard_crop</H2></A>
<font color="blue">function hazard = climada_hazard_crop(hazard,polygon_focus_area) </font>
 climada_hazard_crop
 MODULE:
   advanced
 NAME:
   climada_hazard_crop
 PURPOSE:
   Reduce hazard to focus only on a given area. Very useful for large hazards, 
   that contain gridded information and only a speficic area is need. 
   Usually this is the case after climada_asci2hazard.m. 
 CALLING SEQUENCE:
   hazard = climada_hazard_crop(hazard, polygon_focus_area)
 EXAMPLE:
   hazard = climada_hazard_crop(hazard, polygon_focus_area)
 INPUTS: 
   hazard            : a climada hazard structure
   polygon_focus_area: structure with polygon coordinate information in fields
                       .lon and .lat, or .X and .Y that define the focus
                       area, can be multiple polygon_focus_area(2) or more
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:      
   hazard: a climada hazard structure, with .lon, .lat and .intensity,
                   where all coordinates are within the given polygon focus area.
   hazard.focus_area: copy of polygon struct
   hazard.in_focus_area: a vector to indicate in which polygon/focus_area
                   a centroid is located
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150724, init
 Lea Mueller, muellele@gmail.com, 20151106, move to advanced
 Lea Mueller, muellele@gmail.com, 20151125, rename to climada_hazard_crop from climada_hazard_focus_area
 Lea Mueller, muellele@gmail.com, 20160224, enable for multiple polygons
 Lea Mueller, muellele@gmail.com, 20160314, loop over segments divided by nans
 Lea Mueller, muellele@gmail.com, 20160318, introduce polygon_tolerance
 Lea Mueller, muellele@gmail.com, 20160427, bugfix if hazard.comment does not exist 
 Lea Mueller, muellele@gmail.com, 20160509, add in_focus_area
View <A HREF=file:../../climada_modules/advanced/code/climada_hazard_crop.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_init">
<H2>climada_hazard_init</H2></A>
<font color="blue">function hazard = climada_hazard_init(hazard) </font>
 init hazard structure
 MODULE:
   climada advanced
 NAME:
   climada_hazard_init
 PURPOSE:
   init a climada hazard struct that contains the necessary fields
   (e.g. .lon, .lat, .intensity etc), or append add the necessary fields
   to an existing hazard and order fields
 CALLING SEQUENCE:
   hazard = climada_hazard_init(hazard)
 EXAMPLE:
   hazard = climada_hazard_init
 INPUTS: none
 OPTIONAL INPUT PARAMETERS:
   hazard: an existing hazard structure where one wants to add the
   necessary fields and order the fields
 OUTPUTS:
   hazard: a climada hazard struct with all the necessary fields
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20160427, init
View <A HREF=file:../../climada_modules/advanced/code/climada_hazard_init.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_construct">
<H2>climada_measures_construct</H2></A>
<font color="blue">function measures = climada_measures_construct(measures,n_measures) </font>
 create measures structure
 MODULE:
   climada advanced
 NAME:
   climada_measures_construct
 PURPOSE:
   create a climada measures struct that contains the necessary fields
   (e.g. .name, .hazard_intensity_impact_b etc), or append a new measure
   to an existing measures structure
 CALLING SEQUENCE:
   measures = climada_measures_construct(measures,n_measures)
 EXAMPLE:
   measures = climada_measures_construct
 INPUTS: none
 OPTIONAL INPUT PARAMETERS:
   measures: an existing measures structure where one want to add one or more measures 
   n_measures: number of measures to be created or added
 OUTPUTS:
   measures: a climada measures struct
 MODIFICATION HISTORY:
View <A HREF=file:../../climada_modules/advanced/code/climada_measures_construct.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_measures_impact_add">
<H2>climada_measures_impact_add</H2></A>
<font color="blue">function measures_impact = climada_measures_impact_add(measures_impact,EDS,entity) </font>
 climada_measures_impact_add
 MODULE:
   advanced
 NAME:
   climada_measures_impact_add
 PURPOSE:
   Add control EDS to existing measures_impact so that the before
   'control' run is the asset change run (i.e. urban planning)
 CALLING SEQUENCE:
   measures_impact = climada_measures_impact_add(measures_impact,EDS,entity)
 EXAMPLE:
   measures_impact = climada_measures_impact_add(measures_impact,EDS,entity)
 INPUTS:
   measures_impact: a climada measures_impact structure where we want to
       add a new control run from EDS.
       with fields .EDS,
       .ED, .benefit, .scenario, .peril
       &ampgt promted for if not given
   EDS: a climada EDS structure that contains the control run that will be
       added to measures_impact.
       with field .refence_year,
       .ED, .ED_at_centroid, .peril
       &ampgt promted for if not given
   entity: special case for Barisal to copy asset characteristics
       (.Category, .Caterogy_name, .Category_ID)
 OPTIONAL INPUT PARAMETERS:
   param2: as an example
 OUTPUTS:
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151207, init
View <A HREF=file:../../climada_modules/advanced/code/climada_measures_impact_add.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="axescenter">
<H2>axescenter</H2></A>
<font color="blue">function [] = axescenter(ax) </font>
AXESCENTER locates axes in the center instead of at the edges.
 AXESCENTER(AX) puts axes in the center of axes AX.  If AX is not
 supplied, the current axes is assumed.  Many of the standard properties
 manipulated through the command line will also work when the axes are in
 the center, such as grid, title, and x/ylabel.  This function works by
 placing two 'fake' axes in the center of the current axes and hiding the
 ticks and other signs of AX, while property listeners are attached to the
 relevant properties of AX.  An exception to this is the deletefcn
 property. Apparently no listener can be attached to this property so that
 calling 'delete(AX)' will leave the center axes intact.  In this case,
 the user can find the handles using:
 H = findall(gcf,'type','axes','handlev','off') 
 then the center axes can be deleted manually.
 Another exception is the dataaspectratio property.  If the user sets the
 dataaspectratio property, the center axes will not line up correctly.
 Thus any function that changes this property, such as 'axis equal' will
 not yield the correct alignment for the center axes.  For now it is
 recommended to set the axes position property to get a similar effect.

 Notes:
 The goal of this work is that the user will not see any difference in
 functionality between having the axes at the center, and having them at   
 the edges.  Obviously this goal has not been fully met: there are 
 exceptions.  It is hoped that improvements will be continuously added 
 through feedback from users and the authors own effort.  If you see a 
 way around one of the exceptions, please contact the author!  I am 
 particularly interested in finding ways to match the dataaspect/plotbox  
 ratios so that functions like axis square can be used.  I have been using
 Matlab for years now, and I have NO CLUE how to do this after much  
 wasted effort, though I am certain that it can be done.  
 Using the zoom and pan tools from the figure menubar keeps the center 
 axes correct.
 As of now, AXESCENTER does not work if either axis of AX is log scaled,
 or if the plot is 3D.
 The workings of the code are simple enough that modification/extension
 should be easy.
 Several solutions were sought to allow the user to use delete(AX) and 
 have the center axes be deleted as well.  No method was found that
 worked for both this case and the case where the user closes the figure
 by clicking the x.  If you find a solution to this dilemma, please
 contact the author.
 I would like to acknowledge the work of Yair Altman. A piece of his
 proplistener code, available on the FEX, was incorporated into this 
 work.  As with his work, this function relies on undocumented Matlab
 functions and properties, so it cannot be guaranteed to work on all
 versions of Matlab.

 Perhaps the best way to see this function in action is to copy the demo
 below into a script and run it.  The demo manipulates many of the axes
 properties using gca, as one would normally do.  The demo lasts about 24
 seconds.  When the demo is over, feel free to zoom in and out, and pan
 the plot using the figure's menubar.

 Demo: (Copy and paste into a script, or to the command line.)

   f = figure('position',[100 100 700 680]);
   str = 'Click to continue.';
   x = -2*pi:.01:2*pi;
   plot(x,sin(x),'r'),hold on
   pos = get(gca,'position');
   T = title('Call axescenter','fonts',14,'fontw','b');
   axescenter,uiwait(msgbox(str,'DEMO','modal'));  % Call our function
   set(T,'string','Change ylim')
   set(gca,'ylim',[-10 10]),uiwait(msgbox(str,'DEMO','modal'));
   set(T,'string','Add plot, reset ylim, change fontweight, and xlabels')
   plot(x,cos(x))
   set(gca,'ylim',[-2 2],'fontw','b')
   set(gca,'xticklabel',['2' ;'3' ;'4' ;'5' ;'6'])
   uiwait(msgbox(str,'DEMO','modal'));
   set(T,'string','Change xtick')
   set(gca,'xtick',[-4 0 4]),uiwait(msgbox(str,'DEMO','modal'));
   set(T,'string','Change xtickmode and xticklabelmode to auto')
   set(gca,'xtickmode','auto','xticklabelmode','auto'),
   uiwait(msgbox(str,'DEMO','modal'));
   set(T,'string','Turn on minor grids')
   set(gca,'fontw','n')
   set(gca,'xminorgrid','on','yminorgrid','on')
   uiwait(msgbox(str,'DEMO','modal'));
   set(T,'string','Change axes position')
   set(gca,'pos',[.1 .05 .5 .8]),uiwait(msgbox(str,'DEMO','modal'));
   set(T,'string','Move axes back, add x and y labels, change ticklength')
   set(gca,'pos',pos)
   xlabel('X','fonts',12,'fontw','b'),ylabel('Y','fonts',12,'fontw','b')
   set(gca,'tickl',[.06 .025]),uiwait(msgbox(str,'DEMO','modal'));
   set(T,'string','Change fontangle, fontsize axes linewidth')
   set(gca,'fonta','i','linewidth',2)
   set(gca,'fonts',6),uiwait(msgbox(str,'DEMO','modal'));
   set(T,'string','Change fontsize back, change axes color')
   set(gca,'fonta','n','fonts',10)
   set(gca,{'xcolor','ycolor'},{[.1 .8 .1],[.2 .2 .6]},'tickl',[.02 .025])
   pause(2)
   set(T,'string','Demo over, try zoom and pan.  Thank you.')


 Author:  Matt Fig
 Contact: popkenai@yahoo.com
 Created: 1/9/2009
View <A HREF=file:../../climada_modules/advanced/code/ECA_graphics/axescenter.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="batch_create_ECA_graphics">
<H2>batch_create_ECA_graphics</H2></A>
% WATERFALL GRAPH
View <A HREF=file:../../climada_modules/advanced/code/ECA_graphics/batch_create_ECA_graphics.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_adaptation_graph">
<H2>climada_adaptation_graph</H2></A>
<font color="blue">function  fig = climada_adaptation_graph(ECA_adaptation, case_i, digits) </font>
View <A HREF=file:../../climada_modules/advanced/code/ECA_graphics/climada_adaptation_graph.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_adaptation_graph_damage">
<H2>climada_adaptation_graph_damage</H2></A>
<font color="blue">function  fig = climada_adaptation_graph_damage(ECA_adaptation, case_i, digits) </font>
View <A HREF=file:../../climada_modules/advanced/code/ECA_graphics/climada_adaptation_graph_damage.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_adaptation_graph_new">
<H2>climada_adaptation_graph_new</H2></A>
<font color="blue">function  fig = climada_adaptation_graph_new(ECA_adaptation, case_i, digits) </font>
View <A HREF=file:../../climada_modules/advanced/code/ECA_graphics/climada_adaptation_graph_new.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_adaptation_graph_upsidedown">
<H2>climada_adaptation_graph_upsidedown</H2></A>
<font color="blue">function  fig = climada_adaptation_graph_upsidedown(ECA_adaptation, case_i, digits) </font>
View <A HREF=file:../../climada_modules/advanced/code/ECA_graphics/climada_adaptation_graph_upsidedown.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_read_risk_analysis">
<H2>climada_read_risk_analysis</H2></A>
<font color="blue">function ECA_studies = climada_read_risk_analysis(xlsfile, sheet_name) </font>
 climada
 MODULE:
   ECA_graphics
 NAME:
   climada_read_risk_analysis
 PURPOSE:
   read structure ECA_studies with ECA results from all previuous studies
   (Florida, Gulf Coast, New York, Guyana, Mali, Tanzania, India, China,
   Samoa, Hull, Bermuda, Cayman Islands, Barbados, Angtigua&ampBarbuda,
   Anguilla, St. Lucia, Jamaica and Dominica)
   includes: 
   - Waterfall graphic: today, economic growth, climate change, 
       total climate risk, percentage of all cost-effective measures, residual loss 
   - adaptation cost curve: name of measures, averted loss, cost-benefit ratio
 CALLING SEQUENCE:
   ECA_studies = climada_read_risk_analysis(xlsfile, sheet_name)
 EXAMPLE:
   ECA_studies = climada_read_risk_analysis([],'million_USD')
   ECA_studies = climada_read_risk_analysis([],'adaptation')
 INPUTS:
   sheet_name: sheet name of excel sheet to be read
 OPTIONAL INPUT PARAMETERS:
   xlsfile: file name of xls sheet
 OUTPUTS:
   structure ECA_studies with ECA results from all previuous studies
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20131024, initial
 Lea Mueller, muellele@gmail.com, 20150107, update
View <A HREF=file:../../climada_modules/advanced/code/ECA_graphics/climada_read_risk_analysis.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_waterfall_graph_special">
<H2>climada_waterfall_graph_special</H2></A>
<font color="blue">function  fig = climada_waterfall_graph_special(ECA_studies, case_i, digits) </font>
 waterfall figure, expected damage for specified return period for 
 - today,
 - increase from economic growth, 
 - increase from high climate change, total expected damage 2030
 for the three EDS quoted above
 NAME:
   climada_waterfall_graph
 PURPOSE:
   plot expected damage for specific return period
 CALLING SEQUENCE:
   climada_waterfall_graph(EDS1, EDS2, EDS3, return_period,
   check_printplot)
 EXAMPLE:
   climada_waterfall_graph
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   EDS:            three event damage sets 
                   - today
                   - economic growth
                   - cc combined with economic growth, future
   return_period:  requested return period for according expected damage,or
                   annual expted damage, prompted if not given
   check_printplot:if set to 1, figure saved, default 0. 
 OUTPUTS:
   waterfall graph
 MODIFICATION HISTORY:
 Lea Mueller, 20110622
 Martin Heynen, 20120329
 David N. Bresch, david.bresch@gmail.com, 20130316 EDS-&ampgtEDS
View <A HREF=file:../../climada_modules/advanced/code/ECA_graphics/climada_waterfall_graph_special.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_waterfall_graph_special_NY">
<H2>climada_waterfall_graph_special_NY</H2></A>
<font color="blue">function  fig = climada_waterfall_graph_special_NY(ECA_studies, case_i, digits) </font>
 waterfall figure, expected damage for specified return period for 
 - today,
 - increase from economic growth, 
 - increase from high climate change, total expected damage 2030
 for the three EDS quoted above
 NAME:
   climada_waterfall_graph
 PURPOSE:
   plot expected damage for specific return period
 CALLING SEQUENCE:
   climada_waterfall_graph(EDS1, EDS2, EDS3, return_period,
   check_printplot)
 EXAMPLE:
   climada_waterfall_graph
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   EDS:            three event damage sets 
                   - today
                   - economic growth
                   - cc combined with economic growth, future
   return_period:  requested return period for according expected damage,or
                   annual expted damage, prompted if not given
   check_printplot:if set to 1, figure saved, default 0. 
 OUTPUTS:
   waterfall graph
 MODIFICATION HISTORY:
 Lea MuEDler, 20110622
 Martin Heynen, 20120329
 David N. Bresch, david.bresch@gmail.com, 20130316 EDS-&ampgtEDS
View <A HREF=file:../../climada_modules/advanced/code/ECA_graphics/climada_waterfall_graph_special_NY.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_waterfall_graph_special_tanzania">
<H2>climada_waterfall_graph_special_tanzania</H2></A>
<font color="blue">function  fig = climada_waterfall_graph_special_tanzania(ECA_studies, case_i, digits) </font>
 waterfall figure, expected damage for specified return period for 
 - today,
 - increase from economic growth, 
 - increase from high climate change, total expected damage 2030
 for the three EDS quoted above
 NAME:
   climada_waterfall_graph
 PURPOSE:
   plot expected damage for specific return period
 CALLING SEQUENCE:
   climada_waterfall_graph(EDS1, EDS2, EDS3, return_period,
   check_printplot)
 EXAMPLE:
   climada_waterfall_graph
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   EDS:            three event damage sets 
                   - today
                   - economic growth
                   - cc combined with economic growth, future
   return_period:  requested return period for according expected damage,or
                   annual expted damage, prompted if not given
   check_printplot:if set to 1, figure saved, default 0. 
 OUTPUTS:
   waterfall graph
 MODIFICATION HISTORY:
 Lea MuEDler, 20110622
 Martin Heynen, 20120329
 David N. Bresch, david.bresch@gmail.com, 20130316 EDS-&ampgtEDS
View <A HREF=file:../../climada_modules/advanced/code/ECA_graphics/climada_waterfall_graph_special_tanzania.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="font_test">
<H2>font_test</H2></A>
 Script File: ShowFonts
 How choose a font, a size, a weight, and an angle.
View <A HREF=file:../../climada_modules/advanced/code/ECA_graphics/font_test.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="ktools_model_from_climada">
<H2>ktools_model_from_climada</H2></A>
<font color="blue">function ktools_model_from_climada(entity,hazard,doPlot,doCallKtools,ktools_bin_PATH) </font>
 climada ktools OASIS LMF
 MODULE:
   advanced
 NAME:
   ktools_model_from_climada
 PURPOSE:
   This function serves to migrate a climada portfolio and model to a
   ktools model. From climada we need the 'entity' structure and the
   'hazard' structure which are the relevant input parameters of this
   code. This code is written as an example for a tropicaly cyclone wind.
   It is meant as a starting point for migrating any model to
   ktools/Oasis. But there must be code changes depending on the hazard,
   binning, portfolio etc.

   The output of this code is a set of CSV files which are as specified by the
   Oasis team in the ktools documentation (GitHub). These CSV files are
   written into a folder in the user's home directory, into a subfolder
   named below in the code ('ktools_tcusa' by default).

   From there they can be converted to binary files (.bin) with the standard
   ktools functions and the loss simulation can be done. We give an example
   call at the end of this code, but these are as documented in the ktools
   GitHub.

   It is important to note that we do not expect this code to run for all
   portfolios and hazards, just because there is a variety of portfolio
   structures, hazard types and units. But it should serve as a good basis
   for any climada model.

   Authors of this code:  Marc Wueest and Nadine Koenig (ETH Zurich)
   Editor of this code: David N. Bresch (ETH Zurich)

   The code was written and used in a master thesis project in early 2017.
   The report can be found at
   http://www.iac.ethz.ch/the-institute/publications.html?title=&amp_charset_=UTF-8&ampauthors=koenig&amp_charset_=UTF-8&amprgroup=&amppub_type=.

 CALLING SEQUENCE:
   ktools_model_from_climada(entity,hazard,doPlot,doCallKtools)
 EXAMPLE:
   entity = climada_entity_load('USA_UnitedStates_Florida');
   hazard = climada_hazard_load('USA_UnitedStates_Florida_atl_TC');
   ktools_model_from_climada(entity,hazard)
   ktools_model_from_climada; % runs TEST (same entity and hazard as stated just above)
 INPUTS:
   entity: an entity structure or an entity .mat file, see climada_assets_encode(climada_assets_read)
       If a file and no path provided, default path ../data/entities is
       used (and name can be without extension .mat)
       &ampgt promted for if not given
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       If a file and no path provided, default path ../data/hazards is
       used (and name can be without extension .mat). If hazard is empty
       and entity contains hazard in entity.hazard, this hazard is used.
       &ampgt promted for if not given
       Minimum fileds of hazard struct are:
       peril_ID, event_ID, centroid_ID, intensity and frequency
 OPTIONAL INPUT PARAMETERS:
   doPlot: create a check plot of the vulnerability binning (if true), or
       not (if false, default).
   doCallKtools: try to call the ktools conversion codes (CSV to BIN) and
       run the ground-up loss (GUL) simulation. Default=true, hence at least try)
   ktools_bin_PATH: the statement to add the path to the (compiled)
       ktools, default is ='export PATH=$PATH:/cluster/apps/climate/ktools/bin'
       YEs, one states the full system command here, including 'export PATH=...'
 OUTPUTS:
   tc_track: the tc_track structure, restricted to centroids, if passed
       and cleaned up, if check_plot=-99. Otherwise same as input tc_track
   info contains some information, but to stdout is main purpose of this
       routine
 MODIFICATION HISTORY:
 Nadine Koenig, koenigna@student.ethz.ch and maegic@maegic.ch, 20170330, initial
 David N. Bresch, david.bresch@gmail.com, 20170412, climada adjustemnts (no absolute path etc.)
 David N. Bresch, david.bresch@gmail.com, 20170412, ktools_bin_PATH added
View <A HREF=file:../../climada_modules/advanced/code/ktools/ktools_model_from_climada.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_windfield_animation">
<H2>climada_tc_windfield_animation</H2></A>
<font color="blue">function climada_tc_windfield_animation(tc_track,centroids,aggregation,check_avi)                                 </font>
 plot animation of windfield for a specific historical or
 probabilistic storm
 to find a specific windstorm use
 climada_plot_probabilistic_wind_speed_map
 NAME:
   climada_tc_windfield_animation
 PURPOSE:
   plot animation of windfield for a specific historical or
   probabilistic storm, plot is produced every aggregation time step
   (minimum 1 hour or more)
 CALLING SEQUENCE:
   climada_tc_windfield_animation(tc_track       ,...
                                  centroids      ,...
                                  aggregation    ,...
                                  check_printplot)
 EXAMPLE:
   climada_tc_windfield_animation(tc_track_prob(1226), centroids, 1, 6)
 INPUTS:
	tc_track:           just one tc_track, tc_track_prob(1)
   centroids:          centroid mat file
 OPTIONAL INPUT PARAMETERS:
   aggregation:        desired timestep for plots (minimum one plot per
   hour, can be one plot for 6 hours or more)
   check_avi:         if set to 1 will save animation as avi-file
 OUTPUTS:
   plot of windfield (footprint) for every aggreagation step
   (minimum 1 hour) for one specific storm track
 MODIFICATION HISTORY:
 Lea Mueller, 20110603
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir
View <A HREF=file:../../climada_modules/advanced/code/old_code/climada_tc_windfield_animation.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_windfield_timestep">
<H2>climada_tc_windfield_timestep</H2></A>
<font color="blue">function res = climada_tc_windfield_timestep(tc_track, centroids, equal_timestep) </font>
 TC windfield calculation for every timestep
 NAME:
   climada_tc_windfield_timestep
 PURPOSE:
   given a TC track (lat/lon,CentralPressure,MaxSustainedWind), calculate
   the wind field at locations (=centroids) for every timestep and display
   it in a loop
 CALLING SEQUENCE:
   climada_tc_windfield_timestep(tc_track, centroids, equal_timestep)
 EXAMPLE:
   climada_tc_windfield_timestep
 INPUTS:
   tc_track: a structure with the track information:
       tc_track.lat
       tc_track.lon
       tc_track.MaxSustainedWind: maximum sustained wind speed (one-minute)
       tc_track.MaxSustainedWindUnit as 'kn', 'mph', 'm/s' or 'km/h'
       tc_track.CentralPressure: optional
       tc_track.Celerity: translational (forward speed) of the hurricane.
           optional, calculated from lat/lon if missing
       tc_track.TimeStep: optional, only needed if Celerity needs to be
           calculated, 6h assumed as default
       tc_track.Azimuth: the forward moving angle, calculated if not given
           to ensure consistency, it is even suggested not to pass Azimuth
       tc_track.yyyy: 4-digit year, optional
       tc_track.mm: month, optional
       tc_track.dd: day, optional
       tc_track.ID_no: unique ID, optional
       tc_track.name: name, optional
       tc_track.SaffSimp: Saffir-Simpson intensity, optional
   centroids: a structure with the centroids information
       centroids.lat: the latitude of the centroids
       centroids.lon: the longitude of the centroids
 OPTIONAL INPUT PARAMETERS:
   equal_timestep: if set=1 (default), first interpolate the track to a common
       timestep, if set=0, no equalization of TC track data (not
       recommended)
 OUTPUTS:
   res.gust: the windfield [m/s] at all centroids
       the single-character variables refer to the Pioneer offering circular
       that's why we kept these short names (so one can copy the OC for
       documentation)
   res.lat: the latitude of the centroids
   res.lon: the longitude of the centroids
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20110721
View <A HREF=file:../../climada_modules/advanced/code/old_code/climada_tc_windfield_timestep.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="GeoDistance">
<H2>GeoDistance</H2></A>
<font color="blue">function d=GeoDistance(xx,yy,Lon,Lat) </font>
   % HAVERSINE FORMULA FOR DISTANCES; 
   % distance in lon lat 
   R = 6378.135; % earth radius in km 
   Dlat  = (yy - Lat).*pi/180;
   Dlong = (xx - Lon).*pi/180;
   a = (sin(Dlat./2)).^2 + cos(Lat.*pi/180).*cos(yy.*pi/180).*(sin(Dlong./2)).^2;
   c = 2.*atan2( sqrt(a), sqrt((1-a)) );
   d = R.*c;  % distance in km 
nd
View <A HREF=file:../../climada_modules/coastal_hazards/code/GeoDistance.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="arcgridwrite">
<H2>arcgridwrite</H2></A>
<font color="blue">function arcgridwrite(fileName,X,Y,Z,varargin) </font>
ARCGRIDWRITE- Write gridded data set in Arc ASCII Grid Format

   ARCGRIDWRITE(fileName,X,Y,Z)- converts data in a matlab
   grid into a text file in Arc ASCII Grid Format. 

   INPUTS
       fileName:  output filename including extension
       X:         X coordinates (vector 1 x N) 
       Y:         Y coordinates (vector m x 1) 
       Z:         gridded data (m x n) 

   SYNTAX AND OPTIONS
       arcgridwrite('D:\tools\bathyGrid.asc',X,Y,Z)

       arcgridwrite(...,'precision',5) - changes default output
           from 3 to 5 decimal places.

       arcgridwrite(...,'nodata',-32768) - changes no data value
           from -9999 (default) to -32768.

       arcgridwrite(...,'grid_mapping','center') - changes the 
           grid spatial reference from 'corner' (default) to 'center'.
           This is useful when combining output from the mapping
           toolbox's PIXCENTERS function.               

   EXAMPLE 1 - create a raster grid of the peaks function
       [X,Y,Z]=peaks(100);
       arcgridwrite('peaksArc.asc',X(1,:),Y(:,1),Z,'precision',5)

   NOTES 
   Because the Arc ASCII format has only one parameter for cell size,
   both X and Y must have the same, non-varying grid spacing.  

 A.Stevens @ USGS 7/18/2007
 updated 11/16/2015
View <A HREF=file:../../climada_modules/coastal_hazards/code/arcgridwrite.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="aux_historical_storms_MEX">
<H2>aux_historical_storms_MEX</H2></A>
<font color="blue">function tc_track=aux_historical_storms_MEX </font>
 
lobal climada_global
% 
nisys_file         = fullfile(climada_global.data_dir,'tc_tracks','tracks.atl.txt'); 
View <A HREF=file:../../climada_modules/coastal_hazards/code/aux_historical_storms_MEX.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="class_plot_profiles">
<H2>class_plot_profiles</H2></A>
lassdef class_plot_profiles
   properties % values
       transect 
       FigHandle
       dd
   end % properties
View <A HREF=file:../../climada_modules/coastal_hazards/code/class_plot_profiles.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_DFC_2xls">
<H2>climada_EDS_DFC_2xls</H2></A>
<font color="blue">function res = climada_EDS_DFC_2xls(EDS,SHEET,Percentage_Of_Value_Flag,report_file) </font>
 climada
 NAME:
   climada_EDS_DFC_2xls
 NOTE: 
   created from climada_EDS_DFC_report
 PURPOSE:
   Interpolate damage frequency curve (DFC) to standard return periods
   (see climada_global.DFC_return_periods)

   previous call: climada_EDS_calc
 CALLING SEQUENCE:
   res=climada_EDS_DFC_report(EDS,Percentage_Of_Value_Flag,report_style)
 EXAMPLE:
   res=climada_EDS_DFC_report(climada_EDS_calc(climada_entity_read))
 INPUTS:
   EDS: either an event damage set, as e.g. returned by climada_EDS_calc or
       a file containing such a structure
       SPECIAL: we also accept a structure which contains an EDS, like
       measures_impact.EDS
       if EDS has the field annotation_name, the legend will show this
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   Percentage_Of_Value_Flag: if =1, scale vertical axis with Value, such
       that damage as percentage of value is shown, instead of damage amount,
       default=0 (damage amount shown). Very useful to compare DFCs of
       different portfolios to see relative differences in risk
   report_style: 'lean' for only the damages at predefined return periods
       'std' (default): the damages at return periods.
   report_file: filename (and path) to save the report to (as .csv)
       ='': no saving to file (default)
       ='ASK' to prompt for
 OUTPUTS:
   res: a structure with fields
       return_periods(RP_i): return period RP_i
       damage(EDS_i,RP_i)
 MODIFICATION HISTORY:
 Borja G. Reguero - borjagreguero@gmail.com - creation 06/07/2016
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_EDS_DFC_2xls.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_DFC_coastal">
<H2>climada_EDS_DFC_coastal</H2></A>
<font color="blue">function [fig,legend_str,return_period,sorted_damage] = climada_EDS_DFC_coastal(EDS,EDS_comparison,Percentage_Of_Value_Flag,plot_loglog) </font>
 climada
 NAME:
   climada_EDS_DFC
 PURPOSE:
   plot occurrence Damage exceedence Frequency Curve (DFC)

   See also: climada_EDS_DFC_match and climada_DFC_compare
 CALLING SEQUENCE:
   climada_EDS_DFC(EDS,EDS_comparison,Percentage_Of_Value_Flag)
 EXAMPLE:
   climada_EDS_DFC(climada_EDS_calc(climada_entity_read))
 INPUTS:
   EDS: either an event damage set, as e.g. returned by climada_EDS_calc or
       a file containing such a structure
       SPECIAL: we also accept a structure which contains an EDS, like
       measures_impact.EDSed
       if EDS has the field annotation_name, the legend will show this
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   EDS_comparison: like EDS see above, plotted (fine lines) for comparison
       not prompted for, if not given,unless set to 'ASK'
   Percentage_Of_Value_Flag: if =1, scale vertical axis with Value, such
       that damage as percentage of value is shown, instead of damage amount,
       default=0 (damage amount shown). Very useful to compare DFCs of
       different portfolios to see relative differences in risk
   plot_loglog: if =1, plot logarithmic scale both axes, =0 plot linear
       axes (default)
 OUTPUTS:
   a figure with the DFC plot
   legend_str: the legend string
   return_period: the return periods as shown (for the last DFC plottet,
       be careful)
   sorted_damage: the damage as shown (for the last DFC plottet,
       be careful)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20100108
 David N. Bresch, david.bresch@gmail.com, 20100109, comparison added
 Lea Mueller, 20120816, comparison title of all comparisons, changed markersize
 David N. Bresch, david.bresch@gmail.com, 20130316, ELS-&ampgtEDS...
 David N. Bresch, david.bresch@gmail.com, 20130316, slight cleanup
 David N. Bresch, david.bresch@gmail.com, 20141206, legend_str as output added
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_EDS_DFC_coastal.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_calc_coastal">
<H2>climada_EDS_calc_coastal</H2></A>
<font color="blue">function EDS=climada_EDS_calc_coastal(entity,hazard,annotation_name,force_re_encode,silent_mode) </font>
 climada calculate event damage set for coastal areas 
 MAIN DIFFERENCE WITH climada_EDS_calc: 
   Factors in the topography and elevation of assets. Therefore, the
   interpolation with the damage curves varies. 
 NOTE: 
   only works for 1 type of asset value. 
   to include more types of buildings, prepare a loop outside this
   function, the same way that is done for adapation measures. 
 NAME:
   climada_EDS_calc_coastal
 PURPOSE:
   given an encoded entity (assets and damage functions) and a hazard
   event set, calculate the event damage set (EDS). The event damage set
   contains the event damage for each hazard event. In case you set
   climada_global.damage_at_centroid=1, the damage is also stored for each
   event at each centroids (be aware of memory implications). The exepcted
   damage is always stored at each centroid, see EDS.ED_at_centroid.

   Note that the waitbar consumes quite some time, so switch it off by
   setting climada_global.waitbar=0 or by
   using the climada_code_optimizer, which removes all slowing code, i.e.
   all code lines marked by % CLIMADA_OPT - but by now, the code is pretty
   fast, hence climada_code_optimizer does usually not bring huge
   improvements.

   next (likely): climada_EDS_DFC, climada_EDS_DFC_report
 CALLING SEQUENCE:
   EDS=climada_EDS_calc(entity,hazard,annotation_name)
 EXAMPLE:
   EDS=climada_EDS_calc(climada_assets_encode(climada_assets_read))
 INPUTS:
   entity: a read and encoded assets file, see climada_assets_encode(climada_assets_read)
       &ampgt promted for if not given
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   annotation_name: a free text that will appear e.g. on plots for
       annotation, default is the name of the hazard set
   force_re_encode: if =1, force re-encoding (either to be on the safe
       side, or if the entity has been encoded t a different hazard event
       set). Default=0
   silent_mode: suppress any output to stdout (useful i.e. if called many times)
       defult=0 (output to stdout), =1: no output and no waitbar at all
       (neither to stdout nor as progress bar)
 OUTPUTS:
   EDS, the event damage set with:
       ED: the total expected annual damage (=EDS.damage*EDS.frequency')
       reference_year: the year the damages are references to
       event_ID(event_i): the unique ID for each event_i
       damage(event_i): the damage amount for event_i (summed up over all
           assets)
       ED_at_centroid(centroid_i): expected damage at each centroid
       Value: the sum of all Values used in the calculation (to e.g.
           express damages in percentage of total Value)
       frequency(event_i): the per occurrence event frequency for each event_i
       orig_event_flag(event_i): whether an original event (=1) or a
           probabilistic one (=0)
       comment: a free comment, contains time for calculation
       hazard: itself a structure, with:
           filename: the filename of the hazard event set
           comment: a free comment
       assets.lat(asset_i): the latitude of each asset_i
       assets.lon(asset_i): the longitude of each asset_i
       assets.Value(asset_i): the Value of asset_i, i.e. used to show
           ED_at_centroid in percentage of asset value.
       assets.filename: the filename of the assets
       assets.admin0_name: the admin0_name of the assets (optional)
       assets.admin0_ISO3: the admin0_ISO3 code of the assets (optional)
       assets.admin1_name: the admin1_name of the assets (optional)
       assets.admin1_code: the admin1_code of the assets (optional)
       damagefunctions.filename: the filename of the damagefunctions
       annotation_name: a kind of default title (sometimes empty)
 MODIFICATION HISTORY:
 Borja G. Reguero - borjagreguero@gmail.com - creation 
 David N. Bresch, david.bresch@gmail.com, 20170107, EDS_at_centroid renamed to damage_at_centroid
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_EDS_calc_coastal.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_calc_coastal_oneasset">
<H2>climada_EDS_calc_coastal_oneasset</H2></A>
<font color="blue">function EDS=climada_EDS_calc_coastal_oneasset(entity,hazard,annotation_name,force_re_encode,silent_mode) </font>
 climada calculate event damage set for coastal areas 
 MAIN DIFFERENCE WITH climada_EDS_calc: 
   Factors in the topography and elevation of assets. Therefore, the
   interpolation with the damage curves varies. 
 NOTE: 
   only works for 1 type of asset value. 
   to include more types of buildings, prepare a loop outside this
   function, the same way that is done for adapation measures. 
 NAME:
   climada_EDS_calc
 PURPOSE:
   given an encoded entity (assets and damage functions) and a hazard
   event set, calculate the event damage set (EDS). The event damage set
   contains the event damage for each hazard event. In case you set
   climada_global.damage_at_centroid=1, the damage is also stored for each
   event at each centroids (be aware of memory implications). The exepcted
   damage is always stored at each centroid, see EDS.ED_at_centroid.

   Note that the waitbar consumes quite some time, so switch it off by
   setting climada_global.waitbar=0 or by
   using the climada_code_optimizer, which removes all slowing code, i.e.
   all code lines marked by % CLIMADA_OPT - but by now, the code is pretty
   fast, hence climada_code_optimizer does usually not bring huge
   improvements.

   next (likely): climada_EDS_DFC, climada_EDS_DFC_report
 CALLING SEQUENCE:
   EDS=climada_EDS_calc(entity,hazard,annotation_name)
 EXAMPLE:
   EDS=climada_EDS_calc(climada_assets_encode(climada_assets_read))
 INPUTS:
   entity: a read and encoded assets file, see climada_assets_encode(climada_assets_read)
       &ampgt promted for if not given
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   annotation_name: a free text that will appear e.g. on plots for
       annotation, default is the name of the hazard set
   force_re_encode: if =1, force re-encoding (either to be on the safe
       side, or if the entity has been encoded t a different hazard event
       set). Default=0
   silent_mode: suppress any output to stdout (useful i.e. if called many times)
       defult=0 (output to stdout), =1: no output and no waitbar at all
       (neither to stdout nor as progress bar)
 OUTPUTS:
   EDS, the event damage set with:
       ED: the total expected annual damage (=EDS.damage*EDS.frequency')
       reference_year: the year the damages are references to
       event_ID(event_i): the unique ID for each event_i
       damage(event_i): the damage amount for event_i (summed up over all
           assets)
       ED_at_centroid(centroid_i): expected damage at each centroid
       Value: the sum of all Values used in the calculation (to e.g.
           express damages in percentage of total Value)
       frequency(event_i): the per occurrence event frequency for each event_i
       orig_event_flag(event_i): whether an original event (=1) or a
           probabilistic one (=0)
       comment: a free comment, contains time for calculation
       hazard: itself a structure, with:
           filename: the filename of the hazard event set
           comment: a free comment
       assets.lat(asset_i): the latitude of each asset_i
       assets.lon(asset_i): the longitude of each asset_i
       assets.Value(asset_i): the Value of asset_i, i.e. used to show
           ED_at_centroid in percentage of asset value.
       assets.filename: the filename of the assets
       assets.admin0_name: the admin0_name of the assets (optional)
       assets.admin0_ISO3: the admin0_ISO3 code of the assets (optional)
       assets.admin1_name: the admin1_name of the assets (optional)
       assets.admin1_code: the admin1_code of the assets (optional)
       damagefunctions.filename: the filename of the damagefunctions
       annotation_name: a kind of default title (sometimes empty)
 MODIFICATION HISTORY:
 Borja G. Reguero - borjagreguero@gmail.com - creation 
 David N. Bresch, david.bresch@gmail.com, 20170107, damage_at_centroid renamed to damage_at_centroid
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_EDS_calc_coastal_oneasset.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_arrow_2015">
<H2>climada_arrow_2015</H2></A>
<font color="blue">function [h,yy,zz] = climada_arrow_2015(varargin) </font>
 ARROW  Draw a line with an arrowhead.

  ARROW(Start,Stop) draws a line with an arrow from Start to Stop (points
        should be vectors of length 2 or 3, or matrices with 2 or 3
        columns), and returns the graphics handle of the arrow(s).

        A copy of arrow, just to fix the following 'bug':
        Undefined function 'arrow' for input arguments of type 'double'
        The present version does read double...

  ARROW uses the mouse (click-drag) to create an arrow.

  ARROW DEMO &amp ARROW DEMO2 show 3-D &amp 2-D demos of the capabilities of ARROW.

  ARROW may be called with a normal argument list or a property-based list.
        ARROW(Start,Stop,Length,BaseAngle,TipAngle,Width,Page,CrossDir) is
        the full normal argument list, where all but the Start and Stop
        points are optional.  If you need to specify a later argument (e.g.,
        Page) but want default values of earlier ones (e.g., TipAngle),
        pass an empty matrix for the earlier ones (e.g., TipAngle=[]).

  ARROW('Property1',PropVal1,'Property2',PropVal2,...) creates arrows with the
        given properties, using default values for any unspecified or given as
        'default' or NaN.  Some properties used for line and patch objects are
        used in a modified fashion, others are passed directly to LINE, PATCH,
        or SET.  For a detailed properties explanation, call ARROW PROPERTIES.

        Start         The starting points.                     B
        Stop          The end points.                         /|\           ^
        Length        Length of the arrowhead in pixels.     /|||\          |
        BaseAngle     Base angle in degrees (ADE).          //|||\\        L|
        TipAngle      Tip angle in degrees (ABC).          ///|||\\\       e|
        Width         Width of the base in pixels.        ////|||\\\\      n|
        Page          Use hardcopy proportions.          /////|D|\\\\\     g|
        CrossDir      Vector || to arrowhead plane.     ////  |||  \\\\    t|
        NormalDir     Vector out of arrowhead plane.   ///    |||    \\\   h|
        Ends          Which end has an arrowhead.     //&amplt-----&ampgt||      \\   |
        ObjectHandles Vector of handles to update.   /   base |||        \  V
                                                    E    angle||&amplt--------&ampgtC
  ARROW(H,'Prop1',PropVal1,...), where H is a                 |||tipangle
        vector of handles to previously-created arrows        |||
        and/or line objects, will update the previously-      |||
        created arrows according to the current view       --&ampgt|A|&amplt-- width
        and any specified properties, and will convert
        two-point line objects to corresponding arrows.  ARROW(H) will update
        the arrows if the current view has changed.  Root, figure, or axes
        handles included in H are replaced by all descendant Arrow objects.

  A property list can follow any specified normal argument list, e.g.,
  ARROW([1 2 3],[0 0 0],36,'BaseAngle',60) creates an arrow from (1,2,3) to
  the origin, with an arrowhead of length 36 pixels and 60-degree base angle.

  The basic arguments or properties can generally be vectorized to create
  multiple arrows with the same call.  This is done by passing a property
  with one row per arrow, or, if all arrows are to have the same property
  value, just one row may be specified.

  You may want to execute AXIS(AXIS) before calling ARROW so it doesn't change
  the axes on you; ARROW determines the sizes of arrow components BEFORE the
  arrow is plotted, so if ARROW changes axis limits, arrows may be malformed.

  This version of ARROW uses features of MATLAB 6.x and is incompatible with
  earlier MATLAB versions (ARROW for MATLAB 4.2c is available separately);
  some problems with perspective plots still exist.
 Copyright (c)1995-2009, Dr. Erik A. Johnson &ampltJohnsonE@usc.edu&ampgt, 5/20/2009
 http://www.usc.edu/civil_eng/johnsone/
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_arrow_2015.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_arrow_orig">
<H2>climada_arrow_orig</H2></A>
<font color="blue">function [h,yy,zz] = climada_arrow(varargin) </font>
 ARROW  Draw a line with an arrowhead.

  ARROW(Start,Stop) draws a line with an arrow from Start to Stop (points
        should be vectors of length 2 or 3, or matrices with 2 or 3
        columns), and returns the graphics handle of the arrow(s).

        A copy of arrow, just to fix the following 'bug':
        Undefined function 'arrow' for input arguments of type 'double'
        The present version does read double...

  ARROW uses the mouse (click-drag) to create an arrow.

  ARROW DEMO &amp ARROW DEMO2 show 3-D &amp 2-D demos of the capabilities of ARROW.

  ARROW may be called with a normal argument list or a property-based list.
        ARROW(Start,Stop,Length,BaseAngle,TipAngle,Width,Page,CrossDir) is
        the full normal argument list, where all but the Start and Stop
        points are optional.  If you need to specify a later argument (e.g.,
        Page) but want default values of earlier ones (e.g., TipAngle),
        pass an empty matrix for the earlier ones (e.g., TipAngle=[]).

  ARROW('Property1',PropVal1,'Property2',PropVal2,...) creates arrows with the
        given properties, using default values for any unspecified or given as
        'default' or NaN.  Some properties used for line and patch objects are
        used in a modified fashion, others are passed directly to LINE, PATCH,
        or SET.  For a detailed properties explanation, call ARROW PROPERTIES.

        Start         The starting points.                     B
        Stop          The end points.                         /|\           ^
        Length        Length of the arrowhead in pixels.     /|||\          |
        BaseAngle     Base angle in degrees (ADE).          //|||\\        L|
        TipAngle      Tip angle in degrees (ABC).          ///|||\\\       e|
        Width         Width of the base in pixels.        ////|||\\\\      n|
        Page          Use hardcopy proportions.          /////|D|\\\\\     g|
        CrossDir      Vector || to arrowhead plane.     ////  |||  \\\\    t|
        NormalDir     Vector out of arrowhead plane.   ///    |||    \\\   h|
        Ends          Which end has an arrowhead.     //&amplt-----&ampgt||      \\   |
        ObjectHandles Vector of handles to update.   /   base |||        \  V
                                                    E    angle||&amplt--------&ampgtC
  ARROW(H,'Prop1',PropVal1,...), where H is a                 |||tipangle
        vector of handles to previously-created arrows        |||
        and/or line objects, will update the previously-      |||
        created arrows according to the current view       --&ampgt|A|&amplt-- width
        and any specified properties, and will convert
        two-point line objects to corresponding arrows.  ARROW(H) will update
        the arrows if the current view has changed.  Root, figure, or axes
        handles included in H are replaced by all descendant Arrow objects.

  A property list can follow any specified normal argument list, e.g.,
  ARROW([1 2 3],[0 0 0],36,'BaseAngle',60) creates an arrow from (1,2,3) to
  the origin, with an arrowhead of length 36 pixels and 60-degree base angle.

  The basic arguments or properties can generally be vectorized to create
  multiple arrows with the same call.  This is done by passing a property
  with one row per arrow, or, if all arrows are to have the same property
  value, just one row may be specified.

  You may want to execute AXIS(AXIS) before calling ARROW so it doesn't change
  the axes on you; ARROW determines the sizes of arrow components BEFORE the
  arrow is plotted, so if ARROW changes axis limits, arrows may be malformed.

  This version of ARROW uses features of MATLAB 6.x and is incompatible with
  earlier MATLAB versions (ARROW for MATLAB 4.2c is available separately);
  some problems with perspective plots still exist.
 Copyright (c)1995-2009, Dr. Erik A. Johnson &ampltJohnsonE@usc.edu&ampgt, 5/20/2009
 http://www.usc.edu/civil_eng/johnsone/
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_arrow_orig.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_calculate_ACE">
<H2>climada_calculate_ACE</H2></A>
<font color="blue">function ACE= climada_calculate_ACE(tc_track, name_tag, check_printplot) </font>
 climada template
 MODULE:
   coastal_hazards
 NAME:
   climada_plot_ACE
 PURPOSE:
   given a probabilistic tc_track structure, histograms of ACE, No. storms,
   hurricanes and major hurricanes per season and compare with historical
   histograms (black dotted lines), check distributions
   ACE of a season is calculated by summing the squares of the estimated 
   maximum sustained velocity of
   - every active tropical storm (wind speed 35 knots (65 km/h) or higher),
   - at six-hour intervals. 
 
   ---------------------------------------------
   ACCUMULATED CYCLONE ENERGY ACE
	The ACE of a season is calculated by 
	summing the squares of the estimated maximum sustained velocity of
	- every active tropical storm (wind speed 35 knots (65 km/h) or higher),
	- at six-hour intervals. 
   ---------------------------------------------

 plot histograms of Accumulated Cyclone Energy ACE, No. of storms per
 seasons, No. of hurricanes and No. of major hurricanes per season of
 probabilistic tracks, with historical tracks indicated with dotted black
 lines
   previous step:  generation of probabilistic tracks, 
   tc_track_prob = climada_tc_random_walk_position_windspeed;
   next step:      
 CALLING SEQUENCE:
   climada_plot_ACE(tc_track, name_tag, check_printplot)
 EXAMPLE:
   climada_plot_ACE(tc_track_prob, '4480', 1)
 INPUTS:
   tc_track: probabilistic tc track set (random walk of wind speed, 
   longitude and latitude), wind speed in knots, nodes every six hours
 OPTIONAL INPUT PARAMETERS:
   name_tag:        string that will be used for name of printed pdf
   check_printplot: if set to 1 will print (save) figure
 OUTPUTS:
   figure, printout of figure if requested
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20110621
 davids.bresch@gmail.com, 20120407
 davids.bresch@gmail.com, 20170712, debugged
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_calculate_ACE.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_calculate_LTtrend">
<H2>climada_calculate_LTtrend</H2></A>
<font color="blue">function [cf_lineal]=climada_calculate_LTtrend(Time,series,varargin) </font>
 climada
 MODULE:
   climada_coastal 
 NAME:
   climada_get_SLRhistorical
 PURPOSE:
   get Sea Level Rise historical time series at points 
 CALLING SEQUENCE:
   climada_get_SLRhistorical(X,Y);
 EXAMPLE:
   climada_get_SLRhistorical(param1,param2);
 INPUTS:
   Xp,Yp: 
       coordinates where to extract SLR 
 OPTIONAL INPUT PARAMETERS:
 
 OUTPUTS:
 
 MODIFICATION HISTORY:
 	Borja G. Reguero - borjagreguero@gmail.com - 02262016
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_calculate_LTtrend.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_calculate_storms_stats">
<H2>climada_calculate_storms_stats</H2></A>
<font color="blue">function [storms_stats]= climada_calculate_storms_stats(tc_track) </font>
 ---------------------------------------------
% ACCUMULATED CYCLONE ENERGY ACE
 % The ACE of a season is calculated by 
 % summing the squares of the estimated maximum sustained velocity of
 % - every active tropical storm (wind speed 35 knots (65 km/h) or higher),
 % - at six-hour intervals. 
 ---------------------------------------------

 plot histograms of Accumulated Cyclone Energy ACE, No. of storms per
 seasons, No. of hurricanes and No. of major hurricanes per season of
 probabilistic tracks, with historical tracks indicated with dotted black
 lines
 NAME:
   climada_plot_ACE
 PURPOSE:
   given a probabilistic tc_track structure, histograms of ACE, No. storms,
   hurricanes and major hurricanes per season and compare with historical
   histograms (black dotted lines), check distributions
   ACE of a season is calculated by summing the squares of the estimated 
   maximum sustained velocity of
   - every active tropical storm (wind speed 35 knots (65 km/h) or higher),
   - at six-hour intervals. 
 
   previous step:  generation of probabilistic tracks, 
   tc_track_prob = climada_tc_random_walk_position_windspeed;
   next step:      
 CALLING SEQUENCE:
   climada_plot_compare_tc_tracks(tc_track, name_tag, check_printplot)
 EXAMPLE:
   climada_plot_compare_tc_tracks(tc_track_prob,tc_track_cc, '4480', 1)
 INPUTS:
   tc_track: probabilistic tc track set (random walk of wind speed, 
   longitude and latitude), wind speed in knots, nodes every six hours
 OPTIONAL INPUT PARAMETERS:
   name_tag:        string that will be used for name of printed pdf
   check_printplot: if set to 1 will print (save) figure
 OUTPUTS:
   figure, printout of figure if requested
 RESTRICTIONS:
 MODIFICATION HISTORY:
 borjagreguero@gmail.com, 20160818
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_calculate_storms_stats.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_calculate_storms_stats_inregion">
<H2>climada_calculate_storms_stats_inregion</H2></A>
<font color="blue">function [storms_stats]= climada_calculate_storms_stats_inregion(tc_track,inregion) </font>
 ---------------------------------------------
% ACCUMULATED CYCLONE ENERGY ACE
 % The ACE of a season is calculated by 
 % summing the squares of the estimated maximum sustained velocity of
 % - every active tropical storm (wind speed 35 knots (65 km/h) or higher),
 % - at six-hour intervals. 
 ---------------------------------------------

 plot histograms of Accumulated Cyclone Energy ACE, No. of storms per
 seasons, No. of hurricanes and No. of major hurricanes per season of
 probabilistic tracks, with historical tracks indicated with dotted black
 lines
 NAME:
   climada_plot_ACE
 PURPOSE:
   given a probabilistic tc_track structure, histograms of ACE, No. storms,
   hurricanes and major hurricanes per season and compare with historical
   histograms (black dotted lines), check distributions
   ACE of a season is calculated by summing the squares of the estimated 
   maximum sustained velocity of
   - every active tropical storm (wind speed 35 knots (65 km/h) or higher),
   - at six-hour intervals. 
 
   previous step:  generation of probabilistic tracks, 
   tc_track_prob = climada_tc_random_walk_position_windspeed;
   next step:      
 CALLING SEQUENCE:
   climada_plot_compare_tc_tracks(tc_track, name_tag, check_printplot)
 EXAMPLE:
   climada_plot_compare_tc_tracks(tc_track_prob,tc_track_cc, '4480', 1)
 INPUTS:
   tc_track: probabilistic tc track set (random walk of wind speed, 
   longitude and latitude), wind speed in knots, nodes every six hours
 OPTIONAL INPUT PARAMETERS:
   name_tag:        string that will be used for name of printed pdf
   check_printplot: if set to 1 will print (save) figure
 OUTPUTS:
   figure, printout of figure if requested
 RESTRICTIONS:
 MODIFICATION HISTORY:
 borjagreguero@gmail.com, 20160818
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_calculate_storms_stats_inregion.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_coastal_plot_DFC">
<H2>climada_coastal_plot_DFC</H2></A>
<font color="blue">function handle_fig = climada_coastal_plot_IFC(s2plot) </font>
andle_fig = figure
old on
f isfield(s2plot,'R'),     plot(s2plot.R  , s2plot.intensity_sort    , '-b')
f isfield(s2plot,'R_fit'), plot(s2plot.R_fit  , s2plot.intensity_fit    , '.-k')
f isfield(s2plot,'R_ori'), plot(s2plot.R_ori  , s2plot.intensity_fit_ori, '.-r')
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_coastal_plot_DFC.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_colormap_coastal">
<H2>climada_colormap_coastal</H2></A>
<font color="blue">function [cmap c_ax] = climada_colormap_coastal(peril_ID) </font>
 climada color map
 NAME:
   climada_colormap
 PURPOSE:
   a helper function, returns a color map for specified perils
 CALLING SEQUENCE:
   cmap = climada_colormap(peril_ID)
 EXAMPLE:
   cmap = climada_colormap('TC')
 INPUTS:
   peril_ID: a peril ID, currently implemented are TC, TS and TR
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141121, raw documentation
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_colormap_coastal.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_compare_windfields">
<H2>climada_compare_windfields</H2></A>
<font color="blue">function res  = climada_compare_windfields(tc_track, centroids, ... </font>
   equal_timestep, silent_mode, check_plot,unit_)
 generate hazard surge set from 1 tc_track 
 NAME:
   climada_tc_hazard_surge_CENAPRED
 PURPOSE:
   generate tropical cyclone hazard surge set from the CENAPRED formula
   originally for MEXICO coastline 
   calls climada_tc_surgefield which calculates the surge footprint for
   one single TC track
   previous: likely climada_random_walk &amp climada_tc_windfield 
   next: diverse, see manual, since this code generates the tropical
   cyclone surge hazard event set, to be used by climada_EDS_calc etc.
 CALLING SEQUENCE:
   hazard = climada_tc_hazard_surge_CENAPRED(tc_track,hazard_set_file,centroids)
 EXAMPLE:
   hazard = climada_tc_hazard_surge_CENAPRED(tc_track)
 INPUTS:
   region: area of study [x-left x-right y-bottom y-right]
 OPTIONAL INPUT PARAMETERS:
   tc_track: a tc_track structure (see climada_tc_read_unisys_database),
       or a filename of a saved one
       details: see e.g. climada_random_walk
       &ampgt promted for if not given
   hazard_set_file: the name of the hazard set file to be created, in
       which all the storm surge footrpints will be stored (in essence a
       sparse matrix with storm surge heit for each event at each centroid)
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           Longitude(1,:): the longitudes   
           Latitude(1,:): the latitudes   
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a file which contains the struct (saved after climada_centroids_read)
       if you select Cancel, a regular default grid is used, see
       hard-wired definition in code (sometimes useful for TEST purposesI
   checkplot: if =1, draw graphics 

 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
           tropical cyclone or 'TS' for tropical cycloes surge... only needed
           later for sanity tests, such that e.g. hazards are not messed up
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon (info only,
           not used in calculation)
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one (this information comes from
           tc_track
       event_ID: a unique ID for each event. Note that in case you'd like
           to combine later say wind and surge damages, make sure you generate
           exactly the same events with matching IDs, as this allows to sum up
           event damage sets (EDS)
       date: the creation date of the set (info only)
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event (annual event
           occurence frequency)
       matrix_density: the density of the sparse array hazard.arr
       surgefield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful, since some code checks for
           consistency by checking whether this field is the same.
 MODIFICATION HISTORY:
 Borja G. Reguero  borjagreguero@gmail.com, 20160323, created from
 climada_tc_surgefield 
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_compare_windfields.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_damagefunctions_plot_coastal">
<H2>climada_damagefunctions_plot_coastal</H2></A>
<font color="blue">function res=climada_damagefunctions_plot_coastal(entity,unique_ID_sel) </font>
 climada
 NAME:
   climada_damagefunctions_plot
 PURPOSE:
   Plot the damage functions within entity (if a damagefunctions struct is
   passed, it works, too).

   See also climada_damagefunctions_read
 CALLING SEQUENCE:
   climada_damagefunctions_plot(entity,unique_ID_sel)
   climada_damagefunctions_plot(climada_damagefunctions_read)
 EXAMPLE:
   climada_damagefunctions_plot
 INPUTS:
   entity: an entity, see climada_entity_read
       &ampgt promted for if not given (calling climada_entity_load, not
       climada_entity_read)
       Works also, if just a damagefunctions structure is passed (i.e. the
       same as in entity.damagefunctions, as returned by
       climada_damagefunctions_read)
 OPTIONAL INPUT PARAMETERS:
   unique_ID_sel: a single unique ID or the first n characters of an ID to
       plot only selected damage function(s), as in the case of an entity
       containing many functions, the single panes of the plot might get
       too small). It is recommended to run climada_damagefunctions_plot 
       first without specifying a unique_ID_sel and inspect the single 
       sub-plot headers. Examples are:
       unique_ID_sel='TC 001' % print only the one curve
       unique_ID_sel='TC'     % print all TC curves
 OUTPUTS:
   a figure
   res: a structure with the last (and only the last) damagefunction, with
       fields Intensity, MDD, PAA, MDR for further use. Hence res only
       make sense when called with one unique ID.
 MODIFICATION HISTORY:
 Borja G. Reguero, borjagreguero@gmail.com, 20160628, created 
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_damagefunctions_plot_coastal.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_distribution_v0_vi">
<H2>climada_distribution_v0_vi</H2></A>
<font color="blue">function [mu, sigma, A] = climada_distribution_v0_vi(tc_track, output_unit, check_visible, check_printplot) </font>
 distribution of initial wind speed v0 and change in in wind speed vi
 tc_track has to be recorded at 6h intervals with wind speed in kn
 NAME:
   climada_distribution_v0_vi
 PURPOSE:
   fit normal distribution to inital wind speed from tc tracks and 
   fit normal distribution to 
   previous:   .....
   next:       ....
 CALLING SEQUENCE:
   [mu, sigma] = climada_distribution_v0_vi(tc_name, check_printplot)
 EXAMPLE:
   [mu, sigma] = climada_distribution_v0_vi('all', 1);
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   tc_track:     historical tc tracks, prompted for if not given
   output_unit:      output unit of mu and sigma, e.g. 'kn' for knots or
   'm/s' for m/s, default m/s
   check_visible:    if set to 1 will show figure, default 1
   check_printplot:  if set to 1 will print (save) figure, default 0
 OUTPUTS:
   mu and sigma, mean and standard deviation of fitted normal distribution
   mu:     mean for initial wind speed v0 mu(1) and difference in wind
   speed vi mu(2)
   sigma:  standard deviation for initial wind speed v0 sigma(1) and difference in wind
   speed vi sigma(2)
 MODIFICATION HISTORY:
 Lea Mueller, 20110616
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_distribution_v0_vi.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_calc_diff">
<H2>climada_entity_calc_diff</H2></A>
<font color="blue">function [entity_out] = climada_entity_calc_diff(entity) </font>
 climada assets postprocessing - calculates differences by heights, not
 accumulated assets by elevation 
 
 NAME:
   climada_entity_calc_diff
 PURPOSE:
   calculates differences by heights, not accumulated assets by elevation 
   calculates Value_by_elevation from field Value 

   next step: likely climada_ELS_calc
 CALLING SEQUENCE:
   [entity]=climada_entity_calc_diff(entity)
 EXAMPLE:
   entity=climada_entity_calc_diff;
 INPUTS:
   entity_filename: the filename of the Excel (or .ods) file with the assets
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       &ampgt promted for if not given (out of climada_assets_encode)
       ='NOENCODE' or 'noencode': do not encode assets, see climada_assets_encode
 OUTPUTS:
   entity: a structure, with
       assets: a structure, with
           Latitude: the latitude of the values
           Longitude: the longitude of the values
           Value: the total insurable value
           Deductible: the deductible
           Cover: the cover
           DamageFunID: the damagefunction curve ID
       damagefunctions: a structure, with
           DamageFunID: the damagefunction curve ID
           Intensity: the hazard intensity
           MDD: the mean damage degree (severity of single asset damage)
           PAA: the percentage of assets affected
   entity_save_file: the name the encoded entity got saved to
 MODIFICATION HISTORY:
 Borja G. Reguero, borjagreguero@gmail.com, 20160628, created 
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_entity_calc_diff.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_read_coastal">
<H2>climada_entity_read_coastal</H2></A>
<font color="blue">function [entity,entity_save_file] = climada_entity_read_coastal(entity_filename,hazard,COL_DAMFUNID,COLS_IDS,COLS_DATA_BY_ELEV) </font>
 climada assets read import 
 NOTE: modified from climada_entity_read to read assets distributed by 
   elevations 
 NAME:
   climada_entity_read_coastal
 PURPOSE:
   read the file with the assets, damage functions, measures etc.
   climada_assets_encode is automatically invoked

   read also the damagefunctions sheet, if it exists (and run some checks)

   read also the measures sheet, if it exists (in this case,
   climada_measures_encode is automatically invoked)

   read also the discount sheet, if it exists (and run some checks)

   The code invokes climada_spreadsheet_read to really read the data,
   which implements .xls and .ods files

   For .xls, the sheet names are dynamically checked, for .ods, the sheet
   names are hard-wired (see code), means for .ods, all the sheets
   'assets','damagefunctions','measures' and 'discount' need to exist.

   NOTE: For backward compatibility, the code does read OLD entity files
   with a tab vulnerability (instead of damagefunctions) and VulnCurveID ...
   It renames respective fields in the resulting entity structure.

   Please consider climada_damagefunction_read in case you would like to
   read damagefunctions separately.

   OCTAVE: Please install the io package first, ether directly from source
   forge with: pkg install -forge io -auto
   or, (e.g. in case this fails, get the io package first from Octave
   source forge and then install from the downloaded package:
   pkg install {local_path}/io-2.2.5.tar -auto
   Note that it looks like Octave prefers .xlsx files

   next step: likely climada_ELS_calc
 CALLING SEQUENCE:
   [entity,entity_save_file]=climada_entity_read(entity_filename,hazard)
 EXAMPLE:
   entity=climada_entity_read;
 INPUTS:
   entity_filename: the filename of the Excel (or .ods) file with the assets
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       &ampgt promted for if not given (out of climada_assets_encode)
       ='NOENCODE' or 'noencode': do not encode assets, see climada_assets_encode
 OUTPUTS:
   entity: a structure, with
       assets: a structure, with
           Latitude: the latitude of the values
           Longitude: the longitude of the values
           Value: the total insurable value
           Deductible: the deductible
           Cover: the cover
           DamageFunID: the damagefunction curve ID
       damagefunctions: a structure, with
           DamageFunID: the damagefunction curve ID
           Intensity: the hazard intensity
           MDD: the mean damage degree (severity of single asset damage)
           PAA: the percentage of assets affected
   entity_save_file: the name the encoded entity got saved to
 MODIFICATION HISTORY:
 Borja G. Reguero, borjagreguero@gmail.com, 20160628, created 
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_entity_read_coastal.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_getTemporalSerie_AT">
<H2>climada_getTemporalSerie_AT</H2></A>
<font color="blue">function data=climada_getTemporalSerie_AT(lat,lon,dateIni,dateEnd,varargin) </font>
 climada
 MODULE:
   climada_coastal 
 NAME:
   climada_getTemporalSerie_AT
 PURPOSE:
   get time series of astronomic tides at points - global 
 CALLING SEQUENCE:
   climada_getTemporalSerie_AT(lat,lon,dateIni,dateEnd)
 EXAMPLE:
   climada_getTemporalSerie_AT(y0,x0,datenum(1990,1,1),datenum(2016,1,1),'TPXO7.2')
 
 INPUTS:
   -lat: Latitude of the geopoint
   -lon: Longitude of the geopoint    
   -dateIni: Initial date (julian days)
   -dateEnd: End date (julian days)

 OPTIONAL INPUT PARAMETERS:
   version of the tpxo database 7.1 or 7.2 
 
RETURNS:
   -data: Structure with the following fields
       * time: time positions of the series (julian days).
       * lat:  Latitude of the nearest node to the geopoint
       * lon:  Longitude of the nearest node  to the geopoint
       * tide: Astronomical Tide (m)  
 
 MODIFICATION HISTORY:
 	Borja G. Reguero - borjagreguero@gmail.com - 02262016
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_getTemporalSerie_AT.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_get_GlobalWaveClimate">
<H2>climada_get_GlobalWaveClimate</H2></A>
<font color="blue">function [output]=climada_get_GlobalWaveClimate(Xp,Yp, varargin) </font>
 climada
 MODULE:
   climada_coastal 
 NAME:
   climada_get_GlobalWaveClimate
 PURPOSE:
   get global wave data statistics from Reguero et al (2012)
 CALLING SEQUENCE:
   climada_get_GlobalWaveClimate(X,Y);
 EXAMPLE:
   climada_get_GlobalWaveClimate(param1,param2);
 INPUTS:
   Xp,Yp: 
       coordinates where to extract SLR 
 OPTIONAL INPUT PARAMETERS:
 
 OUTPUTS:
 
 MODIFICATION HISTORY:
 	Borja G. Reguero - borjagreguero@gmail.com - Mar/04/2016
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_get_GlobalWaveClimate.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_get_LandSubsidence">
<H2>climada_get_LandSubsidence</H2></A>
<font color="blue">function output=climada_get_LandSubsidence(Xp,Yp) </font>
 climada
 MODULE:
   climada_coastal 
 NAME:
   climada_get_SLRProjection
 PURPOSE:
   get subsidence at points 
 CALLING SEQUENCE:
   climada_get_SLRProjection(X,Y);
 EXAMPLE:
   climada_get_SLRProjection(param1,param2);
 INPUTS:
   Xp,Yp: 
       coordinates where to extract SLR 
 OPTIONAL INPUT PARAMETERS:
   rcps: lis of rcps to extract. Default: rcps ={'RCP26','RCP45','RCP60','RCP85'}
 NOTE: 2.6 for _l is all nans in original file 
 
 Glacial Isostatic Adjustment (GIA) correction for land uplift/subidence.
 GIA_ICE5G change in sea level between 1986-2005 and 2081-2100, in meters (m)
 
 CITE: Chapter 13 paper:\
 Church, J. A., P. Clark, A. Cazenave, J. Gregory, S. Jevrejeva, A. Levermann, M. Merrifield, G. Milne, R.S.Nerem, P. Nunn, A. Payne, W. Pfeffer, D. Stammer, and A. Unnikrishnan (2013), Sea level change, in Climate Change 2013: The Physical Science Basis, edited by T. F. Stocker, D. Qin, G.-K. Plattner, M. Tignor, S. Allen, J. Boschung, A. Nauels, Y. Xia, V. Bex, and P. Midgley, Cambridge University Press, Cambridge, UK and New York, NY. USA.\
 
 Peltier, W. R. (2004), Global glacial isostasy and the surface of the Ice-Age
 Earth: The ICE-5G (VM2) Model and GRACE, Annu. Rev. Earth
 Planet. Sci., 32, 111149, doi:10.1146/annurev.earth.32.082503.144359
 
 OUTPUTS:
 MODIFICATION HISTORY:
 	Borja G. Reguero - borjagreguero@gmail.com - 02262016
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_get_LandSubsidence.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_get_SLRProjection">
<H2>climada_get_SLRProjection</H2></A>
<font color="blue">function output=climada_get_SLRProjection(Xp,Yp,rcps) </font>
 climada
 MODULE:
   climada_coastal 
 NAME:
   climada_get_SLRProjection
 PURPOSE:
   get Sea Level Rise projections at points 
 CALLING SEQUENCE:
   climada_get_SLRProjection(X,Y);
 EXAMPLE:
   climada_get_SLRProjection(param1,param2);
 INPUTS:
   Xp,Yp: 
       coordinates where to extract SLR 
 OPTIONAL INPUT PARAMETERS:
   rcps: lis of rcps to extract. Default: rcps ={'RCP26','RCP45','RCP60','RCP85'}
 NOTE: 2.6 for _l is all nans in original file 

 sea level rise projections for Representative Concentration Pathways 
 Values correspond to mean value of projection (central estimate), and total sea level rise.
 Values correspond to SLR for &quot2081-2100 20-yr mean minus 1986-2005 20-yr mean&quot
 Units: &quotm&quot

 OUTPUTS:
 Projections of sea level rise, organized in a structure for each RCP 
 (Representative Concentration Pathways) 
 
 MODIFICATION HISTORY:
 	Borja G. Reguero - borjagreguero@gmail.com - 02262016
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_get_SLRProjection.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_get_SLRhistorical">
<H2>climada_get_SLRhistorical</H2></A>
<font color="blue">function [output]=climada_get_SLRhistorical(Xp,Yp) </font>
 climada
 MODULE:
   climada_coastal 
 NAME:
   climada_get_SLRhistorical
 PURPOSE:
   get Sea Level Rise historical time series at points 
 CALLING SEQUENCE:
   climada_get_SLRhistorical(X,Y);
 EXAMPLE:
   climada_get_SLRhistorical(param1,param2);
 INPUTS:
   Xp,Yp: 
       coordinates where to extract SLR 
 OPTIONAL INPUT PARAMETERS:
 
 OUTPUTS:
 
 MODIFICATION HISTORY:
 	Borja G. Reguero - borjagreguero@gmail.com - 02262016
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_get_SLRhistorical.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_stats_coastal">
<H2>climada_hazard_stats_coastal</H2></A>
<font color="blue">function hazard_mod = climada_hazard_stats_coastal(hazard,return_periods,field,check_plot,peril_ID,check_printplot) </font>
 NAME:
   climada_hazard_stats
 PURPOSE:
   plot hazard intensity maps for different return periods
   add statistics
     .intensity_fit_ori
     .intensity_fit
     .R_fit (requested return periods)
   intensities for return periods are calculate based on historical and
   probabilistic data set

 CALLING SEQUENCE:
   climada_hazard_stats(hazard,return_periods,check_plot,peril_ID,check_printplot)
 EXAMPLE:
   for wind:
   climada_hazard_stats
   climada_hazard_stats([],[1 5 10 25 50 100 500 1000])
   climada_hazard_stats([],[1 5 10 25 50 100 500 1000],1,'TR') % force rain
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   hazard: hazard structure, if not given, prompted for
       generated by e.g. climada_tc_hazard_set
   return_periods: vector containing the requested return periods
       (e.g. [1 5 10 25 50 100 500 1000])
       if empty, taken from default as defined in climada_init_vars
   check_plot: default=1, draw the intensity maps for various return
       periods. Set=0 to omit plot
   peril_ID: if passed on, setting for colormap etc. used as for specificed peril
       if hazard.peril_ID exists, this ID is used ('TC','WS','TR'...)
       (TC: tropical cyclones, TS: storm surge, TR: torrential rain, WS: winter storm...)
       Currently implemented: TC and TR
       Otherwise, default settings are used.
   check_printplot: if =1, user will be asked to generate a pdf, default=0
 OUTPUTS:
   hazard structure with
   - hazard.intensity_sort:          probabilistic sorted intensity per centroid
   - hazard.intensity_ori_sort:      historical sorted intensity per centroid
   - hazard.R_fit:             requested return periods
   - hazard.intensity_fit_ori: fitted intensity for requested return periods
                               for every centroid for original events
   - hazard.intensity_fit:     fitted intensity for requested return periods
                               for every centroid for all (probabilistic) events
 MODIFICATION HISTORY:
 Lea Mueller, 20110623
 David N. Bresch, david.bresch@gmail.com, 20130317 cleanup
 David N. Bresch, david.bresch@gmail.com, 20140411 fixed some non-TC issues
 David N. Bresch, david.bresch@gmail.com, 20150114, Octave compatibility for -v7.3 mat-files
 Borja G. Reguero, borjagreguero@gmail.com, 20160613, adapted to coastal variables from
 original climada_hazard_stats
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_hazard_stats_coastal.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_init_vars_coastal">
<H2>climada_init_vars_coastal</H2></A>
<font color="blue">function ok=climada_init_vars_coastal(reset_flag) </font>
 init variables global
 NAME:
	climada_init_vars_coastal
 PURPOSE:
	initialize path and filenames for coastal hazard module 

 CALLING SEQUENCE:
	ok=climada_init_vars_coastal(reset_flag)
 EXAMPLE:
	ok=climada_init_vars_coastal;
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   reset_flag: if set to 1, forced re-init
 OUTPUTS:
	ok: =1 if no troubles, 0 else
 MODIFICATION HISTORY:
 Borja G. Reguero  - modified from original climada_init_vars.m 
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_init_vars_coastal.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_compare_tc_tracks">
<H2>climada_plot_compare_tc_tracks</H2></A>
<font color="blue">function [storms_stats1, storms_stats2] = climada_plot_compare_tc_tracks(tc_track1,tc_track2, names_tracks,name_tag, check_printplot) </font>
 ---------------------------------------------
% ACCUMULATED CYCLONE ENERGY ACE
 % The ACE of a season is calculated by 
 % summing the squares of the estimated maximum sustained velocity of
 % - every active tropical storm (wind speed 35 knots (65 km/h) or higher),
 % - at six-hour intervals. 
 ---------------------------------------------

 plot histograms of Accumulated Cyclone Energy ACE, No. of storms per
 seasons, No. of hurricanes and No. of major hurricanes per season of
 probabilistic tracks, with historical tracks indicated with dotted black
 lines
 NAME:
   climada_plot_ACE
 PURPOSE:
   given a probabilistic tc_track structure, histograms of ACE, No. storms,
   hurricanes and major hurricanes per season and compare with historical
   histograms (black dotted lines), check distributions
   ACE of a season is calculated by summing the squares of the estimated 
   maximum sustained velocity of
   - every active tropical storm (wind speed 35 knots (65 km/h) or higher),
   - at six-hour intervals. 
 
   previous step:  generation of probabilistic tracks, 
   tc_track_prob = climada_tc_random_walk_position_windspeed;
   next step:      
 CALLING SEQUENCE:
   climada_plot_compare_tc_tracks(tc_track, name_tag, check_printplot)
 EXAMPLE:
   climada_plot_compare_tc_tracks(tc_track_prob,tc_track_cc, '4480', 1)
 INPUTS:
   tc_track: probabilistic tc track set (random walk of wind speed, 
   longitude and latitude), wind speed in knots, nodes every six hours
 OPTIONAL INPUT PARAMETERS:
   name_tag:        string that will be used for name of printed pdf
   check_printplot: if set to 1 will print (save) figure
 OUTPUTS:
   figure, printout of figure if requested
 RESTRICTIONS:
 MODIFICATION HISTORY:
 borjagreguero@gmail.com, 20160818
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_plot_compare_tc_tracks.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_compare_tc_tracks_inregion">
<H2>climada_plot_compare_tc_tracks_inregion</H2></A>
<font color="blue">function [storms_stats1, storms_stats2] = climada_plot_compare_tc_tracks_inregion(tc_track1,tc_track2, names_tracks,name_tag, check_printplot,inregion) </font>
 ---------------------------------------------
% ACCUMULATED CYCLONE ENERGY ACE
 % The ACE of a season is calculated by 
 % summing the squares of the estimated maximum sustained velocity of
 % - every active tropical storm (wind speed 35 knots (65 km/h) or higher),
 % - at six-hour intervals. 
 ---------------------------------------------

 plot histograms of Accumulated Cyclone Energy ACE, No. of storms per
 seasons, No. of hurricanes and No. of major hurricanes per season of
 probabilistic tracks, with historical tracks indicated with dotted black
 lines
 NAME:
   climada_plot_ACE
 PURPOSE:
   given a probabilistic tc_track structure, histograms of ACE, No. storms,
   hurricanes and major hurricanes per season and compare with historical
   histograms (black dotted lines), check distributions
   ACE of a season is calculated by summing the squares of the estimated 
   maximum sustained velocity of
   - every active tropical storm (wind speed 35 knots (65 km/h) or higher),
   - at six-hour intervals. 
 
   previous step:  generation of probabilistic tracks, 
   tc_track_prob = climada_tc_random_walk_position_windspeed;
   next step:      
 CALLING SEQUENCE:
   climada_plot_compare_tc_tracks(tc_track, name_tag, check_printplot)
 EXAMPLE:
   climada_plot_compare_tc_tracks(tc_track_prob,tc_track_cc, '4480', 1)
 INPUTS:
   tc_track: probabilistic tc track set (random walk of wind speed, 
   longitude and latitude), wind speed in knots, nodes every six hours
 OPTIONAL INPUT PARAMETERS:
   name_tag:        string that will be used for name of printed pdf
   check_printplot: if set to 1 will print (save) figure
 OUTPUTS:
   figure, printout of figure if requested
 RESTRICTIONS:
 MODIFICATION HISTORY:
 borjagreguero@gmail.com, 20160818
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_plot_compare_tc_tracks_inregion.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_ACE_set">
<H2>climada_tc_ACE_set</H2></A>
<font color="blue">function hazard = climada_tc_ACE_set(tc_track, hazard_set_file, centroids) </font>
 climada TC hazard event set generate
 NAME:
   climada_tc_hazard_set
 PURPOSE:
   generate a tc (tropical cyclone) hazard event set

   If centroids.distance2coast_km exists, the hazard intensity is only
   calculated in the coastal_range_km (usually 200km, see PARAMETERS in
   climada_tc_windfield) - this speeds up calculation for large countries
   considerably.

   Special: the hazard event set is stored every 100 tracks in order to
   allow for interruption of the hazard set generation. Just re-start the
   calculation by calling climada_tc_hazard_set with exactly the same
   input parameters (the last track calculated is stored in hazard.track_i
   and the field track_i is removed in the final complete hazard event set).  

   previous: likely climada_random_walk
   next: diverse
 CALLING SEQUENCE:
   res=climada_tc_hazard_set(tc_track,hazard_set_file)
 EXAMPLE:
   res=climada_tc_hazard_set(tc_track)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   tc_track: a TC track structure, or a filename of a saved one
       details: see e.g. climada_tc_random_walk
       &ampgt promted for if not given
   hazard_set_file: the name and path of the hazard set file
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           Longitude(1,:): the longitudes
           Latitude(1,:): the latitudes
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a .mat-file which contains a centroids struct (saved by
       climada_centroids_read) or the filename of an Excel file (the original
       input to climada_centroids_read) which holds the centroids, in
       which case climada_centroids_read is called.
       OR: an entity, in which case the entity.assets.lat and
       Longitude are used as centroids.
       &ampgt promted for .mat or .xls filename if not given
       NOTE: if you then select Cancel, a regular default grid is used, see hard-wired definition in code
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
       tropical cyclone or 'ET' for extratropical cyclone
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event
       matrix_density: the density of the sparse array hazard.intensity
       windfield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090729
 David N. Bresch, david.bresch@gmail.com, 20130506, centroids filename handling improved
 David N. Bresch, david.bresch@gmail.com, 20140421, waitbar with secs
 David N. Bresch, david.bresch@gmail.com, 20141226, optional fields in centroids added
 David N. Bresch, david.bresch@gmail.com, 20150103, equal_timestep (much) improved
 Borja G. Reguero, borjagreguero@gmail.com, 20160322, created for
 calculting ACE after modifying climada_tc_hazard_set
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_tc_ACE_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_equal_timestep_coastal">
<H2>climada_tc_equal_timestep_coastal</H2></A>
<font color="blue">function tc_track=climada_tc_equal_timestep_coastal(tc_track,default_min_TimeStep) </font>
 tropical cyclone track timstep datenum
 NAME:
   climada_tc_equal_timestep
 PURPOSE:
   Interpolate tc_track to equal timestep, usually 1h

   Uses linear interpolation for all fields (for speedup) and removes the
   (anyway unused) field 'extratrop' (of the form '****..EEE')

   Works to interpolate on any timestep between first and last node,
   timestep measured in hours. Note that time step shall 'fit' within
   start and end, e.g. 0:6:24 -&ampgt [0 6 12 18 24], but 0:5:24 -&ampgt [0 5 10 15 20]

 CALLING SEQUENCE:
   tc_track=climada_tc_equal_timestep(tc_track,default_min_TimeStep)
 EXAMPLE:
   tc_track=climada_tc_equal_timestep(tc_track)
 INPUTS:
   tc_track: a tc_track structure (a single track or many), eg as returned
       by climada_tc_read_unisys_database or climada_tc_read_unisys_track 
 OPTIONAL INPUT PARAMETERS:
   default_min_TimeStep: the default minimum TimeStep in hours
       (default=1 hour as defined in climada_global.tc.default_min_TimeStep)
 OUTPUTS:
   tc_track: a tc_track structure, with equal timesteps and copy of
       time-independent fields
 MODIFICATION HISTORY:
 David N. Bresch, david_bresch@gmail.com, 20040911, 20081006
 Mathias Hauser, 20120507
 Lea Mueller, 20121203
 David N. Bresch, david_bresch@gmail.com, 20040911, new version of MATLAB does not like adding empty stuff
 David N. Bresch, david_bresch@gmail.com, 20141231, datevecmx replaced
 David N. Bresch, david_bresch@gmail.com, 20150103, simplified (a lot) and about five times faster
 David N. Bresch, david_bresch@gmail.com, 20150119, lat/lon interpolation switched to spline
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_tc_equal_timestep_coastal.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_hazard_surge">
<H2>climada_tc_hazard_surge</H2></A>
<font color="blue">function hazard  = climada_tc_hazard_surge(tc_track,hazard_set_file,centroids,... </font>
   wave_models, surge_models, silent_mode,check_plot)
 climada_tc_hazard_surge(boundingbox,bathy,rSLR,tc_track,hazard_set_file,centroids,transects,  ...
                                             dirout, silent_mode, check_plot,storm_vec,keyout_storms)
 generate hazard surge and wave set from tc_tracks for tropical cyclones 
 NAME:
   climada_tc_hazard_surge
 PURPOSE:
   generate tropical cyclone hazard surge set
   calls climada_tc_surgefield which calculates the surge footprint for
   one single TC track
   previous: likely climada_random_walk
   next: diverse, see manual, since this code generates the tropical
   cyclone surge hazard event set, to be used by climada_EDS_calc etc.
 CALLING SEQUENCE:
   hazard = climada_tc_hazard_surge(tc_track,hazard_set_file,centroids)
 EXAMPLE:
   hazard = climada_tc_hazard_surge(tc_track)
 INPUTS:
   type_hazards: [0/1 0/1] = binary for [waves surge]
 OPTIONAL INPUT PARAMETERS:
   tc_track: a tc_track structure (see climada_tc_read_unisys_database),
       or a filename of a saved one
       details: see e.g. climada_random_walk
       &ampgt promted for if not given
   hazard_set_file: the name of the hazard set file to be created, in
       which all the storm surge footrpints will be stored (in essence a
       sparse matrix with storm surge heit for each event at each centroid)
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           Longitude(1,:): the longitudes   
           Latitude(1,:): the latitudes   
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a file which contains the struct (saved after climada_centroids_read)
       if you select Cancel, a regular default grid is used, see
       hard-wired definition in code (sometimes useful for TEST purposesI
   checkplot: if =1, draw graphics 

 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
           tropical cyclone or 'TS' for tropical cycloes surge... only needed
           later for sanity tests, such that e.g. hazards are not messed up
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon (info only,
           not used in calculation)
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one (this information comes from
           tc_track
       event_ID: a unique ID for each event. Note that in case you'd like
           to combine later say wind and surge damages, make sure you generate
           exactly the same events with matching IDs, as this allows to sum up
           event damage sets (EDS)
       date: the creation date of the set (info only)
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event (annual event
           occurence frequency)
       matrix_density: the density of the sparse array hazard.arr
       surgefield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful, since some code checks for
           consistency by checking whether this field is the same.
 MODIFICATION HISTORY:
 David Bresch,     david.bresch@gmail.com,  20130719, initial setup for surge
 Borja G. Reguero  borjagreguero@gmail.com, 20130816, wave field and SS 
 Borja G. Reguero  borjagreguero@gmail.com, 20160328, MAJOR MOD. adaptated 
 for new version of module and more models for surge. 
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_tc_hazard_surge.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_hazard_surge_CENAPRED">
<H2>climada_tc_hazard_surge_CENAPRED</H2></A>
<font color="blue">function res  = climada_tc_hazard_surge_CENAPRED(tc_track, centroids, ... </font>
   equal_timestep, silent_mode, check_plot,unit_)
 generate hazard surge set from 1 tc_track 
 NAME:
   climada_tc_hazard_surge_CENAPRED
 PURPOSE:
   generate tropical cyclone hazard surge set from the CENAPRED formula
   originally for MEXICO coastline 
   calls climada_tc_surgefield which calculates the surge footprint for
   one single TC track
   previous: likely climada_random_walk &amp climada_tc_windfield 
   next: diverse, see manual, since this code generates the tropical
   cyclone surge hazard event set, to be used by climada_EDS_calc etc.
 CALLING SEQUENCE:
   hazard = climada_tc_hazard_surge_CENAPRED(tc_track,hazard_set_file,centroids)
 EXAMPLE:
   hazard = climada_tc_hazard_surge_CENAPRED(tc_track)
 INPUTS:
   region: area of study [x-left x-right y-bottom y-right]
 OPTIONAL INPUT PARAMETERS:
   tc_track: a tc_track structure (see climada_tc_read_unisys_database),
       or a filename of a saved one
       details: see e.g. climada_random_walk
       &ampgt promted for if not given
   hazard_set_file: the name of the hazard set file to be created, in
       which all the storm surge footrpints will be stored (in essence a
       sparse matrix with storm surge heit for each event at each centroid)
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           Longitude(1,:): the longitudes   
           Latitude(1,:): the latitudes   
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a file which contains the struct (saved after climada_centroids_read)
       if you select Cancel, a regular default grid is used, see
       hard-wired definition in code (sometimes useful for TEST purposesI
   checkplot: if =1, draw graphics 

 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
           tropical cyclone or 'TS' for tropical cycloes surge... only needed
           later for sanity tests, such that e.g. hazards are not messed up
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon (info only,
           not used in calculation)
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one (this information comes from
           tc_track
       event_ID: a unique ID for each event. Note that in case you'd like
           to combine later say wind and surge damages, make sure you generate
           exactly the same events with matching IDs, as this allows to sum up
           event damage sets (EDS)
       date: the creation date of the set (info only)
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event (annual event
           occurence frequency)
       matrix_density: the density of the sparse array hazard.arr
       surgefield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful, since some code checks for
           consistency by checking whether this field is the same.
 MODIFICATION HISTORY:
 Borja G. Reguero  borjagreguero@gmail.com, 20160323, created from
 climada_tc_surgefield 
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_tc_hazard_surge_CENAPRED.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_hazard_surge_CENAPRED_field">
<H2>climada_tc_hazard_surge_CENAPRED_field</H2></A>
<font color="blue">function res  = climada_tc_hazard_surge_CENAPRED_field(tc_track, centroids, ... </font>
   equal_timestep, silent_mode, check_plot)
 generate hazard surge set from 1 tc_track 
 NAME:
   climada_tc_hazard_surge_CENAPRED
 PURPOSE:
   generate tropical cyclone hazard surge set from the CENAPRED formula
   originally for MEXICO coastline 
   calls climada_tc_surgefield which calculates the surge footprint for
   one single TC track
   previous: likely climada_random_walk &amp climada_tc_windfield 
   next: diverse, see manual, since this code generates the tropical
   cyclone surge hazard event set, to be used by climada_EDS_calc etc.
 CALLING SEQUENCE:
   hazard = climada_tc_hazard_surge_CENAPRED(tc_track,hazard_set_file,centroids)
 EXAMPLE:
   hazard = climada_tc_hazard_surge_CENAPRED(tc_track)
 INPUTS:
   tc_track - cyclone track to calculate 
   centroids - centroids with lon lat coordinates and ID 
 
 OPTIONAL INPUT PARAMETERS:
   tc_track: a tc_track structure (see climada_tc_read_unisys_database),
       or a filename of a saved one
       details: see e.g. climada_random_walk
       &ampgt promted for if not given
   hazard_set_file: the name of the hazard set file to be created, in
       which all the storm surge footrpints will be stored (in essence a
       sparse matrix with storm surge heit for each event at each centroid)
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           Longitude(1,:): the longitudes   
           Latitude(1,:): the latitudes   
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a file which contains the struct (saved after climada_centroids_read)
       if you select Cancel, a regular default grid is used, see
       hard-wired definition in code (sometimes useful for TEST purposesI
   checkplot: if =1, draw graphics 

 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
           tropical cyclone or 'TS' for tropical cycloes surge... only needed
           later for sanity tests, such that e.g. hazards are not messed up
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon (info only,
           not used in calculation)
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one (this information comes from
           tc_track
       event_ID: a unique ID for each event. Note that in case you'd like
           to combine later say wind and surge damages, make sure you generate
           exactly the same events with matching IDs, as this allows to sum up
           event damage sets (EDS)
       date: the creation date of the set (info only)
       surge(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event (annual event
           occurence frequency)
       matrix_density: the density of the sparse array hazard.surge
       surgefield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful, since some code checks for
           consistency by checking whether this field is the same.
 MODIFICATION HISTORY:
 Borja G. Reguero  borjagreguero@gmail.com, 20160323, created from
 climada_tc_surgefield 
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_tc_hazard_surge_CENAPRED_field.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_hazard_surge_DD92_mslope">
<H2>climada_tc_hazard_surge_DD92_mslope</H2></A>
<font color="blue">function res  = climada_tc_hazard_surge_DD92_mslope(tc_track, centroids, ... </font>
   silent_mode, check_plot)
 generate hazard surge set from 1 tc_track 
 NAME:
   climada_tc_hazard_surge_DD92_mslope
 PURPOSE:
   generate tropical cyclone hazard surge set from the CENAPRED formula
   originally for MEXICO coastline 
   calls climada_tc_surgefield which calculates the surge footprint for
   one single TC track
   previous: likely climada_random_walk &amp climada_tc_windfield 
   next: diverse, see manual, since this code generates the tropical
   cyclone surge hazard event set, to be used by climada_EDS_calc etc.
 CALLING SEQUENCE:
   hazard = climada_tc_hazard_surge_DD92_mslope(tc_track,hazard_set_file,centroids)
 EXAMPLE:
   hazard = climada_tc_hazard_surge_DD92_mslope(tc_track)
 INPUTS:
   tc_track: a tc_track structure (see climada_tc_read_unisys_database),
       or a filename of a saved one
       details: see e.g. climada_random_walk
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           lon(1,:): the longitudes   
           lat(1,:): the latitudes   
           ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
   
 OPTIONAL INPUT PARAMETERS:
   silent_mode: activate to check code and add additional plots 
   check_plot: additional plots / if =1, draw graphics 

 OUTPUTS:
   res: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
           tropical cyclone or 'TS' for tropical cycloes surge... only needed
           later for sanity tests, such that e.g. hazards are not messed up
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon (info only,
           not used in calculation)
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one (this information comes from
           tc_track
       event_ID: a unique ID for each event. Note that in case you'd like
           to combine later say wind and surge damages, make sure you generate
           exactly the same events with matching IDs, as this allows to sum up
           event damage sets (EDS)
       date: the creation date of the set (info only)
       surge(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event (annual event
           occurence frequency)
       matrix_density: the density of the sparse array hazard.surge
       surgefield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful, since some code checks for
           consistency by checking whether this field is the same.
 MODIFICATION HISTORY:
 Borja G. Reguero  borjagreguero@gmail.com, 20160323, created from
 climada_tc_surgefield 
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_tc_hazard_surge_DD92_mslope.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_hazard_surge_SLOSH">
<H2>climada_tc_hazard_surge_SLOSH</H2></A>
<font color="blue">function res=climada_tc_hazard_surge_SLOSH(tc_track,centroids,equal_timestep,silent_mode,check_plot) </font>
 climada storm surge TS hazard event set
 NAME:
   climada_tc_hazard_surge_SLOSH
 PURPOSE:
   create a storm surge (TS) hazard event, based on an existing
   tropical cyclone (TC) hazard event set from Liming Xu, 2010 / SLOSH
   SIMULATIONS IN THE US 

 TC windfield calculation and calculate Surge from SLOSH regression 
 NAME:
   climada_tc_hazard_surge_SLOSH
 PURPOSE:
   given a TC track (lat/lon,CentralPressure,MaxSustainedWind), calculate
   the wind field at locations (=centroids) and Surges 

   If centroids.distance2coast_km exists, the hazard intensity is only
   calculated in the coastal_range_km (usually 300km, see PARAMETERS) -
   this speeds up calculation for large countries considerably. To switch
   this feature off, just centroids=rmfield(centroids,'distance2coast_km')
   prior to passing centroids to climada_tc_windfield

   mainly called from: see climada_tc_hazard_set
 CALLING SEQUENCE:
   climada_tc_hazard_surge_SLOSH(tc_track,centroids,equal_timestep,silent_mode)
 EXAMPLE:
   climada_tc_hazard_surge_SLOSH
   plot windfield:
   climada_tc_hazard_surge_SLOSH(tc_track(1411), centroids,1,1,1)
 INPUTS:
   tc_track: a structure with the track information:
       tc_track.lat
       tc_track.lon
       tc_track.MaxSustainedWind: maximum sustained wind speed (one-minute)
       tc_track.MaxSustainedWindUnit as 'kn', 'mph', 'm/s' or 'km/h'
       tc_track.CentralPressure: optional
       tc_track.Celerity: translational (forward speed) of the hurricane.
           optional, calculated from lat/lon if missing
       tc_track.TimeStep: optional, only needed if Celerity needs to be
           calculated, 6h assumed as default
       tc_track.Azimuth: the forward moving angle, calculated if not given
           to ensure consistency, it is even suggested not to pass Azimuth
       tc_track.yyyy: 4-digit year, optional
       tc_track.mm: month, optional
       tc_track.dd: day, optional
       tc_track.ID_no: unique ID, optional
       tc_track.name: name, optional
       tc_track.SaffSimp: Saffir-Simpson intensity, optional
   centroids: a structure with the centroids information
       centroids.lat: the latitude of the centroids
       centroids.lon: the longitude of the centroids
       If centroids.distance2coast_km exists, the hazard intensity is only
       calculated in the coastal_range_km (usually 300km, see PARAMETERS) -
       this speeds up calculation for large countries considerably. To switch
       this feature off, just centroids=rmfield(centroids,'distance2coast_km')
       prior to passing centroids to climada_tc_windfield.
       Some other fields of centroids are also appended to res struct
 OPTIONAL INPUT PARAMETERS:
   equal_timestep: if set=1 (default), first interpolate the track to a common
       timestep, if set=0, no equalization of TC track data (not recommended)
       BUT: for speedup, run climada_tc_equal_timestep for ALL tracks
       prior to calling climada_tc_windfield (see e.g. climada_tc_hazard_set) 
       and then set equal_timestep=0 in calling climada_tc_windfield 
   silent_mode: if =1, do not write to stdout unless severe warning
   check_plot: disabled, see code, commented out for speedup
 OUTPUTS:
   res: the output strcuture, with fields
       gust(i): the windfield [m/s] at all centroids i
       lat(i): the latitude of the centroids i
       lon(i): the longitude of the centroids i
       Some other fields of centroids are also appended to res struct
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Borja G. Reguero  borjagreguero@gmail.com, 20160404, created from
 windfield original climada code 
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_tc_hazard_surge_SLOSH.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_surgefield_barotropic">
<H2>climada_tc_surgefield_barotropic</H2></A>
<font color="blue">function [res centroids] = climada_tc_surgefield_barotropic(tc_track, centroids, ... </font>
   equal_timestep, silent_mode, check_plot,unit_)
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_tc_surgefield_barotropic.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_tracks_clim_scen">
<H2>climada_tc_tracks_clim_scen</H2></A>
<font color="blue">function tc_track_out=climada_tc_tracks_clim_scen(tc_track,screw,comment,check_plot) </font>
 TC event set for future storms 
 NAME:
   climada_tc_tracks_clim_scen
 PURPOSE:
   given a tc_track structure, create future storm tracks derived tracks based on
   storms previously generated 

   NOTE see PARAMETER section to change parameters
   (e.g. ens_amp0,ens_amp,Maxangle)

   previous step: see climada_tc_random_walk
   next step: see climada_tc_hazard_set
 CALLING SEQUENCE:
   tc_track=climada_tc_random_walk(tc_track,ens_size);
 EXAMPLE:
   tc_track=climada_read_unisys_database;
   tc_track=climada_tc_random_walk(tc_track);
   tc_track=climada_tc_tracks_clim_scen(tc_track);

 INPUTS:
   tc_track: a structure with the track information for each cyclone i at
       each node j, see climada_read_unisys_database for a detailed
       description
   screw: 
 OPTIONAL INPUT PARAMETERS:
   ens_size: create ens_size varied derived tracks, default 9 
       (means for each original track, 9 daughter tracks are generated)
   ens_amp: amplitude of random walk wiggles in degree longitude for
       'directed', default 0.35. Be careful when changing, test with one track and plot, e.g.
       climada_tc_random_walk(tc_track(1),9,ens_amp,[],1)
   Maxangle: the angle the track direction can change for one timestep
       default=pi/7. Be careful when changing, test with one track and plot, e.g.
       climada_tc_random_walk(tc_track(1),9,[],Maxangle,1)
   check_plot: whether we show a check plot (=1) or not (=0), default=0
 OUTPUTS:
   same structure now including the ens_size times number of tracks
   all the info from the original tracks is copied, only the lat, lon
   differs
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Borja G. Reguero  borjagreguero@gmail.com, 20160321 
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_tc_tracks_clim_scen.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_wavefield">
<H2>climada_tc_wavefield</H2></A>
<font color="blue">function [res tc_track_ori centroids] = climada_tc_wavefield(tc_track, centroids, .... </font>
   bathy, models_waves,equal_timestep, silent_mode, check_plot,unit_,dirout)
 TC wave field calculation
 NAME:
   climada_tc_wavefield
 PURPOSE:
   given a TC track (lat/lon,CentralPressure,MaxSustainedWind), calculate
   the wave field (footprint) at locations (=centroids)
   mainly called from: see climada_tc_hazard_surge
   This code only resolves 1 storm! Loop over at the upper level. 

   DEVELOPERS NOTE:
   edit the code especially where indicated by INSERT/EDIT CODE HERE
 CALLING SEQUENCE:
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_tc_wavefield.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_windfield_ACE">
<H2>climada_tc_windfield_ACE</H2></A>
<font color="blue">function res=climada_tc_windfield_ACE(tc_track,centroids,equal_timestep,silent_mode,check_plot) </font>
 TC windfield calculation
 NAME:
   climada_tc_windfield
 PURPOSE:
   given a TC track (lat/lon,CentralPressure,MaxSustainedWind), calculate
   the wind field at locations (=centroids)

   If centroids.distance2coast_km exists, the hazard intensity is only
   calculated in the coastal_range_km (usually 300km, see PARAMETERS) -
   this speeds up calculation for large countries considerably. To switch
   this feature off, just centroids=rmfield(centroids,'distance2coast_km')
   prior to passing centroids to climada_tc_windfield

   mainly called from: see climada_tc_hazard_set
 CALLING SEQUENCE:
   climada_tc_windfield(tc_track,centroids,equal_timestep,silent_mode)
 EXAMPLE:
   climada_tc_windfield
   plot windfield:
   climada_tc_windfield(tc_track(1411), centroids,1,1,1)
 INPUTS:
   tc_track: a structure with the track information:
       tc_track.lat
       tc_track.lon
       tc_track.MaxSustainedWind: maximum sustained wind speed (one-minute)
       tc_track.MaxSustainedWindUnit as 'kn', 'mph', 'm/s' or 'km/h'
       tc_track.CentralPressure: optional
       tc_track.Celerity: translational (forward speed) of the hurricane.
           optional, calculated from lat/lon if missing
       tc_track.TimeStep: optional, only needed if Celerity needs to be
           calculated, 6h assumed as default
       tc_track.Azimuth: the forward moving angle, calculated if not given
           to ensure consistency, it is even suggested not to pass Azimuth
       tc_track.yyyy: 4-digit year, optional
       tc_track.mm: month, optional
       tc_track.dd: day, optional
       tc_track.ID_no: unique ID, optional
       tc_track.name: name, optional
       tc_track.SaffSimp: Saffir-Simpson intensity, optional
   centroids: a structure with the centroids information
       centroids.lat: the latitude of the centroids
       centroids.lon: the longitude of the centroids
       If centroids.distance2coast_km exists, the hazard intensity is only
       calculated in the coastal_range_km (usually 300km, see PARAMETERS) -
       this speeds up calculation for large countries considerably. To switch
       this feature off, just centroids=rmfield(centroids,'distance2coast_km')
       prior to passing centroids to climada_tc_windfield.
       Some other fields of centroids are also appended to res struct
 OPTIONAL INPUT PARAMETERS:
   equal_timestep: if set=1 (default), first interpolate the track to a common
       timestep, if set=0, no equalization of TC track data (not recommended)
       BUT: for speedup, run climada_tc_equal_timestep for ALL tracks
       prior to calling climada_tc_windfield (see e.g. climada_tc_hazard_set) 
       and then set equal_timestep=0 in calling climada_tc_windfield 
   silent_mode: if =1, do not write to stdout unless severe warning
   check_plot: disabled, see code, commented out for speedup
 OUTPUTS:
   res: the output strcuture, with fields
       gust(i): the windfield [m/s] at all centroids i
       lat(i): the latitude of the centroids i
       lon(i): the longitude of the centroids i
       Some other fields of centroids are also appended to res struct
 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090728
 David N. Bresch, david.bresch@gmail.com, 20141227, centroids.distance2coast_km treatment added
 David N. Bresch, david.bresch@gmail.com, 20150124, wind_threshold=15 (was 0), coastal_range_km=375 (was 300)
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_tc_windfield_ACE.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_windfield_HURAC">
<H2>climada_tc_windfield_HURAC</H2></A>
<font color="blue">function wind  = climada_tc_windfield_HURAC(tc_track,track_node_i, LL) </font>
 generates windfield in a grid 
 NAME:
   climada_tc_windfield_HURAC
 PURPOSE:
 generates windfield in a grid, just for 1 position --&ampgt only generates 1
 unique wind field 
 based on Hydromet-Rankin Vortex de Holland (1980) &amp Bretschneider (1990) 
 following Ruiz-Martinez (2009) with minor modifications 
 CALLING SEQUENCE:
   wind = climada_tc_windfield_HURAC(tc_track,hazard_set_file,centroids)
 EXAMPLE:
   wind = climada_tc_windfield_HURAC(tc_track)
 INPUTS:
 tc_track: a tc_track structure (see climada_tc_read_unisys_database),
       or a filename of a saved one
       details: see e.g. climada_random_walk
 track_node_i = position of track to simulate 
 OPTIONAL INPUT PARAMETERS:
   LL: grid size is 2*LLx2*LL 
 
 OUTPUTS:
   wind: wind speed and coordinates in a grid 
 
 MODIFICATION HISTORY:
 Borja G. Reguero  borjagreguero@gmail.com, 20160330, created for being
 called from surge and wave fields scripts 
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_tc_windfield_HURAC.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_waterfall_graph_coastal">
<H2>climada_waterfall_graph_coastal</H2></A>
<font color="blue">function  [fig, damage_disp] = climada_waterfall_graph_coastal(EDS1, EDS2, EDS3, return_period, unit_scale,units,xlabels_descrpt, check_printplot,type_hazard,y_axis_limits) </font>
 waterfall figure, expected damage for specified return period for 
 - today,
 - increase from economic growth, 
 - increase from high climate change, total expected damage 2030
 for the three EDS quoted above
 NAME:
   climada_waterfall_graph
 PURPOSE:
   plot expected damage for specific return period
 CALLING SEQUENCE:
   climada_waterfall_graph(EDS1, EDS2, EDS3, return_period,
   check_printplot)
 EXAMPLE:
   climada_waterfall_graph
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   EDS:            three event damage sets 
                   - today
                   - economic growth
                   - cc combined with economic growth, future
   return_period:  requested return period for according expected damage,or
                   annual expted damage, prompted if not given
   check_printplot:if set to 1, figure saved, default 0. 
 OUTPUTS:
   waterfall graph
 MODIFICATION HISTORY:
 Lea MuEDler, 20110622
 Martin Heynen, 20120329
 David N. Bresch, david.bresch@gmail.com, 20130316 EDS-&ampgtEDS
View <A HREF=file:../../climada_modules/coastal_hazards/code/climada_waterfall_graph_coastal.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="create_bathymetry">
<H2>create_bathymetry</H2></A>
<font color="blue">function [bathy]=create_bathymetry(coords,bathy_source,check_plot) </font>

 coords = : An array defining the corner points of the grid       
|                    coord(1) = Longitude (x) of lower left hand corner  
|                    coord(2) = Longitude (x) of upper right hand corner  
|                    coord(3) = Latitude (y) of lower left hand corner  
|                    coord(2) = Latitude (x) of upper right hand corner  
 dir_data = folder with the bathy_source 
 bathy_source= file root to 'etopo2' or 'etopo1' / FULL DIRECTORY 

 MODIFICATION HISTORY:
 Borja G. Reguero borjagreguero@gmail.com  20160222 created for coastal
 module 
View <A HREF=file:../../climada_modules/coastal_hazards/code/create_bathymetry.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="deg2utm">
<H2>deg2utm</H2></A>
<font color="blue">function  [x,y,utmzone] = deg2utm(Lat,Lon) </font>
 -------------------------------------------------------------------------
 [x,y,utmzone] = deg2utm(Lat,Lon)

 Description: Function to convert lat/lon vectors into UTM coordinates (WGS84).
 Some code has been extracted from UTM.m function by Gabriel Ruiz Martinez.

 Inputs:
    Lat: Latitude vector.   Degrees.  +ddd.ddddd  WGS84
    Lon: Longitude vector.  Degrees.  +ddd.ddddd  WGS84

 Outputs:
    x, y , utmzone.   See example

 Example 1:
    Lat=[40.3154333; 46.283900; 37.577833; 28.645650; 38.855550; 25.061783];
    Lon=[-3.4857166; 7.8012333; -119.95525; -17.759533; -94.7990166; 121.640266];
    [x,y,utmzone] = deg2utm(Lat,Lon);
    fprintf('%7.0f ',x)
       458731  407653  239027  230253  343898  362850
    fprintf('%7.0f ',y)
      4462881 5126290 4163083 3171843 4302285 2772478
    utmzone =
       30 T
       32 T
       11 S
       28 R
       15 S
       51 R

 Example 2: If you have Lat/Lon coordinates in Degrees, Minutes and Seconds
    LatDMS=[40 18 55.56; 46 17 2.04];
    LonDMS=[-3 29  8.58;  7 48 4.44];
    Lat=dms2deg(mat2dms(LatDMS)); %convert into degrees
    Lon=dms2deg(mat2dms(LonDMS)); %convert into degrees
    [x,y,utmzone] = deg2utm(Lat,Lon)

 Author: 
   Rafael Palacios
   Universidad Pontificia Comillas
   Madrid, Spain
 Version: Apr/06, Jun/06, Aug/06, Aug/06
 Aug/06: fixed a problem (found by Rodolphe Dewarrat) related to southern 
    hemisphere coordinates. 
 Aug/06: corrected m-Lint warnings
View <A HREF=file:../../climada_modules/coastal_hazards/code/deg2utm.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="disk_kernel">
<H2>disk_kernel</H2></A>
<font color="blue">function kernel=disk_kernel(p2)  </font>
    rad   = p2;
    crad  = ceil(rad-0.5);
    [x,y] = meshgrid(-crad:crad,-crad:crad);
    maxxy = max(abs(x),abs(y));
    minxy = min(abs(x),abs(y));
    m1 = (rad^2 &amplt  (maxxy+0.5).^2 + (minxy-0.5).^2).*(minxy-0.5) + ...
         (rad^2 &ampgt= (maxxy+0.5).^2 + (minxy-0.5).^2).* ...
        sqrt(rad^2 - (maxxy + 0.5).^2);
    m2 = (rad^2 &ampgt  (maxxy-0.5).^2 + (minxy+0.5).^2).*(minxy+0.5) + ...
         (rad^2 &amplt= (maxxy-0.5).^2 + (minxy+0.5).^2).* ...
          sqrt(rad^2 - (maxxy - 0.5).^2);
    sgrid = (rad^2*(0.5*(asin(m2/rad) - asin(m1/rad)) + ...
            0.25*(sin(2*asin(m2/rad)) - sin(2*asin(m1/rad)))) - ...
            (maxxy-0.5).*(m2-m1) + (m1-minxy+0.5)) ... 
          .*((((rad^2 &amplt (maxxy+0.5).^2 + (minxy+0.5).^2) &amp ...
            (rad^2 &ampgt (maxxy-0.5).^2 + (minxy-0.5).^2)) | ...
          ((minxy==0)&amp(maxxy-0.5 &amplt rad)&amp(maxxy+0.5&ampgt=rad))));
    sgrid = sgrid + ((maxxy+0.5).^2 + (minxy+0.5).^2 &amplt rad^2);
    sgrid(crad+1,crad+1) = min(pi*rad^2,pi/2);
    if ((crad&ampgt0) &amp&amp (rad &ampgt crad-0.5) &amp&amp (rad^2 &amplt (crad-0.5)^2+0.25)) 
       m1  = sqrt(rad^2 - (crad - 0.5).^2);
     m1n = m1/rad;
       sg0 = 2*(rad^2*(0.5*asin(m1n) + 0.25*sin(2*asin(m1n)))-m1*(crad-0.5));
       sgrid(2*crad+1,crad+1) = sg0;
       sgrid(crad+1,2*crad+1) = sg0;
       sgrid(crad+1,1)        = sg0;
       sgrid(1,crad+1)        = sg0;
       sgrid(2*crad,crad+1)   = sgrid(2*crad,crad+1) - sg0;
       sgrid(crad+1,2*crad)   = sgrid(crad+1,2*crad) - sg0;
       sgrid(crad+1,2)        = sgrid(crad+1,2)      - sg0;
       sgrid(2,crad+1)        = sgrid(2,crad+1)      - sg0;
    end
    sgrid(crad+1,crad+1) = min(sgrid(crad+1,crad+1),1);
    kernel = sgrid/sum(sgrid(:));
nd
View <A HREF=file:../../climada_modules/coastal_hazards/code/disk_kernel.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="filter2_ch">
<H2>filter2_ch</H2></A>
 ## Copyright (C) 2001 Paul Kienzle
 ##
 ## This program is free software; you can redistribute it and/or modify
 ## it under the terms of the GNU General Public License as published by
 ## the Free Software Foundation; either version 2 of the License, or
 ## (at your option) any later version.
 ##
 ## This program is distributed in the hope that it will be useful,
 ## but WITHOUT ANY WARRANTY; without even the implied warranty of
 ## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 ## GNU General Public License for more details.
 ##
 ## You should have received a copy of the GNU General Public License
 ## along with this program; if not, write to the Free Software
 ## Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 
 ## Y = filter2 (B, X)
 ##	Apply the 2-D FIR filter B to the matrix X.
 ## Y = filter2 (B, X, 'shape')
 ##      Apply the 2-D FIR filter B to the matrix X, returning the
 ##      desired shape:
 ##          full  - pad X with zeros on all sides before filtering
 ##          same  - unpadded X (default)
 ##          valid - trim X after filtering so edge effects are no included
 ##
 ## Note this is just a variation on convolution, with the parameters
 ## reversed and B rotated 180 degrees.
 
 ## Author: Paul Kienzle &ampltpkienzle@kienzle.powernet.co.uk&ampgt
 ## 2001-02-08 
 ##    * initial release
View <A HREF=file:../../climada_modules/coastal_hazards/code/filter2_ch.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fun_DFC2struct">
<H2>fun_DFC2struct</H2></A>
<font color="blue">function [S] = fun_DFC2struct(DFC_at_centroids,shp) </font>
 
 reads a shapefile strurcture and saves DFC results--&ampgt Return periods and
 Expected damage 
 joins by Same Ids in shp and DFC at centroids 
 Note 1: calculate by centroids 
 Note 2: requires mapping toolbox 
 -- 
View <A HREF=file:../../climada_modules/coastal_hazards/code/fun_DFC2struct.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fun_SurgeHeightFun">
<H2>fun_SurgeHeightFun</H2></A>
<font color="blue">function [surgeheight]=fun_SurgeHeightFun(h0,u10,m,check_plot) </font>
  
 Code to estimate storm surge by using one dimensional sureg model       %
 The storm surge model explained in the book titled:                     %
 &quotwater wave mechanics for engineers and scientists&quot                     %
 by Dean Dalrymple method 1992                                           %
 Ver 1                                                                   %
                                                     by: Arash Karimpour %
                                                   www.arashkarimpour.com%
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++%
INPUT---------------------------------------------------------------------
 Modeling the storm surge using Dean Dalrymple method 1992
 
 h0=40;               % deep water depth in (m), It was 42 m for Katrina
 u10=40;              % wind velocity 10 meter above the ground in (m/s), It was 40 m/s for Katrina 
 m=0.00084;           % bed slope = h0/l; 
 
OUTPUT--------------------------------------------------------------------
 surgeheight         : Surge Height in (m)
 
View <A HREF=file:../../climada_modules/coastal_hazards/code/fun_SurgeHeightFun.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fun_angcoast_centroids">
<H2>fun_angcoast_centroids</H2></A>
<font color="blue">function [centroids_mod] = fun_angcoast_centroids(centroids,coast) </font>
 centroids struct 
 coastline coordinates: coast.X coast.Y 
 -
View <A HREF=file:../../climada_modules/coastal_hazards/code/fun_angcoast_centroids.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fun_calculate_IFC">
<H2>fun_calculate_IFC</H2></A>
<font color="blue">function [intensity_fit_ori, exc_freq_ori,   intensity_pos_ori ,R_ori, ... </font>
intensity_fit,     exc_freq,       intensity_pos     ,R    ] = fun_calculate_IFC(intensity,frequency,...
return_periods_calc, intensity_threshold, no_generated)
View <A HREF=file:../../climada_modules/coastal_hazards/code/fun_calculate_IFC.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fun_calculate_mean_slope">
<H2>fun_calculate_mean_slope</H2></A>
<font color="blue">function mslope = fun_calculate_mean_slope(centroids, check_plot)  </font>
 requires field &quotprofiles&quot in centroids
 interpolates bathymetry at centroids lon and lat coordinates and
 calculates mean slope for surge formulation 
View <A HREF=file:../../climada_modules/coastal_hazards/code/fun_calculate_mean_slope.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fun_clean_track">
<H2>fun_clean_track</H2></A>
<font color="blue">function tc_track_clean = fun_clean_track(onetrack,ind) </font>
c_track_clean = onetrack; 
View <A HREF=file:../../climada_modules/coastal_hazards/code/fun_clean_track.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fun_find_closest_point">
<H2>fun_find_closest_point</H2></A>
<font color="blue">function [pos,min_dist]= fun_find_closest_point(x0,y0,lon_vec,lat_vec) </font>
ist_=(lon_vec-x0).^2 + (lat_vec-y0).^2; 
ist_= sqrt(dist_); 
View <A HREF=file:../../climada_modules/coastal_hazards/code/fun_find_closest_point.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fun_plot_IFC">
<H2>fun_plot_IFC</H2></A>
<font color="blue">function [handle_fig]=fun_plot_IFC(intensity,frequency,return_periods,peril_ID,orig_event_count,event_count) </font>
 climada event damage hazard probabilistic stochastic
 NAME:
   fun_plot_IFC
   edited from climada_damage_exceedence
 PURPOSE:
   create Intensity Frequency Curve for different fields in hazard struct 
   NOTE: the exceedence frequency and the cumulative probability have been 
   previously calculated in climada_hazard_stats_coastal

 CALLING SEQUENCE:
   
 EXAMPLE:
   
 INPUTS:
   hazard : structure (array)
   fields : cell array with fields to calculate. Will return as many figs 
   centroid_i: index position for centroid 
 OPTIONAL INPUT PARAMETERS:
 
 OUTPUTS:
   handle of figures 
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 Borja G. Reguero, borjagreguero@gmail.com, 20160615
View <A HREF=file:../../climada_modules/coastal_hazards/code/fun_plot_IFC.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fun_process_for_EDScalc_coastal">
<H2>fun_process_for_EDScalc_coastal</H2></A>
<font color="blue">function EDSentity = fun_process_for_EDScalc_coastal(entity,entity_field_names,... </font>
                                                    damagefunctions,measures,discounts)
 
 entity for EDS calculation template 
   entity.assets 
   entity.damagefunctions
   entity.measures 
   entity.discounts 
 --
View <A HREF=file:../../climada_modules/coastal_hazards/code/fun_process_for_EDScalc_coastal.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fun_write_xls_Damages">
<H2>fun_write_xls_Damages</H2></A>
<font color="blue">function fun_write_xls_Damages(filexls,SHEET,EDS) </font>
 delete(filexls)
ry 
View <A HREF=file:../../climada_modules/coastal_hazards/code/fun_write_xls_Damages.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fun_writeshp_contour_lines">
<H2>fun_writeshp_contour_lines</H2></A>
<font color="blue">function [S] = fun_writeshp_contour_lines(C,nameout)  </font>
 = getcontourlines(C);
View <A HREF=file:../../climada_modules/coastal_hazards/code/fun_writeshp_contour_lines.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fun_writeshp_stats_points">
<H2>fun_writeshp_stats_points</H2></A>
<font color="blue">function [S] = fun_writeshp_stats_points(X,Y,STATS,nameout)  </font>
 STATS - structure with stats created with climada_hazard_stats_coastal, 
   for different return periods
   includes stats.R_fit and stats.intensity_fit 
 X,Y, coordinates of centroids points 
 
 Borja G. Reguero, borjagreguero@gmail.com, July 2016
 --
lear S 
TATS.R_fit = full(STATS.R_fit); 
TATS.intensity_fit = full(STATS.intensity_fit); 
or ii=1:numel(X)
   S(ii).Geometry= 'Point'; 
   S(ii).X=X(ii); 
   S(ii).Y=Y(ii);
   for jj=1:numel(STATS.R_fit) 
       rp = num2str(STATS.R_fit(jj)); 
       eval(['S(ii).RP',rp,'=STATS.intensity_fit(jj,ii);'])
   end
nd
 write structure to shapefile 
hapewrite(S,[nameout,'.shp'])
View <A HREF=file:../../climada_modules/coastal_hazards/code/fun_writeshp_stats_points.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="getcontourlines">
<H2>getcontourlines</H2></A>
<font color="blue">function s = getcontourlines(c) </font>
   sz = size(c,2);     % Size of the contour matrix c
   ii = 1;             % Index to keep track of current location
   jj = 1;             % Counter to keep track of % of contour lines
View <A HREF=file:../../climada_modules/coastal_hazards/code/getcontourlines.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="harmonics">
<H2>harmonics</H2></A>
Magic numbers for TPXO (Name, Solar Doodson Numbers, Ref. Phase, Speed degrees/hour)
PXOharmonics={ 'MM'     '0'   '1'   '0'  '-1'   '0'   '0'    '0'    '0.5443747'
                          'MF'     '0'   '2'   '0'   '0'   '0'   '0'    '0'    '1.0980331'
                          'Q1'     '1'  '-3'   '1'   '1'  '0'   '0'  '270'   '13.3986607'
                          'O1'     '1'  '-2'   '1'   '0'   '0'   '0'  '270'   '13.9430351'
                          'P1'     '1'   '0'  '-1'   '0'   '0'   '0'  '270'   '14.9589310'
                          'K1'     '1'   '0'   '1'   '0'   '0'   '0'   '90'   '15.0410690'
                          'N2'     '2'  '-3'   '2'   '1'   '0'   '0'    '0'   '28.4397297'
                          'M2'     '2'  '-2'   '2'   '0'   '0'   '0'    '0'   '28.9841042'
                          'S2'     '2'   '0'   '0'  '0'   '0'   '0'    '0'   '30.0000000'
                          'K2'     '2'   '0'   '2'   '0'   '0'   '0'    '0'   '30.0821381'
                          'MN4'     '4'  '-5'   '4'   '1'   '0'   '0'    '0'   '57.4238319'
                          'M4'     '4'  '-4'   '4'   '0'   '0'   '0'    '0'   '57.9682083'
                          'MS4'     '4'  '-2'   '2'   '0'   '0'   '0'    '0'   '58.9841042'};
View <A HREF=file:../../climada_modules/coastal_hazards/code/harmonics.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="nearestneighbour">
<H2>nearestneighbour</H2></A>
<font color="blue">function [idx, tri] = nearestneighbour(varargin) </font>
NEARESTNEIGHBOUR    find nearest neighbours
   IDX = NEARESTNEIGHBOUR(X) finds the nearest neighbour by Euclidean
   distance to each point (column) in X from X. X is a matrix with points
   as columns. IDX is a vector of indices into X, such that X(:, IDX) are
   the nearest neighbours to X. e.g. the nearest neighbour to X(:, 2) is
   X(:, IDX(2))

   IDX = NEARESTNEIGHBOUR(P, X) finds the nearest neighbour by Euclidean
   distance to each point in P from X. P and X are both matrices with the
   same number of rows, and points are the columns of the matrices. Output
   is a vector of indices into X such that X(:, IDX) are the nearest
   neighbours to P

   IDX = NEARESTNEIGHBOUR(I, X) where I is a logical vector or vector of
   indices, and X has at least two rows, finds the nearest neighbour in X
   to each of the points X(:, I).
   I must be a row vector to distinguish it from a single point.
   If X has only one row, the first input is treated as a set of 1D points
   rather than a vector of indices

   IDX = NEARESTNEIGHBOUR(..., Property, Value)
   Calls NEARESTNEIGHBOUR with the indicated parameters set. Property
   names can be supplied as just the first letters of the property name if
   this is unambiguous, e.g. NEARESTNEIGHBOUR(..., 'num', 5) is equivalent
   to NEARESTNEIGHBOUR(..., 'NumberOfNeighbours', 5). Properties are case
   insensitive, and are as follows:
      Property:                         Value:
      ---------                         ------
         NumberOfNeighbours             natural number, default 1
            NEARESTNEIGHBOUR(..., 'NumberOfNeighbours', K) finds the closest
            K points in ascending order to each point, rather than the
            closest point. If Radius is specified and there are not
            sufficient numbers, fewer than K neighbours may be returned

         Radius                         positive, default +inf
            NEARESTNEIGHBOUR(..., 'Radius', R) finds neighbours within
            radius R. If NumberOfNeighbours is not set, it will find all
            neighbours within R, otherwise it will find at most
            NumberOfNeighbours. The IDX matrix is padded with zeros if not
            all points have the same number of neighbours returned. Note
            that specifying a radius means that the Delaunay method will
            not be used.

         DelaunayMode                   {'on', 'off', |'auto'|}
            DelaunayMode being set to 'on' means NEARESTNEIGHBOUR uses the
            a Delaunay triangulation with dsearchn to find the points, if
            possible. Setting it to 'auto' means NEARESTNEIGHBOUR decides
            whether to use the triangulation, based on efficiency. Note
            that the Delaunay triangulation will not be used if a radius
            is specified.

         Triangulation                  Valid triangulation produced by
                                        delaunay or delaunayn
            If a triangulation is supplied, NEARESTNEIGHBOUR will attempt
            to use it (in conjunction with dsearchn) to find the
            neighbours.

   [IDX, TRI] = NEARESTNEIGHBOUR( ... )
   If the Delaunay Triangulation is used, TRI is the triangulation of X'.
   Otherwise, TRI is an empty matrix

   Example:

     % Find the nearest neighbour in X to each column of X
     x = rand(2, 10);
     idx = nearestneighbour(x);

     % Find the nearest neighbours to each point in p
     p = rand(2, 5);
     x = rand(2, 20);
     idx = nearestneighbour(p, x)

     % Find the five nearest neighbours to points x(:, [1 6 20]) in x
     x = rand(4, 1000)
     idx = nearestneighbour([1 6 20], x, 'NumberOfNeighbours', 5)

     % Find all neighbours within radius of 0.1 of the points in p
     p = rand(2, 10);
     x = rand(2, 100);
     idx = nearestneighbour(p, x, 'r', 0.1)

     % Find at most 10 nearest neighbours to point p from x within a
     % radius of 0.2
     p = rand(1, 2);
     x = rand(2, 30);
     idx = nearestneighbour(p, x, 'n', 10, 'r', 0.2)


   See also DELAUNAYN, DSEARCHN, TSEARCH
View <A HREF=file:../../climada_modules/coastal_hazards/code/nearestneighbour.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="pol2cart_ch">
<H2>pol2cart_ch</H2></A>
<font color="blue">function [x,y,z] = pol2cart_ch(th,r,z) </font>
POL2CART Transform polar to Cartesian coordinates.
   [X,Y] = POL2CART(TH,R) transforms corresponding elements of data
   stored in polar coordinates (angle TH, radius R) to Cartesian
   coordinates X,Y.  The arrays TH and R must the same size (or
   either can be scalar).  TH must be in radians.

   [X,Y,Z] = POL2CART(TH,R,Z) transforms corresponding elements of
   data stored in cylindrical coordinates (angle TH, radius R, height
   Z) to Cartesian coordinates X,Y,Z. The arrays TH, R, and Z must be
   the same size (or any of them can be scalar).  TH must be in radians.

   Class support for inputs TH,R,Z:
      float: double, single

   See also CART2SPH, CART2POL, SPH2CART.
View <A HREF=file:../../climada_modules/coastal_hazards/code/pol2cart_ch.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="save_fig">
<H2>save_fig</H2></A>
<font color="blue">function save_fig(handle,file,res, varargin) </font>
 saves figure in png with given resolution, keeping ratio and colors
 Example: 
   save_fig(gcf,[dirResults,filesep,filename],200)
f ~exist('res','var'), res=100; end
View <A HREF=file:../../climada_modules/coastal_hazards/code/save_fig.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="save_fig_formats">
<H2>save_fig_formats</H2></A>
<font color="blue">function save_fig_formats(handle,file,res,type_output, varargin) </font>
 saves figure in png with given resolution, keeping ratio and colors
 Example: 
   save_fig_formats(gcf,[dirResults,filesep,filename],200,[1 0])
View <A HREF=file:../../climada_modules/coastal_hazards/code/save_fig_formats.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="tlabel">
<H2>tlabel</H2></A>
<font color="blue">function tlabel(varargin) </font>
TLABEL   Full date formatted tick labels with ZOOM, PAN and LINKAXES.

   SYNTAX:
     tlabel
     tlabel(...,TICKAXIS)
     tlabel(...,DATEFORM)
     tlabel(...,'keeplimits') vs 'freelimits'
     tlabel(...,'keepticks')  vs 'freeticks'
     tlabel(...,PRO,VAL,...)
     tlabel(AX,...)
     tlabel(...);

   INPUT: (all optionals)
     TICKAXIS     - Date axis. One of 'x', 'y' or 'z'.
                    DEFAULT: 'x'
     DATEFORM     - Numerical or string date format to be used on the
                    ticks. See DATESTR for details. 
                    DEFAULT: (as DATETICK, see NOTE below)
     'keeplimits' - Preserves the axis limits or 'freelimits' to not.
                    DEFAULT: (does it if axis limit mode is 'manual')
     'keepticks'  - Preserves the ticks locations or 'freeticks' to not.
                    DEFAULT: (does it if axis tick mode is 'manual')
     PRO,VAL      - Property/value extra inputs.
                    DEFAULT: (see TABLE below for details)  
     AX           - Uses the specified axis, rather than the current axis.
                    Axes are automatically linked if more than one were
                    specified. May include figure handles see NOTE below
                    for details.
                    DEFAULT: gca

   DESCRIPTION:
     This program works as DATETICK but with ZOOM, PAN and LINK
     functionalities.
      
     It's a mayor modification of DATETICKZOOM function by Lauwerys, by
     including the LINK functionality and includes in the date axis Label
     the part of the date that was left out by the TickLabels, allowing
     the user to know the full date no matter the zooming in.

     Besides, it includes some extra functionalities that the user may use
     as usual Property/Value pair inputs, which are:

      PROPERTY        POSSIBLE VALUES            DESCRIPTION
     ---------------------------------------------------------------------
      'Language'      'local' or 'en_us'         Sets months language.
                      DEFAULT: 'local'          

      'LinkOthers'    false, true, or            Links other axes besides
                      the specified ones         time?
                      ('yz' for example)
                      DEFAULT: false

      'WhichAxes'     'all', 'none', 'first',    Specifies on which axes
                      'last', or the             to display the dates.
                      specified axes handles
                      DEFAULT: 'all'

      'FixLow'        An integer or zero.        Indicates if more ticks
                      DEFAULT: 4                 should be included when
                                                 when less than 4 are
                                                 displayed.

      'FixHigh'       An integer or zero.        Indicates if less ticks
                      DEFAULT: 11                should be used when more
                                                 than 11 are displayed.

      'NumFmtNN'      User custom (see NOTE      Change the MATLAB
                      below for details)         default numeric date
                      DEFAULT: by DATETICK       format: 'NN' by the 
                                                 specified one.

      'Reference'     'middle', 'first',         Specifies the date on
                      'last' or 'none'           the time axis to be used
                      DEFAULT: 'middle'          as reference for the
                                                 whole date.

      'LabelY'        DEFAULT: 'yyyy'            Numeric or string format
                                                 on axis label when only
                                                 year is displayed.

      'LabelYM'       DEFAULT: 'mmm yyyy'        Numeric or string format
                                                 on axis label when year
                                                 and month are displayed.

      'LabelYMD'      DEFAULT: 'dd/mmm/yyyy'     Numeric or string format
                                                 on axis label when only
                                                 year is displayed.
     ---------------------------------------------------------------------
    
   NOTE:
     * Optional inputs use its DEFAULT value when not given or [].
     * For example, by default pairwise options: ('NumFmt6','dd/mmm') and
       ('NumFmt17',12) are used. See DATETICK for details on the numeric
       formats.
     * Except from the optional AX input which must be the first one,
       all other inputs arguments may be entered in any other position
       (keeping the pairs always toghether, of course).
     * The string inputs may be as short as posible, except for its value.
       Besides, upper cases are ignored (try 'keepl' instead of
       'KeepLimits').
     * If DATEFORMAT is used, it will be used even after any ZOOM.
     * 'keepticks' and 'keeplimits' are used by default if the TICKAXIS
       ticks and limits mode is 'manual'. So, limits are preserved if
       before TLABEL, axis tight was used.
     * Use 'Reference','none' to avoid the using of the label axis.
     * ADDITIONAL NOTES are included inside this file.

   EXAMPLE:
     tini = datenum([2009 05 29 12 00 00]);
     dt   = 20/60/24;
     N    = 100;
     t    = (0:N-1)'*dt + tini;
     figure(1), clf
      subplot(311)
       plot(t,3*cos(2*pi*t/12*24))
      subplot(312)
       plot(t,5*cos(2*pi*t/6*24))
      subplot(313)
       plot(t,8*cos(2*pi*t/3*24))
      axis(findobj(gcf,'Type','axes'),'tight')
     tlabel(gcf,'keepl','W','last')   % Dates printed only on last plot!
     zoom on

   SEE ALSO:
     DATETICK, DATESTR, DATENUM
     and
     DATETICKZOOM by Christophe Lauwerys and LINKZOOM by Carlos Vargas
     at http://www.mathworks.com/matlabcentral/fileexchange


   ---
   MFILE:   tlabel.m
   VERSION: 2.6 (Sep 07, 2009) (&amplta href=&quotmatlab:web('http://www.mathworks.com/matlabcentral/fileexchange/authors/11258')&quot&ampgtdownload&amplt/a&ampgt) 
   MATLAB:  7.7.0.471 (R2008b)
   AUTHOR:  Carlos Adrian Vargas Aguilera (MEXICO)
   CONTACT: nubeobscura@hotmail.com
View <A HREF=file:../../climada_modules/coastal_hazards/code/tlabel.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="centroids_generate_hazard_sets">
<H2>centroids_generate_hazard_sets</H2></A>
<font color="blue">function centroids_hazard_info=centroids_generate_hazard_sets(centroids,probabilistic,force_recalc,check_plots,peril_ID) </font>
 climada
 MODULE:
   country_risk
 NAME:
   centroids_generate_hazard_sets
 PURPOSE:
   run all (available) perils for a given set of centroids. Generate
   earthquake (EQ), volcano (VQ), tropical cyclone (TC), torrential rain
   (TR) and storm surge (TS) hazard event sets 
   1) figure which hazards affect the centroids
   2) create the hazard event sets, uses
      - climada_tc_hazard_set (wind)
      - climada_tr_hazard_set (rain)
      - climada_ts_hazard_set (surge)
      - eq_global_hazard_set (earthquake)
      - European winter storm module (existing hazard)

   Note that the code supports both TC tracks from unisys database files
   and (NCAR) netCDF TC track files. Should both exist in the active
   ..\data\tc_tracks folder, the user NEEDS to 'hide' the ones not needed
   (e.g. by moving them into a temporary subfolder). Otherwise, the code
   produces two hazard event sets (which might be intended).

   Please not further that the WS_Europe hazard event set is defined in
   PARAMETERS, as this is not freshly generated, but the country hazard
   event set is just a subset (see also climada module ws_europe)

   previous step: country_risk_calc or climada_create_GDP_entity
   next step: see country_risk_calc (if you start with your own centroids,
   you might rather calculate the risk yourself, e.g. using
   climada_EDS_calc...)
 CALLING SEQUENCE:
   centroids_hazard_info=centroids_generate_hazard_sets(centroids,probabilistic,force_recalc,check_plots,peril_ID)
 EXAMPLE:
   centroids_generate_hazard_sets; % interactive, prompt for centroids
 INPUTS:
   centroids: a centroid structure, see e.g. climada_centroids_load
       or an entity (in which case it takes the entity.assets.lat and
       entity.assets.lon)
       &ampgt prompted for if empty (centroids need to exist als .mat file
       already - otherwise run e.g. climada_centroids_read first).
       In case you select an entity, it takes entity.assets.lat and
       entity.assets.lon.
 OPTIONAL INPUT PARAMETERS:
   probabilistic: if =1, generate probabilistic hazard event sets,
       =0 generate 'historic' hazard event sets (default)
       While one need fully probabilistic sets for really meaningful
       results, the default is 'historic' as this is the first thing to
       check.
   force_recalc: if =1, recalculate the hazard sets, even if they exist
       (good for TEST while editing the code, default=0)
   check_plots: if =1, show figures to check hazards etc.
       If =0, skip figures (default)
   peril_ID: if passed on, run all calculations only for specified peril
       peril_ID can be 'TC','TS','TR','EQ','WS'..., default='' for all
 OUTPUTS:
   writes hazard event set files: III_name_rrr_PP{|_hist}.mat with III
       ISO2 country (admin0) code, country name, rrr peril region and PP
       peril_ID. Appends _hist if non-probabilistic. Note that for admin1
       hazard event sets, name does alos contain the admin1 name.
   centroids_hazard_info(centroids_i): a structure with hazard information for
       each set of centroids. See centroids_hazard_info.res.hazard with
       peril_ID: 'TC' or ...
       data_file: for TC only: the file sused to generste the event set
       hazard_set_file: the full filename of the hazard set generated
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141025, moved out of country_risk_calc
 David N. Bresch, david.bresch@gmail.com, 20141026, probabilistic as input
 David N. Bresch, david.bresch@gmail.com, 20141029, WSEU added
 David N. Bresch, david.bresch@gmail.com, 20141208, possibility to pass entity as centroids
 David N. Bresch, david.bresch@gmail.com, 20150110, save with -v7.3 (needed for large hazard sets)
 David N. Bresch, david.bresch@gmail.com, 20150112, hazard extension '_hist' for historic, '' for probabilistic
 David N. Bresch, david.bresch@gmail.com, 20150112, III_name_rrr_PP{|_hist}.mat
 David N. Bresch, david.bresch@gmail.com, 20150118, tc_track nodes file with track number
 David N. Bresch, david.bresch@gmail.com, 20150123, distance2coast_km in TC added
 David N. Bresch, david.bresch@gmail.com, 20150128, tc_track handling simplified, climada_tc_track_nodes
 David N. Bresch, david.bresch@gmail.com, 20150309, VQ (volcano) added, but switched off as default
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 David N. Bresch, david.bresch@gmail.com, 20151010, TR switched on as default
 David N. Bresch, david.bresch@gmail.com, 20151224, hazard module names renamed
 David N. Bresch, david.bresch@gmail.com, 20160517, double-check for tc datasets
 David N. Bresch, david.bresch@gmail.com, 20170524, _readme.txt in tc_tracks not processed ;-)
 David N. Bresch, david.bresch@gmail.com, 20170524, hazard.units displayed
View <A HREF=file:../../climada_modules/country_risk/code/centroids_generate_hazard_sets.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_create_GDP_entity">
<H2>climada_create_GDP_entity</H2></A>
<font color="blue">function [centroids,entity,entity_future]=climada_create_GDP_entity(country_name,polygon,check_figure,no_wbar) </font>
 GDP entity assets
 MODULE:
   GDP_entity
 NAME:
   climada_create_GDP_entity
 PURPOSE:
   See climada_nightlight_entity for mots purposes first.

   create centroids and entity for a specific country, distribute assets
   and value according to night light intensities and scale up to match 
   GDP today (see climada_global.present_reference_year) and a future (see
   climada_global.future_reference_year) scenario 
 CALLING SEQUENCE:
   [centroids entity entity_future] = climada_create_GDP_entity(country_name,polygon,check_figure,no_wbar)
 EXAMPLE:
   [centroids entity entity_future] = climada_create_GDP_entity
   [centroids entity entity_future] = climada_create_GDP_entity('Mexico')
 INPUTS:
   country_name: the name of the country or an ISO3 country code (like
       'CHE'), see climada_country_name
   polygon: do restrict to centroids in polygon, calls
       climada_cut_out_GDP_entity, see parameters there.
   check_figure: set to 1 to visualize figures, default 1
   no_wbar: 1 to suppress waitbars
   OBSOLETE (not supported any more): GDP: GDP data within a structure, 
       prompted for if not given, loaded automatically from economic_indicators_mastertable.mat file if existing
       --&ampgt all automatic now
 OUTPUTS:
   centroids: a structure with fields centroid_ID, Latitude, Longitude,
       onLand, country_name, comment for each centroid
   entity         : a structure with fields assets, damagefunctions, measures,
                    discount. Assets values are based on night light 
                    intensity and scaled up to todays GDP (e.g. 2014)
   entity_future  : entity strucure with values scaled to a future GDP
                    scenario
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20140206
 David N. Bresch, david.bresch@gmail.com, 20141209, country ISO3 enabled
 David N. Bresch, david.bresch@gmail.com, 20141212, migrated to world_50m.gen being local to GDP_entity, as climada moved to admin0.mat
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150125, incorporated climada_entity_value_GDP_adjust to scale up the entity, ... 
                                                    climada_entity_GDP not used anymore
 David N. Bresch, david.bresch@gmail.com, 20150204, cleanup
 David N. Bresch, david.bresch@gmail.com, 20150804, cleanup
 David N. Bresch, david.bresch@gmail.com, 20160517, fix for missing entity.assets.centroid_index and entity.assets.hazard.comment
View <A HREF=file:../../climada_modules/country_risk/code/climada_create_GDP_entity.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_GDP">
<H2>climada_entity_GDP</H2></A>
<font color="blue">function entity = climada_entity_GDP(entity_base, GDP, year_requested, centroids, borders, check_figure, check_printplot) </font>
 upscale given base entity (sum of assets is 100, or less if only coastal
 areas) to match the GDP of a specific country for a given year
 NAME:
   climada_entity_GDP
 PURPOSE:
   Upscale entity to a GDP of a given country and year, read GDP data from
   worldbank/IMF, find country for given entity/centroids
 CALLING SEQUENCE:
   entity = climada_entity_GDP(entity_100, GDP, year_start, centroids,
   borders, check_figure, check_printplot)
 EXAMPLE:
   entity = climada_entity_GDP(entity_100, GDP, 2014, centroids)
 INPUTS:
   entity_base: entity with entity.assets.Value sum up to 100 for the
   entire country (if only coastal areas, sum is less than 100)
 OPTIONAL INPUTS:
   GDP       : GDP data within a structure, prompted for if not given, loaded
               automatically from GDP.mat file if existing
   year_requested: year for GDP for a given country, default
               climada_global.present_reference_year
   centroids : prompted if not given, centroids with field .country_name
               for each centroid indicating the country matching with GDP data
   borders   : border structure (with name, polygon for every country)
   check_figure   : 1 to visualize figure
   check_printplot: 1 to print/save figure
 OUTPUTS:
   entity             : assets upscaled to a GDP of a country and a given year
   a structure, with
       assets         : a structure, with
           Latitude   : the latitude of the values
           Longitude  : the longitude of the values
           Value      : the total insurable value
           Deductible : the deductible
           Cover      : the cover
           DamageFunID: the damagefunction curve ID
       damagefunctions: a structure, with
           DamageFunID: the damagefunction curve ID
           Intensity  : the hazard intensity
           MDD        : the mean damage degree
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20140206
 David N. Bresch, david.bresch@gmail.com, 20141105,
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir
View <A HREF=file:../../climada_modules/country_risk/code/climada_entity_GDP.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hybrid_entity">
<H2>climada_hybrid_entity</H2></A>
<font color="blue">function [entity,centroids]=climada_hybrid_entity(admin0_name) </font>
 climada hybrid entity
 MODULE:
   country_risk
 NAME:
   climada_hybrid_entity
 PURPOSE:
   Create a high-resolution entity (climada_nightlight_entity) for the
   country within its borders and add the mid-resolution centroids for
   offshore along the coast plus coarse resolution centroids around the
   country (from GDP_entity)
 CALLING SEQUENCE:
   [entity,centroids]=climada_hybrid_entity(admin0_name)
 EXAMPLE:
   entity=climada_hybrid_entity('Switzerland')
 INPUTS:
   admin0_name: country name
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   entity: the entity, see e.g. climada_entity_read for a description of
       the entity structure
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150915, intitial
 David N. Bresch, david.bresch@gmail.com, 20160907, calling new climada_nightlight_entity
View <A HREF=file:../../climada_modules/country_risk/code/climada_hybrid_entity.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_night_light_to_country">
<H2>climada_night_light_to_country</H2></A>
<font color="blue">function [values_distributed,pp] = climada_night_light_to_country(country_name,pp,night_light,... </font>
   borders,border_mask,check_figure,check_printplot,save_on,silent_mode)
 NAME:
   climada_night_light_to_country
 PURPOSE:
   distributed values within one country according to night light density

   geographically distribute values within one country according to
   nonlinearly tranformed night light density values (values between 1 and 63)
   based on nonlinear relationship between night light intensity and
   distribution of GDP assets, use a second order polynomial function
   without y-indent: y = pp(1) x^2 + pp(2) x;

   previous: climada_night_light_read
   next: climada_resolution_downscale
 CALLING SEQUENCE:
   [values_distributed pp] = climada_night_light_to_country(country_name, pp, night_light,...
             borders, border_mask, check_figure, check_printplot, save_on, silent_mode)
 EXAMPLE:
 values_distributed = climada_night_light_to_country('Bangladesh')
 INPUTS:
   country_name     : name of country (string)
 OPTIONAL INPUT PARAMETERS:
   pp               : parameter of second order polynomial function to transform night lights
                      nonlinearly into distribution of GDP assets
                      y = pp(1)*x^2 + pp(2)*x;
   night_light      : night light mat file (structure with values,
                      lon_range, lat_range, resolution_x, resolution_y and comment)
   borders          : climada world map country borders (structure with
                      polygon and names)
   border_mask      : structure with all country masks (zeros and ones)
   check_figure     : set to 1 to visualize figures, default 1
   check_printplot  : set to 1 to save figure, default 0
   save_on          : set to 1 to save Gvalues_distributed.mat
   silent_mode      : if set to 1, no print out messages, default 0
 OUTPUTS:
   values_distributed: a struct, with following fields
         .values       : distributed GDP per pixel
         .lon_range    : range of Longitude
         .lat_range    : range of Latitude
         .resolution_x : resolution in x-direction
         .resolution_y : resolution in y-direction
         .comment      : information about distributed GDP data, year and pp
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20130412
 David N. Bresch, david.bresch@gmail.com, 20141205, cleanup and 1km try (see parameters below)
 David N. Bresch, david.bresch@gmail.com, 20160222, module_data_dir updated
View <A HREF=file:../../climada_modules/country_risk/code/climada_night_light_to_country.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_nightlight_global_entity">
<H2>climada_nightlight_global_entity</H2></A>
<font color="blue">function entity=climada_nightlight_global_entity(parameters) </font>
 country admin0 admin1 entity high resolution
 NAME:
	climada_nightlight_global_entity
 PURPOSE:
   Construct an entity file based on high-resolution (1km!) or
   mid-resolution (10km) night light data for the whole world. Use scaling
   etc. as in climada_nightlight_entity, but for all countries.

   SPECIAL: run climada_nightlight_entity at least for one country at the
   desried resolution once before calling
   climada_nightlight_gloabl_entity, since climada_nightlight_entity does
   prepare and init some (nightlight) datasets.

   Reads an image file with nightlight density and matches it to the local
   geography, then scales to proxy for asset values. See
   climada_nightlight_entity for detailed description of the scaling etc.

   climada_nightlight_entity also for sources, data files etc.

   This code is a bit a bare-bone version, just to create a globally
   consistent asset base (usually in 10km resolution).

   Note: the code uses climada_inpolygon instead of inpolygon.

   See also: climada_nightlight_entity
 CALLING SEQUENCE:
   entity=climada_nightlight_global_entity(parameters)
 EXAMPLE:
   entity=climada_nightlight_global_entity; % global 10km
   climada_entity_plot(entity,[],1); % visual check
   parameters=climada_nightlight_global_entity('parameters') % return all default parameters
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   parameters: a structure to pass on parameters, with fields as
       (run parameters=climada_nightlight_global_entity('parameters') to obtain
       all default values)
       resolution_km: the resuting resolution, either =1 or =10
           It is often advisable to first TEST with resolution=10 for
           speed reasons. If a fully country is selected, default=10, else
           =1 for admin1
       restrict_Values_to_country: whether we scale country assets to GDP
           * factor, see climada_nightlight_entity and assign the country
           ISO3 code to each centroid  (=1, default) or not (=0,faster,
           but less useful).
           NOTE: this parameter has the same name, but a different meaning
           in climada_nightlight_entity (but convenient to use same set of
           parameters oin both codes).
       grid_spacing_multiplier: the spacing of regular grid outside of the
           area requested. Default=5, hence approx every 5th point as outer
           grid.
       nightlight_transform_poly: the polynomial coefficients to transform
           the nightlight intensity (usually in the range 0..60) to proxy
           asset values. Evaluated using polyval, i.e.
           value=polyval(parameters.nightlight_transform_poly,nightlight_intensity)
           Default=[1 0 0 0], which means Value=nightlight_intensity^3
           After this Values are normalized to sum up to 1.
           Note that if a whole country is requested, Values are then
           scaled to sum up to GDP*(income_group+1).
       value_threshold: if empty or =0, all centroids (also those with zero
           value) are kept in the entity (default). If set to a value,
           only centroids with entity.Value&ampgtvalue_threshold are kept (note
           that this way, one can specify an asset value threshold, reduce
           the number of points to be dealt with).
           One might often want to avoid all truly tero points, i.e.
       add_distance2coast_km: if =1, add distance to coast, default=0
       add_elevation_m: if =1, add elevation, default=0
       img_filename: the filename of an image with night light density, as
           created using the GUI at http://maps.ngdc.noaa.gov/viewers/dmsp_gcv4/
           and select Satellite F18, 2010, avg_lights_x_pct, then 'Download
           data' and enter the coordinates
           The filename has to be of form A_B_C_D_{|E_F}*..lzw.tiff with A,B,C and D
           the min lon, min lat, max lon and max lat (integer), like
           87_20_94_27_F182010.v4c.avg_lights_x_pct.lzw.tiff and E and F the
           country (admin0) and state/province (admin1) name, like
           -88_24_-79_32_United States of America_Florida_high_res.avg_lights.lzw.tiff

           If empty (eg run the code without any argument), it prompts for country
           and admin1 name and constructs the URL to get the corresponding
           tile from the nightlight data, e.g. a string such as:
           http://mapserver.ngdc.noaa.gov/cgi-bin/public/gcv4/F182010.v4c.
               avg_lights_x_pct.lzw.tif?request=GetCoverage&ampservice=WCS&amp
               version=1.0.0&ampCOVERAGE=F182010.v4c.avg_lights_x_pct.lzw.tif&amp
               crs=EPSG:4326&ampformat=geotiff&ampresx=0.0083333333&ampresy=0.0083333333&amp
               bbox=-88,24,-79,32

           ='ASK' prompt for an image file (without first asking for country
           where one has to press 'Cancel') to get the to filename prompt
       save_entity: whether we save the entity (=1, default) or nor (=0).
       entity_filename: the filename to save the entity to, default is a
           long one with ISO3, country name, admin1 name, geo coord and
           resolution. Not used if save_entity=0
       check_plot: if =1: plot nightlight data with admin0 (countries)
           superimposed. If=3, plot the resulting asset Values
       verbose: whether we printf progress to stdout (=1, default) or not (=0)
 OUTPUTS:
   entity: a full climada entity, see climada_entity_read, plus the fields
       entity.assets.distance2coast_km(i): distance to coast in km (both on-
           and offshore) for each centroid
       entity.assets.elevation_m(i): elevation in m for each centroid,
           negatove for ocean depth (needs climada module etopo, just skips
           this if module not installed)
       entity.assets.centroid_admin0_ISO3{i}: country ISO3 code for each
           centroid i, WWW for water (oceans). Not added, if
           restrict_Values_to_country=0)
       entity.assets.nightlight_transform_poly: the polynomial
           coefficients that have been used to transform the nightlight
           intensity.
       entity.assets.isgridpoint: =1 for the regular grid added 'around'
           the assets, =0 for the 'true' asset centroids (not added, if
           restrict_Values_to_country=0)
       see e.g. climada_entity_plot to check
 RESTRICTIONS:
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20161022, initial
 david.bresch@gmail.com, 20161023, save using -v7.3 if troubles
View <A HREF=file:../../climada_modules/country_risk/code/climada_nightlight_global_entity.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_entity_assets">
<H2>climada_plot_entity_assets</H2></A>
<font color="blue">function fig = climada_plot_entity_assets(entity,centroids,country_name,check_printplot,printname,keep_boundary) </font>
 climada plot assets from entity file and save if needed
 NAME:
   climada_plot_entity_assets
 PURPOSE:
   plot assets from entity file on a map with different colors to show the
   distribution of assets, print if needed
   normally called from: climada_create_GDP_entity
 CALLING SEQUENCE:
   fig = climada_plot_entity_assets(entity, centroids, country_name, check_printplot)
 EXAMPLE:
   climada_plot_entity_assets(entity, centroids, country_name)
 INPUTS:
   entity          : entity structure, with entity.assets field
   centroids       : centroids mat-file (struct)
       if passed empty, the information is taken from entity.assets
 OPTIONAL INPUT PARAMETERS:
   country_name_str: country name as string format
   check_printplot : 1 for printing (save as pdf), set to 0 by default
   printname       : name for pdf-file, to be saved in .../climada/data/results/Entity_printname.pdf
 OUTPUTS:
   fig             : figure handle
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20140205
 David N. Bresch, david.bresch@gmail.com, 20141127, figure creating suppressed
 David N. Bresch, david.bresch@gmail.com, 20141208, country_name='' as default
 David N. Bresch, david.bresch@gmail.com, 20141209, abort if sum(Values)=0
 Lea Mueller, muellele@gmail.com, 20140205, add keep_boundary option
 Lea Mueller, muellele@gmail.com, 20160318, use climada_colormap('assets')
View <A HREF=file:../../climada_modules/country_risk/code/climada_plot_entity_assets.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="country_admin1_risk_calc">
<H2>country_admin1_risk_calc</H2></A>
<font color="blue">function country_risk=country_admin1_risk_calc(country_name,probabilistic,check_plots,peril_ID,admin1_save_entity) </font>
 climada country admin1 risk calc
 MODULE:
   country_risk
 NAME:
   country_admin1_risk_calc
 PURPOSE:
   Run the all (available) perils for one country's admin1 level

   Obtains the admin1 boundaries (from www.naturalearthdata.com, see
   PARAMETERS in code) and carve out the respective centroids (set Value
   at all others to zero). Runs the risk calculation for each admin1 for
   all hazards. In case one would like to skip hazards, just (temporarily)
   remove the respective {country_ISO3}_{country_name}_*.mat hazard event
   sets or see parameter peril_ID. 

   ONLY makes sense if country_risk_calc has been run for the respective
   country (we keep it like this, as automatic mode might trigger lots of
   un-wanted calculations). If not, the code terminates with the
   respective messages (no entity found, no hazard set(s) found...)
   But one can run country_admin1_risk_calc for more than one
   country (see country_name), if the respective countries have been run
   as country_risk_calc.

   NOTE: Before using this code, make yourself familiar with 
   country_risk_calc

   next step: country_risk_report (same format as country_risk_calc)
 CALLING SEQUENCE:
   country_risk=country_admin1_risk_calc(country_name,probabilistic,check_plots,peril_ID,admin1_save_entity)
 EXAMPLE:
   country_risk=country_admin1_risk_calc; % interactive, select country from dropdown
   country_risk=country_admin1_risk_calc('ALL') % whole world, no figures
   country_risk=country_admin1_risk_calc({'Germany','Switzerland'}) % just two countries
 INPUTS:
   country_name: name of the country, like 'Switzerland', or a list of
       countries, like {'Switzerland','Germany','France'}, see
       climada_create_GDP_entity.
       If set to 'ALL', the code runs recursively through ALL countries
       (mind the time this will take...)
       &ampgt prompted for via dropdown list if empty (allows for single or
       multiple country selection)
 OPTIONAL INPUT PARAMETERS:
   probabilistic: Whether we use historic (=0) or probabilistic (=1,
       default) hazard event sets. Obviously depends on what hazard event sets
       have been generated in country_risk_calc
   check_plots: if =1, show figures to check hazards etc.
       If =0, skip figures (default)
       If =100, plot only, skip calculations
       If country_name is set to 'ALL', be careful to set check_plots=1
   peril_ID: if passed on, run all calculations only for specified peril
       Same behaviour as in country_risk_calc, namely:
       peril_ID can be 'TC','TS','TR','EQ','WS'..., default='' for all
       One can also specify the peril region within peril_ID, such as
       'atl_TC' and peril_ID can also contain a list, e.g. peril_ID=['atl_TC';'atl_TS';'EQ'] 
   admin1_save_entity: =1 to save each admin1 entity as single entity file
       Entity file named {country_ISO3}_{country_name}_{admin1_name}_entity.mat
       =0 to omit this (default)
 OUTPUTS:
   country_risk(1): a structure with some risk information, same structure
       as from country_risk_calc, see country_risk_report to create a
       readable report to stdout or file
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141126, initial
 David N. Bresch, david.bresch@gmail.com, 20141212, compatible with new admin0.mat instead of world_50m.gen
 David N. Bresch, david.bresch@gmail.com, 20150110, country naming as in country_risk_calc
 David N. Bresch, david.bresch@gmail.com, 20150112, hazard extension '_hist' for historic, '' for probabilistic
 David N. Bresch, david.bresch@gmail.com, 20150112, climada_hazard2octave
 David N. Bresch, david.bresch@gmail.com, 20150714, find admin1 also based on ISO3
 David N. Bresch, david.bresch@gmail.com, 20150803, peril_ID added and admin1_save_entity debugged
 David N. Bresch, david.bresch@gmail.com, 20150803, probabilistic=1 as defaut
View <A HREF=file:../../climada_modules/country_risk/code/country_admin1_risk_calc.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="country_risk_calc">
<H2>country_risk_calc</H2></A>
<font color="blue">function country_risk=country_risk_calc(country_name,method,force_recalc,check_plots,peril_ID,damagefunctions) </font>
 climada
 MODULE:
   country_risk
 NAME:
   country_risk_calc
 PURPOSE:
   run all (available) perils for one country. I.e. generate earthquake
   (EQ), volcano (VQ), tropical cyclone (TC), torrential rain (TR), storm
   surge (TS) and European winter storm (WS) hazard event sets and run
   risk calculation for a given country:  
   1) generate centroids for the country (uses climada_create_GDP_entity)
   2) figure which hazards affect the country
   3) create the hazard event sets, uses
      - climada_tc_hazard_set (wind)
      - climada_tr_hazard_set (rain)
      - climada_ts_hazard_set (surge)
      - eq_global_hazard_set (earthquake)
      - European winter storms (existing European hazard set)
   4) run the risk calculation for all hazards

   NOTE that centroids_generate_hazard_sets is called for steps 2 and 3.
   Note further that should there be more than one source for TC tracks,
   more than one TC hazard set is generated (see centroids_generate_hazard_sets)

   next step: country_risk_report, see also country_admin1_risk_calc and
   esepcially country_risk_calibrate, plus cr_DFC_plot and cr_DFC_plot_aggregate
 CALLING SEQUENCE:
   country_risk=country_risk_calc(country_name,method,force_recalc,check_plots,peril_ID)
 EXAMPLE:
   country_risk0=country_risk_calc('CHE',1,0); % 10x10km resolution for
       % Switzerland, using climada_nightlight_entity (not GDP_entity)
   country_risk0=country_risk_calc('CHE',2,0); % 1x1km resolution for
       % Switzerland, using climada_nightlight_entity
   country_risk0=country_risk_calc('CHE',3,0); % 10x10km resolution for
       % Switzerland, using GDP_entity
   country_risk=country_risk_calc; % interactive, select country from dropdown
   country_risk=country_risk_calc('ALL',1,0,0) % whole world, no figures
   country_risk=country_risk_calc(country_name,-7,0,0,['atl_TC';'atl_TS']) % both TC and TS for atl
 INPUTS:
   country_name: name of the country, like 'Switzerland', or a list of
       countries, like {'Switzerland','Germany','France'}. See
       climada_check_country_name for the list of valid country names
       If set to 'ALL', the code runs recursively through ALL countries
       (mind the time this will take...)
       &ampgt prompted for via dropdown list if empty (allows for single or
       multiple country selection)
 OPTIONAL INPUT PARAMETERS:
   method: =1: use 10km nightlight (climada_nightlight_entity, NOT default)
       =2: use 1km nightlight (climada_nightlight_entity)
       =3: (default) use 10km nightlight (GDP_entity). In this case, USA is
           restricted to contiguous US excl. Alaska and NZL only West of dateline.

       Since the code uses the entity (III_Name, with III Iso3 code and
       Name the country name) if it exists already, the resolution only
       matters on the first call, that's why we can use force_recalc to
       direct resolution. For another entity resolution, delete or rename
       the entity.

       &amplt0: all above options *(-1) trigger the generation of the full
       probabilistic hazard sets (otherwise _hist is added to the hazard
       event sets) 
       =7 (for historic, or -7 to use probabilistic sets): skip entity and
       hazard set generation, straight to damage calculations (this allows
       to avoid any re-generation of - missing - hazard event sets, the
       code just takes what's there). In this case, peril_ID can contain
       the peril region, too, i.e. 'atl_TC' or 'glb_EQ' and peril_ID can
       be a list of IDs, such as peril_ID=['atl_TC';'atl_TS'].

       Internally: if method&amplt0, probabilistic=1, =0 else (default)
       =sign(.)*(abs(.)+100): use future entities, e.g. -107 uses
       future entity, and probabilistic hazards, but skips entity and
       hazard calculation.
       If method has two elements, the second one triggers
       EDS_emdat_adjust, i.e. if method(2)=1, we adjust the EDS by
       comparison with EM-DAT, see cr_EDS_emdat_adjust

       In case method is a vector and abs(method(1)) either 1 or 2:
       method(2)=1 -&ampgt add distance2coast_km (takes time)
       method(3)=1 -&ampgt add elevation_m (takes time)
   check_plot: if =1: plot nightlight data with admin0 (countries)
   force_recalc: if =1, recalculate the hazard sets, even if they exist
       (good for TEST while editing the code, default=0)
   check_plots: if =1, show figures to check hazards etc.
       If =0, skip figures (default)
       If country_name is set to 'ALL', be careful to set check_plots=1
   peril_ID: if passed on, run all calculations only for specified peril
       peril_ID can be 'TC','TS','TR','EQ','WS'..., default='' for all
       Once generated, one can also specify the peril region within
       peril_ID, such as 'atl_TC'. If method=+/-7, peril_ID can also
       contain a list, e.g. peril_ID=['atl_TC';'atl_TS';'EQ']
   damagefunctions: if passed, use damagefunctions instead of the one that
       comes with the entity (or entities). Replaces entity.damagefunctiuons 
       without any further tests. The user is responsible for not messing
       up, i.e. for entity.assets.DamageFunID to point to the right damage
       function, damagefunctions.peril_ID to be consistent with e.g. input
       parameter peril_ID etc.
 OUTPUTS:
   writes a couple files, such as entities and hazard event sets (the
       output to stdout lists all names)
   country_risk(country_i): a structure with some risk information for
       each country (if run eg with 'ALL'), see hazard(hazard_i).EDS
       e.g. plot damage for one hazard in one country at each centroid with
         climada_circle_plot(...
          country_risk(country_i).res.hazard(hazard_i).EDS.ED_at_centroid,...
          country_risk(country_i).res.hazard(hazard_i).EDS.assets.lon,...
          country_risk(country_i).res.hazard(hazard_i).EDS.assets.lat)
       see country_risk_report to create a readable report to stdout
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20140831, initial
 David N. Bresch, david.bresch@gmail.com, 20140922, three hazards: TC,TS,TR
 David N. Bresch, david.bresch@gmail.com, 20141020, ready for checkin
 David N. Bresch, david.bresch@gmail.com, 20141025, major cleanup, WS and EQ added
 David N. Bresch, david.bresch@gmail.com, 20141026, probabilistic as input
 David N. Bresch, david.bresch@gmail.com, 20141029, force_re_encoding
 David N. Bresch, david.bresch@gmail.com, 20141103, matching peril_ID for damagefunction added
 David N. Bresch, david.bresch@gmail.com, 20141107, add ncetCFD tc_track file treatment (NCAR) (on flight to Dubai)
 David N. Bresch, david.bresch@gmail.com, 20141126, country list enabled and multiple selection added
 David N. Bresch, david.bresch@gmail.com, 20141222, method parameter simplified (replaces and includes probabilistic)
 David N. Bresch, david.bresch@gmail.com, 20150112, climada_hazard2octave
 David N. Bresch, david.bresch@gmail.com, 20150121, method=7 added
 David N. Bresch, david.bresch@gmail.com, 20150123, distance2coast_km added
 David N. Bresch, david.bresch@gmail.com, 20150213, peril_ID to contain region and multiple perils enabled (if method=+/-7)
 David N. Bresch, david.bresch@gmail.com, 20150819, centroids in their own folder
 Lea Mueller, muellele@gmail.com, 20151021, add climate change option (method=-8) (use hazard TWN_TAIWAN_wpa_TC_cc_2050.mat instead of TWN_TAIWAN_wpa_TC.mat)
 David N. Bresch, david.bresch@gmail.com, 20160303, method as vector added
 David N. Bresch, david.bresch@gmail.com, 20160517, probabilistic based on GDP entity as default
 David N. Bresch, david.bresch@gmail.com, 20160517, enabled use without tropical_cyclone or volcano_earthquake models loaded
View <A HREF=file:../../climada_modules/country_risk/code/country_risk_calc.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="country_risk_calibrate">
<H2>country_risk_calibrate</H2></A>
<font color="blue">function ok=country_risk_calibrate(country_name) </font>
 climada template
 MODULE:
   module name
 NAME:
   country_risk_calibrate
 PURPOSE:
   Calibrate a given country (or a list of countries)
   Call country_risk_calc before

   Standard procedure is that the switch statement below has entries for
   countries (and lists of countries) and hence performs the specific
   actions. Be careful to check for repetitious application. We set the
   field entity.calibrated=1 the first time it is treated here, but since
   one might need to re-calibrate, one should rather assign absolute
   values to e.g. damagefunctions.MDD, since a mere multiplication of
   existing values might lead to troubles on subsequent calls. the code
   climada_damagefunctions_replace does indeed not replace on repetitious
   calls if the result would be exactly the same.

   See also cr_country_hazard_test in order to test country calibration

 CALLING SEQUENCE:
   ok=country_risk_calibrate(country_name)
 EXAMPLE:
   ok=country_risk_calibrate('USA')
 INPUTS:
   country_name: a single country name or a list of countries
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150214, initial
 David N. Bresch, david.bresch@gmail.com, 20150217, Philippines and Taiwan re-adjusted
 David N. Bresch, david.bresch@gmail.com, 20150715, HKG added
 David N. Bresch, david.bresch@gmail.com, 20150803, USA EQ added
 Lea Mueller, muellele@gmail.com, 20151021, add additional countries for phase 2 (Aruba, Barbados, Bermuda, Venezuela, 
            Bahamas, Cook Islands, Guatemala, Honduras, Jamaica, Mozambique, Fiji, Trinidad), calibrated by Jacob Anz
 Lea Mueller, muellele@gmail.com, 20160212, rename to climada_damagefunctionS_generate instead of without s
View <A HREF=file:../../climada_modules/country_risk/code/country_risk_calibrate.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="country_risk_prep">
<H2>country_risk_prep</H2></A>
<font color="blue">function params=country_risk_prep(country_name,check_plot) </font>
 climada
 MODULE:
   country_risk
 NAME:
   country_risk_prep
 PURPOSE:
   prepare all parameters for a given country, sucb that one can run
   country_risk_calc afterwards

   next step: country_risk_calc, see also country_admin1_risk_calc and
 CALLING SEQUENCE:
   params=country_risk_prep(country_name,check_plot)
 EXAMPLE:
   params=country_risk_prep('Barbados')
 INPUTS:
   country_name: name of the country, like 'Switzerland', or a list of
       countries, like {'Switzerland','Germany','France'}. See
       climada_check_country_name for the list of valid country names
       &ampgt prompted for via dropdown list if empty (allows for single or
       multiple country selection)
 OPTIONAL INPUT PARAMETERS:
   check_plot: =1, show check plots, =0 not (default)
 OUTPUTS:
   params: the parameter structure to run country_risk_calc
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160615, initial
View <A HREF=file:../../climada_modules/country_risk/code/country_risk_prep.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="country_risk_report">
<H2>country_risk_report</H2></A>
<font color="blue">function country_risk_report(country_risk,print_format,report_filename,DFC_return_periods,plot_DFC) </font>
 climada
 MODULE:
   country_risk
 NAME:
   country_risk_report
 PURPOSE:
   produce a report (country, peril, damage) based on the results from
   country_risk_calc and country_admin1_risk_calc

   previous call: country_risk_calc and/or country_admin1_risk_calc
   see also: country_risk_report_raw for a raw report (to stdout)
 CALLING SEQUENCE:
   country_risk_report(country_risk,print_format,report_filename,DFC_return_periods,plot_DFC)
 EXAMPLE:
   country_risk_report(country_risk_calc('Barbados')); % all in one

   country_risk0=country_risk_calc('Switzerland'); % country, admin0 level
   country_risk1=country_admin1_risk_calc('Switzerland'); % admin1 level
   country_risk_report([country_risk0 country_risk1]) % report all
   country_risk_report(country_risk,1,'',-250) % only 250yr RP
 INPUTS:
   country_risk: a structure with the results from country_risk_calc
 OPTIONAL INPUT PARAMETERS:
   print_format: =1, report damages in the order they have been calculated
       =2 show by descending damages (default)
       if negative, omit reporting all to stdout
       =0, call country_risk_report_raw (one line with ED per country)
   report_filename: the filename of the Excel file the report is written
       to. Prompted for if not given (if Cancel pressed, write to stdout only)
   DFC_return_periods: damage frequency curve return periods, define the
       return periods we report damage for set =[] to report expected damage
       (ED) only (note that the ED will be denoted as return period=0 in the
       report). Default: DFC_return_periods=[100 250];
       If you set DFC_return_periods to a negative valiue, ONLY that
       return peirod will be reported (no ED, expected damage). Useful if
       e.g. only 100yr damage is of interest (and hence sorting
       descedingly by 100yr return period works, if print_format=2
       Note: DFC_return_periods are not passed on in the old version
       (print_format=0)
   plot_DFC: if =1, plot damage frequency curves (DFC) of all EDSs (!) in
       country_risk, =0 not (default)
       if =2, plot logarithmic scale both axes
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141209, initial
 David N. Bresch, david.bresch@gmail.com, 20141211, header added to Excel report
 David N. Bresch, david.bresch@gmail.com, 20150715, bug fix for empty EDS (e.g. if combine EDS is called prior to report)
 David N. Bresch, david.bresch@gmail.com, 20150715, empty EDS not reported any more
 David N. Bresch, david.bresch@gmail.com, 20150815, option to only report one single RP (no ED)
View <A HREF=file:../../climada_modules/country_risk/code/country_risk_report.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="country_risk_report_raw">
<H2>country_risk_report_raw</H2></A>
<font color="blue">function country_risk_report_raw(country_risk,print_unsorted,plot_DFC) </font>
 climada
 MODULE:
   country_risk
 NAME:
   country_risk_report_raw
 PURPOSE:
   produce a quick&ampdirty report based on the results from
   country_risk=country_risk_calc

   previous call: country_risk_calc and country_admin1_risk_calc
   see also: country_risk_report
 CALLING SEQUENCE:
   country_risk_report_raw(country_risk,print_unsorted,plot_DFC)
 EXAMPLE:
   country_risk_report_raw(country_risk_calc('Barbados')); % all in one

   country_risk0=country_risk_calc('Switzerland'); % country, admin0 level
   country_risk1=country_admin1_risk_calc('Switzerland'); % admin1 level
   country_risk_report([country_risk0 country_risk1]) % report all
 INPUTS:
   country_risk: a structure with the results from country_risk_calc
 OPTIONAL INPUT PARAMETERS:
   print_unsorted: =1, show the results in the order they have been calculated
       =0, show by descending damages (default)
   plot_DFC: if =1, plot damage frequency curves (DFC) of all EDSs (!) in
       country_risk, =0 not (default)
       if =2, plot logarithmic scale both axes
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141024, initial
 David N. Bresch, david.bresch@gmail.com, 20141025, cleanup of country_risk_report
 David N. Bresch, david.bresch@gmail.com, 20141209, renamed to country_risk_report_raw
View <A HREF=file:../../climada_modules/country_risk/code/country_risk_report_raw.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="country_risk_waterfall">
<H2>country_risk_waterfall</H2></A>
<font color="blue">function [entity, entity_future, DFC, DFC_eco, DFC_cc] = country_risk_waterfall(country_name,annual_eco_growth) </font>
 country_risk_waterfall(country_name,annual_eco_growth)
 MODULE:
   country risk
 NAME:
   country_risk_waterfall
 PURPOSE:
   Produce waterfall graph for a specific country, using the precalculated
   hazards (TC, TS, TC_cc_2050, TS_cc_2050) and entity (entity today)
 CALLING SEQUENCE:
   country_risk_waterfall(country_name,annual_eco_growth)
 EXAMPLE:
   country_risk_waterfall('Mexico',0.04)
   country_risk_waterfall({'Mexico'; 'Aruba'},0.04)
   country_risk_waterfall('ALL',0.04)
 INPUTS:
   country_name: name of the country, like 'Switzerland', or a list of
       countries, like {'Switzerland','Germany','France'}. See
       climada_check_country_name for the list of valid country names
       If set to 'ALL', the code runs recursively through ALL countries
       (mind the time this will take...)
       &ampgt prompted for via dropdown list if empty (allows for single or
       multiple country selection)
 OPTIONAL INPUT PARAMETERS:
   annual_eco_growth: annual economic growth, e.g. 0.04 for 4% growth for 
       a developing country, and 0.01 for a developed country 
 OUTPUTS:
   entity: entity structure with today's values
   entity_future: entity structure with future values
   DFC: damage frequency curve with 250 year damage for today's values
   DFC_eco: 250 year damage for economic growth
   DFC_cc: 250 year damage for economic growth and climate change
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151029, initial
 Lea Mueller, muellele@gmail.com, 20151105, call climada_entity_scaleup_factor for future entity and add output variables
View <A HREF=file:../../climada_modules/country_risk/code/country_risk_waterfall.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="emdat_barplot">
<H2>emdat_barplot</H2></A>
<font color="blue">function [legend_str,legend_handle]=emdat_barplot(em_data,damage_symbol,damage_orig_symbol,legend_tag,legend_str,legend_handle,legend_location) </font>
 climada template
 MODULE:
   country_risk
 NAME:
   emdat_barplot
 PURPOSE:
   adds kind of error bars based upon EM-DAT, to a DFC plot, see emdat_read first.
   Just plots the range between em_data.DFC.damage and
   em_data.DFC_orig.damage as a range. Call this last, as it adds two
   legend items (and since the connecting bars are plots, adding legend
   items later is tricky).

   Hint: to show legend 'translucent', call legend('boxoff')

   previous call: emdat_read
   next call: many
 CALLING SEQUENCE:
   legend_str=emdat_barplot(em_data,damage_symbol,damage_orig_symbol,legend_tag,legend_str,legend_handle,legend_location)
 EXAMPLE:
   em_data=emdat_read('','GBR','-WS',1,1);
   emdat_barplot(em_data);
 INPUTS:
   em_data: output of emdat_read, see there, needs to contain em_data.DFC
 OPTIONAL INPUT PARAMETERS:
   damage_symbol: the plot symbol and color for inflated damage, default 'db'
   damage_orig_symbol: the plot symbol and color for original damage, default 'ob'
   legend_tag: the legend entry for EM-DAT, default ='EM-DAT indexed'
       for the original EM-DAT data, ' orig' is added.
   legend_str: the legend items so far, since the routine adds two items
   legend_handle: the handle(s) to all plots with legend items so far
       see e.g. [~,~,legend_str,legend_handle]=climada_EDS_DFC(...)
   legend_location: the position of the legend, default ='SouthEast'
 OUTPUTS:
   legend_str: all legend items, two added
   legend_handle: the handle of all plots 'that matter', i.e. the ones with legends
   plot
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170727, initial
 David N. Bresch, david.bresch@gmail.com, 20170729, defaults improved
View <A HREF=file:../../climada_modules/country_risk/code/emdat_barplot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="emdat_read">
<H2>emdat_read</H2></A>
<font color="blue">function em_data=emdat_read(emdat_file,country_ISO3,peril_ID,exposure_growth,verbose_mode,CAGR) </font>
 climada template
 MODULE:
   country_rsk
 NAME:
   emdat_read
 PURPOSE:
   Read EM-DAT database (www.emdat.be and www.emdat.be/explanatory-notes)
   from the file {country_risk_module}/data/emdat/emdat.xls

   The code primarily reads disaster_syubtype (more precise), which also
   allows a better mapping to climada perils (see paramter peril_ID). But
   since some (past) events are not properly classified by type and/or
   subtype, one can also base the selection on disaster_type (see
   parameter peril_ID). Since we joined disaster type to subtype in Exel,
   disaster type is always there.

   Please note that the EM-DAT database does NOT contain its reference
   date (i.e. the last year it contains data for, see EMDAT_last_year
   in PARAMETERS)

   If requested, index past damages according to GDP (see
   exposure_growth). This feature needs t GDP_entity module to exist

   Please note that the code stores a .mat copy of the Excel upon first
   import (checkes for .mat file being younger then Excel). Use this .mat
   file in case you'd like to get all records, also those with no damage
   or affeced people.

   Also produce a damage frequency curve (DFC) in order to ease comparison with
   climada results, especially if EM-DAT data is filtered by country (see
   input country_ISO3) and peril (see input peril_ID).
   Use e.g. plot(em_data.DFC.return_period,em_data.DFC.damage) to plot the
   damage excess frequency curve based on EM-DAT.

 CALLING SEQUENCE:
   em_data=emdat_read(emdat_file,country_ISO3,peril_ID,exposure_growth,verbose_mode,CAGR)
 EXAMPLE:
   em_data=emdat_read('','USA','TC',0,1);
 INPUTS:
   emdat_file: filename of the emdat database
       Default (='' or no input at all) is full global EM-DAT database, 
       see PARAMETERS for its default location
       if ='ASK', prompt for
 OPTIONAL INPUT PARAMETERS:
   country_ISO3: if provided, only return records for specific country - or
       for the list of countries, if provided as cell, i.e. {'USA','CAN'}
       default: all countries (use climada_country_name to obtaib the ISO3 code)
   peril_ID: if provided, only return records for specific peril, based on
       disaster_subtype (since more precise). If peril_ID starts with '-',
       such as '-TC' or '-Storm', disaster_type is used instead of subtype.
       currently implemented are (see PARAMETERS section)
       - 'TC': tropical cyclone, returns records with disaster subtype='Tropical cyclone' or type 'Storm'
       - 'TS': tropical cyclone surge, returns records with disaster subtype='Coastal flood'
       - 'FL': flood, returns records with disaster subtype='Riverine flood'
       - 'WS': winter storm, returns records with disaster subtype='Extra-tropical storm' or type 'Storm'
       - 'EQ': earthquake, returns records with disaster subtype='Ground movement' or type 'Earthquake'
       - or just any of the disaster subtypes or types in EM-DAT, e.g.
       'Tsunami' (a subtype) or '-Storm' (a type, thus the traling '-'.
       You might use em_data=emdat_read('','USA','',0,1); to get a list of
       all available disaster types or subtypes in the United States (or
       any other country), or emdat_read('','','',0,1) to get all
       Default: all perils (i.e. all disaster subtypes)
   exposure_growth: =1: correct damage numbers to account for exposure
       growth (the field em_data.damage_orig contains the uncorrected numbers
       Only works if a single country is requested, i.e. if country_ISO3
       is specified. In essence, we calculate the correction factor for
       year i as GDP(today)/GDP(year i)
       =0: no correction (default)
   verbose_mode: if =1, print list of countries and disaster subtypes that
       are returned in em_data. Default=0 (silent)
   CAGR: the compound annual growht rate (decimal). If not specified, the
       GDP development of thw past is used to index damages, and a CAGR
       default is used where no GDP exists (see PARAMETERS section, CAGR set
       to 0.02).
 OUTPUTS:
   em_data, a structure with (for each row/event i, field names converted to lowercase)
       filename: the original filename with EM-DAT fata
       year(i): the year (e.g. use hist(em_data.year) to get a feel...)
       disaster_type{i}: disaster type i, see www.emdat.be/explanatory-notes
       disaster_subtype{i}: disaster subtype i, see www.emdat.be/explanatory-notes
       occurrence(i): see www.emdat.be/explanatory-notes
       total_deaths(i): see www.emdat.be/explanatory-notes
       total_affected(i): see www.emdat.be/explanatory-notes
       injured(i): see www.emdat.be/explanatory-notes
       homeless(i): see www.emdat.be/explanatory-notes
       damage(i): the damage in USD (in units of 1 USD)
           Note that EM-DAT estimated damage in the database are given in
           US$ (?000), hence we multiply by 1000. And note further that we
           rename Total_damage to damage for climada compatibility.
       damage_orig(i): the uncorrected damage in case exposure_growth=1
       disaster_combitype(i): both type and subtype, as 'type .. subtype' (for checks)
       frequency(i): the frequency of eaxch event (once in the years the
           database exists for)
       DFC: the damage frequency curve, a structure, see e.g.
           climada_EDS2DFC for this structures's fields, e.g.
           DFC.return_period and DFC.damage
       DFC_orig: the DFC of the original damages in case exposure_growth=1
       YDS: the year damage set, just plain summation of all damages in
           one year, use climada_EDS2DFC(em_data.YDS) to plot...
       last_year: the last year there is data in the whole EM-DAT
       first_year: the first year there is data for selected country(s)
       first_year_overall: the first year there is any data in the whole
           EM-DAT
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150126, initial, Sils Maria
 David N. Bresch, david.bresch@gmail.com, 20150207, list of countries accepted
 David N. Bresch, david.bresch@gmail.com, 20150208, YDS added
 David N. Bresch, david.bresch@gmail.com, 20170715, new emdat until mid 2017
 David N. Bresch, david.bresch@gmail.com, 20170725, FULL overhaul
 David N. Bresch, david.bresch@gmail.com, 20170727, Value_unit added
 David N. Bresch, david.bresch@gmail.com, 20170730, on output em_data.emdat_file_mat added
View <A HREF=file:../../climada_modules/country_risk/code/emdat_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="selected_countries_all_in_one">
<H2>selected_countries_all_in_one</H2></A>
 selected_countries_all_in_one
 climada template
 MODULE:
   module name
 NAME:
   selected_countries_all_in_one, run all project countries, all calculations

   run as a batch code, such that all is available on command line
 PURPOSE:
   Run all climada for project

   In order to synchronize all entities with GDP etc, country_risk_calc
   uses climada_entity_value_GDP_adjust

 CALLING SEQUENCE:
   selected_countries_all_in_one
 EXAMPLE:
   selected_countries_all_in_one
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150105
 David N. Bresch, david.bresch@gmail.com, 20150116, almost complete
 David N. Bresch, david.bresch@gmail.com, 20150121, GDP adjust added
 David N. Bresch, david.bresch@gmail.com, 20150121, GDP adjust added
 David N. Bresch, david.bresch@gmail.com, 20150215, country calibration added at the bottom (all commented out, see there)
 David N. Bresch, david.bresch@gmail.com, 20150225, figure name added
 David N. Bresch, david.bresch@gmail.com, 20150815, latest country list and report only for 250yr event
 David N. Bresch, david.bresch@gmail.com, 20150815, WARNING: cr_EDS_adjust_all and country_risk_EDS2YDS switched off for now
 David N. Bresch, david.bresch@gmail.com, 20150819, centroids in their own dir
 Lea Mueller, muellele@gmail.com, 20151021, add climate change calculations (country_risk_calc_method=-8)
 Lea Mueller, muellele@gmail.com, 20151021, use country_list for phase1+phase2
 David N. Bresch, david.bresch@gmail.com, 20160322, country_list for TEST phase3 (US admin1)
 David N. Bresch, david.bresch@gmail.com, 20160324, small edit
View <A HREF=file:../../climada_modules/country_risk/code/selected_countries_all_in_one.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="GDP_docs_test">
<H2>GDP_docs_test</H2></A>
 batch TEST code, see code
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/GDP_docs_test.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_GDP_check_countrynames">
<H2>climada_GDP_check_countrynames</H2></A>
<font color="blue">function GDP = climada_GDP_check_countrynames(GDP, borders, silent_mode) </font>
 compare countrynames of GDP with climada worldmap (borders.mat)
 NAME:
   climada_GDP_read
 PURPOSE:
   check county names of GDP (worldbank) with climada worldmap country names
   and add index within GDP structure to refer to the index of the relevant
   country within climada world map structure (borders structure)
   previous: climada_GDP_read
   next: diverse
 CALLING SEQUENCE:
   GDP = climada_GDP_check_countrynames(GDP, borders, silent_mode)
 EXAMPLE:
   GDP = climada_GDP_check_countrynames
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   GDP: a struct, if not given, prompted for, with following fields
         .country_names: sorted countrynames (207 countries)
         .year         : vector of all the years that GDP is available for
         .value        : GDP value in USD per country
         .comment      : information about GDP data
         .description  : use for plot as colorbarlabel
   borders             : the borders-strucuture-mat-file in systems folder
                         (created in function climada_world_border)
   silent_mode         :  if set to 1, no print out messages
 OUTPUTS:
  GDP: including field
        .country_borders_index: index to relate to climada worldmap
                                borders.name (can have more than one index
                                if within a group (e.g. china for china
                                and taiwan in climada worldmap))
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20120730
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_GDP_check_countrynames.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_GDP_read">
<H2>climada_GDP_read</H2></A>
<font color="blue">function GDP = climada_GDP_read(xlsfilename, special_cases_on, check_names, silent_mode) </font>
 read GDP data from worldbank (1960 - 2010, in USD)
 http://data.worldbank.org/indicator/NY.GDP.MKTP.CD/countries
 read GDP data and forecast from IMF (2000 - 2017, in national currency)
 http://www.imf.org/external/ns/cs.aspx?id=28
 NAME:
   climada_GDP_read
 PURPOSE:
   read GDP data excel-file to mat-file
   previous: diverse
   next: climada_night_light_read
 CALLING SEQUENCE:
   GDP = climada_GDP_read(xlsfilename, special_cases_on, check_names,
   save_on)
 EXAMPLE:
   GDP = climada_GDP_read(xlsfilename)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   xlsfilename     :  the filename (location) of the GDP data
                      (default World_GDP_1960_2010.xls)
   special_cases_on:  set to 1 for summing up GDP of e.g. Sudan and South
                      Sudan, not applicable for GDP per capita (set to 0)
   check_names     :  if set to 1, check GDP names with borders.name
                      (climada world map)
   save_on         :  if set to 1, GDP-mat file to be saved
   silent_mode     :  if set to 1, no print out messages
 OUTPUTS:
   GDP: a struct, with following fields
         .country_names: sorted countrynames (207 countries)
         .year         : vector of all the years that GDP is available for
         .value        : GDP value in USD per country
         .comment      : information about GDP data
         .description  : use for plot as colorbarlabel
         .country_borders_index: index to relate to climada worldmap
                                  borders.name
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_GDP_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_ask_country_name">
<H2>climada_ask_country_name</H2></A>
<font color="blue">function [country_name,country_ISO3] = climada_ask_country_name(SelectionMode,PromptString) </font>
 ask for a country name through a pop up gui
 NAME:
   climada_ask_country_name
 PURPOSE:
   ask for a country name through a pop up gui
 CALLING SEQUENCE:
   country_name = climada_ask_country_name(SelectionMode,PromptString)
 EXAMPLE:
   country_name = climada_ask_country_name
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   SelectionMode: if set to 'multiple' allow for more than one country to
       be selected, if ='single', allow for single selection only (default)
   PromptString: the prompt string, default is set according to SelectionMode
 OUTPUTS:
   country_name, a char if SelectionMode='single' (default)
       a cell if SelectionMode='multiple'
   country_ISO3: the ISO3 country code (unambiguous)
       a cell if SelectionMode='multiple'
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20141016
 David N. Bresch, david.bresch@gmail.com, 20141126, SelectionMode added
 David N. Bresch, david.bresch@gmail.com, 20141209, ISO3 country code added
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_ask_country_name.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_create_centroids_entity_base">
<H2>climada_create_centroids_entity_base</H2></A>
<font color="blue">function [centroids, entity] = climada_create_centroids_entity_base(country_name, asset_resolution_km, hollowout,... </font>
   check_for_groups, night_light, pp, borders, border_mask, ...
   check_figure, save_on_entity_centroids, no_wbar)
 NAME:
   climada_create_centroids_entity_base
 PURPOSE:
   create centroids and entity for a specific country, distribute assets
   and value according to night light intensities
 CALLING SEQUENCE:
   [centroids entity] =
   climada_create_centroids_entity_base(country_name,asset_resolution_km,...
       hollowout,check_for_groups,night_light,pp,borders,border_mask,...
       check_figure,save_on_entity_centroids,no_wbar)
 EXAMPLE:
   [centroids entity] = climada_create_centroids_entity_base;
   [centroids entity] = climada_create_centroids_entity_base('Bangladesh', 10);
 INPUTS:
   country_name: the name of the country or an ISO3 country code (like
       'CHE'), see climada_check_country_name
   asset_resolution_km:resolution for centroids and assets within entity,
       default 10km
   check_for_groups: if country is within a group (e.g. China with
       Taiwan), to combine the two or more regions, default do not check
       DISABLED, run the code multiple times (see also climada module
       country risk)
   hollowout: hollwout country, so to take only points close to the coast
       line, default do not hollowout
   night_light: structure with night light intensities, automatically load
       from mat or read from default file
   pp: nonlinear transformation function of night lights to values (e.g.
       pp = [0 1 0]; y = 0*x^2 + 1*x + 0
   borders: border structure (with name, polygon for every country)
   border_mask: structure with all country masks (zeros and ones)
   check_figure: set to 1 to visualize figures, default 1
   save_on_entity_centroids: to save entity and centroids automatically,
       default 1
   no_wbar: 1 to suppress waitbars
 OUTPUTS:
   centroids: a structure with fields centroid_ID, Latitude, Longitude,
       onLand, country_name, comment for each centroid
   entity: an entity structure with fields assets, damagefunctions,
       measures, discount. Asset values from an entire country
       sum up to 100. If only coastal areas are selected,
       values sum up to less than 100.
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20140205
 david.bresch@gmail.com, 20140216, replaced variable entity_base with entity for compatibility
 david.bresch@gmail.com, 20141209, country or ISO3 enabled
 david.bresch@gmail.com, 20141229, tolerant iro country names
 david.bresch@gmail.com, 20150804, return empty if Cancel pressed
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 David N. Bresch, david.bresch@gmail.com, 20150819, module_data_dir updated
 Lea Mueller, muellele@gmail.com, 20160318, use climada_map_plot instead of climada_plot_centroids and climada_plot_entity_assets
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_create_centroids_entity_base.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_cut_out_GDP_entity">
<H2>climada_cut_out_GDP_entity</H2></A>
<font color="blue">function [centroids,entity,polygon] = climada_cut_out_GDP_entity(entity,centroids,polygon) </font>
 NAME:
   climada_cut_out_GDP_entity
 PURPOSE:
   Select a specific region within a country (entity and centroids).
   specify region either with a polygon or define interactively with mouse
 CALLING SEQUENCE:
   [centroids entity polygon] = climada_cut_out_GDP_entity(entity, centroids, polygon)
 EXAMPLE:
   [centroids entity polygon] = climada_cut_out_GDP_entity
 INPUTS:
 none
 OUTPUTS:
   centroids: a structure with fields centroid_ID, Latitude, Longitude,
       onLand, country_name, comment for each centroid
   entity: a structure with fields assets, damagefunctions, measures,
       discount. Assets values are based on night light
       intensity and scaled up to todays GDP (e.g. 2014)
   polygon: the polygon that specifies the region that was
       defined through mouse clicks, or self-defined input. The vertices 
       of the polygon as an Mx2 array [X1 Y1; X2 Y2; etc].
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20140206
 david.bresch@gmail.com, 20140216, _2012 replaced by _today
 david.bresch@gmail.com, 20141209, tried to fix, does not work properly
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_cut_out_GDP_entity.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_define_polygon">
<H2>climada_define_polygon</H2></A>
 [x,y] = ginput(4)
 [x,y] = gline(3)
<font color="blue">function polygon = climada_define_polygon </font>
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_define_polygon.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_downscale">
<H2>climada_downscale</H2></A>
<font color="blue">function stru_new_res = climada_downscale(stru, downscale_factor, f_name) </font>
 see code
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_downscale.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_base_assets_add">
<H2>climada_entity_base_assets_add</H2></A>
<font color="blue">function entity_base = climada_entity_base_assets_add(values_distributed, centroids, country_name_str, matrix_hollowout,  X, Y, hollow_name, no_wbar) </font>
 climada add assets to entity base structure, from values_distributed
 NAME:
   climada_entity_base_assets_add
 PURPOSE:
   add assets to entity structure from values_distributed and find the
   closest calculation centroids (encode assets to centroids)
   normally called from: climada_create_centroids_entity_base
 CALLING SEQUENCE:
   entity_base = climada_entity_base_assets_add(values_distributed, centroids, country_name_str, matrix_hollowout,  X, Y)
 EXAMPLE:
   entity_base = climada_entity_base_assets_add(values_distributed, centroids, country_name_str, matrix_hollowout,  X, Y)
 INPUTS:
   values_distributed    : structure mat-file with the following fields
         .values         : distributed values per pixel
         .lon_range      : range of Longitude
         .lat_range      : range of Latitude
         .resolution_x   : resolution in x-direction
         .resolution_y   : resolution in y-direction
   centroids             : a centroid mat-file (struct)
   country_name_str      : country name as string format
   matrix_hollowout      : coastal area, bufferzone and hollowed out matrix,
                           masking 1 for on land, and zero for sea, 2 (max value) for buffer
   X                     : helper matrix containing Longitude information for plotting matrix
   Y                     : helper matrix containing Latitude information for plotting matrix
 OPTIONAL INPUT PARAMETERS:
   no_wbar               : set to 1 to suppress waitbar
 OUTPUTS:
   entity_base           : entity with assets from values_distributed.
                           Values sum up to 100, or if only coastal areas
                           are selected, to less than 100.
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20140205
 david.bresch@gmail.com, 20140216, _2012 replaced by _today
 david.bresch@gmail.com, 20140216, assets.comment introduced
 david.bresch@gmail.com, 20141104, climada_check_matfile used
 david.bresch@gmail.com, 20141215, switch to entity_template.xls
 Lea Mueller, muellele@gmail.com, 20150123, omit assets.Value_today, not needed
 Lea Mueller, muellele@gmail.com, 20150904, add assets.Value_unit field
 Lea Mueller, muellele@gmail.com, 20151125, invoke climada_entity_read instead of climada_entity_read_wo_assets
 Lea Mueller, muellele@gmail.com, 20160331, use entity_template.xlsx from from climad/data/entities, omit encoding
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_entity_base_assets_add.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_read_wo_assets">
<H2>climada_entity_read_wo_assets</H2></A>
<font color="blue">function entity = climada_entity_read_wo_assets(entity_filename) </font>
 climada assets read import without assets
 NAME:
   climada_entity_read_wo_assets
 PURPOSE:
   read the Excel file without assets, but with damagefunctions, measures
   etc. without encoding (climada_assets_encode)
   The code invokes climada_spreadsheet_read to really read the data,
   which implements .xls files
   For .xls, the sheet names are dynamically checked,
   'assets','damagefunctions','measures' and 'discount' need to exist.
 CALLING SEQUENCE:
   entity = climada_entity_read_wo_assets(entity_filename, assets_off)
 EXAMPLE:
   entity = climada_entity_read_wo_assets
 INPUTS:
   entity_filename: the filename of the Excel file with the assets
       &ampgt promted for if not given
 OUTPUTS:
   entity: a structure, with
       assets: a structure, with
           Latitude: the latitude of the values
           Longitude: the longitude of the values
           Value: the total insurable value
           Deductible: the deductible
           Cover: the cover
           DamageFunID: the damagefunction curve ID
       damagefunctions: a structure, with
           DamageFunID: the damagefunction curve ID
           Intensity: the hazard intensity
           MDD: the mean damage degree
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090920
 Lea Mueller, 20110720
 David N. Bresch, david.bresch@gmail.com, 20130328, vuln_MDD_impact -&ampgt
 MDD_impact ...
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_entity_read_wo_assets.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_save_xls">
<H2>climada_entity_save_xls</H2></A>
<font color="blue">function climada_entity_save_xls(entity, entity_xls_file,dam_funct_overwrite,measures_overwrite,discount_overwrite) </font>
 climada assets read import without assets
 MODULE:
   GDP_entity
 NAME:
   climada_entity_save_xls
 PURPOSE:
   Save entiy as xls file
 CALLING SEQUENCE:
   climada_entity_save_xls(entity, entity_xls_file)
 EXAMPLE:
   climada_entity_save_xls(entity)
 INPUTS:
   entity: entity strucure to write out in excel file
   entity_xls_file: the filename of the Excel file to be written
 OUTPUTS:
   excel file
 MODIFICATION HISTORY:
 Lea Mueller, 20130412
 Gilles Stassen 20141210 - change condition from
                  multiple strcmp() statements to ismember(); add relevant
                  'wrong' fields to cell array to be checked in line 64;
                  change to dynamic field referencing instead of getfield;
                  add isnumeric condition to damagefunction section to
                  include peril_ID field.
 Gilles Stassen 20141211 - add overwrite options for non-asset sheets
 Gilles Stassen 20150106 - generalise condition on entity.assets.(fields)
 David N. Bresch, david.bresch@gmail.com, 20150804, old assets.Longitude replaced by assets.lon
 Lea Mueller, muellele@gmail.com, 20160212, set dam_funct_overwrite, measures_overwrite, discount_overwrite to 1 (default)
 Lea Mueller, muellele@gmail.com, 20160212, check excel limit only for .xls version
 Lea Mueller, muellele@gmail.com, 20160307, add other fields in tab &quotothers&quot so that this function can be used for any kind of structure, not just an entity
 Lea Mueller, muellele@gmail.com, 20160318, bugfix if .damagefunctions is empty
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_entity_save_xls.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_scaleup_GDP">
<H2>climada_entity_scaleup_GDP</H2></A>
<font color="blue">function [entity,scale_up_factor]=climada_entity_scaleup_GDP(entity,GDP_future,year_future,year_start,centroids,borders,check_figure,check_printplot) </font>
 upscale a given entity based on GDP growth between two periods
 NAME:
   climada_entity_scaleup_GDP
 PURPOSE:
   upscale a given entity based on GDP growth between two periods
 CALLING SEQUENCE:
   entity = climada_entity_scaleup_GDP(entity, GDP_future,
   year_future, year_start, centroids, borders, check_figure, check_printplot)
 EXAMPLE:
   entity = climada_entity_scaleup_GDP(entity, '', 2030, 2012)
 INPUTS:
   none
 OPTIONAL INPUTS:
   entity       : entity with entity.assets, prompted for it not given
   GDP_future   : GDP data structure based on IMF data, automatically
                  loaded from mat-file or newly read from xls if available
   year_future  : e.g. 2030, default 2030
   year_start   : e.g. 2012, default 2012
   centroids    : centroids structure, with centroids.country_name to link
                  GDP data with entity.assets, prompted for if not given
   borders      : border structure (with name, polygon for every country)
   check_figure : set to 1 to visualize figures, default 1
   check_printplot : set to 1 to save figure, default 0
 OUTPUTS:
   entity: assets upscaled based on GDP growth
   a structure, with
       assets: a structure, with
           Latitude: the latitude of the values
           Longitude: the longitude of the values
           Value: the total insurable value
           Deductible: the deductible
           Cover: the cover
           DamageFunID: the damagefunction curve ID
       damagefunctions: a structure, with
           DamageFunID: the damagefunction curve ID
           Intensity: the hazard intensity
           MDD: the mean damage degree
 MODIFICATION HISTORY:
 Lea Mueller, 20130412
 Melanie Bieli, 20150125, added scale_up_factor as an additional output parameter 
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir
 David N. Bresch, david.bresch@gmail.com, 20160222, module_data_dir updated
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_entity_scaleup_GDP.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_entity_scaleup_factor">
<H2>climada_entity_scaleup_factor</H2></A>
<font color="blue">function entity = climada_entity_scaleup_factor(entity, factor_) </font>
 upscale a given entity with a specific factor
 MODULE:
   GDP_entity
 NAME:
   climada_entity_scaleup_factor
 PURPOSE:
   Upscale entity assets with a specific factor 
 CALLING SEQUENCE:
   entity = climada_entity_scaleup_factor(entity, factor_)
 EXAMPLE:
   entity = climada_entity_scaleup_factor(entity, factor_)
 INPUTS:
   entity: entity with entity.assets
   factor_: factor to multiply entity.assets.Value with
 OPTIONAL INPUTS:
   none
 OUTPUTS:
   entity: assets upscaled with a specific factor
   a structure, with
       assets: a structure, with
           Latitude: the latitude of the values
           Longitude: the longitude of the values
           Value: the total insurable value
           Deductible: the deductible
           Cover: the cover
           DamageFunID: the damagefunction curve ID
       damagefunctions: a structure, with
           DamageFunID: the damagefunction curve ID
           Intensity: the hazard intensity
           MDD: the mean damage degree
 MODIFICATION HISTORY:
 Lea Mueller, 20130412
 david.bresch@gmail.com, 20140216, _2012 replaced by _today
 david.bresch@gmail.com, 20141024, entity.assets.comment introduced
 muellele@gmail.com, 20151105, add module name in documentation
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_entity_scaleup_factor.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_load_border_mask">
<H2>climada_load_border_mask</H2></A>
<font color="blue">function border_mask = climada_load_border_mask(border_mask_DUMMY, asset_resolution_km) </font>
 load border mask
 NAME:
   climada_load_border_mask
 PURPOSE:
   load border mask
 CALLING SEQUENCE:
   border_mask = climada_load_border_mask(border_mask, asset_resolution_km)
 EXAMPLE:
   border_mask = climada_load_border_mask
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   border_mask_DUMMY: a dummy parameter for backward compatibility, not used
   asset_resolution_km: resolution in km, default=10
 OUTPUTS:
   border_mask
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20141016
 David N. Bresch, david.bresch@gmail.com, 20141229, full revision
 David N. Bresch, david.bresch@gmail.com, 20160222, module_data_dir updated
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_load_border_mask.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_load_world_borders">
<H2>climada_load_world_borders</H2></A>
<font color="blue">function borders = climada_load_world_borders </font>
 load world borders and perform basic checks
 MODULE:
   GDP_entity
 NAME:
   climada_load_world_borders

   An OLD code, please consider climada_shaperead
   Kept for backward compatibility, only used by GDP_entity

 PURPOSE:
   load world borders and perform basic checks

   Please note that this is a backward-compatibility solution, as climada
   switched to shapes-based country borders (20141212). Please consider
   climada_country_name and inspect climada_plot_world_borders as well as
   climada_shaperead.

   map_border_file: filename and path to a *.gen or *.shp border file
       if set to 'ASK', prompt for the .gen broder file

       the *.gen file has to be of the following format
       file content                        description (NOT in file)
       -------------------------------------------------------------------
       country_name                        Name of the country
       -70.6,35.2                          longitude,latitude of first polygon point
       -75.3,23.5                          longitude,latitude of second polygon point
       -75.3,23.5                          longitude,latitude of next polygon point
       END                                 marks end of one closed contour
       -45.45,23-6                         next colsed polygon (eg island)
       -67.3,23.7
       END                                 marks end of one closed contour
       country_name                        next country name
       -70.6,35.2                          longitude,latitude of first polygon point
       ...                                 etc...
       END                                 marks end of one closed contour
       END                                 last (double) end to close file (optional)
   keep_boundary: if =1, keep axes boundaries, default =0, undefined
   country_color: the RGB triple for country coloring (e.g. [255 236
       139]/255). Default set in code (yellow)

   See also climada module country_risk
 CALLING SEQUENCE:
   borders = climada_load_world_borders(borders)
 EXAMPLE:
   borders = climada_load_world_borders
 INPUTS:
   none
 OPTIONAL INPUT PARAMETERS:
   borders
 OUTPUTS:
   borders
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20141016
 David N. Bresch, david.bresch@gmail.com, 20141126, for backward compatibility
 David N. Bresch, david.bresch@gmail.com, 20160222, module_data_dir updated
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_load_world_borders.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_mask_buffer_hollow">
<H2>climada_mask_buffer_hollow</H2></A>
<font color="blue">function matrix_buffer = climada_mask_buffer_hollow(matrix, no_pixel_buffer, no_pixel_hollow, border_mask, ... </font>
                                                   check_figure, check_printplot, printname, cbar_label, no_wbar)
 create buffer around country (matrix masking 1 for onland (or higher 
 values if more than one country), 0 for sea, max value for bufferzone)
 NAME:
   climada_bufferzone
 PURPOSE:
   create buffer around country
   previous: diverse
   next: climada_mask_hollowout, climada_matrix2centroid
 CALLING SEQUENCE:
   matrix_buffer = climada_bufferzone(matrix, no_pixel, border_mask,
   check_figure, check_printplot, printname, cbar_label)
 EXAMPLE:
   matrix_buffer = climada_bufferzone(matrix, 5)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   matrix          : matrix masking 1 for on land, and zero for sea
                     (e.g.border_mask.mask{1}), max value for buffer
   no_pixel_buffer : no of pixel that mask the bufferzone around the
                     country/countries
   no_pixel_hollow : no of pixel that mask the bufferzone around the
                     country/countries. Set to 0 if no hollowout is needed.
   border_mask     : structure containg all country masks, including field
                     .world_mask (1 for on land, and 0 for sea)
   check_figure    : set to 1 to show figure distributed GDP
   check_printplot : set to 1 to save figure
   printname       : string for title and for filename if saved
   cbar_label      : label for colorbar (ISO3 codes for country names)
   no_wbar         : 1 for not waitbar, otherwise waitbar will show up
 OUTPUTS:
   matrix_buffer   : matrix masking 1 for on land, zero for on sea, and
                     max value for bufferzone
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20120730
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_mask_buffer_hollow.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_matrix2centroid">
<H2>climada_matrix2centroid</H2></A>
<font color="blue">function centroids = climada_matrix2centroid(matrix_buffer, lon_range, lat_range, country_name) </font>
 create centroids (structure) out of matrix_buffer and according range of
 longitude and latitude
 NAME:
   climada_matrix2centroid
 PURPOSE:
   create centroids based on matrix_hollowout or matrix_buffer
   previous: climada_mask_buffer_hollow
   next    : create entity, diverse
 CALLING SEQUENCE:
   centroids = climada_matrix2centroid(matrix_buffer, lon_range, lat_range, 
   country_name)
 EXAMPLE:
   centroids = climada_matrix2centroid(matrix_buffer, lon_range, lat_range)
 INPUTS:
   matrix_buffer   : matrix masking 1 for on land (or higher values if more 
                     than one country), zero for on sea, and max value for bufferzone
   lon_range       : range of Longitude of matrix_buffer
   lat_range       : range of Latitude of matrix_buffer
 OPTIONAL INPUT PARAMETERS:
   country_name    : country name for countries in matrix_buffer
 OUTPUTS:
   centroids structure with following fields
      .centroid_ID : unambiguous ID number for each centroid
      .lon   : Longitude of centroid
      .lat    : Latitude of centroid
      .onLand      : 1 for on land (or higher if more than one country, 
                     zero for on sea, and max value for bufferzone
      .country_name: country_name for each centroid, enhanced with 
                     'buffer' and 'sea'
      .comment     : information about centroids
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20140205
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_matrix2centroid.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_night_light_read">
<H2>climada_night_light_read</H2></A>
<font color="blue">function night_light = climada_night_light_read(png_filename, check_figure, check_printplot, save_on) </font>

 NAME:
   climada_night_light_read
 PURPOSE:
   read stable night lights (2010) from NOAA

   read stable night lights, 2010 (resolution ~10km)
   http://www.ngdc.noaa.gov/dmsp/downloadV4composites.html
   http://www.ngdc.noaa.gov/dmsp/data/web_data/v4composites/F182010.v4.tar
   Version 4 DMSP-OLS Nighttime Lights Time Series

   previous: diverse
   next: climada_GDP_distribute
   see also: module country_risk, climada_nightlight_entity
 CALLING SEQUENCE:
   night_light = climada_night_light_read(png_filename, check_figure, check_printplot, save_on)
 EXAMPLE:
   night_light = climada_night_light_read
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   png_filename: the filename (location) of the png-file with night lights
       (global coverage)
       &ampgt prompted for if empty (default night_light_2010_10km.png, but not
       automatically chosen)
   check_figure: =1: show figure of night light, default=0
   check_printplot: =1 to 1 to save figure (default=0)
   save_on: =1 to save .mat file (default)
 OUTPUTS:
   night_light: a struct, with following fields
         .value        : GDP value in USD per country
         .lon_range    : range of Longitude
         .lat_range    : range of Latitude
         .resolution_x : resolution in x-direction
         .resolution_y : resolution in y-direction
         .comment      : information about night light data
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20120730
 David N. Bresch, david.bresch@gmail.com, 20141205, cleanup
 David N. Bresch, david.bresch@gmail.com, 20160222, module_data_dir updated
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_night_light_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_nightlight_nonlinear_transformation">
<H2>climada_nightlight_nonlinear_transformation</H2></A>
<font color="blue">function [values_out, pp] = climada_nightlight_nonlinear_transformation(values_in, pp, check_figure, check_printplot) </font>
 transform night light intensity values (between 1 and 63) nonlinearly 
 into distributed GDP assets (based on relationship between night lights
 and asset distribution), use a second order polynomial without y-indent,
 e.g. y = pp(1)*x^2 + pp(2)*x;
 NAME:
   climada_nightlight2GDP
 PURPOSE:
   nonlinearly transform night light with second order polynomial
   this function is used within climada_GDP_distribute
 CALLING SEQUENCE:
   [values_out pp] = climada_nightlight2GDP(values_in, pp, check_figure)
 EXAMPLE:
   [values_out pp] = climada_nightlight2GDP(values_in, pp)
 INPUTS:
   values_in   : original night light values (matrix) (values between
                 1 and 63)
   pp          : parameters of second order polynomial function, 
                 y = pp(2)*x^2 + pp(1)*x
 OPTIONAL INPUT PARAMETERS:
   check_figure   : set to 1 to show figure distributed GDP
   check_printplot: set to 1 to save figure
 OUTPUTS:
   values_out  : transformed night light values
   pp          : parameters of second order polynomial function
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20120813
 Lea Mueller, muellele@gmail.com, 20160318, add pp numbers
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_nightlight_nonlinear_transformation.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_parameter_string">
<H2>climada_parameter_string</H2></A>
<font color="blue">function pp_str = climada_parameter_string(pp) </font>
 create parameter string from parameters
 NAME:
   climada_parameter_string
 PURPOSE:
   create parameter string from parameters
 CALLING SEQUENCE:
   pp_str = climada_parameter_string(pp)
 EXAMPLE:
   pp_str = climada_parameter_string
 INPUTS:
   pp
 OUTPUTS:
   pp_str
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20141017
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_parameter_string.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_centroids">
<H2>climada_plot_centroids</H2></A>
<font color="blue">function fig = climada_plot_centroids(centroids, country_name, check_printplot, printname) </font>
 plot centroids on a map, differentiate for coastal land areas,
 bufferzone, and further away (more inland and on sea)
 NAME:
   climada_plot_centroids
 PURPOSE:
   plot centroids on a map, differentiate for coastal land areas,
   bufferzone, and further away (more inland and on sea)
   next: diverse
 CALLING SEQUENCE:
   fig = climada_plot_centroids(centroids, country_name, check_printplot, printname)
 EXAMPLE:
   climada_plot_centroids(centroids, country_name)
 INPUTS:
   centroids       : centroids structure
   country_name    : name of the country (cell or string)
   check_printplot : set to 1 to save figure, default 0
   printname       : string for title and for filename if saved
 OUTPUTS:
   fig             : figure handle
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20140205
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_plot_centroids.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_polygon2raster">
<H2>climada_polygon2raster</H2></A>
<font color="blue">function border_mask = climada_polygon2raster(borders, raster_size, save_on) </font>
 create raster (mask with 1 for inside and on polygon, and zeros for
 outside polygon) based on polygon-input for a specific raster size
 NAME:
   climada_polygon2raster
 PURPOSE:
   create raster (mask with 1 for inside and on polygon, and zeros for
   outside polygon) based on polygon-input for a specific raster size
   previous: diverse
   next: diverse
 CALLING SEQUENCE:
   border_mask = climada_polygon2raster(borders, raster_size)
 EXAMPLE:
   border_mask = climada_polygon2raster(borders, raster_size)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   borders     : structure (fields with polygons and names) from climada plot
                 world map
   raster_size : size of requested matrix (e.g. [336 864], 50km
   resolution); [1680 4320], 10km; [168 432], 100km
 OUTPUTS:
  border_mask  : structure with following fields
  .mask        : 243 matrices (for each country) masking 1 for
                 within country and zero for out of country
  .name        : name of all countries
  .world_mask  : world mask (all countries), 1 for land, 0 for sea
  .lon_range   : longitudinal range of masks
  .lat_range   : latitudinal range of masks
  .resolution_x: resolution in x direction in degree
  .resolution_y: resolution in y direction in degree
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20120730
 David N. Bresch, david.bresch@gmail.com, 20141229, revision
 David N. Bresch, david.bresch@gmail.com, 20160222, module_data_dir updated
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_polygon2raster.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_resolution_downscale">
<H2>climada_resolution_downscale</H2></A>
<font color="blue">function [low_resolution_matrix, X, Y, resolution_km] = climada_resolution_downscale(high_resolution_matrix, resolution_km, specification) </font>
 downscale resolution of input matrix to requested resolution in km
 sum up the data, or take the mean, or take the maximum occurence of
 values
 NAME:
   climada_resolution_downscale
 PURPOSE:
   downscale resolution of input matrix to requested resolution in km
   previous: climada_GDP_distribute
   next: diverse
 CALLING SEQUENCE:
   [low_resolution_matrix, X, Y, resolution_km] = climada_resolution_downscale(high_resolution_matrix, resolution_km, specification)
 EXAMPLE:
   [low_resolution_matrix, X, Y, resolution_km] = climada_resolution_downscale
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   high_resolution_matrix: structure mat-file with the following fields
                           e.g. values_distributed
         .values         : distributed values per pixel
         .lon_range      : range of Longitude
         .lat_range      : range of Latitude
         .resolution_x   : resolution in x-direction
         .resolution_y   : resolution in y-direction
   resolution_km         : requested resolution in km, if empty, set to 50km
   specification         : specificy way to determine value for downscaled
                           resolution, sum up all values with keyword 'sum', 
                           take average with keyword 'average', take most 
                           counted value with keyword 'unique', if not
                           given 'sum' is taken
 OUTPUTS:
   low_resolution_matrix : structure with same fields as
                           high_resolution_matrix
         .values         : values per pixel
         .lon_range      : range of Longitude
         .lat_range      : range of Latitude
         .resolution_x   : resolution in x-direction
         .resolution_y   : resolution in y-direction
         .comment        : information 
  X                      : helper matrix containing Longitude information for
                           plotting matrix
  Y                      : helper matrix containing Latitude information for
                           plotting matrix
  resolution_km          : requested resolution in km

 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20120730
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/climada_resolution_downscale.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="inpoly">
<H2>inpoly</H2></A>
<font color="blue">function [cn,on] = inpoly(p,node,edge,TOL) </font>
  INPOLY: Point-in-polygon testing.

 Determine whether a series of points lie within the bounds of a polygon
 in the 2D plane. General non-convex, multiply-connected polygonal
 regions can be handled.

 SHORT SYNTAX:

   in = inpoly(p,node);

   p   : The points to be tested as an Nx2 array [x1 y1; x2 y2; etc].
   node: The vertices of the polygon as an Mx2 array [X1 Y1; X2 Y2; etc].
         The standard syntax assumes that the vertices are specified in
         consecutive order.

   in  : An Nx1 logical array with IN(i) = TRUE if P(i,:) lies within the
         region.

 LONG SYNTAX:

  [in,on] = inpoly(p,node,edge);

  edge: An Mx2 array of polygon edges, specified as connections between
        the vertices in NODE: [n1 n2; n3 n4; etc]. The vertices in NODE
        do not need to be specified in connsecutive order when using the
        extended syntax.

  on  : An Nx1 logical array with ON(i) = TRUE if P(i,:) lies on a
        polygon edge. (A tolerance is used to deal with numerical
        precision, so that points within a distance of
        eps^0.8*norm(node(:),inf) from a polygon edge are considered &quoton&quot
        the edge.

 EXAMPLE:

   polydemo;       % Will run a few examples

 See also INPOLYGON

 The algorithm is based on the crossing number test, which counts the
 number of times a line that extends from each point past the right-most
 region of the polygon intersects with a polygon edge. Points with odd
 counts are inside. A simple implementation of this method requires each
 wall intersection be checked for each point, resulting in an O(N*M)
 operation count.

 This implementation does better in 2 ways:

   1. The test points are sorted by y-value and a binary search is used to
      find the first point in the list that has a chance of intersecting
      with a given wall. The sorted list is also used to determine when we
      have reached the last point in the list that has a chance of
      intersection. This means that in general only a small portion of
      points are checked for each wall, rather than the whole set.

   2. The intersection test is simplified by first checking against the
      bounding box for a given wall segment. Checking against the bbox is
      an inexpensive alternative to the full intersection test and allows
      us to take a number of shortcuts, minimising the number of times the
      full test needs to be done.

   Darren Engwirda: 2005-2007
   Email          : d_engwirda@hotmail.com
   Last updated   : 23/11/2007 with MATLAB 7.0

 Problems or suggestions? Email me.
View <A HREF=file:../../climada_modules/country_risk/code/GDP_entity/inpoly.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_nightlight2cdf">
<H2>climada_nightlight2cdf</H2></A>
<font color="blue">function ok=climada_nightlight2cdf(parameters) </font>
 country admin0 admin1 entity high resolution
 NAME:
	climada_nightlight2cdf
 PURPOSE:
   save high-resolution (1km!) or mid-resolution (10km) night light data
   as netCDF file (using ncwrite), use ncdisp to check the file

   Reads an image file with nightlight density and scales to proxy for asset values.

   The original nightlight intensities are first scaled to the range
   [0..1], then transformed using a polynomial (see
   parameters.nightlight_transform_poly).

   If the high-resolution night light image is stored locally (about 700MB
   as tiff, after first call about 24MB as .mat), the code works from
   there.
   See http://ngdc.noaa.gov/eog/dmsp/downloadV4composites.html#AVSLCFC3
   to obtain the file
   http://ngdc.noaa.gov/eog/data/web_data/v4composites/F182012.v4.tar
   and unzip the file F182012.v4c_web.stable_lights.avg_vis.tif in there
   to the /data folder of country_risk module. As the .tif is so much
   larger, the climada module country_risk comes with the .mat file, but
   does not contain the original (.tif).

   next step: ncdisp % to check the file
 CALLING SEQUENCE:
   ok=climada_nightlight2cdf(parameters)
 EXAMPLE:
   ok=climada_nightlight2cdf;
   parameters=climada_nightlight2cdf('parameters') % return all default parameters
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   parameters: a structure to pass on parameters, with fields as
       (run parameters=climada_nightlight2cdf('parameters') to obtain
       all default values)
       resolution_km: the resuting resolution, either =1 (default) or =10
       nightlight_transform_poly: the polynomial coefficients to transform
           the nightlight intensity (usually in the range 0..62) to proxy
           asset values. Evaluated using polyval, i.e.
           value=polyval(parameters.nightlight_transform_poly,nightlight_intensity)
           Default=[0 1 0 0], which means Value=nightlight_intensity^2
           After this Values are normalized to sum up to 1.
           Note that if a whole country is requested, Values are then
           scaled to sum up to GDP*(income_group+1).
       img_filename: the filename of an image with night light density, as
           created using the GUI at http://maps.ngdc.noaa.gov/viewers/dmsp_gcv4/
           and select Satellite F18, 2010, avg_lights_x_pct, then 'Download
           data' and enter the coordinates
           The filename has to be of form A_B_C_D_{|E_F}*..lzw.tiff with A,B,C and D
           the min lon, min lat, max lon and max lat (integer), like
           87_20_94_27_F182010.v4c.avg_lights_x_pct.lzw.tiff and E and F the
           country (admin0) and state/province (admin1) name, like
           -88_24_-79_32_United States of America_Florida_high_res.avg_lights.lzw.tiff

           If empty (eg run the code without any argument), it prompts for country
           and admin1 name and constructs the URL to get the corresponding
           tile from the nightlight data, e.g. a string such as:
           http://mapserver.ngdc.noaa.gov/cgi-bin/public/gcv4/F182010.v4c.
               avg_lights_x_pct.lzw.tif?request=GetCoverage&ampservice=WCS&amp
               version=1.0.0&ampCOVERAGE=F182010.v4c.avg_lights_x_pct.lzw.tif&amp
               crs=EPSG:4326&ampformat=geotiff&ampresx=0.0083333333&ampresy=0.0083333333&amp
               bbox=-88,24,-79,32

           ='ASK' prompt for an image file (without first asking for country
           where one has to press 'Cancel') to get the to filename prompt
       netcdf_filename: the filename to save the netCDF file to, default
           is same folder as original image, just with extension .cdf
       verbose: whether we printf progress to stdout (=1, default) or not (=0)
 OUTPUTS:
   ok: =1, if successful
 RESTRICTIONS:
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20170119, initial, based on climada_nightlight_entity
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/climada_nightlight2cdf.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="country_risk_EDS2YDS">
<H2>country_risk_EDS2YDS</H2></A>
<font color="blue">function country_risk=country_risk_EDS2YDS(country_risk) </font>
 climada country risk
 MODULE:
   country_risk
 NAME:
   country_risk_EDS2YDS
 PURPOSE:
   Convert event damage sets (EDS) to year damage sets (YDS) where
   appropriate (currently TC, TS and TR, see climada_EDS2YDS, where
   this is determined).

   Works properly with both country_risk_calc and
   country_admin1_risk_calc output

   Makes most sense of country_risk_EDS_combine has been applied to the
   country_risk rsult structure before

   prior call: country_risk_EDS_combine
 CALLING SEQUENCE:
   res=country_risk_EDS2YDS(country_risk)
 EXAMPLE:
   res=country_risk_EDS2YDS(country_risk)
 INPUTS:
   country_risk: a structure as returned by country_risk_calc
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   country_risk: a structure as returned by country_risk_calc, EDSs
   converted into YDSs where appropriate
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150116, initial (TC, TS, TR)
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/country_risk_EDS2YDS.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="country_risk_EDS_combine">
<H2>country_risk_EDS_combine</H2></A>
<font color="blue">function [country_risk,EDC]=country_risk_EDS_combine(country_risk) </font>
 climada country risk
 MODULE:
   country_risk
 NAME:
   country_risk_EDS_combine
 PURPOSE:
   Combine sub-hazards TC and TS in country_risk result structure
   does NOT combine TR (rain). See output EDC for maximally combined EDS.

   Works properly with both country_risk_calc and
   country_admin1_risk_calc output

   Note assumes the TS EDS directly follows the TC EDS, does not search all EDSs
   for matching ones, just: if TC, check whether next EDS is TC (and same
   ocean basin, obviously), then combine.

   prior call: country_risk_calc
 CALLING SEQUENCE:
   res=country_risk_EDS_combine(country_risk)
 EXAMPLE:
   res=country_risk_EDS_combine(country_risk)
 INPUTS:
   country_risk: a structure as returned by country_risk_calc
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   country_risk: the same structure as returned by country_risk_calc,
       with TC and TS combined
   EDC: the maximally combined EDS, the event damage collector
       i.e. only one fully combined EDS per hazard and region (i.e. on for
       all TC atl, EQ glb...). Only assumption: the summation happens over
       EDS.damage of exact same length, i.e. should two perils (and
       regions) have exactly the same number of events, the code sums them
       up, as long as the peril_ID(1) match (it does never sum up EQ and
       TC, as E and T are different, but would sum up TC atl and TC epa
       should both basin hazard event sets have the same number of events.
       Therefore, inspect the EDC(i).EDS.annotation_name carefully, it is
       the cllection of all annotation names.
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150114, initial (only TC and TS)
 David N. Bresch, david.bresch@gmail.com, 20150203, maximally combined EDS
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/country_risk_EDS_combine.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_DFC_plot">
<H2>cr_DFC_plot</H2></A>
<font color="blue">function cr_DFC_plot(country_risk,country_i,hazard_i,CAGR,show_plot) </font>
 climada template
 MODULE:
   country_risk
 NAME:
   cr_DFC_plot
 PURPOSE:
   Plot the country damage frequency curves (DFC)

   Note that the countries and perils selected in EM-DAT are written to
   stdout for check (as a country might have no EM-DAT data and hence
   comparison with EM-DAT might be misleading - as it should anyway be
   taken with a pinch of salt...)

   Previous call: country_risk_calc or country_risk_EDS_combine
   See also: cr_DFC_plot_aggregate (aggregate results for peril regions)
 CALLING SEQUENCE:
   cr_DFC_plot(country_risk,country_i,hazard_i,CAGR,show_plot)
 EXAMPLE:
   % let's assume country_risk_calc has been run for this list with
   % method=-3 (create hazard event sets) already, then:
   country_list={'Colombia','Costa Rica','Dominican Republic'};
   country_risk=country_risk_calc(country_list,-7,0,0,['atl_TC';'atl_TS']); % calc EDS
   [country_risk,EDC]=country_risk_EDS_combine(country_risk); % combine TC and TS and calculate EDC
   cr_DFC_plot(country_risk)
   cr_DFC_plot(country_risk,1,2,[],1) % 1st country, 2nd hazard only
 INPUTS:
   country_risk: the output of country_risk_EDS_combine, see there
       note that country_risk_EDS_combine is just called after
       country_risk_calc to combine sub-peril EDSs. Present code runs also
       if country_risk_EDS_combine has not been called, but then shows
       e.g. TC and TS separately.
 OPTIONAL INPUT PARAMETERS:
   country_i: the country index (as shown when first run) to only show one
       country (usefule in the country damagefunction calibration process)
   hazard_i: the hazard index (as shown when first run) to only show one
       hazard (usefule in the country damagefunction calibration process)
   CAGR: the compound annual growth rate to inflate historic EM-DAT
       damages with, if empty, the default value is used (climada_global.global_CAGR)
   show_plot: =1 (default) show the plot, 0= just create and save the plot
 OUTPUTS:
   plot, as figure and stored to .../results/cr_results/{region}{peril}_aggregate
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150213, intial
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_DFC_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_DFC_plot_aggregate">
<H2>cr_DFC_plot_aggregate</H2></A>
<font color="blue">function cr_DFC_plot_aggregate(country_risk,EDC,CAGR,show_plot) </font>
 climada template
 MODULE:
   country_risk
 NAME:
   cr_DFC_plot_aggregate
 PURPOSE:
   Plot the combined global damage frequency curve (DFC) and the annual
   aggregate DFC 

   Note that the countries and perils selected in EM-DAT are written to
   stdout for check (as a country might have no EM-DAT data and hence
   comparison with EM-DAT might be misleading - as it should anyway be
   taken with a pinch of salt...)

   Previous call: country_risk_calc or country_risk_EDS_combine
   See also: cr_DFC_plot (country instead of aggrgate results)
 CALLING SEQUENCE:
   cr_DFC_plot_aggregate(country_risk,EDC,CAGR,show_plot)
 EXAMPLE:
   % let's assume country_risk_calc has been run for this list with
   % method=-3 (create hazard event sets) already, then:
   country_list={'Colombia','Costa Rica','Dominican Republic'};
   country_risk=country_risk_calc(country_list,-7,0,0,['atl_TC';'atl_TS']); % calc EDS
   [country_risk,EDC]=country_risk_EDS_combine(country_risk); % combine TC and TS and calculate EDC
   cr_DFC_plot_aggregate(country_risk,EDC)
 INPUTS:
   country_risk: the output of country_risk_calc or country_risk_EDS_combine.
       Note that country_risk_EDS_combine is just called after
       country_risk_calc to combine sub-peril EDSs and to produce the EDC,
       the maximally combined EDS (i.e. one global EDS per peril and
       region). If you do not provide the EDC (2nd parameter),
       cr_DFC_plot_aggregate does in fact call country_risk_EDS_combine
       itself.
 OPTIONAL INPUT PARAMETERS:
   EDC: the output of country_risk_EDS_combine, see there. If empty, the
       code runs country_risk_EDS_combine to obtain it.
   CAGR: the compound annual growth rate to inflate historic EM-DAT
       damages with, if empty, the default value is used (climada_global.global_CAGR)
   show_plot: =1 (default) show the plot, 0= just create and save the plot
 OUTPUTS:
   plot, as figure and stored to .../results/cr_results/{region}{peril}_aggregate
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150213, intial
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_DFC_plot_aggregate.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_EDS_emdat_adjust">
<H2>cr_EDS_emdat_adjust</H2></A>
<font color="blue">function [EDS,climada2emdat_factor_weighted,em_data]=cr_EDS_emdat_adjust(EDS,verbose_mode) </font>
 climada template
 MODULE:
   country_risk
 NAME:
   cr_EDS_emdat_adjust
 PURPOSE:
   Given an event damge set (EDS), adjust results to best match EM-DAT
   damage history of a given country for a given peril, see also
   emdat_read (the raw damage from EM-DAT is scaled up for growth...)

   previous call: climada_EDS_calc and country_risk_calc
   See also: emdat_read and cr_plot_DFC
 CALLING SEQUENCE:
   [EDS,climada2emdat_factor_weighted]=cr_EDS_emdat_adjust(EDS,verbose_mode)
 EXAMPLE:
   EDS=cr_EDS_emdat_adjust(climada_EDS_calc)
 INPUTS:
   EDS: an event damge set (EDS), as calculated by climada_EDS_calc
       Only one EDS supported, e.g. use EDS(i) as input if EDS is an array
       of structs
 OPTIONAL INPUT PARAMETERS:
   verbose_mode: if =1, print list of countries and disaster subtypes that
       are returned from EM-DAT. 
       =2: also plot the damage frequency curve (DFC) before and after
       adjustment as well as the EM-DAT information
       Default=0 (silent)
 OUTPUTS:
   EDS: the adjusted EDS
   climada2emdat_factor_weighted: the weighted adjustment factor (i.e.
       EDS.damage output = EDS.damage input * climada2emdat_factor_weighted
   em_data: the EM-DAT data as used to adjust
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150127, initial
 David N. Bresch, david.bresch@gmail.com, 20150202, em_data as output
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_EDS_emdat_adjust.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_checksum">
<H2>cr_checksum</H2></A>
<font color="blue">function cr_checksum(country_name,peril_ID,report_fid) </font>
 climada template
 MODULE:
   country_risk
 NAME:
   cr_checksum
 PURPOSE:
   Calculate a checksum for entity, damage functions (the ones with ID 1)
   and hazard sets

   See also country_risk_calc
 CALLING SEQUENCE:
   cr_checksum(country_name,peril_ID)
 EXAMPLE:
   cr_checksum('Australia','TC')
   cr_checksum({'Australia','China'},'TC')
   country_list={'Japan','New Zealand','Belgium','Taiwan','Mexico','Italy','Philippines'};
   cr_checksum(country_list)
 INPUTS:
   country_name: a single country name (output to stdout) or a list of
       countries (output to file ../results/cr_checksum.csv). If ='ALL',
       run for all countries.
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   peril_ID: the peril_ID we check for
       currently aborts if no ID provided, future implementations will
       loop over perils
   report_fid: INTERNAL, to pass on the fid of the report file
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150429, initial
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_checksum.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_country_DFC_sensitivity">
<H2>cr_country_DFC_sensitivity</H2></A>
<font color="blue">function cr_country_DFC_sensitivity(country_ISO3,show_plot,probabilistic,damagefunctions,peril_ID,peril_region) </font>
 generate damagefunction sensitivity plots of all hazards affecting a 
 given country
 MODULE:
   country_risk
 NAME:
   cr_country_DFC_sensitivity
 PURPOSE:
   For a given country (defined by its ISO3 code), generate 
   &quotdamagefunction sensitivity plots&quot (i.e., DFCs resulting from modifying 
   an entity's original damagefunctions in different ways) of all 
   available hazards and store them in a folder 
   &quotdamagefun_sensitivity_plots&quot in climada-master/data/results

   see cr_damagefunction_sensitivity for more information on how the
   damagefunctions are modified. The present code
   cr_country_DFC_sensitivity is a mere caller to cr_damagefunction_sensitivity

   For the generation of entities and hazards in one single function, see 
   country_risk_calc (in the module country_risk), which creates hazard 
   sets and an entity for a given country before it runs the risk 
   calculations. For automatic comparison of a series of countries in one
   hazard region, see selected_countries_region_peril
   
 CALLING SEQUENCE:
   cr_country_DFC_sensitivity(country_ISO3,show_plot,probabilistic,damagefunctions,peril_ID,peril_region)
 EXAMPLE:
   cr_country_DFC_sensitivity('CHN', 1) % country: China, don't show plots
 INPUTS:
   country_ISO3: ISO3 code of a country (see climada_country_name for
   valid ISO3 codes)
 OPTIONAL INPUT PARAMETERS:
   show_plot: only save the plots (=0; default), or show and save the 
       plots (=1)
   probabilistic: whether to use the probabilistic hazard sets (=1, default) 
       or the historic ones (=0)
   damagefunctions: a struct containing the damagefunctions (for one
       single peril) to overwrite the entity's damagefunctions with. See
       e.g. climada_damagefunctions_read. Replaces entity.damagefunctiuons 
       without any further tests. The user is responsible for not messing
       up, i.e. for entity.assets.DamageFunID to point to the right damage
       function, damagefunctions.peril_ID to be consistent with e.g. input
       parameter peril_ID etc.
   peril_ID: 2-digit peril ID, like 'TC','TS','TR','WS','EQ',... 
       If not provided, the peril for which the first damagefunction with
       DamageFunID =1 exists is used.
   peril_region: e.g. 'wpa' or 'atl', allows for selection of a
       specific region. If not provided, no selection of peril region,
       i.e. a country affected by tropical cyclones from two basins (such
       as El Salvador with atl and epa) is treated twice.
 OUTPUTS:
   plots of a set of DFCs (generated using different damagefunctions) for
   all perils affecting the given country (or for one specific peril, if a
   peril-specific damagefunctions struct is passed as input)
 NOTE 1:
   TR hazard sets are currently not considered since there is no
   damagefunctions implemented for that peril yet.
 NOTE 2:
   In the current implementation, a peril_ID can only be selected
   implicitly, i.e. by giving the function a peril-specific
   damagefunctions struct. One might consider adding peril_ID also as a
   separate input argument, such that a specific peril can be chosen
   without having to pass a damagefunctions struct to the function
 NOTE 3:
   This is a preliminary version that might need some clean-up /
   optimization

 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150206, initial
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150209, added damagefunctions and peril_region
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150209, simplified to one peril (and one region)
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_country_DFC_sensitivity.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_country_hazard_test">
<H2>cr_country_hazard_test</H2></A>
<font color="blue">function country_risk=cr_country_hazard_test(country_risk,country_i,hazard_i,CAGR,show_plot) </font>
 climada country risk calibrate test damage function
 MODULE:
   module name
 NAME:
   cr_country_hazard_test
 PURPOSE:
   Given a country_risk results structure, experiment with one country and
   hazard to test different damage function settings etc.

   This code is MOST LIKELY to be edited by the user, i.e. to set
   damagefunction parameters etc. It provides merely a TESTBED for
   efficient calibration of country results.

   Process:
   - Run country_risk_calc for either one or a set of countries. A set makes
     particularly sense for e.g. a peril region, such as TC atl, in order to
     ensure (neighbouring) countries in that region have similar
     damagefunction settings. Hence you might e.g. run
     &ampgt&ampgt country_list={'Colombia','Costa Rica','Dominican Republic','United States'};
     &ampgt&ampgt country_risk=country_risk_calc(country_list,-7,0,0,['atl_TC';'atl_TS']);
   - call cr_DFC_plot to get a first overview by country, e.g.
     &ampgt&ampgt cr_DFC_plot(country_risk)
   - call cr_DFC_plot_aggregate to get a first overview or the combined
     results of all countries, e.g.
     &ampgt&ampgt cr_DFC_plot_aggregate(country_risk) % does combine EDSs himself
     Note that especially the comparison with EM-DAT makes only sense for
     either larger countries or a group of smaller ones - otherwise it
     might be too much due to chance whether a country got hit in the past
     years or not.
   - Now, call cr_country_hazard_test to test different damagefunction
     settings (or modifications) for one country and peril, e.g.
     country_risk=cr_country_hazard_test(country_risk,2,1) % 'Costa Rica','TC'
     and occasionally call cr_DFC_plot_aggregate(country_risk) to show the
     aggregate result. Note that cr_DFC_plot_aggregate does the
     aggregation itself.
     In case you'd like to experiment only with TC, but want to compare TC
     and TS combined, proceed as follows (say hazard 1 is TC, hazard 2 TS)
     &ampgt&ampgt country_risk=cr_country_hazard_test(country_risk,2,1)
     &ampgt&ampgt [country_risk_agg,EDC]=country_risk_EDS_combine(country_risk);
     &ampgt&ampgt cr_DFC_plot(country_risk_agg,1,1)

   How to use: make your copy of the present code (name it e.g.
   cr_country_hazard_mytest) and experiment with different damage function
   settings for a given country and region (group of countries). In
   special cases, you might also consider adjusting hazard event sets.

   Next step: put your final adjustments in country_risk_calibrate
 CALLING SEQUENCE:
   country_risk=cr_country_hazard_test(country_risk,country_i,hazard_i,CAGR,show_plot)
 EXAMPLE:
   country_risk=cr_country_hazard_test(country_risk,2,1) % 2nd country, 1st haazrd
 INPUTS:
   country_risk: the output of country_risk_calc (NOT of
       country_risk_EDS_combine, as this would result in empty EDSs for
       e.g. TS).
   country_i: the country index (as shown when first run) to only show one
       country (usefule in the country damagefunction calibration process)
       Default=1 (hence the user will usually specify)
   hazard_i: the hazard index (as shown when first run) to only show one
       hazard (usefule in the country damagefunction calibration process)
       Default=1 (hence the user will usually specify)
 OPTIONAL INPUT PARAMETERS:
   CAGR: the compound annual growth rate to inflate historic EM-DAT
       damages with, if empty, the default value is used (climada_global.global_CAGR)
   show_plot: =1 (default) show the plot, 0= just create and save the plot
       =2: show not only the single DFC plot for the country, but also
       call cr_DFC_plot_aggregate
       If show_plot is negative, first delete all existing figures.
 OUTPUTS:
   country_risk: the country_risk structure with the results for country_i
       and hazard_i updated
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150213, initial
 David N. Bresch, david.bresch@gmail.com, 20150906, no change, as the user anyway needs to edit lines....
 Lea Mueller, muellele@gmail.com, 20160212, rename to climada_damagefunctionS_generate instead of without s
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_country_hazard_test.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_damage_as_percentage_of_GDP">
<H2>cr_damage_as_percentage_of_GDP</H2></A>
 create waterfall graphs and calculate damage as percentage of GDP
 for two example countries Dominican Republic and USA
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_damage_as_percentage_of_GDP.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_damagefunction_adjust">
<H2>cr_damagefunction_adjust</H2></A>
<font color="blue">function entity_adjusted = cr_damagefunction_adjust(entity) </font>
 adjust the data points describing the damage function 
 MODULE:
   country_risk
 NAME:
   cr_damagefunction_adjust
 PURPOSE:
   Adjust the data points describing the damage function by multiplying
   them with country-specific factors that are based on expert judgment. 
   The resulting damage function provides the basis for the final climada 
   model results of a country's expected losses over the return period(s) 
   one is interested in.
 CALLING SEQUENCE:
   entity_adjusted = cr_damagefunction_adjust(entity)
 EXAMPLE:
   entity_Australia_adjusted = cr_damagefunction_adjust(entity_Australia)
 INPUTS:
   entity: a climada entity with the fields 
       - assets
       - damagefunctions
       - measures
       - discount
   to generate an entity, see climada_nightlight_entity (in the module 
   country_risk) or climada_create_GDP_entity (in the module GDP_entity)
 OPTIONAL INPUT PARAMETERS:

 OUTPUTS:
   entity_adjusted: entity with adjusted damagefunction; contains the
   fields
       - assets
       - damagefunctions
       - measures
       - discount
       - damagefunctions_adjusted (=1; flag to show that the
       damagefunctions of that entity have been adjusted)
       - damagefunctions_orig (original/unadjusted damage functions for
       reference)
   Also, damagefunctions_adjusted contains a further field 
   'adjustment_factor_table', which contains the information on the 
   adjustment factors for that country and all perils.
   
   The field 'MDR' is removed in entity_adjusted (if it existed in the 
   input entity)

 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150202, initial
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_damagefunction_adjust.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_damagefunction_sensitivity">
<H2>cr_damagefunction_sensitivity</H2></A>
<font color="blue">function entity_out=cr_damagefunction_sensitivity(entity,hazard,selection_i,show_plot,peril_region) </font>
 explore the DFCs' sensitivity to underlying damagefunctions
 MODULE:
   country_risk
 NAME:
   cr_damagefunction_sensitivity
 PURPOSE:
   Given an entity and a hazard, generate different event damage sets
   (EDSs) by varying the underlying damagefunctions. Plot the
   resulting damage frequency curves (DFCs) together with the two DFCs
   (indexed and original) that stem from the historic event set of the
   international disaster database EM-DAT (www.emdat.be).

   The plot then allows to determine by eye which of the damagefunctions
   used to calculate the DFCs produces the best fit to the EM-DAT data.

   If the function is given a specific selection of a damagefunction
   (selection_i), the damagefunctions in the input entity gets overwritten
   with that selected damagefunction. The default value for selection_i is
   1, which refers to the original damagefunction, such that in that case
   the entity's damagefunction is left unchanged.
   However, there is one change that applies to all input entities: If an
   entity contains a field 'MDR' (Mean Damage Ratio), this field is
   removed because it is not needed in any damage calculation in CLIMADA.

   For the generation of entities and hazards in one single function, see
   country_risk_calc (in the module country_risk), which creates hazard
   sets and an entity for a given country before it runs the risk
   calculations. For automatic comparison of a series of countries in one
   hazard region, see selected_countries_region_peril

 CALLING SEQUENCE:
   entity_out=cr_damagefunction_sensitivity(entity,hazard,selection_i,show_plot,peril_region)
 EXAMPLE:
   entity_out=cr_damagefunction_sensitivity(entity,hazard,4)
   overwrites the damagefunctions of the entity with damagefunction 4
 INPUTS:
   entity: a climada entity with the fields
       - assets
       - damagefunctions
       - measures
       - discount
       to generate an entity, see climada_nightlight_entity (in the module
       country_risk) or climada_create_GDP_entity (in the module GDP_entity)
   hazard: a climada hazard event set structure, see e.g.
        climada_tc_hazard_set
 OPTIONAL INPUT PARAMETERS:
   selection_i: selection of the damagefunction to overwrite the entity's
       damagefunction with
       1: original damagefunctions, entity is left unchanged (=default)
       2: shift to the right by 15% of max intensity
       3: shift to the left by 15% of max intensity
       4: [...]
       etc. (this is only a preliminary version of the function, further
       selections will be added later. See section 'implement
       damagefunction modifications here' in this code for the
       currently implemented damagefunctions)
   show_plot: only save the plot (=0), or show and save the plots (=1,default)
   peril_region: the peril region (only used to label the plot, such as
       'atl' or 'glb'), Default=''
   SPECIAL: if there is a file ../results/target_DFC.xls wth columns
       country, perilID, return period and damage, the matching country and
       peril DFC will be plotted for reference (i.e. to help calibrate climada
       to any given (other model) results (see target_DFC_file in PARAMETERS)
 OUTPUTS:
   entity_out: entity with the damagefunction selection_i refers to
       (default for selection_i is 1, i.e. entity_out is the same as the
       original entity).
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150203, initial
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150206, added show_plot
 David N. Bresch, david.bresch@gmail.com, 20150210, peril_region added
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_damagefunction_sensitivity.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_economic_loss_calc">
<H2>cr_economic_loss_calc</H2></A>
<font color="blue">function country_risk_economic_loss = cr_economic_loss_calc(country_risk,economic_data_file) </font>
 MODULE:
   country_risk
 NAME:
   cr_economic_loss_calc
 PURPOSE:
   Calculate the economic loss, i.e. the impact of a natural disaster on a
   country's economy
   method: Starting point for the economic loss calculation is 
   damage(event_i), i.e. the damage calculated by climada_EDS_calc. 
   The economic loss caused by the natural disaster is then calculated
   according to:
   economic_loss(event_i) = damage(event_i)*loss_multiplier
   with
   loss_multiplier = 
   1 + cr_get_damage_weight(damage(event_i)/GDP) * country_damage_factor
       with 
           cr_get_damage_weight: function that determines how much weight a
           damage should be given based on its ratio to GDP
           country_damage_factor = (1/financial_strength +
           BI_and_supply_chain_risk + natural_hazard_economic_exposure 
           - disaster_resilience)
           Hence, country_damage_factor consists of four terms: 
               - financial_strength measures a country's economic health and
               ability to finance the recovery
               - BI_and_supply_chain_risk measures a country's risk of
               disaster-related business and supply chain interruption
               - natural_hazard_economic_exposure assesses which countries 
               have a concentration of their total economic output exposed to 
               natural hazards
               - disaster_resilience measures the quality of a country's 
               natural hazard risk management, i.e., the country's 
               &quotpreparedness&quot to deal with the consequences of a disaster 
   See economic_indicators_mastertable.xls (in climada/data/system for 
   more information on the components of country_damage_factor
 PREVIOUS STEP:
   country_risk = country_risk_calc('country_i')
 CALLING SEQUENCE:
   country_risk_economic_loss = cr_economic_loss_calc(country_risk)
 EXAMPLE:
   country_risk_economic_loss =
   cr_economic_loss_calc(country_risk_Switzerland)
 INPUT:
   country_risk: A struct generated by country_risk_calc
   containing the fields
       peril_ID:       ID(s) of the peril(s) the country is exposed to
       raw_data_file:  the file used to generste the event set
       hazard_set_file:file with the stored hazard
       EDS:            event damage set(s) for the peril(s) 
   country_risk can contain information on a single country or on multiple
   countries
 OPTIONAL INPUT: 
   economic_data_file: the filename of the excel file with the raw data
       (country-specific economic and resilience data used to calculate the
       economic loss)
       If empty, the code uses the default table as provied with core
       climada, should it not exist, it prompts the user to locate the file 
 OUTPUT:
 	country_risk_economic_loss: The same struct as the input, but
 	country_risk.res.hazard.EDS.damage has been replaced by
 	country_risk.res.hazard.EDS.economic_loss (for all countries and 
   perils in country_risk)

 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20141229, initial
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150105, compatibility with multiple country input
 David N. Bresch, david.bresch@gmail.com, 20150203, economic_indicators_mastertable part of core climada
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150210, economic_indicators_mastertable: extended and standard version

 TO DO: Modify the function such that it can also handle hazard event sets
 that have been generated by functions other than country_risk_calc, e.g.,
 by eq_global_hazard_set or climada_tc_hazard_set
 ANSWER: for the time being, running this afer country_risk_calc is OK.
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_economic_loss_calc.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_get_damage_weight">
<H2>cr_get_damage_weight</H2></A>
<font color="blue">function damage_weight = cr_get_damage_weight(damage_per_GDP) </font>
 MODULE:
   country_risk
 NAME:
   cr_get_damage_weight
 PURPOSE:
   Get the weight of a specific damage caused by a natural hazard, i.e.,
   the factor it will be multiplied with in the calculation of the
   economic loss caused by that event (see
   climada_calculate_economic_loss). 
   The underlying assumption is that damages up to a certain threshold
   (defined in terms of damage per GDP) do not affect a country's national
   economy, but the bigger the damage, the more importance/weight is given
   to the country's socioeconomic strength and preparedness for disasters
   (as indicated by the country_damage_factor calculated in 
   climada_calculate_economic_loss).
 CALLING SEQUENCE:
   damage_weight = cr_get_damage_weight(damage_per_GDP)
 EXAMPLE:
   damage_weight = cr_get_damage_weight(0.02)
 INPUT:
   damage_per_GDP: the ratio of the damage caused by a specific event to
   the GDP of the country where the event occurred
 OUTPUT:
   damage_weight: The weighting factor for the input damage per GDP
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch 20150101, initial
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_get_damage_weight.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_hazard_clim_scen">
<H2>cr_hazard_clim_scen</H2></A>
<font color="blue">function ok = cr_hazard_clim_scen(country_name,peril_ID,force_recalc) </font>
 climada
 MODULE:
   country_risk
 NAME:
   cr_hazard_clim_scen
 PURPOSE:
   create climate change hazards for 2050
   load existing hazards and modify based on TC, TS and basin

   to be called in selected_countries_all_in_one
 CALLING SEQUENCE:
   country_risk =country_risk_calc(country_name,method,force_recalc,check_plots,peril_ID)
 EXAMPLE:
   country_risk0=country_risk_calc('CHE',1,0); % 10x10km resolution for
 INPUTS:
   country_name: name of the country, like 'Switzerland', or a list of
       countries, like {'Switzerland','Germany','France'}. See
       climada_check_country_name for the list of valid country names
       If set to 'ALL', the code runs recursively through ALL countries
       (mind the time this will take...)
       &ampgt prompted for via dropdown list if empty (allows for single or
       multiple country selection)
 OPTIONAL INPUT PARAMETERS:
   peril_ID: 'TS' or 'TC', or both. If empty, all perils (TC and TS) will 
       be modified
   force_recalc: if set to 1 recalcs hazards even if they already exist,
       default 0
 OUTPUTS:
   creates climate change hazard files and saves them in the hazard
   directory. Additionally creates a diary file to save output from
   command window in the hazard directoy.
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151020, initial
 Lea Mueller, muellele@gmail.com, 20151022, bugfix mixed up intensity and frequency screw
 Lea Mueller, muellele@gmail.com, 20151023, add basin epa
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_hazard_clim_scen.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_hazard_comparison">
<H2>cr_hazard_comparison</H2></A>
<font color="blue">function res=cr_hazard_comparison(cmp_folder,cmp_file_regexp,scale_value_flag,reference_RP) </font>
 cr_hazard_comparison
 MODULE:
   module name
 NAME:
   cr_hazard_comparison
 PURPOSE:
   Model comparison (cmp) for countries and hazards

   Loops over damage frequency curve (DFC) files (see climada_DFC_read),
   indentifies the matching climada entity and hazard event set and shows
   the DFCs for comparison (and any other further use).

   See e.g. climada_DFC_comparison for further scrutiny
 CALLING SEQUENCE:
   cr_hazard_comparison(cmp_folder)
 EXAMPLE:
   cr_hazard_comparison
   cr_hazard_comparison('','*.xlsx',0); % no scaling
 INPUTS:
   cmp_folder: folder with model comparison files, i.e. DFC files with
       names III_name_rrr_PP_cmp_results with III ISO3, name country name,
       rrr the peril PP region (e.g. CHE_Switzerland_glb_EQ_cmp_results)
       &ampgt prompted for folder if not given
 OPTIONAL INPUT PARAMETERS:
   cmp_file_regexp: the regexp to find the comparison files in cmp_folder
       Default=['*' climada_global.spreadsheet_ext] (hence e.g. '*.xls')
       This way, one can also restrict files such as '*_latest.xlsx'
   scale_value_flag: =1: scale value of climada (and damages) to cmp value
       (default), =0 keep values and do not scale damages.
   reference_RP: the (few) reference return periods we report values in
       res (the output). Default: reference_RP=[100 200]. Values have to
       be return period the cmp results exist for (no interpolation).
 OUTPUTS:
   res: a struct with
       file_name: the comparison filename
       admin0_ISO3: the country ISO3 (if in entity)
       admin0_name: the country name (if in entity)
       DFC.value: the value 'underlying' the climada DFC
       DFC_cmp.value: the value 'underlying' the comparison DFC
       return_period(i): the return periods (as in reference_RP)
       DFC.damage(i): the climada damage for return_period(i)
       DFC_cmp.damage(i): the comparison damage for return_period(i)
   Plus the DFC plots and writes a small report to
       'cr_hazard_comparison.csv'
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150120, initial
 David N. Bresch, david.bresch@gmail.com, 20150122, scale_value_flag
 David N. Bresch, david.bresch@gmail.com, 20150126, ED also reported
 David N. Bresch, david.bresch@gmail.com, 20150126, renamed to cr_hazard_comparison (formerly country_hazard_comparison)
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_hazard_comparison.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="cr_loss_multiplier_plot">
<H2>cr_loss_multiplier_plot</H2></A>
<font color="blue">function country_ec_damage = cr_loss_multiplier_plot(country_names,economic_data_file) </font>
 plot the loss multiplier
 MODULE:
 country_risk
 climada template
 NAME:
   cr_loss_multiplier_plot
 PURPOSE:
   Plot the loss multiplier which is defined by:
   loss_multiplier = 1+cr_get_damage_weight(damage/GDP) * country_damage_factor; 
   see documentation climada_module_country_risk.docx for details on the 
   calculation of the loss multiplier)
 CALLING SEQUENCE:
   country_ec_damage = cr_loss_multiplier_plot(country_names,economic_data_file)
 EXAMPLE:
   country_ec_damage = cr_loss_multiplier_plot({'El Salvador','Austria'})
 INPUT:
   country_names: name of the country, like 'Switzerland', or a list of
       countries, like {'Switzerland','Germany','France'}. See
       climada_check_country_name for the list of valid country names
 OPTIONAL INPUT PARAMETERS:
   economic_data_file: the filename of the excel file with the raw data
   (country-specific economic and resilience data used to calculate the
   economic loss)
   if empty, the code tries a default name, if it does not exist, it
   prompts the user to locate the file
 OUTPUTS
   a plot showing how the loss multiplier depends on damage per GDP
   country_damage_factors: A struct wih the following fields:
       country_ec_damage.Country           country name
       country_ec_damage.ISO3              ISO3 code 
       country_ec_damage.damage_factor     country damage factor
       country_ec_damage.financial_strength financial strength
       country_ec_damage.BI_risk           BI_and_supply_chain_risk
       country_ec_damage.ec_exposure       natural_hazard_economic_exposure
       country_ec_damage.resilience        disaster_resilience
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150109, initial
View <A HREF=file:../../climada_modules/country_risk/code/helper_functions/cr_loss_multiplier_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="diana">
<H2>diana</H2></A>
<font color="blue">function varargout = diana(varargin) </font>
 DIANA MATLAB code for diana.fig
      DIANA, by itself, creates a new DIANA or raises the existing
      singleton*.

      H = DIANA returns the handle to a new DIANA or the handle to
      the existing singleton*.

      DIANA('CALLBACK',hObject,eventData,handles,...) calls the local
      function named CALLBACK in DIANA.M with the given input arguments.

      DIANA('Property','Value',...) creates a new DIANA or raises the
      existing singleton*.  Starting from the left, property value pairs are
      applied to the GUI before diana_OpeningFcn gets called.  An
      unrecognized property name or invalid value makes property application
      stop.  All inputs are passed to diana_OpeningFcn via varargin.

      *See GUI Options on GUIDE's Tools menu.  Choose &quotGUI allows only one
      instance to run (singleton)&quot.

 See also: GUIDE, GUIDATA, GUIHANDLES
View <A HREF=file:../../climada_modules/disaster_risk_finance/code/diana/diana.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="diana_params">
<H2>diana_params</H2></A>
<font color="blue">function varargout = diana_params(varargin) </font>
 DIANA_PARAMS MATLAB code for diana_params.fig
      DIANA_PARAMS, by itself, creates a new DIANA_PARAMS or raises the existing
      singleton*.

      H = DIANA_PARAMS returns the handle to a new DIANA_PARAMS or the handle to
      the existing singleton*.

      DIANA_PARAMS('CALLBACK',hObject,eventData,handles,...) calls the local
      function named CALLBACK in DIANA_PARAMS.M with the given input arguments.

      DIANA_PARAMS('Property','Value',...) creates a new DIANA_PARAMS or raises the
      existing singleton*.  Starting from the left, property value pairs are
      applied to the GUI before diana_params_OpeningFcn gets called.  An
      unrecognized property name or invalid value makes property application
      stop.  All inputs are passed to diana_params_OpeningFcn via varargin.

      *See GUI Options on GUIDE's Tools menu.  Choose &quotGUI allows only one
      instance to run (singleton)&quot.

 See also: GUIDE, GUIDATA, GUIHANDLES
View <A HREF=file:../../climada_modules/disaster_risk_finance/code/diana/diana_params.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="drf_create_EDS">
<H2>drf_create_EDS</H2></A>
<font color="blue">function [entity,hazard]=drf_create_EDS </font>
 climada disaster risk finance drf evaluation tool
 MODULE:
   disaster_risk_finance
 NAME:
   drf_create_EDS
 PURPOSE:
   Create an event damage set (EDS) instead of running climada or
   importing a period loss set (PLS) from MSP. This allows to create
   quick&ampdirty examples for DIANA

   All Parameters set in code, see PARAMETERS section below

   What this code really does:
   Creates a (dummy) entity, creates a (dummy) hazard event set and
   juggles the content of the respective structures (entity and hazard)
   such that the EDS calculated by climada_EDS_calc reproduces the EDS as
   requested.

   some abbreviations used:
   EDS: event damage set
   admin0: country
   admin1: state or province
   ISO3: the admin0 (country) ISO code, such as USA for United States

   Next call: drf_damage_calc, then drf_evaluation, then drf_plot
   See also: diana (the GUI)
 CALLING SEQUENCE:
   [entity,hazard]=drf_create_EDS;
 EXAMPLE:
   drf_create_EDS; diana
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   creates a climada entity and hazard structure, for a description, see
   e.g. climada_entity_read and climada_tc_hazard_set
   and saves them into a .mat file to be selected in DIANA
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160613, initial
View <A HREF=file:../../climada_modules/disaster_risk_finance/code/diana/drf_create_EDS.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="drf_damage_calc">
<H2>drf_damage_calc</H2></A>
<font color="blue">function drf_damage_calc(reinit_flag,verbose) </font>
 climada disaster risk finance drf evaluation tool
 MODULE:
   disaster_risk_finance
 NAME:
   drf_damage_calc
 PURPOSE:
   A DRAFT disaster risk finance (drf) evaluation tool. Runs on country
   (admin0) and state (admin1) level.

   See also diana GUI for a nice graphical user interface

   Prompts the user for (country or state) assets (as prepared by
   country_risk_calc) and hazard set(s). The calculation unfolds as follows: 
   - calculate the event damage set (EDS) for each (sub) peril (EQ, TC..)
   - combine sub-perils (such as TC, TS) into one EDS (eg TC) per main peril
   - apply direct proportional insurance coverage (at no cost)
     -&ampgt this forms the reference base to calculate cost of insurance and
        other financial instruments net of direct primary insurance)
   - apply per-event conditions
   - convert event damage set (EDS) to year damage set (YDS)
   - apply peril annual aggregate conditions
   - combine peril year damage sets into one aggregate year damage set
   hand over to drf_evaluation (treats combined peril annual aggregate
   conditions and does care for all other financial instruments, eg loan)
     -&ampgt this results in the cost of insurance (all risk transfer
     conditions AFTER application of direct proportional insurance
     coverage)
   
   All parameters as well as results are stored in the global variable
   drf_global (see detailed description below), which allows for easy edit
   of anything - and simple I/O with GUI.
   Use 'clear GLOBAL drf_global' to really clear and start from
   scratch, as 'clear drf_global' only clears the current workspace, but
   leaves drf_global accessible to any functions declaring it global.
   But drf_damage_calc(1) does reset all, too.

   On subsequent calls, country and hazard(s) remain, such that the user
   can experiment with disaster risk finance parameters. See reinit_flag=1
   to re-start selecting country and hazard(s). Note that re-calculating
   all the EDS(s) might often not be reuqired, but one wants to
   re-assemble the YDS(s), hence consider to set drf_global.calc_SDS=1

   As a prerequisite, run country_risk_calc (from climada module
   country_risk) to obtain assets and hazard(s), see
   https://github.com/davidnbresch/climada_module_country_risk

   The file disaster_risk_finance_mastertable.xls in the data folder of
   the disaster_risk_finance module contains default values per country.

   some abbreviations used:
   EDS: event damage set(s) - generated by climada_EDS_calc
   YDS: year damage set(s) - compiled from EDS(s)
   SDS: summed-up year set(s) - either build from YDS or imported
   admin0: country
   ISO3: the admin0 (country) ISO code, such as USA for United States
   admin1: state or province

   Previous call: country_risk_calc (module country_risk, see
       https://github.com/davidnbresch/climada_module_country_risk
   Next call: drf_evaluation (called at the end of drf_damage_calc), drf_plot
   See also: diana (the GUI)
 CALLING SEQUENCE:
   drf_damage_calc(reinit_flag,verbose)
 EXAMPLE:
   drf_damage_calc
   drf_damage_calc(1) % force re-init (ask for country and hazard)
   drf_damage_calc;drf_plot % usual command sequency to calculate and show results
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   reinit_flag: if =1, re-init, i.e. ask for all inputs, re-calculate YDS
       etc. Default=0, i.e. all parameters once set remain for subsequent
       calls, such that the user can experiment with disaster risk
       finance parameters by editing fields of variable drf_global
       SPECIAL USE of reinit_flag if called from gui:
           reinit_flag=-1 to obtain entities_liststr
           reinit_flag=-2 to obtain hazards_liststr
           reinit_flag=-3 to run analysis from gui
       NOTE: in order to just set up the drf_global structure,
           call drf_damage_calc(-1)
   verbose: whether we print to stdout =1 (default) or only severe errors (=0)

   SPECIAL: parameters and data provided via global variable drf_global,
   with fields
   EDS(i): contains the (combined) EDS for (major) peril i, without risk
       transfer conditions applied
   YDS(i): contains the from ground up (fgu) annual aggregate YDS for
       (major) peril i. Does only contain the essential fields of a YDS, i.e.
       damage, frequency and peril_ID (as all other info in corresponding
       EDS(i). Sum over perils i of this YDS builds SDS(1).
   YDS_cond(i): as YDS(i), but with risk transfer conditions both per
       event and aggregate per peril applied.
   SDS(j): the compbined year damage set all subsequent calculations are based upon
       j refers to the 'level' of finance being applied, i.e.
       j=1: just the sum of all from ground up (fgu) YDS(i) (i.e. without
           any risk transfer conditions applied)
       j=2: with all risk transfer conditions (per peril and event, per
           peril annual aggregate and combined peril annual aggregate)
           applied.
       SDS(j) does not contain all fields of a YDS, it contains:
           damage: the damage vector
           frequency: the frequency vector, with sum(SDS.frequency)=1
   calc_SDS: flag to force (re)calculation of SDS.
       Note: while we can delete EDS to force starting from scratch, the GUI
       does need the SDS (even if parameters are updated), hence we can nor
       delete drf_global.SDS, but indicate its 'validity' via drf_global.calc_SDS
   finance: all the finance information, such as risk transfer parameters...
       Same field names as column headers in thre Excel. Note that in the
       Excel sheet, all values are in the user-defined currency
       (currency.name_str) and all calculations of the drf tool happen in
       this currency. Read from Excel the first time a combination of
       country and hazards is selected (and each time this selection
       changes). This way, the user can edit as long as country/hazard(s)
       selection remains the same.
       Note: peril-specific records are read and populated first.
       Therefore, (multi-peril) combined annual aggregate conditions and
       loan parameters of the record with peril ID YY (or XX or last
       peril, if there is no YY) is used to set these. If in doubt, check
       drf_global.finance on the command line
       Currently, two loans (drf_global.finance.loan(i), with i=1,2 are
       implemented, code works with n loans
   currency: the currency definition, fields:
       unit_fact: the factor used to multiply values with
           for display ONLY (default =1e-9)
       unit_str: the unit to be shown (default='bn')
       name_str: the currency name (default from climada_global.Value_unit)
       conversion: the conversion factor to get from the currency in the
           entity (climada_global.Value_unit) to the one requested
           (currency.name_str)
       Note that all calculations happen in units of 1 (unit_fact and
       unit_str are only used for display purposes) and that values are
       converted to target currency after calculation of EDS.damage (such
       that all calculations of the drf tool happen in the target currency
   ...and some more technical parameters:
   params: contais (some more technical) parameters, fields:
       yearset_length_years: length of yearset in years, default=1000.
           If =0, no re-sampling happens, i.e. if one uses only the
           historic hazard event set, one gets only the historic years
           See climada_EDS2YDS for details of yearset treatment
       block_length_years: number of years that constitute a block,
           defaut=20
           if block_length_years is negative, the blocks are running ones,
           i.e. block 1 is years 1..abs(block_length_years), block 2
           2..abs(block_length_years)+1 ...
       single_block_number: the number(s) of a single block to show, i.e.
           =[1,3] to show only two blocks, the first and the third one
           default=[] to show all blocks
       annual_recovery_rate: rate past damage (year-1) is
           amortized/rebuilt (=1: all done in one year). Default taken
           from disaster_risk_finance_mastertable
       insurance_cost_multiplier: the multiplier to get from pure
       historic_flag: to indicate a historic event only hazard set,
           default=0 (effect: labels real years in drf_plot)
       expected damage (ED) to cost of insurance. Default=2.0
       entity_name: name of entity file (w/o path and w/o '.mat',
           like 'USA_UnitedStates_entity').
           If empty, user gets prompted for (kind of default)
           Note: In case the user would like to also pass on the
           hazards(s), run drf_damage_calc(-2) to
           obtain drf_global.params.hazards_liststr, figure which hazard(s) you
           need and call again with selected hazard(s) in
           drf_global.params.hazards_selection.
       entity_liststr and entity_selection: usually only used if called
           from gui, see cases where reinit_flag&amplt0
       hazards_liststr and hazards_selection: usually only used if called
           from gui, see cases where reinit_flag&amplt0
       RDS_index: =2 to show insurance partition on top left figure (see
           drf_plot, default)
           =3: show loan partition on top left figure (see drf_plot)
   ...and some very technical parameters:
   fig1: the figure handle for graphics output (see drf_plot)
   error_msg: the last error message (to be used by the GUI for display)
 OUTPUTS:
   updates fields in drf_global, see description above
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20151229
 David N. Bresch, david.bresch@gmail.com, 20151230, prompting for inpust and forward-compatibility towards GUI
 David N. Bresch, david.bresch@gmail.com, 20151231, combinign (sub)hazards improved, (artificial) yearsets for any hazard
 David N. Bresch, david.bresch@gmail.com, 20151231, histograms (fig2) added
 David N. Bresch, david.bresch@gmail.com, 20160101, gui support added
 David N. Bresch, david.bresch@gmail.com, 20160102, single_block_number added
 David N. Bresch, david.bresch@gmail.com, 20160301, major overhaul
 David N. Bresch, david.bresch@gmail.com, 20160302, major overhaul, all data and parameters in drf_global
 David N. Bresch, david.bresch@gmail.com, 20160303, peril YDS kept, SDS, too etc.
 David N. Bresch, david.bresch@gmail.com, 20160303, header fully updated, plotting separated into drf_evaluation_plot
 David N. Bresch, david.bresch@gmail.com, 20160308, TEST data added
 David N. Bresch, david.bresch@gmail.com, 20160310, reduction to one figure pane
 David N. Bresch, david.bresch@gmail.com, 20160420, orig_year_flag added
 David N. Bresch, david.bresch@gmail.com, 20160421, drf_global structure changed to accomodate n loans in principle
 David N. Bresch, david.bresch@gmail.com, 20160422, proper treatment of historic only hazard event sets added
 David N. Bresch, david.bresch@gmail.com, 20160504, drf_global.params.RDS_index added
 David N. Bresch, david.bresch@gmail.com, 20160527, re-set all finance parameters if Excel has been edited
View <A HREF=file:../../climada_modules/disaster_risk_finance/code/diana/drf_damage_calc.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="drf_evaluation">
<H2>drf_evaluation</H2></A>
<font color="blue">function drf_evaluation(verbose) </font>
 climada disaster risk finance drf evaluation tool
 MODULE:
   disaster_risk_finance
 NAME:
   drf_evaluation
 PURPOSE:
   Evaluate options such as risk transfer and loan

   Takes ir from where drf_damage_calc left it, i.e.
   - treats combined peril annual aggregate conditions
     -&ampgt this results in the cost of insurance (all risk transfer
     conditions AFTER application of direct proportional insurance
     coverage) and
   - does care for all other financial instruments, eg loan)
     -&ampgt this results in the cost of loan (incl amortization)

   All parameters are stored in the global variable drf_global (see
   detailed description in drf_damage_calc)

   Abbreviations (explained in detail in drf_damage_calc)
   SDS: summed-up year set(s) - either built from YDS or imported
   RDS: result damage set, chopped into blocks of same length

   Previous call: drf_damage_calc
   Next call: drf_plot
   See also: diana (the GUI)
 CALLING SEQUENCE:
   drf_evaluation(verbose)
 EXAMPLE:
   drf_evaluation
 INPUTS:
   all via global variable drf_global (see detailed description in
   drf_damage_calc), mainly its field:
   SDS(j): the combined year damage set all subsequent calculations are based upon
       j refers to the 'level' of finance being applied, i.e.
       j=1: just the sum of all from ground up (fgu) YDS(i) (i.e. without
           any risk transfer conditions applied)
       j=2: with all risk transfer conditions (per peril and event, per
           peril annual aggregate and combined peril annual aggregate)
           applied.
       SDS(j) does not contain all fields of a YDS, it contains:
           damage: the damage vector
           frequency: the frequency vector, with sum(SDS.frequency)=1
   drf_global.params.single_block_number: if not empty, to select only the
       n-th largest block(s), or, if first element of
       drf_global.params.single_block_number is negative, i.e.
       drf_global.params.single_block_number=[-1,3] the n-largest single
       event (within a block)
 OPTIONAL INPUT PARAMETERS:
   verbose: whether we print regular messages to stdout =1 (default)
       or only severe errors (=0)

   SPECIAL: parameters and data provided via global variable drf_global,
       see drf_evaluation_tool
 OUTPUTS:
   adds fields RDS and recovery_balance to drf_global:
   RDS(j).damage(m,n): the SDS(j).damage 'chopped' into m blocks of length n.
       See description of SDS above and in drf_damage_calc
       j=1: after application of loan
       j=2: after application of insurance
       RDS(j).retention(m,n)=the retention of blocks m in year n
       RDS(j).layer(m,n)=the layer/loan damage of blocks m in year n
           damage covered by insurance for j=2 (insurance)
           damage covered by loan(s) for j=1 (loan)
       RDS(j).layer(m,n)=the excess damage of blocks m in year n
   recovery_balance(j,m,n): as RDS, summed up along years in each block (cumsum-like)
       with j=1: fgu, =2: after insurance, =3: after loan
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160303, separated from drf_damage_calc (formerly drf_evaluation_tool)
 David N. Bresch, david.bresch@gmail.com, 20160304, loan calculation implemented, separated from drf_damage_calc
 David N. Bresch, david.bresch@gmail.com, 20160307, taken advantage of SDS(1) now fgu, option to select max damage added
 David N. Bresch, david.bresch@gmail.com, 20160315, running blocks
 David N. Bresch, david.bresch@gmail.com, 20160412, n-th largest block or event
 David N. Bresch, david.bresch@gmail.com, 20160421, allow for n loans, plus full amortization at end of loan
 David N. Bresch, david.bresch@gmail.com, 20160422, for historic, make sure last block contains last year
 David N. Bresch, david.bresch@gmail.com, 20160504, drf_global.RDS(3).retention/layer/uncovered added
View <A HREF=file:../../climada_modules/disaster_risk_finance/code/diana/drf_evaluation.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="drf_plot">
<H2>drf_plot</H2></A>
<font color="blue">function drf_plot(verbose) </font>
 climada disaster risk finance drf evaluation tool
 MODULE:
   disaster_risk_finance
 NAME:
   drf_plot
 PURPOSE:
   Plots the results of drf_evaluation, see its code for a full
   description

   All parameters are stored in the global variable drf_global (see
   detailed description in drf_damage_calc)

   Previous call: drf_evaluation (drf_damage_calc)
   See also: diana (the GUI)
 CALLING SEQUENCE:
   drf_plot(verbose)
 EXAMPLE:
   drf_evaluation;drf_plot % usual command sequency to calculate and show results
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   verbose: whether we print regular messages to stdout =1 (default)
       or only severe errors (=0)

   SPECIAL: parameters and data provided via global variable drf_global,
       see drf_damage_calc
 OUTPUTS:
   figures
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160303, separated from drf_evaluation_tool
 David N. Bresch, david.bresch@gmail.com, 20160304, loan calculation implemented
 David N. Bresch, david.bresch@gmail.com, 20160306, separation in drf_evaluation and drf_plot
 David N. Bresch, david.bresch@gmail.com, 20160310, reduction to one figure pane
 David N. Bresch, david.bresch@gmail.com, 20160331, reduction to two plots
 David N. Bresch, david.bresch@gmail.com, 20160412, event plot with partition and histogram
 David N. Bresch, david.bresch@gmail.com, 20160415, bar edge color 'none'
 David N. Bresch, david.bresch@gmail.com, 20160421, special treatment if original years
 David N. Bresch, david.bresch@gmail.com, 20160504, toggle insurance/loan to be shown in upper left panel (drf_global.RDS(3))
View <A HREF=file:../../climada_modules/disaster_risk_finance/code/diana/drf_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="MSP_PLS_read">
<H2>MSP_PLS_read</H2></A>
<font color="blue">function PLS=MSP_PLS_read(PLS_file,verbose) </font>
 read MultiSNAP period loss set
 MODULE:
   _LOCAL
 NAME:
   MSP_PLS_read
 PURPOSE:
   read MultiSNAP (MSP) Period Loss Set (PLS) and store it into a MATLAB
   structure. See climada_PLS_read to obtain a Year Damage Set (YDS)

   A PLS .csv file contains:

       id,dataScope,totalPanjerFactor,periodAverageExpectedLoss,repetitionPeriodInYears,aggregationPeriodBeginInYearNormalised,aggregationPeriodEndInYearNormalised,nbrOfYearsSimulation,currencyCode,currencyUnit,mainNatCatHazardTypes
       2003800,201508_1MIO_YEARS,1.0315346447966625,1.5307887560850577E9,1.0,0.0,1.0,2.0E7,USD,1,
       ratingZone,panjerFactor
       651002,1.0315346447966625
       time,eventId,sampleId,event rating zone,period rating zone,loss,periodId
       0.5323603633556622,2400008019,3,651002,651002,24435.731790959577,1
       0.6820032772549107,2400111073,3,651002,651002,748944.8931435767,1
       1.8630114629304617,2394903067,4,651002,651002,4.4794916625730775E7,2
       ...

   therefore, we first read the two double loines of parameters and then
   the full block of data at once (using fscanf, built in and fast)
 CALLING SEQUENCE:
   PLS=MSP_PLS_read(PLS_file,verbose)
 EXAMPLE:
   PLS=MSP_PLS_read
 INPUTS:
   PLS_file: MultiSNAP Period Loss Set (PLS) filename with path.
       if it comes w/o path, {climada_global.data_dir}/results is assumed
       if ='TEST', use sample PLS file, see PARAMETERS section in code
 OPTIONAL INPUT PARAMETERS:
   verbose: =1 print some info to stdout, =0 not (silent, default)
 OUTPUTS:
   PLS: a structure with
       filename: the filename (with path) the data has been read from
      first all header/parameter fileds, as:
       id: MultiSNAP ID
       dataScope: scope description, like '201508_1MIO_YEARS'
       totalPanjerFactor
       periodAverageExpectedLoss
       repetitionPeriodInYears
       aggregationPeriodBeginInYearNormalised
       aggregationPeriodEndInYearNormalised
       nbrOfYearsSimulation: number os years simulated
       currencyCode: like 'USD'
       currencyUnit
       mainNatCatHazardTypes
       ratingZone
       panjerFactor
      and then the data fields, namely:
       time(n)
       eventId(n)
       sampleId(n)
       event_rating_zone(n)
       period_rating_zone(n)
       loss(n)
       periodId(n)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160107, initial
 David N. Bresch, david.bresch@gmail.com, 20160108, check for file exist
View <A HREF=file:../../climada_modules/disaster_risk_finance/code/helper_functions/MSP_PLS_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_PLS_read">
<H2>climada_PLS_read</H2></A>
<font color="blue">function YDS=climada_PLS_read(PLS_file,verbose) </font>
 read MultiSNAP period loss set
 MODULE:
   _LOCAL
 NAME:
   climada_PLS_read
 PURPOSE:
   read MultiSNAP (MSP) Period Loss Set (PLS) and convert to
   climada Year Damage Set (YDS)

   calls MSP_PLS_read to read the file and then converts PLS into YDS.
   In essence, adds two fields to render the more complex MSP period set
   compatible with the straightforward climada YDS (year damage set) and
   adds all YDS fields (many with dummy values).

   See MSP_PLS_read for the low-level file i/o
 CALLING SEQUENCE:
   YDS=climada_PLS_read(PLS_file,verbose)
 EXAMPLE:
   YDS=climada_PLS_read
 INPUTS:
   PLS_file: MultiSNAP Period Loss Set (PLS) filename with path.
       if it comes w/o path, {climada_global.data_dir}/results is assumed
       if ='TEST', use sample PLS file, see PARAMETERS section in code
 OPTIONAL INPUT PARAMETERS:
   verbose: =1 print some info to stdout, =0 not (silent, default)
 OUTPUTS:
   YDS, a climada year damage set, structure with the fields:
       reference_year: set to climada_global.present_reference_year
       event_ID: =[], empty, provided for EDS compatibility
       damage(n): the damage for year n
       ED_at_centroid: [], empty, since not provided by MSP
       Value: [], empty, since not provided by MSP
       frequency: the single year frequency compared to the full YDS
       orig_event_flag: [], empty, since not needed for yearset
       peril_ID: set ='XX', since not provided by MSP
       hazard: [], empty, since not provided by MSP
       Value_unit: set to PLS.currencyCode, like 'USD'
       comment: set to ['from MSP PLS: ' PLS.filename]
       assets: [], empty, since not provided by MSP
       damagefunctions: [], empty, since not provided by MSP
       annotation_name: set to 'MSP PLS'
       ED: expected damage, set to average damage over years
       yyyy(n): the year
       orig_year_flag: all =0 since not provided by MSP
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160107, initial
View <A HREF=file:../../climada_modules/disaster_risk_finance/code/helper_functions/climada_PLS_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="bf_TEST_jumpy">
<H2>bf_TEST_jumpy</H2></A>
 bf_TEST_jumpy: combined bushfire TEST batch file
 MODULE:
   drought_fire
 NAME:
   bf_TEST_jumpy
 PURPOSE:
   TEST combined bushfire module, base don FIRMS data an cellular automat

   Uses TEST data within the module's data folder (and subfolders). For
   operational use, use the standard climada data folder (see
   climada_global.data_dir), i.e. store your FIRMS data in
   ../hazards/external_model_output etc.

   please refer to the main code bf_generator_jumpy and climada_bf_hazard_set
 CALLING SEQUENCE:
   bf_TEST_jumpy
 EXAMPLE:
   bf_TEST_jumpy
 INPUTS:
   none, it's a batch job, see PARAMETERS. --&ampgt To run the whole TEST for
   another country, you should only have to change country_ISO3_code and csv_file.
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 doerger@student.ethz.ch,dinah@student.ethz.ch,tschumie@student.ethz.ch,20170609, initial, based on bf_TEST
 david.bresch@gmail.com, 20170623, climada-compatibility
View <A HREF=file:../../climada_modules/drought_fire/code/bf_TEST_jumpy.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="bf_TEST_small">
<H2>bf_TEST_small</H2></A>
 bf_TEST_small: bushfire TEST batch file 
 MODULE:
   drought_fire
 NAME:
   bf_TEST_small
 PURPOSE:
   TEST bushfire module
   
   Uses TEST data within the module's data folder (and subfolders). For
   operational use, use the standard climada data folder (see
   climada_global.data_dir), i.e. copy centrpids, entities etc. to the
   respective sub-folders there.

   please refer to the main code climada_bf_hazard_set
   see also bf_TEST_jumpy
 CALLING SEQUENCE:
   bf_TEST_small
 EXAMPLE:
   bf_TEST_small
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 MODIFICATION HISTORY:
 beuschl@student.ethz.ch, 20160601, initial, key author
 horatc@student.ethz.ch, 20160601, initial, key author
 david.bresch@gmail.com, 20160601, climada-compatibility
 david.bresch@gmail.com, 20170508, plots in one window, checked
 david.bresch@gmail.com, 20170624, cleanup, as in bf_TEST_jumpy
View <A HREF=file:../../climada_modules/drought_fire/code/bf_TEST_small.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="bf_generator_jumpy">
<H2>bf_generator_jumpy</H2></A>
<font color="blue">function bf=bf_generator_jumpy(number_years,event_i,store_intensity_field,csv_file,bf_file) </font>
 creates probabilistic bushfire events based on data from FIRMS
 MODULE:
   drought_fire
 NAME:
   bf_generator_jumpy
 PURPOSE:
   generate a hazard event set of bushfires for a specified number of
   years and domain. Next step: climada_bf_hazard_set.m

   Roxanne Doerge (doerger@student.ethz.ch), Dina Haenseler
   (dinah@student.ethz.ch), Elisabeth Tschumi (tschumie@student.ethz.ch),
   20170609. 
 TEST:
   version: use bf_TEST_simple to get started on how to evaluate
   the output of this function
 CALLING SEQUENCE:
   bf_generator_jumpy(years_number, event number, store_output_field);
 EXAMPLE:
   bf=bf_generator_jumpy(1, 100, 1);
   bf_generator_jumpy(1,100,1,'TEST'): % fast test
   when asked for firms file to select: choose a firms csv file
   that can be downloaded from the FIRMS website
   (please see PURPOSE of firms_read.m)
 INPUTS:
   number_years: how many years of bushfire you want to simulate
   event_i: number of events (not really...)
   store_intensity_field: if non-zero: matrix of size dx times dy,
       bf(i).intensity_field, is stored for all fires. for each fire, fire then
       can easily be plotted with for instance contourf(bf(1).intensity_field).
       if 0: matrix bf(i).intensity_field is not stored.
       note: for many years, intensity_field must be set to 0, because not
       enough memory capacity
   csv_file: the .csv file whoch contains all the FIRMS fire data
       set='TEST' for tests, sets also bf_file to a test name
       &ampgt prompted for if not provided
 OPTIONAL INPUT PARAMETERS:
   bf_file: the path and name of the generated proto bushfire data 
       if not given, set to {csv_file without externsion}_BF_proto_data
   none
 OUTPUTS:
   a struct bf where bf(i) is one individual fire:
   with bf(i).lon: array with longitudes of intensities
   with bf(i).lat: array with latitudes of intensities
   with bf(i).intensity: array with intensities at locations (bf(i).lon, bf(i).lat)
   with bf(i).years_simulated: number of years simulated
   with bf(i).no_cells: number of burned cells
   with bf(i).intensity_field: matrix of size dx times dy which contains
   intensities - note: only needed for plots. comment otherwise  needs a
   lot of memory (see below)
   with bf(i).A
 MODIFICATION HISTORY:
 doerger@student.ethz.ch,dinah@student.ethz.ch,tschumie@student.ethz.ch, 20170609, initial, based on bf_generator
 david.bresch@gmail.com, 20170623, climada-compatibility
View <A HREF=file:../../climada_modules/drought_fire/code/bf_generator_jumpy.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="bf_generator_large">
<H2>bf_generator_large</H2></A>
<font color="blue">function hazard=bf_generator_large(csv_file,centroids,hazard_set_file,check_plot) </font>
 climada template
 MODULE:
   drought_fire
 NAME:
   bf_generator_large
 PURPOSE:
   Process the MODIS5 FIRMS data in order to generate large fires.
   See also bf_generator_small to generate small fires (using a cellular
   automat)

   Please proceed as follows:
   0. run bf=bf_generator_large('TEST') to test whether all works
      This generates a _TEST_BF_hazard_large hazard set
   1. Download the historic fire data (since Nov 2000-today) as .csv file
      from https://firms.modaps.eosdis.nasa.gov/download (the full global
      dataset since 2000 is too large for a single download) and store the
      .csv file as ....
   2. run bf_generate_large to process the data (calls firms_read) and to
      generate the bushfire hazard event set

   previous call: generate an entity, see e.g. climada_country_entity,
   next call: e.g. climada_EDS_calc

   Citation for both MCD14DL and MCD14ML: This data set was
   provided by the University of Maryland and NASA FIRMS operated by
   NASA/GSFC/ESDIS with funding provided by NASA/HQ

   Developers hint: search for bf_generator in the code to integrate
   cellular automat to (re)fine fires.

 CALLING SEQUENCE:
   hazard=bf_generator_large(csv_file,param2)
 EXAMPLE:
   hazard=bf_generator_large('TEST') % use the TEST dataset
 INPUTS:
   csv_file: the name and path of the .csv file as downloaded from
       https://firms.modaps.eosdis.nasa.gov/download
       &ampgt promted for filename for if not given
       for TESTS, there is a .csv file for Australia in the drought_fire
       module's data folder, just set csv_file='TEST'. In this case, test
       centroids are used, too.
   centroids: a centroids structure (see climada_centroids_read) or an
       entity structure (in which case entity.assets.lon and .lat are used)
       &ampgt promted for if empty
   hazard_set_file: the filename (and path, optional) of the hazard
       event set. If no path provided, default path ../data/hazards is used
       (and name can be without extension .mat)
       &ampgt promted for if empty
 OPTIONAL INPUT PARAMETERS:
   check_plot: whether we plot it (=1) or not (=0, default)
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       intensity(event_i,centroid_i), sparse: the hazard intensity of
           event_i at centroid_i
       frequency(event_i): the frequency of each event
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
       tropical cyclone or 'ET' for extratropical cyclone
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       matrix_density: the density of the sparse array hazard.intensity
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20160703
 david.bresch@gmail.com, 20170508, hint to bf_generator added, frequency added
 david.bresch@gmail.com, 20170515, check_plot added
 david.bresch@gmail.com, 20170624, centroids avoided, entity used
 david.bresch@gmail.com, 20170625, Victoria_firms.csv instead of firms.csv
View <A HREF=file:../../climada_modules/drought_fire/code/bf_generator_large.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="bf_generator_small">
<H2>bf_generator_small</H2></A>
<font color="blue">function bf=bf_generator_small(number_years,store_intensity_field) </font>
 BF event probabilistic
 MODULE:
   drought_fire
 NAME:
   bf_generator_small
 PURPOSE:
   generate a hazard event set of bushfires for a specified number of
   years and domain. It is currently set up for the region of Melbourne
   with corresponding data. Next step: climada_bf_hazard_set.m

   See bf_TEST_small for a TEST suite and bf_generator_small_DEV for a
   DEVELOPMENT version for speedup, but better see bf_generator_jumpy
 CALLING SEQUENCE:
   bf_generator_small(number_years);
 EXAMPLE:
   bf_generator_small(5);
 INPUTS:
   number_years: how many years of bushfire you want to simulate
   store_intensity_field: if non-zero: matrix of size dx times dy,
   bf(i).intensity_field, is stored for all fires. for each fire, fire then
   can easily be plotted with for instance contourf(bf(1).intensity_field).
   if 0: matrix bf(i).intensity_field is not stored.
   note: for many years, intensity_field must be set to 0, because not
   enough memory capacity!
 OPTIONAL INPUT PARAMETERS:
   none
 OUTPUTS:
   a struct bf where bf(i) is one individual fire:
   with bf(i).lon: array with longitudes of intensities
   with bf(i).lat: array with latitudes of intensities
   with bf(i).intensity: array with intensities at locations (bf(i).lon, bf(i).lat)
   with bf(i).no_year: number of years simulated
   with bf(i).intensity_field: matrix of size dx times dy which contains
   intensities - note: only needed for plots. comment otherwise  needs a
   lot of memory (see below)
 MODIFICATION HISTORY:
 beuschl@student.ethz.ch, 20160601, initial, key author
 horatc@student.ethz.ch, 20160601, initial, key author
 david.bresch@gmail.com, 20160601, climada-compatibility
 david.bresch@gmail.com, 20170625, renamed from bf_generator to bf_generator_small
View <A HREF=file:../../climada_modules/drought_fire/code/bf_generator_small.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="bf_generator_small_DEV">
<H2>bf_generator_small_DEV</H2></A>
<font color="blue">function bf=bf_generator_small_DEV(number_years,store_intensity_field) </font>
 BF event probabilistic
 MODULE:
   drought_fire
 NAME:
   bf_generator_small_DEV
 PURPOSE:

   TEST version to improve speed, UNDER CONSTRUCTION, david.bresch@gmail.com
   --&ampgt USE bf_generator_small FOR THE TIME BEING (and bf_TEST to get started)

   generate a hazard event set of bushfires for a specified number of
   years and domain. It is currently set up for the region of Melbourne
   with corresponding data. Next step: climada_bf_hazard_set.m
 CALLING SEQUENCE:
   bf_generator_small_DEV(number_years);
 EXAMPLE:
   bf_generator_small_DEV(5);
   bf_generator_small_DEV(0.01,1): % fast test
 INPUTS:
   number_years: how many years of bushfire you want to simulate
   store_intensity_field: if non-zero: matrix of size dx times dy,
   bf(i).intensity_field, is stored for all fires. for each fire, fire then
   can easily be plotted with for instance contourf(bf(1).intensity_field).
   if 0: matrix bf(i).intensity_field is not stored.
   note: for many years, intensity_field must be set to 0, because not
   enough memory capacity!
 OPTIONAL INPUT PARAMETERS:
   none
 OUTPUTS:
   a struct bf where bf(i) is one individual fire:
   with bf(i).lon: array with longitudes of intensities
   with bf(i).lat: array with latitudes of intensities
   with bf(i).intensity: array with intensities at locations (bf(i).lon, bf(i).lat)
   with bf(i).no_year: number of years simulated
   with bf(i).intensity_field: matrix of size dx times dy which contains
   intensities - note: only needed for plots. comment otherwise  needs a
   lot of memory (see below)
 MODIFICATION HISTORY:
 beuschl@student.ethz.ch, 20160601, initial, key author
 horatc@student.ethz.ch, 20160601, initial, key author
 david.bresch@gmail.com, 20160601, climada-compatibility
 david.bresch@gmail.com, 20170508, UNDER CONSTRUCTION
 david.bresch@gmail.com, 20170625, renamed to bf_generator_small_DEV
View <A HREF=file:../../climada_modules/drought_fire/code/bf_generator_small_DEV.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_bf_hazard_set">
<H2>climada_bf_hazard_set</H2></A>
<font color="blue">function hazard=climada_bf_hazard_set(bf,centroids,fscrew,areascrew,hazard_set_file) </font>
 climada template
 MODULE:
   drought_fire
 NAME:
   climada_bf_hazard_set
 PURPOSE:
   Generate a BF (bushfire) hazard event set. 

   The TEST case for average fires in Victoria, Australia, see code bf_TEST

   Each fire is attributed to 1 centroid (valid for centroids down to 10km
   resolution, revise if using 1km or finer).

   previous: likely climada_bf_generator.m
   next: e.g climada_EDS_calc
 CALLING SEQUENCE:
   hazard = climada_bf_hazard_set(bf,centroids,fscrew,areascrew,hazard_set_file);
 EXAMPLE:
   hazard = climada_bf_hazard_set;
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   bf: file containing lon, lat, intentsity of each wildfire and number
       of years simulated (the 'proto-hazard set')
   centroids:  centroids in my domain (to contribute intensity to)
   fscrew:     to account for climate change: constant factor I multiply
               frequency with -&ampgt if empty set to 1 by default -&ampgt input in
               format 1+%increase -&ampgt eg for 30% increase fscrew = 1.3
   areascrew:  to account for climate change: constant factor I multiply
               affected area with -&ampgt if empty set to 1 by default -&ampgt input
               in format 1+%increase -&ampgt eg for 30% increase areascrwe = 1.3
 OUTPUTS:
 MODIFICATION HISTORY:
 beuschl@student.ethz.ch, 20160601, initial, key author
 horatc@student.ethz.ch, 20160601, initial, key author
 david.bresch@gmail.com, 20160601, climada-compatibility
View <A HREF=file:../../climada_modules/drought_fire/code/climada_bf_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climadacrop_init">
<H2>climadacrop_init</H2></A>
<font color="blue">function [entity,hazard,params]=climadacrop_init(params) </font>
 climada crop setup
 MODULE:
   drought_fire
 NAME:
   climadacrop_init
 PURPOSE:
   setup the climada crop module, generate the hazard set (hazard) the
   asset and damage function database (entity) from netCDF and .csv files

   DESCRIPTION PENDING

   next call: climada_EDS_calc(entity,hazard)
 CALLING SEQUENCE:
   [entity,hazard,params]=climadacrop_init(params)
 EXAMPLE:
   [entity,hazard]=climadacrop_init; % set it all up
   climada_EDS_DFC(climada_EDS_calc(entity,hazard)) % plot risk curve
   for all damage function sampled:
   for i=1:max(entity.damagefunctions.DamageFunID)
     entity.assets.DamageFunID=entity.assets.DamageFunID*0+i;
     EDS(i)=climada_EDS_calc(entity,hazard,'',0,2);
   end
   params=climadacrop_init('params') % get default parameters
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   params: a structure with fields (see also ISO3='params' above):
    hazard_filename: filename of the .nc file with the crop data
       if no path is provided, the default climadacrop path is assumed
       (=[climada_global.data_dir,'climadacrop']).
    hazard_varname: the varialbe name of in the netCFD file,
       default='days above 32 degrees'
    hazard_set_filename: the name the climada hazard set gets stored to
       default=[climada_global.hazards_dir 'climadacrop_' params.peril_ID '.mat']
    exposure_filename: filename of the .nc file with the exposure data
       if no path is provided, the default climadacrop path is assumed
       (=[climada_global.data_dir,'climadacrop']).
    exposure_varname: the varialbe name of in the netCFD file,
       default='days above 32 degrees'
    damfun_filename: the filename of the .csv file containing the damage
       function(s)
    check_plot: whether show a check plot (=1), or not (=0, default)
       if =2, run a test calculation, too, and show resulting damage
       frequency curve (DFC). If=-2, only test calc and DFC, no other plot
    add_country_ISO3: whether show add country ISO3 code to each gridcell
       (default=1)
    distance_to_coast: whether we calculate distant to coast (in km) of
       call centroids (default=1), which speeds up later climada calculations
       substantially (as coastal hazards need not to be evaluated at
       inner-continental points). Set =0 in special cases, as initial
       calculation might easily take some time, but since
       climada_distance2coast_km listens to climada_global.parfor, set
       climada_global.parfor=1 for speedup).
    peril_ID: the 2-digit peril ID, default='AT'
    hazard_units: the units of the hazard intensity (used in hazard.units
       and entity.damagefunctions.Intensity_unit
 OUTPUTS:
   entity: a climada entity structure, see climada_entity_read for a full
       description of all fields
    PLUS the fields
       entity.assets.ISO3_pos: the country number (ISO3_list(:,2))
       entity.assets.ISO3_list: the list linking isimip country numbers
           in ISO3_list(:,2) with ISO names in ISO3_list(:,1)
       Note that entity.assets.centroid_index is already pointing to the
           correct centroids in the corresponding hazard set as generated
           in this code, too.
   hazard: a climada hazard set, see documentation
    PLUS the field params, a copy of params for this code
   params: the params structure, as on input, just completed.
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170210, initial
View <A HREF=file:../../climada_modules/drought_fire/code/climadacrop_init.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="firms_read">
<H2>firms_read</H2></A>
<font color="blue">function firms=firms_read(csv_file,check_plot) </font>
 climada template
 MODULE:
   module name
 NAME:
   firms_read
 PURPOSE:
   Read the MODIS5 firms csv data

   Please proceed as follows:
   1. Download the historic fire data (since Nov 2000-today) as .csv file
      from https://firms.modaps.eosdis.nasa.gov/download (the full global
      dataset since 2000 is too large for a single download) and store the
      .csv file as ....
      download the file as .csv and select MODIS C6
   2. run firms_read to read the data

   next call: bf_generator_large

   Citation for both MCD14DL and MCD14ML: This data set was
   provided by the University of Maryland and NASA FIRMS operated by
   NASA/GSFC/ESDIS with funding provided by NASA/HQ
 CALLING SEQUENCE:
   firms=firms_read(csv_file,check_plot)
 EXAMPLE:
   firms=firms_read('TEST') % use the TEST dataset
 INPUTS:
   csv_file: the name and path of the .csv file as downloaded from
       https://firms.modaps.eosdis.nasa.gov/download
       &ampgt promted for filename for if not given
       for TESTS, there is a .csv file for Australia in the drought_fire
       module's data folder, just set csv_file='TEST'
 OPTIONAL INPUT PARAMETERS:
   param2: as an example
 OUTPUTS:
   firms: the data, a structure with fields
       filename: the original .csv filename with path
           reads files such as firms.csv, fire_nrt_M6_*.cvs, fire_archive_M6_*.cvs
       lat(i): latitudes of burning point i
       lon(i): longitudes of burning point i
       brightness(i): brightness of burning point i
       datenum(i): the matlab datenum for each point i, also
           datenum_unique: the unique datenums
           unique_IA: the positions of the first unique elements
           unique_IC: the output of [~,IA,IC]=unique
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20160703, initial
 david.bresch@gmail.com, 20170515, formts archive_M6 and nrt_M6 added
 david.bresch@gmail.com, 20160625, Victoria_firms.csv instead of firms.csv
View <A HREF=file:../../climada_modules/drought_fire/code/firms_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="MMI_attenuation_calc">
<H2>MMI_attenuation_calc</H2></A>
<font color="blue">function MMI = MMI_attenuation_calc(mag, dist, dep, correction, a1, a2, a3, a4, b) </font>
 Calculate the attenuation of an earthquake's intensity with distance from
 the epicenter
 MODULE:
 eq_global
 NAME:
   MMI_attenuation_calc
 PURPOSE:
   calculate MMI at a given distance from the epicenter 
 CALLING SEQUENCE:
   MMI=MMI_attenuation_calc(mag, dist, correction,a1, a2, a3, a4)
 EXAMPLE:
   MMI=MMI_attenuation_calc(7.44,10.0,1.67,1.67,1.3,0.0026);
   MMI=MMI_attenuation_calc(8,15.5)   % using default values for
   depth, correction and the attenuation parameters a1, a2, a3, a4, 
 INPUTS:
   mag:    magnitude
   dist:   distance to epicentre [in km] 
 OPTIONAL INPUTS:
   dep: epicenter depth
   correction, a1,a2,a3,a4,b: parameters defining an attenuation function
   of the type MMI = a1 + a2*mag - a3*log(dist+correction) - a4*dist + b*dep
   where MMI is the Modified Mercalli Intensity at distance dist from the 
   epicenter and dep is the epicenter depth; log denotes the natural
   logarithm
   Have a look at eq_global-master/data/system/attenuation_parameters.xlsx 
   for a compilation of parameters for selected geographic regions
 OUTPUT:
   MMI:    the MMI at distance dist from the epicenter (Modified Mercalli
   Intensity)
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20141116
 Melanie Bieli, melanie.bieli@bluewin.ch, 20141209, added correction parameter
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150118, minor clean-up, renaming
View <A HREF=file:../../climada_modules/earthquake_volcano/code/MMI_attenuation_calc.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_get_single_event">
<H2>climada_get_single_event</H2></A>
<font color="blue">function single_eq_event = climada_get_single_event(eq_data, event_i) </font>
 get single earthquake event
 MODULE:
 eq_global
 NAME:
   climada_get_single_event
 PURPOSE:
   Extract a single event from a set of hazards
 PREVIOUS STEP:
   Generation of a hazard set, either by reading a set of historic hazard
   events (see eq_isc_gem_read) or by creating a probabilistic hazard
   event set based on a historic event set (see eq_global_probabilistic)
 INPUTS:
   eq_data, a structure with the following fields:
       yyyy(line_i): year
       mm(line_i)  : month
       dd(line_i)  : day
       hr(line_i)  : origin hour
       min(line_i) : origin min
       sec(line_i) : origin sec
       glat(line_i): geographic latitude
       glon(line_i): geographic longitude
       dep(line_i) : focal depth
       mag(line_i) : magnitude
       country(line_i): country
   event_i: number of the event to be extracted from eq_data. If not
   given, event_i is set to 1
 OUTPUT:
   single_event: a structure with the same fields as eq_data, but 
   containing only the data for the (event_i)th hazard in eq_data
 CAUTIONARY NOTE: 
   This code has only been written for testing purposes
   (namely as a helper function for validate_eq_damage) and might need 
   some improvements for general use
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20141213, initial
View <A HREF=file:../../climada_modules/earthquake_volcano/code/climada_get_single_event.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="eq_centennial_read">
<H2>eq_centennial_read</H2></A>
<font color="blue">function eq_data=eq_centennial_read(centennial_file,check_plot) </font>
 Read Centennial Earthquake Database
 MODULE:
 eq_global
 NAME:
   eq_centennial_read
 PURPOSE:
   Read earthquake (EQ) database, a raw text file downloaded from
   earthquake.usgs.gov/data/centennial/ usually the file
   http://earthquake.usgs.gov/data/centennial/centennial_Y2K.CAT
   
   see the associated readme at
   http://earthquake.usgs.gov/data/centennial/centennial_README.rtf

   next step: see eq_global_probabilistic
 CALLING SEQUENCE:
   eq_data=eq_centennial_read(centennial_file,check_plot)
 EXAMPLE:
   eq_data=eq_centennial_read('',1) % read std file, show epicenters plot
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   centennial_file: the filename of the ASCII text file with the raw data
       if empty, the code tries a default name, if it does not exist, it
       promptes the user to locate the file
   check_plot: show a check plot (=1), or not (=0, default)
 OUTPUTS:
   eq_data, a structure with
       yyyy(line_i): year
       mm(line_i)  : month
       dd(line_i)  : day
       hr(line_i)  : origin hour
       min(line_i) : origin min
       sec(line_i) : origin sec
       glat(line_i): geographic latitude
       glon(line_i): geographic longitude
       dep(line_i) : focal depth
       mag(line_i) : magnitude
   also stored as .mat file. Please delete the .mat file manually in order
   to re-read from the original .txt file 
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141010, initial
 David N. Bresch, david.bresch@gmail.com, 20141014, some minor improvements
View <A HREF=file:../../climada_modules/earthquake_volcano/code/eq_centennial_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="eq_global_attenuation">
<H2>eq_global_attenuation</H2></A>
<font color="blue">function intensity_at_centroids = eq_global_attenuation(glat,glon,mag,centroids,check_plot,dep,correction,a1,a2,a3,a4,b) </font>
 Calculate the attenuation of an earthquake's intensity with
 increasing distance from the epicenter
 MODULE:
 eq_global
 NAME:
   eq_global_attenuation
 PURPOSE:
   given an earthquake (EQ) epicenter, defined by glat,glon,dep,mag,
   calculate the resulting intensity at a set of centroids, using an attenuation
   function. Distance is on sphere iro correction for latitude, but no
   great circle distance (for speedup reasons, other errors are bigger).

   In order to speed up the calculation, no consistency checks are done,
   code assumes proper glat,glon,dep,mag and reasonable centroids input

   For basic theory, see e.g. https://en.wikipedia.org/wiki/Peak_ground_acceleration

   To test attenuation functions, see eq_global_attenuation_TEST
   then edit between *********** lines beow

   mainly called from: eq_global_hazard_set
 CALLING SEQUENCE:
   intensity_at_centroids = eq_global_attenuation(glat,glon,dep,mag,centroids,check_plot,a1,a2,a3,a4)
 EXAMPLE:
   for an earthquake in Vancouver, Canada:
   glat=49.25;glon=-123.10;
   intensity_at_centroids = eq_global_attenuation(glat,glon,5,6,centroids,0,1,2.4,1.5,1.13,0.0063)
   The parameters a1=2.4, a2=1.5, a3=1.13, a4=0.0063 describe the
   attenuation function for Western Canada; see
   eq_global-master/data/system/attenuation_parameters.xlsx
 INPUTS:
   glat: latitude of epicenter [in degrees]
   glon: longitude of epicenter [in degrees]
   dep: depth [km] of epicenter
   mag: magnitude (Richter) of epicenter
   centroids: a structure with the centroids information
       centroids.lat: the latitude of the centroids
       centroids.lon: the longitude of the centroids
 OPTIONAL INPUT PARAMETERS:
   correction,a1,a2,a3,a4,b: parameters defining the attenuation function. 
   See eq_global-master/data/system/attenuation_parameters.xlsx to use
   parameters for specific regions; otherwise default values representing
   a &quotglobal average attenuation function&quot will be used
   check_plot: =1, if a check plot shall be drawn (default=0)
 OUTPUTS:
   intensity_at_centroids: the MMI at centroids
 RESTRICTIONS:
   code does not quality or even consistency checks, optimized for speed.
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141013
 Melanie Bieli, melanie.bieli@bluewin.ch, 20141106
View <A HREF=file:../../climada_modules/earthquake_volcano/code/eq_global_attenuation.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="eq_global_attenuation_TEST">
<H2>eq_global_attenuation_TEST</H2></A>
<font color="blue">function eq_global_attenuation_TEST </font>
 eq attenuation test
 NAME:
   eq_global_attenuation_TEST
 PURPOSE:
   Test different attenuation functions

   all set in code to allow for maximum flexibility

 CALLING SEQUENCE:
   eq_global_attenuation_TEST
 EXAMPLE:
   eq_global_attenuation_TEST
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   plots attenuation function
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141016
View <A HREF=file:../../climada_modules/earthquake_volcano/code/eq_global_attenuation_TEST.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="eq_global_hazard_set">
<H2>eq_global_hazard_set</H2></A>
<font color="blue">function hazard=eq_global_hazard_set(eq_data,hazard_set_file,centroids,TEST_epicenter_preselection,correction,a1,a2,a3,a4,b) </font>
 Create earthquake hazard set
 MODULE
 eq_global
 NAME:
   eq_global_hazard_set
 PURPOSE:
   generate an earthqake (EQ) hazard event set, starting from epicenters
   calculating attenuation (distance and depth) to convert Richter
   magnitude to a modified Mercalli intensity (MMI)

   previous step: see eq_global_probabilistic or eq_isc_gem_read (or
   eq_centennial_read, or eq_signieq_read)
 CALLING SEQUENCE:

   hazard=eq_global_hazard_set(eq_data,hazard_set_file,centroids)
 EXAMPLE:
   eq_data=eq_global_probabilistic(eq_isc_gem_read); % global
   centroids=climada_centroids_load('USFL_MiamiDadeBrowardPalmBeach');
   hazard=eq_global_hazard_set(eq_data,'_EQ_TEST',centroids);
   %hazard=eq_global_hazard_set(eq_global_probabilistic(eq_isc_gem_read))
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   eq_data: a structure with EQ epicenters, see eq_isc_gem_read
       &ampgt promted for if not given
   hazard_set_file: the name and path of the hazard set file
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           Longitude(1,:): the longitudes
           Latitude(1,:): the latitudes
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a .mat-file which contains a centroids struct (saved by
       climada_centroids_read) or the filename of an Excel file (the original
       input to climada_centroids_read) which holds the centroids, in
       which case climada_centroids_read is called.
       &ampgt promted for .mat or .xls filename if not given
       NOTE: if you then select Cancel, a regular default grid is used
       (TEST mode), see hard-wired definition in code (a rectangular area in California)
   TEST_epicenter_preselection: whether we show the epicenters selected
       for processing (=1) or not (=0, default)
       if =2, STOP after plot of preselection (to check preselection only)
   correction,a1,a2,a3,a4,b: parameters defining the attenuation function. See
       eq_global-master/data/system/attenuation_parameters.xlsx to use
       parameters for specific regions; otherwise the function
       eq_global_attenuation will use default values that represent a &quotglobal
       average attenuation function&quot
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'EQ' for
       earthquake
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event
       matrix_density: the density of the sparse array hazard.intensity
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)

   simple check for hazard content: hist(full(hazard.intensity(find(hazard.intensity))))
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141012
 Melanie Bieli, melanie.bieli@bluewin.ch, 20141223, added correction,a1,a2,a3,a4
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150120, hazard_arr_density=0.01
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 David N. Bresch, david.bresch@gmail.com, 20160529, parfor speedup, factor 3-5
 David N. Bresch, david.bresch@gmail.com, 20160611, climada_global.save_file_version
View <A HREF=file:../../climada_modules/earthquake_volcano/code/eq_global_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="eq_global_hazard_set_slow">
<H2>eq_global_hazard_set_slow</H2></A>
<font color="blue">function hazard=eq_global_hazard_set_slow(eq_data,hazard_set_file,centroids,TEST_epicenter_preselection,correction,a1,a2,a3,a4,b) </font>
 Create earthquake hazard set
 MODULE
 eq_global
 NAME:
   eq_global_hazard_set
 PURPOSE:
   SLOW version of eq_global_hazard_set

   generate an earthqake (EQ) hazard event set, starting from epicenters
   calculating attenuation (distance and depth) to convert Richter
   magnitude to a modified Mercalli intensity (MMI)

   previous step: see eq_global_probabilistic or eq_isc_gem_read (or
   eq_centennial_read, or eq_signieq_read)
 CALLING SEQUENCE:
   hazard=eq_global_hazard_set_slow(eq_data,hazard_set_file,centroids)
 EXAMPLE:
   hazard=eq_global_hazard_set_slow(eq_global_probabilistic(eq_isc_gem_read))
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   eq_data: a structure with EQ epicenters, see eq_isc_gem_read
       &ampgt promted for if not given
   hazard_set_file: the name and path of the hazard set file
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           Longitude(1,:): the longitudes
           Latitude(1,:): the latitudes
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a .mat-file which contains a centroids struct (saved by
       climada_centroids_read) or the filename of an Excel file (the original
       input to climada_centroids_read) which holds the centroids, in
       which case climada_centroids_read is called.
       &ampgt promted for .mat or .xls filename if not given
       NOTE: if you then select Cancel, a regular default grid is used
       (TEST mode), see hard-wired definition in code (a rectangular area in California)
   TEST_epicenter_preselection: whether we show the epicenters selected
       for processing (=1) or not (=0, default)
       if =2, STOP after plot of preselection (to check preselection only)
   correction,a1,a2,a3,a4,b: parameters defining the attenuation function. See
       eq_global-master/data/system/attenuation_parameters.xlsx to use
       parameters for specific regions; otherwise the function
       eq_global_attenuation will use default values that represent a &quotglobal
       average attenuation function&quot
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'EQ' for
       earthquake
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event
       matrix_density: the density of the sparse array hazard.intensity
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)

   simple check for hazard content: hist(full(hazard.intensity(find(hazard.intensity))))
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141012
 Melanie Bieli, melanie.bieli@bluewin.ch, 20141223, added correction,a1,a2,a3,a4
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150120, hazard_arr_density=0.01
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 David N. Bresch, david.bresch@gmail.com, 20160529, renamed to eq_global_hazard_set_slow
View <A HREF=file:../../climada_modules/earthquake_volcano/code/eq_global_hazard_set_slow.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="eq_global_probabilistic">
<H2>eq_global_probabilistic</H2></A>
<font color="blue">function eq_data=eq_global_probabilistic(eq_data_in,ens_size,check_plot) </font>
 generate probabilistic hazard set
 MODULE:
 eq_global
 NAME:
   eq_global_probabilistic
 PURPOSE:
   Given an earthquake(EQ) database, create a probabilistic version by
   wiggling location, depth and magnitudes of epicenters

   previous step: see eq_isc_gem_read, eq_centennial_read, or eq_signigeq_read
   next step: see eq_global_hazard_set
 CALLING SEQUENCE:
   eq_data=eq_global_probabilistic(eq_data_in,check_plot)
 EXAMPLE:
   eq_data=eq_global_probabilistic(eq_centennial_read,9,1)
 INPUTS:
   eq_data_in: an EQ database, see eq_centennial_read
 OPTIONAL INPUT PARAMETERS:
   ens_size: ensemble size, the number of 'copies' of the original
       database we create, default=9 (means 10x as original data)
   check_plot: show a check plot (=1), or not (=0, default)
 OUTPUTS:
   eq_data, a structure with
       yyyy(line_i): year
       mm(line_i)  : month
       dd(line_i)  : day
       hr(line_i)  : origin hour
       min(line_i) : origin min
       sec(line_i) : origin sec
       glat(line_i): geographic latitude
       glon(line_i): geographic longitude
       dep(line_i) : focal depth
       mag(line_i) : magnitude
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141010, initial
 David N. Bresch, david.bresch@gmail.com, 20160423, rand('seed',0) --&ampgt rng(0)
View <A HREF=file:../../climada_modules/earthquake_volcano/code/eq_global_probabilistic.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="eq_isc_gem_read">
<H2>eq_isc_gem_read</H2></A>
<font color="blue">function [eq_data,isc_gem_file_mat]=eq_isc_gem_read(isc_gem_file,check_plot) </font>
 read ISC-GEM earthquake catalogue
 EQ eq data read
 NAME:
   isc_gem_read
 PURPOSE:
   Read earthquake (EQ) database, a .csv file downloaded from
   www.isc.ac.uk/iscgem/download.php
   for further information on the earthquake catalogue, see
   www.isc.ac.uk/iscgem/index.php

   Note: it can sometimes happen that the original epicenters file
   isc-gem-cat.csv gets currupted. Just donwload it from
   www.isc.ac.uk/iscgem/download.php (or directly
   http://colossus.iris.washington.edu/iscgem/download/isc-gem-cat.zip)
   again. 

   next step: see eq_global_probabilistic
 CALLING SEQUENCE:
   [eq_data,isc_gem_file_mat]=eq_isc_gem_read(isc_gem_file,check_plot)
 EXAMPLE:
   eq_data=eq_isc_gem_read('',1) % read std file, show epicenters plot
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   isc_gem_file: the filename of the .csv file with the raw data
       if empty, the code tries a default name, if it does not exist, it
       prompts the user to locate the file
   check_plot: show a check plot (=1), or not (=0, default)
 OUTPUTS:
   eq_data, a structure with
       yyyy(line_i): year
       mm(line_i)  : month
       dd(line_i)  : day
       hr(line_i)  : origin hour
       min(line_i) : origin min
       sec(line_i) : origin sec
       glat(line_i): geographic latitude
       glon(line_i): geographic longitude
       dep(line_i) : focal depth
       mag(line_i) : magnitude (moment magnitude, mw)
       &ampgt also stored as .mat file. Please delete the .mat file manually in order
       to re-read from the original .csv file 
   isc_gem_file_mat: the name of the .mat file eq_data is stored to
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20141117
 David N. Bresch, david.bresch@gmail.com, 20141210, date conversion revised
 David N. Bresch, david.bresch@gmail.com, 20141223, issue with .csv file noted
View <A HREF=file:../../climada_modules/earthquake_volcano/code/eq_isc_gem_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="eq_signigeq_read">
<H2>eq_signigeq_read</H2></A>
<font color="blue">function eq_data=eq_signigeq_read(signigeq_file,check_plot) </font>
 Read Significant Earthquake Database
 MODULE:
 eq_global
 NAME:
   eq_signigeq_read
 PURPOSE:
   Read earthquake (EQ) database, an .xlsx file downloaded from
   www.ngdc.noaa.gov/nndc/struts/form?t=101650&amps=1&ampd=1

   for MATLAB to be able to read the .xlsx file, open it once in Excel,
   convert columns SECOND, LATITUDE and LONGITUDE to Number format and
   save as signigeq_CLEAN.xlsx (otherwise you will likely get errors of
   the kind &quotError using xlsread, Invalid zip file ... &quot

   next step: see eq_global_probabilistic
 CALLING SEQUENCE:
   eq_data=eq_signigeq_read(signigeq_file,check_plot)
 EXAMPLE:
   eq_data=eq_signigeq_read('',1) % read std file, show epicenters plot
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   signigeq_file: the filename of the .xlsx file with the raw data
       if empty, the code tries a default name, if it does not exist, it
       promptes the user to locate the file
   check_plot: show a check plot (=1), or not (=0, default)
 OUTPUTS:
   eq_data, a structure with
       yyyy(line_i): year
       mm(line_i)  : month
       dd(line_i)  : day
       hr(line_i)  : origin hour
       min(line_i) : origin min
       sec(line_i) : origin sec
       glat(line_i): geographic latitude
       glon(line_i): geographic longitude
       dep(line_i) : focal depth
       mag(line_i) : magnitude
   also stored as .mat file. Please delete the .mat file manually in order
   to re-read from the original .xlsx file 
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141015, initial
View <A HREF=file:../../climada_modules/earthquake_volcano/code/eq_signigeq_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="plot_attenuation_parameters">
<H2>plot_attenuation_parameters</H2></A>
<font color="blue">function plot_attenuation_parameters(mag,attenuation_file,dep) </font>
 Plot attenuation curves
 MODULE:
 eq_global
 NAME:
   plot_attenuation_parameters
 PURPOSE:
   plot the attenuation functions defined by the sets of parameters in
   earthquake_volcano/data/system/attenuation_parameters.xlsx, for a
   given magnitude
 CALLING SEQUENCE:
   plot_attenuation_parameters(magnitude, filename)
 EXAMPLE:
   plot_attenuation_parameters(8)
   plot_attenuation_parameters
 OPTIONAL INPUTS:
   mag: Richter magnitude at epicenter. If empty, 8 is used as
   default value
   attenuation_file: Name of the file that contains the attenuation 
   parameters. 
   If empty, the code tries a default name, if it does not exist, it
   prompts the user to locate the file
   dep: epicenter depth (only makes a difference for attenuation functions
   with a depth-dependent term
 OUTPUT:
   A plot showing the attenuation of intensity with distance for each set
   of parameters and for the magnitude specified in the input
 COMMENT:
   The parameters a1, a2, a3, and a4 describe an attenuantion of the type
   MMI(dist) = a1 + a2*mag - a3*log(dist+correction) - a4*dist + b*dep 
       where
       mag is the Richter magnitude at the epicenter
       dist is the distance from the epicenter (in km)
       dep is the epicenter depth
       MMI is the Mercalli Modified Intensity at distance dist from the
       epicenter

 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20141209, initial
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150123, inlcuded dep and correction
View <A HREF=file:../../climada_modules/earthquake_volcano/code/plot_attenuation_parameters.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="plot_gutenberg_richter">
<H2>plot_gutenberg_richter</H2></A>
<font color="blue">function plot_gutenberg_richter(eq_data)  </font>
 plot a Gutenberg Richter curve
 MODULE
 eq_global
 NAME:
   plot_gutenberg_richter
 PURPOSE:
   produces a plot showing the relationship between the
   magnitude and total number of earthquakes of at least that 
   magnitude 
   see http://en.wikipedia.org/wiki/Gutenberg%E2%80%93Richter_law 
   for some background
 CALLING SEQUENCE:
   plot_gutenberg_richter(eq_data)
 EXAMPLE:
   eq_data = eq_isc_gem_read   % read historic earthquakes 
   eq_data_prob = eq_global_probabilistic(eq_data) % create probabilistic event set
   plot_gutenberg_richter(eq_data_prob)
 COMMENT:
   eq_data can be a historic data set directly generated by eq_isc_gem_read 
   or a set of probabilistic events generated based on the historic data 
   using eq_global_probabilistic
 INPUT:
   eq_data, a structure with
       yyyy(line_i): year
       mm(line_i)  : month
       dd(line_i)  : day
       hr(line_i)  : origin hour
       min(line_i) : origin min
       sec(line_i) : origin sec
       glat(line_i): geographic latitude
       glon(line_i): geographic longitude
       dep(line_i) : focal depth
       mag(line_i) : magnitude

 OUTPUT:
   A plot showing the relationship between earthquake magnitude (mag) and 
   its relative occurrence (N/N_tot, where N is the number
   of events having a magnitude &ampgt=mag and N_tot is the total number of
   earthquakes in eq_data). The plot also shows a power law fit to the 
   input data, of form N/N_tot = 10^(a-b*mag). The parameter b, which is 
   commonly close to 1.0 in seismically active regions, can be used as a
   first check whether the input data fits empirical relations between
   earthquake magnitude and occurrence frequency

 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20141119, initial
View <A HREF=file:../../climada_modules/earthquake_volcano/code/plot_gutenberg_richter.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="validate_eq_damage">
<H2>validate_eq_damage</H2></A>
<font color="blue">function eq_data_calculated_damage = validate_eq_damage(eq_data, check_plot) </font>
 Calculate damages of single earthquakes (and compare to historic data)
 MODULE:
 eq_global
 NAME:
   validate_eq_damage
 PURPOSE:
   Calculate the damages (in USD) of individual events, e.g., to compare
   them to historic damage data for validation purposes 
 CALLING SEQUENCE:
   eq_data_calculated_damage = validate_eq_damage(eq_data)
 EXAMPLE:
   eq_data_calculated_damage = validate_eq_damage
 OPTIONAL INPUTS:
   eq_data, a structure generated by reading a catalog of historic
   earthquakes (see eq_isc_gem_read) or by 'boosting' historic earthquakes
   to a probabilistic event set (see eq_global_probabilistic). 
   eq_data contains the following fields:
       yyyy(line_i)    : year
       mm(line_i)      : month
       dd(line_i)      : day
       hr(line_i)      : origin hour
       min(line_i)     : origin min
       sec(line_i)     : origin sec
       glat(line_i)    : geographic latitude
       glon(line_i)    : geographic longitude
       dep(line_i)     : focal depth
       mag(line_i)     : magnitude
       country(line_i) : country

   Alternatively, eq_data can also be a filename of a saved eq_data
   structure, or the filename of an excel file to read the earthquake data
   from (e.g., the file signieq_table_for_validation.xls in 
   eq_global/data/epicenters). 
   In the latter case, the excel sheet needs to have the following
   fields:
       YEAR        : year when the earthquake happened
       MONTH       : month
       DAY         : day
       HOUR        : hour
       MINUTE      : minute
       SECOND      : second
       FOCAL_DEPTH : hypocenter depth (km)   
       MAGNITUDE   : Richter magnitude of the earthquake
       COUNTRY     : country 
       LATITUDE    : geographic latitude
       LONGITUDE   : geographic longitude
       DAMAGE_DOLLARS (optional): damage data in USD (historic estimates)

   If eq_data is not given, a dialog box opens to prompt for it.

   check_plot: show a plot of the calculated damages (=1), or not
   (=0, default). If eq_data contains estimated damage values, these data are 
   plotted as well to allow for comparison and the mean ratio of
   calculated to estimated damage is displayed.
 
 OUTPUTS:
   eq_data_calculated_damage: eq_data with an additional field  
   'calculated damage' containing the calculated damages (in USD)
   of the earthquakes

 COMMENT:
 Generating the entities and centroids via climada_create_GDP_entity can
 be pretty time consuming for large countries. If the country-specific 
 entities and centroids are already available as .mat files, the code will
 skip that step and load them directly from those .mat files instead. In
 order for this to work, the entity files need to be placed
 in the /data/entities directory of the climada-master module, and named 
 in the following way:
 ISO3_countryname_centroids.mat (e.g. ITA_Italy_centroids.mat),
 and the centroids need to be placed in the /data/system directory of the
 climada-master module, and named in the following way:
 ISO3_countryname_entity.mat (e.g. ITA_Italy_entity.mat)
 
 CAUTIONARY NOTE:
 This code was only produced for testing purposes and has not been
 optimized for general applications - it might therefore need some
 adjustment to work properly in different environments.

 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20141212, initial
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150123, minor changes
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
View <A HREF=file:../../climada_modules/earthquake_volcano/code/validate_eq_damage.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="vq_global_hazard_set">
<H2>vq_global_hazard_set</H2></A>
<font color="blue">function hazard=vq_global_hazard_set(vq_data,hazard_set_file,centroids,TEST_volcano_preselection) </font>
 Create volcanoe hazard set
 MODULE
 eq_global
 NAME:
   vq_global_hazard_set
 PURPOSE:
   generate a volcano (VQ) hazard event set, starting from volcano data
   calculating ash thickness (distance and depth).

   previous step: see vq_volcano_list_read and vq_global_probabilistic
 CALLING SEQUENCE:
   hazard=vq_global_hazard_set(vq_data,hazard_set_file,centroids)
 EXAMPLE:
   hazard=vq_global_hazard_set(vq_volcano_list_read)
   hazard=vq_global_hazard_set(vq_volcano_list_read,'',[],1) % TEST
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   vq_data: a structure with volcano information, see vq_volcano_list_read
       &ampgt promted for if not given
   hazard_set_file: the name and path of the hazard set file
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           Longitude(1,:): the longitudes
           Latitude(1,:): the latitudes
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a .mat-file which contains a centroids struct (saved by
       climada_centroids_read) or the filename of an Excel file (the original
       input to climada_centroids_read) which holds the centroids, in
       which case climada_centroids_read is called.
       OR: an entity, in which case the entity.assets.lat and
       entity.assets.lon are used as centroids.
       &ampgt promted for .mat or .xls filename if not given
       NOTE: if you then select Cancel, a regular default grid is used
       (TEST mode), see hard-wired definition in code (a rectangular area in California)
   TEST_volcano_preselection: if =1, check and show centroids and volcano
       positions, if =2 STOP after check, Default=0, no check
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'EQ' for
       earthquake
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event
       matrix_density: the density of the sparse array hazard.intensity
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)

   simple check for hazard content: hist(full(hazard.intensity(find(hazard.intensity))))
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150302, initial
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 David N. Bresch, david.bresch@gmail.com, 20170611, allow for entity instead of centroids
 David N. Bresch, david.bresch@gmail.com, 20160611, climada_global.save_file_version
View <A HREF=file:../../climada_modules/earthquake_volcano/code/vq_global_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="vq_global_probabilistic">
<H2>vq_global_probabilistic</H2></A>
<font color="blue">function vq_data=vq_global_probabilistic(vq_data,ens_size,check_plot) </font>
 generate probabilistic hazard set
 MODULE:
   eq_global
 NAME:
   vq_global_probabilistic
 PURPOSE:
   Given a volcano (VQ) database, create a probabilistic version by
   wiggling duration, cloud height, wind direction and speed...

   First, add wind speed and direction (from climatolog) to historic
       eruptions. For those historic eruptions with no known month, add mean
       wind.
   Second, generate 11 times the events and add the 'missing' months winds
       For historic eruptions without wind, use January wind for historic
   Third, generate probabilistic eruptions

   previous step: see vq_volcano_list_read
   next step: see vq_global_hazard_set
 CALLING SEQUENCE:
   vq_data=vq_global_probabilistic(vq_volcano_list_read,ens_size,check_plot)
 EXAMPLE:
   vq_data=vq_global_probabilistic(vq_volcano_list_read,9,1)
 INPUTS:
   vq_data: an volcano (VQ) database, see vq_volcano_list_read
 OPTIONAL INPUT PARAMETERS:
   ens_size: ensemble size, the number of 'copies' of the original
       database we create, default=9 (means 10x as original data)
       if =0, the data is only enriched by wind climatology and no
       probabilistic eruptions are generated (for historic events with no
       month indicated, the annual mean wind is used).
       if =1, the data is 'replicated' 11 additional times, to reflect the
       wind climatology each month.
       if &ampgt1, it's really replicating other parameters, mainly Cloud_height_km
       parameters are sampled ens_size-1 times, the final event count is
       thus n_orig_events*12*(ens_size-1)
   check_plot: show a check plot (=1), or not (=0, default)
 OUTPUTS:
   vq_data, same as output of vq_volcano_list_read (see there), just for
       (many) more eruptions, plus U_vel_kmh an U_vel_rad added
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150307, initial
 David N. Bresch, david.bresch@gmail.com, 20160423, rand('seed',0) --&ampgt rng(0)
View <A HREF=file:../../climada_modules/earthquake_volcano/code/vq_global_probabilistic.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="vq_tephra_field_cm">
<H2>vq_tephra_field_cm</H2></A>
<font color="blue">function T=vq_tephra_field_cm(centroids,lon,lat,H,U_vel,U_phi,tau,check_plot) </font>
 Create volcanoe hazard set
 MODULE
 eq_global
 NAME:
   vq_tephra_field_cm
 PURPOSE:
   Calculate the tephra (ash) field thickness for one eruption at
   centroids. The eroption is characterized by (obviously) the coordinate
   of the eruption center, the eruptive column height, the prevailing wind
   and the duration of the eruption.

   according to A. O. Gonzalez-Mellado and S. De la Cruz-Reyna, 2010: A
   simple semi-empirical approach to model thickness of ash-deposits for
   different eruption scenarios. Nat. Hazards Earth Syst. Sci., 10,
   2241?2257, 2010, direct:
   www.nat-hazards-earth-syst-sci.net/10/2241/2010/nhess-10-2241-2010.pdf

   Variable parameters are distance r between centroid(i) and eruption
   center and phi, angle between the wind direction and the vector from
   the ash emission center to centroid(i).

   Some PARAMETERS set in code, see below, also defaults

   previous step: see vq_global_hazard_set (usually colled from there)
 CALLING SEQUENCE:
   T=vq_tephra_field_cm(centroids,lon,lat,H,U_vel,U_phi,tau)
 EXAMPLE:
   lon=14.426;lat=40.821; % Vesuvius
   centroids.lon=lon-1:.01:lon+1;centroids.lat=centroids.lon*0+lat; % 1D cross-section
   T=vq_tephra_field_cm(centroids,lon,lat,15,50,0,1);
   plot((centroids.lon-lon)*100,T);hold on;plot([0 0],[0 max(T)],'-r');
   xlabel('approx km');ylabel('ash thickness [cm]')

   [X,Y]=meshgrid(lon-1:.01:lon+1,lat-1:.01:lat+1); % 2D grid
   centroids.lon=reshape(X,numel(X),1);centroids.lat=reshape(Y,numel(X),1); % 2D grid
   T=vq_tephra_field_cm(centroids,lon,lat,15,50,0,1,1); % last '1' for plot

   % As in Fig. 11 of cited paper: 30 June 1997 Popocatepetl eruption
   T=vq_tephra_field_cm(centroids,lon,lat,8,80,312/360*pi,0.58,1); % last '1' for plot

 INPUTS:
   centroids: a structure with lon(i) and lat(i) of all the points we'd
       like to obtain the tephra field thickness for
   lon: the longitude (scalar) of the eruption center
   lat: the latitude of the eruption center
 OPTIONAL INPUT PARAMETERS:
   H: eruptive column height in km
   U_vel: wind velocity in km/h, indicative 50-100 km/h most often.
   U_phi: direction of wind in radian (-pi..pi), counterclockwise from
       (dx=1,dy=0), i.e. from direction East, West=pi, North=pi/2
   tau: duration of the high-intensity phase of the eruption in hours
       (e.g. Pinatubo 1-5h) default=8h
   check_plot: =1, show check plot, =0 not (default)
 OUTPUTS:
   T: the height of the tephra field (in cm) at each centroid
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150302, initial
View <A HREF=file:../../climada_modules/earthquake_volcano/code/vq_tephra_field_cm.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="vq_volcano_list_read">
<H2>vq_volcano_list_read</H2></A>
<font color="blue">function [vq_data,volcano_list_file_mat]=vq_volcano_list_read(volcano_list_file,check_plot) </font>
 read ISC-GEM earthquake catalogue
 EQ eq data read
 NAME:
   eq_GVP_volcano_list_read
 PURPOSE:
   Read volcano (VQ) database, either

   GVP_Volcano_List.xls from http://www.volcano.si.edu
   (more volcanoes, but less information)

   or

   NGDC_SignificantVolcanicEvents.xls from
   http://www.ngdc.noaa.gov/nndc/struts/results?type_15=Like&ampquery_15=&ampop_30=eq
   &ampv_30=&ampge_23=&ample_23=&ampop_29=eq&ampv_29=&amptype_16=Like&ampquery_16=&ample_17=&ampge_18=
   &ample_18=&ampge_17=&ampop_20=eq&ampv_20=&ampge_7=&ample_7=&ampbt_24=&ampst_24=&amptype_25=EXACT
   &ampquery_25=None+Selected&ampbt_26=&ampst_26=&amptype_27=EXACT&ampquery_27=None+Selected
   &amptype_12=Exact&ampquery_12=&amptype_11=Exact&ampquery_11=&ampt=102557&amps=50&ampd=50
   (more information, but less volcanoes)

   next step: see vq_global_probabilistic
 CALLING SEQUENCE:
   [vq_data,vq_data_file_mat]=vq_volcano_list_read(volcano_list_file_mat,check_plot)
 EXAMPLE:
   [vq_data,vq_data_file_mat]=vq_volcano_list_read % returns NGDC...
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   volcano_list_file: the filename of the .xls file with the tab
       volacano_list with volcano information
       if empty, the code tries a default name, if it does not exist, it
       prompts the user to locate the file
       Two short options are possible, too: 'GVP' or 'NGDC', see above
       Default is 'NGDC', as this list contains more parameters
   check_plot: show a check plot (=1), or not (=0, default)
 OUTPUTS:
   vq_data, a structure with either (for
       NGDC_SignificantVolcanicEvents.xls)
       yyyy(line_i): year
       mm(line_i)  : month
       dd(line_i)  : day
       lat(line_i): geographic latitude
       lon(line_i): geographic longitude
       elevation_m(line_i) : the elevation of the volcano
       mag(line_i) : magnitude (moment magnitude, mw)
       ...and other fields, same names as column headers in Excel
   or for GVP_Volcano_List.xls
       lat(i): geographic latitude
       lon(line_i): geographic longitude
       elevation_m(line_i) : the elevation of the volcano
       filename: the filename the data has been read from
       Volcano_Number(i)
       Volcano_Name{i}
       country_name{i}
       Primary_Volcano_Type{i}
       Activity_Evidence{i}
       Last_Known_Eruption{i}
       Region{i}
       Subregion{i}
       Dominant_Rock_Type{i}
       Tectonic_Setting{i}
       &ampgt also stored as .mat file. Please delete the .mat file manually in order
       to re-read from the original .xls file
   volcano_list_file_mat: the name of the .mat file vq_data is stored to
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20150217, initial
 David N. Bresch, david.bresch@gmail.com, 20150223, some trimming
View <A HREF=file:../../climada_modules/earthquake_volcano/code/vq_volcano_list_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_srtm_entity">
<H2>climada_srtm_entity</H2></A>
<font color="blue">function [entity,centroids,SRTM_info]=climada_srtm_entity(centroidsORcountryORshapes,check_plot) </font>
 climada template
 MODULE:
   elevation_models
 NAME:
   climada_srtm_entity
 PURPOSE:
   Starting grom SRTM digital elevation model (90m), construct a country
   entity an the corresponding centroids, save both with standard names,
   i.e. III_{country_name}_SRTM_{entity|centroids}, with III the 3-digit
   iso code and country_name with no spaces, e.g. UnitedStates.

   check using climada_entity_plot and climada_centroids_plot
   please note that you need to run climada_EDS_calc with
   force_re_encode=1 unless you re-generate the hazard with the controids
   as generated here. Even better, run climada_assets_encode and save the
   encoded entity (
 CALLING SEQUENCE:
   entity=climada_srtm_entity(centroidsORcountryORshapes,check_plot)
 EXAMPLE:
   entity=climada_srtm_entity('Tuvalu')
 INPUTS:
   centroidsORcountryORshapes:  can be a country_name 'El Salvador', or
       coordinates of the rectangle box to get topography within [lonmin lonmax latmin latmax]
       or centroids (as e.g. from climada_centroids_load)
       handed over to climada_srtm_get, see there
 OPTIONAL INPUT PARAMETERS:
   check_plot: show a check plot, if =1, (default=0)
       if negative, omit calculation of distance2coast_km (which easily
           takes a few minutes)
 OUTPUTS:
   entity: a climada entity structure, see climada_entity_read for format
       description
   centroids: a climada centroids structure, see climada_centroids_read
   SRTM_info: just handed over from climada_srtm_get, see there
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20160514, initial (Rotterdam)
 david.bresch@gmail.com, 20160516, full compatibility with eg centroids_generate_hazard_sets
 david.bresch@gmail.com, 20160529, Cancel pressed works
View <A HREF=file:../../climada_modules/elevation_models/code/climada_srtm_entity.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_srtm_get">
<H2>climada_srtm_get</H2></A>
<font color="blue">function [SRTM,srtm_info] = climada_srtm_get(centroidsORcountryORshapes,check_plot,save_tile,verbose) </font>
 climada
 MODULE:
   elevation_models
 NAME:
   climada_srtm_get
 PURPOSE:
   Read the digital elevation model data from the files in an existing
   srtm directory. Data can be downloaded from http://srtm.csi.cgiar.org/SELECTION/inputCoord.asp
   or http://srtm.csi.cgiar.org/index.asp

   The code tries to automatically get the tiles from
   http://droppr.org/srtm/v4.1/6_5x5_TIFs/ (see SRTM_URL in PARAMETERS in
   code). If this fails, the list of required tiles of the SRTM is printed
   to stdout for the suer to manually retrieve
 CALLING SEQUENCE:
   [SRTM,srtm_info] = climada_srtm_get(centroidsORcountryORshapes,check_plot,save_tile,verbose)
 EXAMPLE:
   [SRTM,srtm_info] = climada_srtm_get('Switzerland',1,1,1)

   SRTM = climada_srtm_get('El Salvador',1,0)
   SRTM = climada_srtm_get([-89.15 -89.1 13.695 13.73],1,0) % las canas area, San Salvador
   SRTM = climada_srtm_get([min_lon max_lon min_lat max_lat],1,0)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   centroidsORcountryORshapes:  can be a country_name 'El Salvador', or
       coordinates of the rectangle box to get topography within [lonmin lonmax latmin latmax]
       or centroids (as e.g. from climada_centroids_load)
   check_plot: show a check plot, if =1, (default=0)
   save_tile: =1: save the respective SRTM tiles, in order to speed up in
       subsequent calls. =0 (default): do not save anything
       Warning: the user is responsible for managing such tiles in the
       ../data/results folder
   verbose: =1 print info, =0 not (default)
 OUTPUTS:
   SRTM: a structure, with
       .x(i,j): the longitude coordinates
       .y(i,j): the latitude coordinates
       .h(i,j): the elevation [m, negative below sea level]
       sourcefile: the source file (e.g. .../srtm_18_10.tif)
   If save_tile=1, the tile as returned is also saved to
       ../data/results/etopo_*
 MODIFICATION HISTORY:
 muellele@gmail.com, 20150723, init based on climada_90m_DEM by Gilles Stassen and etopo_get by David Bresch
 david.bresch@gmail.com, 20160122, srtm folder moved, some fixes (removed hard-wired paths)
 david.bresch@gmail.com, 20160126, automatic retrieve implemented
 david.bresch@gmail.com, 20160126, single precision (half the memory need)
 david.bresch@gmail.com, 20160513, issue southern hemisphere solved
 david.bresch@gmail.com, 20160529, Cancel pressed works
 david.bresch@gmail.com, 20170323, issue with latitude for southern hemisphere patched, be careful, i.e. check output (as the tiles will be downloaded from www)
View <A HREF=file:../../climada_modules/elevation_models/code/climada_srtm_get.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="etopo_elevation_m">
<H2>etopo_elevation_m</H2></A>
<font color="blue">function elevation_m=etopo_elevation_m(lon,lat,check_plot) </font>
 climada elevation m etopo
 MODULE:
   etopo
 NAME:
   etopo_elevation_m
 PURPOSE:
   obtain elevation in m (based on ETOPO)

   See etopo_get for any further information about ETOPO. See
   http://www.ngdc.noaa.gov/mgg/global/global.html and the readme files in
   .../etopo/data. Since ETOPO1 is globally consistent, its use is highly
   recommended (use ETOPO2 only if e.g. running in memory issues).
 CALLING SEQUENCE:
   elevation_m=etopo_elevation_m(lon,lat,check_plot)
 EXAMPLE:
   elevation_m=etopo_elevation_m(lon,lat)
 INPUTS:
   lon: vector of longitues
   lat: vector of latitudes
 OPTIONAL INPUT PARAMETERS:
   check_plot: =1: show circle plot for check, only works for more than
       one point
       =0: no plot (default)
 OUTPUTS:
   elevation_m: elevation in m for each lat/lon (ocean depth for below sea
       level)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141226, initial
View <A HREF=file:../../climada_modules/elevation_models/code/etopo_elevation_m.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="etopo_get">
<H2>etopo_get</H2></A>
<font color="blue">function ETOPO=etopo_get(etopo_coords,check_plot,save_tile) </font>
 climada topography ETOPO bathymetry
 NAME:
   etopo_get
 PURPOSE:
   get a chunk (tile) of the global ETOPO elevation (and bathymetry) dataset.

   Test it calling etopo_get without any argument (you should get an area
   around Switzerland)

   There are two datasets, ETOPO1 in high-res and ETOPO2 in mid-res. See
   http://www.ngdc.noaa.gov/mgg/global/global.html and the readme files in
   .../etopo/data. Since ETOPO1 is globally consistent, it?s use is highly
   recommended (use ETOPO2 only if e.g. running in memory issues).

   If there is no data file, means no file .../etopo/data/ETOPO1.nc,
   proceed as follows:
   1. Download the file
      http://www.ngdc.noaa.gov/mgg/global/relief/ETOPO1/data/ice_surface/grid_registered/netcdf/ETOPO1_Ice_g_gmt4.grd.gz
   2. Move it to .../etopo/data/
   3. Unzip it (it might do so automatically, e.g. on a Mac)
   4. Rename it to ETOPO1.nc
   5. Test it using etopo_get without any argument (you should get an area
      around Switzerland)

 CALLING SEQUENCE:
   ETOPO=etopo_get(etopo_coords,check_plot,save_tile)
 EXAMPLE:
   ETOPO=etopo_get([4 14 43 53])
 INPUTS:
   etopo_coords: the rectangle to get topography within
       [lonmin lonmax latmin latmax]
       if empty (or not provided): TEST mode, you should get an area
       around Switzerland - and the elevation is plotted, too.
 OPTIONAL INPUT PARAMETERS:
   check_plot: show a check plot, if =1, (default=0)
   save_tile: =1: save the respective etopo tile, in order to speed up in
       subsequent calls. =0 (default): do not save anything
       Warning: the user is responsible for managing such tiles in the
       ../data/results folder
       The option has mainly been introduced to support use of etopo_get
       under Octave, which does not yert provide ncread. Please note that
       check_plot does not work on subsequent calls.
 OUTPUTS:
   ETOPO: a structure, with
       x(i,j): the longitude coordinates
       y(i,j): the latitude coordinates
       h(i,j): the elevation [m, negative below sea level]
       sourcefile: the source file (.../ETOPO1.nc)
   If save_tile=1, the tile as returned is also saved to
       ../data/results/etopo_*
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20140422
 David N. Bresch, david.bresch@gmail.com, 20141022, small fix if requested area ourside limits (just a FIX, not a nice one, see below)
 David N. Bresch, david.bresch@gmail.com, 20150101, save_tile
 David N. Bresch, david.bresch@gmail.com, 20160526, better error messaging for ETOPO issues
View <A HREF=file:../../climada_modules/elevation_models/code/etopo_get.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="srtm_elevation_m">
<H2>srtm_elevation_m</H2></A>
<font color="blue">function elevation_m=srtm_elevation_m(lon,lat,check_plot) </font>
 climada elevation m srtm
 MODULE:
   etopo
 NAME:
   srtm_elevation_m
 PURPOSE:
   obtain elevation in m (based on SRTM)

   Data can be downloaded from http://srtm.csi.cgiar.org/SELECTION/inputCoord.asp
   or http://srtm.csi.cgiar.org/index.asp

   See climada_srtm_get
 CALLING SEQUENCE:
   elevation_m=srtm_elevation_m(lon,lat,check_plot)
 EXAMPLE:
   elevation_m=srtm_elevation_m(lon,lat)
 INPUTS:
   lon: vector of longitues
   lat: vector of latitudes
 OPTIONAL INPUT PARAMETERS:
   check_plot: =1: show circle plot for check, only works for more than
       one point
       =0: no plot (default)
 OUTPUTS:
   elevation_m: elevation in m for each lat/lon (ocean depth for below sea
       level)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141226, initial based on etopo_elevation_m
View <A HREF=file:../../climada_modules/elevation_models/code/srtm_elevation_m.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hdr_read">
<H2>climada_hdr_read</H2></A>
<font color="blue">function min_max_lon_lat = climada_hdr_read(tif_filename) </font>
 climada
 MODULE:
   etopo
 NAME:
   climada_hdr_read
 PURPOSE:
   Read hdr files that go together with tif files and get coordinates
   information (upper left, lower left, upper right, lower right)
 CALLING SEQUENCE:
    min_max_lon_lat = climada_hdr_read(tif_filename)
 EXAMPLE:
   min_max_lon_lat = climada_hdr_read('...\etopo\data\srtm_19_10.tif')
 INPUTS:
   tif_filename: a char or a cell with one or multiple tif-filenames (e.g.
   ...etopo\data\srtm_19_10.tif)
 OUTPUTS:
   min_max_lon_lat: a 1x4 matrix with [min_lon max_lon min_lat max_lat] data
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150723, init based on climada_90m_DEM by Gilles Stassen
View <A HREF=file:../../climada_modules/elevation_models/code/helper_functions/climada_hdr_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_srtm_info">
<H2>climada_srtm_info</H2></A>
<font color="blue">function [srtm_info,is_mat] = climada_srtm_info(centroidsORcountryORshapes,silent_mode) </font>
 climada
 MODULE:
   etopo
 NAME:
   climada_srtm_info
 PURPOSE:
   Get tile information for a specified country, centroids or a shape,
   i.e. which tiles to download from srtm directory.

   Data needs to be manually downloaded from from
   http://srtm.csi.cgiar.org/SELECTION/inputCoord.asp,
   (or possibly also ftp://srtm.csi.cgiar.org/SRTM_V41/SRTM_Data_GeoTiff/,
   http://droppr.org/srtm/v4.1/6_5x5_TIFs/)

   See also https://dds.cr.usgs.gov/srtm/version2_1/SRTM3
   https://dds.cr.usgs.gov/srtm/version2_1/Documentation/Quickstart.pdf
   https://dds.cr.usgs.gov/srtm/version2_1/Documentation/SRTM_Topo.pdf
   
   Next call: climada_srtm_get
 CALLING SEQUENCE:
   [srtm_info,is_mat] = climada_srtm_info(centroidsORcountryORshapes,silent_mode)
 EXAMPLE:
   srtm_info = climada_srtm_info
   srtm_info = climada_srtm_info('Netherlands')
   srtm_info = climada_srtm_info([min_lon max_lon min_lat max_lat])
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   centroidsORcountryORshapes:  centroids with lat/lon, country_name or
   shapes with lat/lon, it not specified prompted for a country_name
 OUTPUTS:
   srtm_tile: A struct with information which srtm_files to download from srtm
        http://srtm.csi.cgiar.org/SELECTION/inputCoord.asp
        .country_name:  country name of selected country, or region
        .n_tiles:  number of tiles that are required for the selected region/country
        .min_max_lon_lat: a 4x1 vector containing the srtm tile indices (e.g [18 19 10 10] for El Salvador)
        .srtm_filename: a cell with filenames to be downloaded from srtm
        .srtm_save_file: a char with the srtm filename (as .mat)
   is_mat: =1 if matfile exists, =0 if it does not exist (=1 usually only
       after climada_srtm_get has been called)
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150720, init based on climada_90m_DEM by Gilles Stassen
 david.bresch@gmail.com, 20160122, srtm folder moved, some fixes (removed hard-wired paths)
 david.bresch@gmail.com, 20160126, file info to stdout improved
 david.bresch@gmail.com, 20160513, error in latitude selection for southern hemisphere fixed, prompting for country name if invalid
 david.bresch@gmail.com, 20170323, issue with latitude for southern hemisphere patched, be careful, i.e. check output (as the tiles will be downloaded from www)
View <A HREF=file:../../climada_modules/elevation_models/code/helper_functions/climada_srtm_info.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_encode_distance">
<H2>climada_hazard_encode_distance</H2></A>
<font color="blue">function hazard = climada_hazard_encode_distance(hazard,entityORassetsORcentroids,cutoff) </font>
 climada
 MODULE:
   flood
 NAME:
   climada_hazard_encode_distance
 PURPOSE:
   This is a function that is usually called from climada_ls_hazard_set.
   Convert landslide hazard intensity (landslide depth(m))
   into distance between an asset and the nearest centroid with nonzero
   intensity. Distance is transformed into intensity in the form of (y = mx+b), 
   which means increasing intensity with increasing damage, 
   intensity = 1 - 1/cutoff * distance_m
   Minimum distance is set to  1m, which translates into the maximum intensity 1.
   The lat/lon coordinates of the hazard are overwritten by the asset
   lat/lon coordinates
   A default distance cutoff, when it can be assumed that no asset is
   affected anymore is introduced at 1000 m.
 CALLING SEQUENCE:
   hazard = hazard_distance_convert(hazard,entity,cutoff)
 EXAMPLE:
   hazard = hazard_distance_convert(hazard,entity,250)
 INPUTS:
   hazard: landslide hazard structure, intensity given as meters soildepth
   entity: climada entity structure, with .assets.lon and .assets.lat
 OPTIONAL INPUT PARAMETERS:
   cutoff: default 1000m, can be set to other value
 OUTPUTS:
   hazard: a climada structure with lat/lon that equal the entity.assets.lat/lon
           and intensity as 1-1/cutoff*distance_m (-)
 MODIFICATION HISTORY:
 Jacob Anz, j.anz@gmx.net, 20150708, initial
 Lea Mueller, muellele@gmail.com, 20150713, intensity as 1-1/cutoff*distance_m instead of distance
 Gilles Stassen, gillesstassen@hotmail.com, 20150803, faster (~30x) alternative to knnsearch; argin entity -&ampgt entityORassetsORcentroids
 Gilles Stassen, 20150805, elevation cutoff. Entity points higher in elevation than land slide excluded
 Lea Mueller, muellele@gmail.com, 20150915, bugfix when calculate distance_m from intensity
 Lea Mueller, muellele@gmail.com, 20151106, move to flood
View <A HREF=file:../../climada_modules/flood/code/climada_hazard_encode_distance.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_ls_hazard_binary_plot">
<H2>climada_ls_hazard_binary_plot</H2></A>
<font color="blue">function fig = climada_ls_hazard_binary_plot(hazard) </font>
 climada plot ls binary hazard
 MODULE:
   flood
 NAME:
   climada_ls_hazard_binary_plot
 PURPOSE:
   This is a function that is usually called from climada_ls_hazard_set.
   Plot binary landslide hazard, all events on one map
 PREVIOUS STEP:
   hazard_binary = climada_ls_hazard_set_binary(centroids)
 NEXT STEP:
   hazard = climada_hazard_encode_distance(hazard,centroids,cutoff);
 CALLING SEQUENCE:
   fig = climada_ls_hazard_binary_plot(hazard)
 EXAMPLE:
   fig = climada_ls_hazard_binary_plot;
 INPUTS:
   hazard:  a climada hazard stucture with binary landslide
   information (.intensity is either 1 or 0)
 OPTIONAL INPUT PARAMETERS:
   none
 OUTPUTS:
   fig: handle of map with landslide events
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151124, init
 -
View <A HREF=file:../../climada_modules/flood/code/climada_ls_hazard_binary_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_ls_hazard_set">
<H2>climada_ls_hazard_set</H2></A>
<font color="blue">function [hazard, centroids, fig] = climada_ls_hazard_set(centroids,n_events,hazard_set_file,... </font>
                                       wiggle_factor_TWI,condition_TWI, wiggle_factor_slope,condition_slope,...
                                       n_downstream_cells,focus_area,polygon_correction,random_trigger_condition,...
                                       check_plot)
 Generate a landslide hazard set
 MODULE:
   flood
 NAME:
   climada_ls_hazard_set
 PURPOSE:
   This is a all-in-one function to generate a landslide hazard set. The 
   landslide events are based solely on topographical information 
   (SRTM 90m digital elevation data) and calculates slope and 
    topographical wetness index. We create first a binary hazard,
   encode to distance and plot figures if required.
   invokes 
       - climada_ls_hazard_set_binary
       - climada_hazard_encode_distance
   and for plots
       - climada_ls_hazard_binary_plot
       - climada_map_plot
       - climada_hazard_stats
       - climada_hazard_stats_figure   
 PREVIOUS STEP:
   create centroids, select a rectangle box to create the landslide hazard
   centroids = climada_centroids_elevation_add;
 CALLING SEQUENCE:
   [hazard, centroids, fig] = climada_ls_hazard_set(centroids,n_events,hazard_set_file,...
                                         wiggle_factor_TWI,condition_TWI, wiggle_factor_slope,condition_slope,...
                                         n_downstream_cells,focus_area,polygon_correction,random_trigger_condition,...
                                         check_plot)
 EXAMPLE:
   hazard = climada_ls_hazard_set(centroids)
   check_plot = 1;
   [hazard, centroids, fig]  = climada_ls_hazard_set([-89.145 -89.1 13.692 13.727],'','','','','','','','','','',check_plot)
 INPUTS:
   centroids:  a climada centroids stucture (ideally including topographical
       information) or a rectangle to define lon/lat box, if not given, the
       user can select a rectangle by first selecting a country and then drawing
       a rectangle on a map
 OPTIONAL INPUT PARAMETERS:
   n_events: number of events
   hazard_set_file: the name (and path, optional) of the hazard set file
       If no path provided, default path ../data/hazards is used (and name
       can be without extension .mat)
       &ampgt promted for if not given
   wiggle_factor_TWI:    an array, default is 0.35, to modify topographical
                         wetness factor, which is a number between 0 and 1.4
   condition_TWI:        an array, default is 0.95, to define a minimum
                         topographical wetness index, where a landslide occurs
   wiggle_factor_slope:  an array, default is 0.35, to modify the slope factor, 
                         which is a number between 0 and 1
   condition_slope:      an array, default is 0.45, to define a minimum slope
                         where a landslide occurs
   n_downstream_cells:   number of downstream cells where the landslide is extended
   focus_area:           a polygon to define the focus area (with focus_area.lon, focus_area.lat),
                         landslides only in the given area will be filtered 
                         and the other areas are cut out
   polygon_correction:   a polygon to define an area where less landlislides should occur
   random_trigger_condition: a number between 0 and 1, 1 prevents all landslide 
                         in the polygon_correction area, 0 does not inhibit any
                         landlides in the polygon_correction area
   check_plot:          set to 1 if you want to see maps (elevation, slope, hazard, etc)
 OUTPUTS:
   hazard: a climada hazard structure with binary landslide information
       .peril_ID: 'LS'
       .date: the creation date of the set
       .intensity(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i, binary, 1 indicates a landslide, 0 no landslide
       .frequency(event_i): the frequency of each event
       .matrix_density: the density of the sparse array hazard.intensity
       .filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
   centroids: a climada centroids structure with fields
       .lon
       .lat
       .elevation_m, elevation in meters
       .slope_deg, slope in degree
       .TWI, topographical wetness index
       .aspect_deg, spect in degree
   fig: handle of figures (maps with elevation, slope, landslide
        hazard,etc)
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20151124, init
 -
View <A HREF=file:../../climada_modules/flood/code/climada_ls_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_ls_hazard_set_binary">
<H2>climada_ls_hazard_set_binary</H2></A>
<font color="blue">function [hazard, centroids]  = climada_ls_hazard_set_binary(centroids,n_events,hazard_set_file,... </font>
                                   wiggle_factor_TWI,condition_TWI, wiggle_factor_slope,condition_slope,...
                                   n_downstream_cells,focus_area,polygon_correction,random_trigger_condition)
 Generate a binary landslide hazard set
 MODULE:
   flood
 NAME:
   climada_ls_hazard_set_binary
 PURPOSE:
   This is a function that is usually called from climada_ls_hazard_set.
   Generate a binary landslide hazard set based solely on topographical
   information (slope and topographical wetness index)
 PREVIOUS STEP:
   centroids = climada_centroids_elevation_add;
 CALLING SEQUENCE:
   hazard = climada_ls_hazard_set_binary(centroids,n_events,hazard_set_file,...
                    wiggle_factor_TWI,condition_TWI, wiggle_factor_slope,condition_slope,...
                    n_downstream_cells,focus_area,polygon_correction,random_trigger_condition)
 EXAMPLE:
   hazard = climada_ls_hazard_set_binary(centroids)
   hazard = climada_ls_hazard_set_binary([-89.145 -89.1 13.692 13.727])
   hazard = climada_ls_hazard_set_binary
 INPUTS:
   centroids:  a climada centroids stucture (ideally including topographical
   information) or a rectangle to define lon/lat box, if not given, the
   user can select a rectangle by first selecting a country and then drawing
   a rectangle on a map
 OPTIONAL INPUT PARAMETERS:
   n_events: number of events
   hazard_set_file: the name (and path, optional) of the hazard set file
       If no path provided, default path ../data/hazards is used (and name
       can be without extension .mat)
       &ampgt promted for if not given
   wiggle_factor_TWI:    an array, default is 0.35, to modify topographical
                         wetness factor, which is a number between 0 and 1.4
   condition_TWI:        an array, default is 0.95, to define a minimum
                         topographical wetness index, where a landslide occurs
   wiggle_factor_slope:  an array, default is 0.35, to modify the slope factor, 
                         which is a number between 0 and 1
   condition_slope:      an array, default is 0.45, to define a minimum slope
                         where a landslide occurs
   n_downstream_cells:   number of downstream cells where the landslide is extended
   focus_area:           a polygon to define the focus area (with focus_area.lon, focus_area.lat),
                         landslides only in the given area will be filtered 
                         and the other areas are cut out
   polygon_correction:   a polygon to define an area where less landlislides should occur
   random_trigger_condition: a number between 0 and 1, 1 prevents all landslide 
                         in the polygon_correction area, 0 does not inhibit any
                         landlides in the polygon_correction area
 OUTPUTS:
   hazard: a climada hazard structure with binary landslide information
       .peril_ID: 'LS'
       .date: the creation date of the set
       .intensity(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i, binary, 1 indicates a landslide, 0 no landslide
       .frequency(event_i): the frequency of each event
       .matrix_density: the density of the sparse array hazard.intensity
       .filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150911, init
 Lea Mueller, muellele@gmail.com, 20150920, add polygon_correction with a random trigger condition, to reduce landslides in a given polygon
 Lea Mueller, muellele@gmail.com, 20151124, return centroids as output, use climada_hazard_focus_area
 Lea Mueller, muellele@gmail.com, 20151124, call from climada_ls_hazard_set
 Lea Mueller, muellele@gmail.com, 20151125, rename to climada_centroids_TWI_calc from centroids_TWI
 Lea Mueller, muellele@gmail.com, 20151125, rename to climada_hazard_crop from climada_hazard_focus_area
 David N. Bresch, david.bresch@gmail.com, 20170629, hazard.fraction added
 -
View <A HREF=file:../../climada_modules/flood/code/climada_ls_hazard_set_binary.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_centroids_TWI_calc">
<H2>climada_centroids_TWI_calc</H2></A>
<font color="blue">function centroids = climada_centroids_TWI_calc(centroids, check_plots) </font>
 Calculate flood scores and topographic wetness indices
 MODULE:
   flood
 NAME:
	climada_centroids_TWI_calc
 PURPOSE:
   Calculate flood scores and topographic wetness indices for given
   centroids, that are on a regular grid.
   climada_centroids_TWI_calc applies a multiple-flow-direction method which,
   in contrast to the simple D8 method, allows the runoff to flow to
   multiple neighbouring cells. The distribution of the flow is determined
   based on the respective gradients between the central cell and its
   neighbouring cells. Also, the algorithm controls dispersion effects
   using a method suggested by
       Freeman, T.G. (1991): Calculating catchment area with
       divergent flow based on a regular grid;
       doi:10.1016/0098-3004(91)90048-I
   The Topographic wetness index (TWI), which can be derived from the
   calculated flow accumulation, then provides a cost-efficient
   alternative to flood determination by conventional hydrodynamic models.
   For more information on TWI see
       Pourali, S.H. et al. (2014): Topography Wetness Index Application
       in Flood-Risk-Based Land Use Planning;
       doi:10.1007/s12061-014-9130-2
 CALLING SEQUENCE:
   centroids = climada_centroids_TWI_calc(centroids, check_plots)
 EXAMPLE:
   centroids = climada_centroids_TWI_calc(centroids,0)
 INPUTS:
   centroids: Climada centroids struct; the following fields are required:
         .lat:           Latitude
         .lon:           Longitude
         .centroid_ID:   centroid ID
         .admin0_name    Country name
 OPTIONAL INPUT PARAMETERS:
   check_plots: whether plots of topography (elevation), slope, aspect
   angle, and flood scores should be drawn (=1) or not (=0; default)
   force_recalc: if set to 1, flood scores are calculated even if they
   already exist (default is 0)
 OUTPUTS:
   centroids: centroids with additional fields:
       .FL_score:   assigns a number for flow accumulation to each centroid, and
       .TWI:        assigns a topographic wetness index to each centroid
       .slope_deg:  slope of every centroid, in degree
       .area_m2:    area of every centroid, in square meters
       .aspect_deg: aspect of every centroid, in degree
       .sink_ID:    sink of every centroid, links to centroid_ID
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150226, initial
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150311, added wetness index
 Gilles Stassen, gillesstassen@hotmail.com, 20150407, clean up
 Lea Mueller, muellele@gmail.com, 20150720, bugfix, quick+dirty workaround
              to create meshgrid and allocate FL_score, @Gilles: please check and correct
 Jacob Anz, 280715, fixed shift_matrix
 Lea Mueller, muellele@gmail.com, 20150925, add process management/waitbar
 Lea Mueller, muellele@gmail.com, 20151105, improve output documentation
 Lea Mueller, muellele@gmail.com, 20151125, rename to climada_centroids_TWI_calc from centroids_TWI
 David N. Bresch, david.bresch@gmail.com, 20170629, double() of single for griddata
View <A HREF=file:../../climada_modules/flood/code/helper_functions/climada_centroids_TWI_calc.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_flow_find">
<H2>climada_flow_find</H2></A>
<font color="blue">function centroids = climada_flow_find(centroids) </font>
 Find flow direction for every centroid 
 MODULE:
   flood
 NAME:
   climada_flow_find
 PURPOSE:
   Find flow direction for every centroid, find next 10 centroids, based
   on sink_ID
 PREVIOUS STEP:
   centroids = climada_centroids_TWI_calc(centroids)
 CALLING SEQUENCE:
   centroids = climada_flow_find(centroids)
 EXAMPLE:
   centroids = climada_flow_find(centroids)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   centroids: a climada centroids structure, including TWI properties,
   especially .sink_ID
 OUTPUTS:
   centorids: centroid with field .sink_ID_10 defining the 10 next centroids
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150920, init
 Lea Mueller, muellele@gmail.com, 20151125, rename to climada_centroids_TWI_calc from centroids_TWI
 -
View <A HREF=file:../../climada_modules/flood/code/helper_functions/climada_flow_find.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_geo_distance_2">
<H2>climada_geo_distance_2</H2></A>
<font color="blue">function dist_m = climada_geo_distance_2(lonlat1,lonlat2) </font>
 calculate distance between to points in meters
 MODULE:
   flood
 NAME:
   climada_geo_distance_2
 PURPOSE:
   calculate distance between two points or a point and a series of
   points, with different input format than climada_geo_distance. lonlat1
   and lonlat2 are a matrices that contain both lon and lat information. 
 CALLING SEQUENCE:
   climada_geo_distance_2(lonlat1, lonlat2);
 EXAMPLE:
   climada_geo_distance_2([0.0 45.0], [1.0 45.0]); % two points
   climada_geo_distance_2([0.0 45.0], [1.0 45.0; 1.0 46.0]); % point and a series of points
 INPUTS:
   lonlat1: longitude and latitude of first point
   lonlat2: longitude and latitude of second point
       or, if vectors of the same length, series of points
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   dist_m: distance(s) between points in [m]
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150801, init based on climada_geo_distance
 Lea Mueller, muellele@gmail.com, 20151106, move to flood
View <A HREF=file:../../climada_modules/flood/code/helper_functions/climada_geo_distance_2.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="basin_identify">
<H2>basin_identify</H2></A>
<font color="blue">function basin_IDs = basin_identify(lon_pts,lat_pts,lon_polygons,lat_polygons,basin_names) </font>
 Identify basins in which a set of points are located
 MODULE:
   flood
 NAME:
   basin_identify
 PURPOSE: 
   Identify basins in which a given set of points is located
   For a set of longitude and latitude points (usually from centroids), 
   determine if they are located in a given set of polygons, and if so,
   assign a basin name (or ID) to them.
 CALLING SEQUENCE: 
   basin_IDs = basin_identify(lon_pts,lat_pts,lon_polygons,lat_polygons,basin_names)
 INPUTS:
   lon_pts [deg E]: longitude of input points [0,360)
   lat_pts [deg N]: latitude of input points [-90,90]
   lon_polygons [deg E]: cell array of longitude values of polygon vertices
       (must be ordered either clockwise or counterclockwise)    
   lat_polygons [deg N]: cell array of latitude values of polygon vertices
       (must be ordered either clockwise or counterclockwise)  
   basin_names: cell array of basin labels (one per cell in lon_polygons)
 OPTIONAL INPUTS:  

 OUTPUTS:
   basin_IDs: cell array of basin labels at input points; 0 if
       outside all input polygons

 NOTE 1: This function has been adapted from code written by
 Dan Chavas, CEE Dept, Princeton University
 See http://www.mathworks.com/matlabcentral/fileexchange/48360-basin-identify-m/content/basin_identify/basin_identify.m

 NOTE 2: The current implementation also allows for basin names that
 consist of strings (rather than integer basin IDs). However, since for
 the time being the function will be used mostly with basin numbers, 
 basin_IDs will be converted from cell to a numeric vector in the end,
 which is only possible if all contents of the cell array are of the same
 data type. Therefore, remove the last command (&quotcell2mat&quot) in case you'd 
 like to attach the basin names to the input centroids as a cell

 MODIFICATION HISTORY
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150306, initial
View <A HREF=file:../../climada_modules/flood/code/under_construction/basin_identify.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="centroids_BD">
<H2>centroids_BD</H2></A>
<font color="blue">function centroids=centroids_BD(centroids, check_plots) </font>
 Assign bulk density (BD) values to given centroids
 MODULE:
   flood
 NAME:
	centroids_BD
 PURPOSE:
   Determine bulk density (BD) for given centroids by
   reading a grayscale GeoTIFF of global annual mean BD.
   The global average annual BD GeoTIFF image derived from http://soilgrids.org/

   It needs to be placed in data/system of the climada module flood
   The code automatically reads the GeoTIFF from that URL if it does not
   exist in the data folder of the flood module (but this is VERY slow...).
   bulk density values are in m
 CALLING SEQUENCE:
   centroids = centroids_BD(centroids, check_plots)
 EXAMPLE:
   centroids = centroids_BD(centroids)
 INPUTS:
  centroids: Climada centroids struct; the following fields are required:
         .lat:           Latitude
         .lon:           Longitude
         .centroid_ID:   centroid ID
         .admin0_name    Country name
 OPTIONAL INPUT PARAMBDERS:
   check_plots: whether a plot should be drawn (=1) or not (=0; default)
   force_recalc: if set to 1, BD is calculated even if the centroids
   already have a field 'bulk density' (default is 0)
 OUTPUTS:
   centroids: The input centroids structure with an additional field
   'BD_kg_m3', which contains the annual mean bulk density
   (in mm/day) for each centroid
 NOTE:
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmaail.com, 20150414
View <A HREF=file:../../climada_modules/flood/code/under_construction/centroids_BD.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="centroids_ET">
<H2>centroids_ET</H2></A>
<font color="blue">function centroids=centroids_ET(centroids, check_plots) </font>
 Assign Evapotranspiration (ET) values to given centroids
 MODULE:
   flood
 NAME:
	centroids_ET
 PURPOSE:
   Determine Evapotranspiration (ET) for given centroids by
   reading a grayscale GeoTIFF of global annual mean ET.
   The global average annual ET GeoTIFF image derived from 2010-2013 MODIS
   data can be downloaded here:
   ftp://ftp.ntsg.umt.edu/pub/MODIS/NTSG_Products/MOD16/MOD16A3.105_MERRAGMAO/Geotiff/MOD16A3_ET_2000_to_2013_mean.tif
   It needs to be placed in data/system of the climada module flood
   The code automatically reads the GeoTIFF from that URL if it does not
   exist in the data folder of the flood module (but this is VERY slow...).
   Evapotranspiration values are in mm/day.
 CALLING SEQUENCE:
   centroids = centroids_ET(centroids, check_plots)
 EXAMPLE:
   centroids = centroids_ET(centroids)
 INPUTS:
  centroids: Climada centroids struct; the following fields are required:
         .lat:           Latitude
         .lon:           Longitude
         .centroid_ID:   centroid ID
         .admin0_name    Country name
 OPTIONAL INPUT PARAMETERS:
   check_plots: whether a plot should be drawn (=1) or not (=0; default)
   force_recalc: if set to 1, ET is calculated even if the centroids
   already have a field 'evapotranspiration' (default is 0)
 OUTPUTS:
   centroids: The input centroids structure with an additional field
   'ET_mm_day', which contains the annual mean evapotranspiration
   (in mm/day) for each centroid
 NOTE:
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150320, initial
 Gilles Stassen, gillesstassen@hotmail.com, 20150407, cleanup, units mm/yr -&ampgt mm/day
 Gilles Stassen, gillesstassen@hotmaail.com, 20150414, speedup
View <A HREF=file:../../climada_modules/flood/code/under_construction/centroids_ET.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="centroids_LAI">
<H2>centroids_LAI</H2></A>
<font color="blue">function centroids=centroids_LAI(centroids, check_plots) </font>
 Assign Leaf Area Indices (LAIs) to given centroids
 MODULE:
   flood
 NAME:
	centroids_LAI_assign
 PURPOSE:
   Determine Leaf Area Indices (LAIs) for given centroids by
   reading a grayscale picture of global annual mean LAIs.
   Leaf area index (LAI) is a dimensionless quantity that characterizes
   plant canopies. It is defined as the one-sided green leaf area per unit
   ground surface area (LAI = leaf area / ground area, m^2/m^2).
   For more information on the LAI see
       http://en.wikipedia.org/wiki/Leaf_area_index
   The Moderate Resolution Imaging Spectroradiometer (MODIS) aboard NASA's
   Terra and Aqua satellites collects global LAI data on a daily basis.
   Values range from 0 to 7 square meters of leaf area per square meter of
   land surface.
   Global monthly mean LAI images in grayscale can be downloaded here:
       http://neo.sci.gsfc.nasa.gov/view.php?datasetId=MOD15A2_M_LAI
 NOTE: Since only monthly mean data are provided under the link above, a
 grayscale picture of the annual mean LAI needs to be produced manually by
 adding monthly pictures and taking the average.

 CALLING SEQUENCE:
   centroids = centroids_LAI(centroids,check_plots)
 EXAMPLE:
   centroids = centroids_LAI(centroids)
 INPUTS:
  centroids: Climada centroids struct; the following fields are required:
         .lat:           Latitude
         .lon:           Longitude
         .centroid_ID:   centroid ID
         .admin0_name    Country name
 OPTIONAL INPUT PARAMETERS:
   LAI_img_filename: File name of the global mean LAI image. If empty, a
   default image is used, and if it does not exists, the function prompts
   for the image filename.
   check_plots: whether a plot should be drawn (=1), for each month (=2) or not at all (=0; default) 
                   [about 3x slower when using check_plots = 2]
 OUTPUTS:
   centroids: The input centroids structure with an additional field
   'leaf_area_index', which contains the Leaf Area Index for each centroid
 NOTE:
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150318, initial
 Gilles Stassen, gillesstassen@hotmail.com, 20150407, monthly data; auto
                   file finder/downloader; interp2 to determine values at centroids; plotter
View <A HREF=file:../../climada_modules/flood/code/under_construction/centroids_LAI.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="centroids_SD">
<H2>centroids_SD</H2></A>
<font color="blue">function centroids=centroids_SD(centroids, check_plots) </font>
 Assign soil depth (SD) values to given centroids
 MODULE:
   flood
 NAME:
	centroids_SD
 PURPOSE:
   Determine soil depth (SD) for given centroids by
   reading a grayscale GeoTIFF of global annual mean SD.
   The global average annual SD GeoTIFF image derived from http://soilgrids.org/
   
   It needs to be placed in data/system of the climada module flood
   The code automatically reads the GeoTIFF from that URL if it does not
   exist in the data folder of the flood module (but this is VERY slow...).
   soil depth values are in m
 CALLING SEQUENCE:
   centroids = centroids_SD(centroids, check_plots)
 EXAMPLE:
   centroids = centroids_SD(centroids)
 INPUTS:
  centroids: Climada centroids struct; the following fields are required:
         .lat:           Latitude
         .lon:           Longitude
         .centroid_ID:   centroid ID
         .admin0_name    Country name
 OPTIONAL INPUT PARAMSDERS:
   check_plots: whether a plot should be drawn (=1) or not (=0; default)
   force_recalc: if set to 1, SD is calculated even if the centroids
   already have a field 'soil depth' (default is 0)
 OUTPUTS:
   centroids: The input centroids structure with an additional field
   'SD_m' containing info about soil depth to bedrock in m
 NOTE:
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150414
View <A HREF=file:../../climada_modules/flood/code/under_construction/centroids_SD.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="centroids_SWI">
<H2>centroids_SWI</H2></A>
<font color="blue">function centroids=centroids_SWI(centroids, check_plots) </font>
 Assign soil water indices (SWIs) to given centroids
 MODULE:
   flood
 NAME:
	centroids_SWI_assign
 PURPOSE:
   Determine soil water indices (SWIs) for given centroids by
   reading a grayscale image of global annual mean SWI.
   SWI describes the amount of soil moisture present out of how much could
   potentially exist in the soil; i.e., the current water storage divided
   by the available water storage. SWI ranges from 0 to 100% and is given
   by:
   SWI = (soil_moisture-wilting_point)/(field_capacity-wilting_point)
   SWI therefore equals 0 at the wilting point and 1 at the field capacity
   For more information on SWI see e.g. this paper by the Global Soil
   Wetness Project:
       https://www.jstage.jst.go.jp/article/jmsj1965/77/1B/77_1B_305/_pdf
   Daily global SWI images derived can be downloaded here:
   http://land.copernicus.eu/global/products/swi
   The image needs to be placed in data/system of the climada module flood

   NOTE: Since only daily data are provided under the link above, a
       grayscale picture of the annual mean SWI needs to be produced
       manually adding monthly pictures and taking the average.
 CALLING SEQUENCE:
   centroids = centroids_SWI_assign(centroids, check_plots)
 EXAMPLE:
   centroids = centroids_SWI_assign(centroids)
 INPUTS:
  centroids: Climada centroids struct; the following fields are required:
         .lat:           Latitude
         .lon:           Longitude
         .centroid_ID:   centroid ID
         .admin0_name    Country name
 OPTIONAL INPUT PARAMETERS:
   check_plots: whether a plot should be drawn (=1) or not (=0; default)
   force_recalc: if set to 1, SWI is calculated even if the centroids
   already have a field 'soil_water_index' (default is 0)
 OUTPUTS:
   centroids: The input centroids structure with an additional field
   'SWI' (soil water index), which contains the annual mean soil water index
   (in %) for each centroid
 NOTE:
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150325, initial
View <A HREF=file:../../climada_modules/flood/code/under_construction/centroids_SWI.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="centroids_WHC">
<H2>centroids_WHC</H2></A>
<font color="blue">function centroids=centroids_WHC(centroids, check_plots) </font>
 Assign available water holding capacity (WHC) values to given centroids
 MODULE:
   flood
 NAME:
	centroids_WHC
 PURPOSE:
   Determine water holding capacity (WHC) for given centroids by
   reading a grayscale GeoTIFF of global annual mean WHC.
   The available water-holding capacity describes the amount of water
   available for evapotranspiration after drainage and is defined as the
   field capacity minus the permanent wilting point.
   The global mean annual FC GeoTIFF image is part of the Global Gridded
   Surfaces of Selected Soil Characteristics data set, which was developed
   by the Global Soil Data Task of the International Geosphere-Biosphere
   Programme. It can be downloaded here:
   http://webmap.ornl.gov/wcsdown/wcsdown.jsp?dg_id=569_3
   The image needs to be placed in data/system of the climada module
   flood.
   WHC values are in mm.
   For more information on the Global Soil Data Task, see
   https://daac.ornl.gov/SOILS/guides/igbp-surfaces.html
 CALLING SEQUENCE:
   centroids = centroids_WHC(centroids, check_plots, force_recalc)
 EXAMPLE:
   centroids = centroids_WHC(centroids)
 INPUTS:
  centroids: Climada centroids struct; the following fields are required:
         .lat:           Latitude
         .lon:           Longitude
         .centroid_ID:   centroid ID
         .admin0_name    Country name
 OPTIONAL INPUT PARAMETERS:
   check_plots: whether a plot should be drawn (=1) or not (=0; default)
   force_recalc: if set to 1, FC is calculated even if the centroids
   already have a field 'water_holding_capacity' (default is 0)
 OUTPUTS:
   centroids: The input centroids structure with an additional field
   'WHC_mm' (water holding capacity), which contains the annual mean available
   water holding capacity
   (in mm) of each centroid
 NOTE:
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150325, initial
 Gilles Stassen, gillesstassen@hotmail.com, 20150423, cleanup
View <A HREF=file:../../climada_modules/flood/code/under_construction/centroids_WHC.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="centroids_basin_ID">
<H2>centroids_basin_ID</H2></A>
<font color="blue">function [centroids, shapes] = centroids_basin_ID(centroids, res, check_plots) </font>
 assign basin ID to centroids
 MODULE:
   tbd
 NAME:
	country_basin_ID
 PURPOSE:
   Assign basin IDs to centroids based on HydroSHEDS basin outline
   shapefiles For more information and a technical documentation see
   http://hydrosheds.org/page/hydrobasins
 CALLING SEQUENCE:
   centroids_basin_ID = centroids_basin_ID(basin_shapefile,centroids, check_plots)
 EXAMPLE:
   centroids_basin_ID = centroids_basin_ID('',centroids,0)
 INPUTS:
   centroids: Climada centroids struct; the following fields are required:
         .lat:           Latitude
         .lon:           Longitude
         .centroid_ID:   centroid ID
         .admin0_name    Country name
 OPTIONAL INPUT PARAMETERS:
   basin_shapefile: name (including full path) of the basin shapefile to
   be used. If left empty, the code constructs default names corresponding
   to the shapefile names as provided by HydroSHEDS. The basin shapefiles
   need to be located in the data/system folder of the CLIMADA flood
   module.
   res: resolution of shape file - the HydroSHEDS basin outline files are
   provided in 15 arcsecond (res==15; default) and 30 arcsecond (res==30)
   resolution.
   check_plots: whether a plot of the centroids should be generated (=1),
   or not (=0; default)
   force_recalc: if set to 1, basin IDs are recalculated even if they
   already exist (default is 0)
 OUTPUTS:
   centroids: centroids with an additional field 'basin_ID' denoting the
   river basin a centroid has been assigned to

 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150301, initial
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150314, add basin identification based on continents
 Gilles Stassen, gillesstassen@hotmail.com, 20150315, added use of subdir
 Gilles Stassen, gillesstassen@hotmail.com, 20150327, automatic download functionality
 Gilles Stassen, 20150408, clean up, the file finding piece in particular
View <A HREF=file:../../climada_modules/flood/code/under_construction/centroids_basin_ID.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="centroids_river_network">
<H2>centroids_river_network</H2></A>
<font color="blue">function centroids = centroids_river_network(centroids,check_plots) </font>
 identify river network in centroids
 MODULE:
   flood
 NAME:
	centroids_river_network
 PURPOSE:
   Add rivers to centroids based on HydroSHEDS river network outline
   shapefiles For more information and a technical documentation see
   http://hydrosheds.org/page/hydrobasins,

 CALLING SEQUENCE:
   centroids = centroids_river_network(river_shapes,centroids, check_plots)
 EXAMPLE:
   centroids = centroids_river_network('',centroids,0)
 INPUTS:
   centroids: Climada centroids struct; the following fields are required:
         .lat:           Latitude
         .lon:           Longitude
         .centroid_ID:   centroid ID
         .admin0_NAME    Country name
 OPTIONAL INPUT PARAMETERS:
   river_shapes:   name (including full path) of the river network shapefile
                   to be used. If set for 'DL', climada will
                   automatically download the relevant files given the
                   spatial extent of the centroids.
   res:            resolution of shape file - the HydroSHEDS files are
                   provided in 15 arcsecond (res==15; default) and 30
                   arcsecond (res==30) resolution.
   check_plots:    whether a plot of the centroids should be generated (=1),
                   or not (=0; default)
 OUTPUTS:
   centroids:      centroids with an additional field 'river' defining the
                   river network as logicals.
 MODIFICATION HISTORY:
   Gilles Stassen, gillesstassen@hotmail.com, 20150318
View <A HREF=file:../../climada_modules/flood/code/under_construction/centroids_river_network.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_90m_DEM">
<H2>climada_90m_DEM</H2></A>
<font color="blue">function [centroids, DEM] = climada_90m_DEM(centroidsORcountryORshapes, srtm_dir, DEM_save_file, smooth, check_plot) </font>
 climada
 MODULE:
   flood
 NAME:
   climada_read_srtm_DEM
 PURPOSE:
   Read the digital elevation model data from the files in an existing
   srtm directory. Data can be downloaded from http://srtm.csi.cgiar.org/SELECTION/inputCoord.asp
 CALLING SEQUENCE:
   [centroids,DEM] = climada_90m_DEM(centroids, srtm_dir, DEM_save_file, smooth, check_plot)
 EXAMPLE:
   [centroids,DEM] = climada_90m_DEM('Netherlands',[],[],[],1)
   [~,DEM] = climada_90m_DEM
   [centroids,DEM] = climada_90m_DEM([min_lon max_lon min_lat max_lat],srtm_dir,DEM_save_file, 4,1)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   centroids:  If centroids are provided as an input, the DEM will contain
               elevation data sampled at the location of centroids, and
               hence will have an extra field .centroid_ID. The extra
               field is required for tc_surge_hazard_create if you wish to
               provide your own topography data (e.g. srtm).
               If this input is left empty , a
               centroids struct will be generated at the same resolution
               as the DEM.
               If set to a 4-element vector (centroids_rect), these 4
               points will define the area of interest, which is
               subsequently cropped out of the DEM.
               NOTE:   It is only sensible to provide a centroids struct
               as input if its resolution is significantly lower than that
               of the DEM, otherwise, it is much faster to generate
               centroids directly from the DEM.
   srtm_dir:   The directory of an srtm data tile folder, containing at
               least a .hdr and a .tif file. Can also be set to 'DL' 
               (default) which will initiate automatic download from SRTM 
               website according to the centroidsORcountry given as input.
   smooth:     Can either be set to an integer N (smooth by default filter
               specified by a matrix size NxN with values 1/N^2) or a
               smoothing filter. Default = [] (no smoothing).
   check plot: Specify whether to plot a relief of the DEM, default = 0
 OUTPUTS:
   DEM:        Struct containing information of the digital elevation
               model at full 90m resolution, with fields:
               .elevation_m:   Elevation data
               .lat:           Latitude
               .lon:           Longitude
               .centroid_ID:   Only if centroids provided as input or if
                               centroids input set to 1.
   centroids:  Climada centroids struct with fields:
               .elevation_m:   Elevation data
               .lat:           Latitude
               .lon:           Longitude
               .centroid_ID:   Only if centroids provided as input or if
                               centroids input set to 1.
               .onLand:        Set to 0 if .elevation_m &amplt0, 1 otherwise
               .admin0_name    Country name
               .admin0_ISO3    ISO 3 country code
 MODIFICATION HISTORY:
 Gilles Stassen 20150107
 Gilles Stassen 20150224     fixed some bugs in the plotting routines
                               and added messages to warn of DEM edges
 Gilles Stassen 20150225     cleanup and added automatic download and
                               unzip feature
 Gilles Stassen 20150707     renamed climada_read_srtm_DEM-&ampgtclimada_90m_DEM
                               usage of climada_grid2array replaced with
                               reshape, some further bug fixes
 Lea Mueller, muellele@gmail.com, 20150720, @Gilles, please correct,
   code does not work, srtm_19_10 is a .tif.aux.xml, not a .tif, probably
   file was not copied from your drive to the shared drive
 Lea Mueller, muellele@gmail.com, 20160229, rename to climada_shapeplotter from shape_plotter
View <A HREF=file:../../climada_modules/flood/code/under_construction/climada_90m_DEM.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_DEM_plot">
<H2>climada_DEM_plot</H2></A>
<font color="blue">function [h,I,z]=climada_DEM_plot(x,y,z,varargin) </font>
DEM Shaded relief image plot

	DEM(X,Y,Z) plots the Digital Elevation Model defined by X and Y 
	coordinate vectors and elevation matrix Z, as a lighted image using
	specific &quotlandcolor&quot and &quotseacolor&quot colormaps. DEM uses IMAGESC 
	function which is much faster than SURFL when dealing with large 
	high-resolution DEM. It produces also high-quality and moderate-size 
	Postscript image adapted for publication.

	[H,I] = DEM(...); returns graphic handle H and illuminated image as I, 
	an MxNx3 matrix (if Z is MxN and DECIM is 1).

	DEM(X,Y,Z,'Param1',Value1,'Param2',Value2,...) specifies options or
	parameter/value couple (case insensitive):


	--- Lighting options ---

	'Azimuth',A
		Light azimuth in degrees clockwise relative to North. Default is
		A = -45 for	a natural northwestern illumination.

	'Contrast',C
		Light contrast, as the exponent of the gradient value:
			C = 1 for linear contrast (default),
			C = 0 to remove lighting,
			C = 0.5 for moderate lighting,
			C = 2 or more for strong contrast.

	'LCut',LC
		Lighting scale saturation cut with a median-style filter in % of 
	    elements, such as LC% of maximum gradient values are ignored:
			LC = 0.2 is default, 
			LC = 0 for full scale gradient.

	'km'
		Stands that X and Y coordinates are in km instead of m (default).
		This allows correct lighting. Ignored if LATLON option is used.


	--- Elevation colorscale options ---

	'ZLim',[ZMIN,ZMAX]
		Fixes min and max elevation values for colormap. Use NaN to keep 
		real min and/or max data values.

	'ZCut',ZC
		Median-style filter to cut extremes values of Z (in % of elements),
		such that ZC% of most min/max elevation values are ignored in the
		colormap application:
			ZC = 0.5 is default, 
			ZC = 0 for full scale.


	--- &quotNo Value&quot elevation options ---

	'NoValue',NOVALUE
		Defines the values that will be replaced by NaN. Note that values 
		equal to minimum of Z class are automatically detected as NaN 
		(e.g., -32768 for int16 class).

	'NaNColor',[R,G,B]
		Sets the RGB color for NaN/NoValue pixels (default is a dark gray).
		Note that your must specify a valid 3-scalar vector (between 0 and
		1);	color characters like 'w' or 'k' are not allowed, use [1,1,1]
		or [0,0,0] instead.

	'Interp'
		Interpolates linearly all NaN values (fills the gaps using linear 
		triangulation), using an optimized algorithm.


	--- Colormap options ---

	'LandColor',LMAP
		Uses LMAP colormap instead of default (landcolor, if exists or 
		jet) for Z &ampgt 0 elevations.

	'SeaColor',SMAP
		Sets the colormap used for Z &amplt= 0 elevations. Default is seacolor 
		(if exists) or single color [0.7,0.9,1] (a light cyan) to simulate
		sea color.

	'ColorMap',CMAP
		Uses CMAP colormap for full range of elevations, instead of default 
		land/sea. This option overwrites LANDCOLOR/SEACOLOR options.

	'Lake'
		Detects automaticaly flat areas different from sea level (non-zero 
		elevations) and colors them as lake surfaces.

	'Watermark',N
		Makes the whole image lighter by a factor of N.


	--- Basemap and scale options ---

	'Legend'
		Adds legends to the right of graph: elevation scale (colorbar)
		and a distance scale (in km).

	'Cartesian'
		Plots classic basemap-style axis, considering coordinates X and Y 
		as cartesian in meters. Use parameter &quotkm' for X/Y in km.

	'LatLon'
		Plots geographic basemap-style axis in deg/min/sec, considering 
		coordinates X as longitude and Y as latitude. Axis aspect ratio 
		will be adjusted to approximatively preserve distances (this is  
		not a real projection!). This overwrites ZRatio option.

	'AxisEqual', 'auto' (default) | 'manual' | 'off'
		When 'Cartesian' or 'LatLon' option is used, automatic axes scaling
		is applied to respect data aspect ratio. Default mode is 'auto' and
		uses AXIS EQUAL and DASPECT functions. The 'manual' mode modifies
		axes width or height with respect to the paper size in order to
		produce correct data scaling at print (but not necessarily at 
		screen). The 'off' mode disables any scaling.

	Additionnal options for basemap CARTESIAN or LATLON:

	'BorderWidth',BW
		Border width of the basemap axis, in % of axis height. Default is
		BW = 1%.

	'XTick',DX
	'YTick',DY
		X and Y Tick length (same unit as X and Y). Default is automatic.
		Tick labels are every 2 ticks.

	'FontSize',FS
		Font size for X and Y tick labels. Default is FS = 10.

	'FontBold'
		Font weight bold for tick labels.


	--- Decimation options ---

	For optimization purpose, DEM will automatically decimate data to limit
	to a total of 1500x1500 pixels images. To avoid this, use following
	options, but be aware that large grids may require huge computer 
	ressources or induce disk swap or memory errors.

	'Decim',N
		Decimates matrix Z at 1/N times of the original sampling.

	'NoDecim'
		Forces full resolution of Z, no decimation.



	--- Informations ---

	Colormaps are Mx3 RGB matrix so it is easy to modify saturation 
	(CMAP.^N), set darker (CMAP/N), lighter (1 - 1/N + CMAP/N), inverse
	it (flipud(CMAP)), etc...

	To get free worldwide topographic data (SRTM), see READHGT function.

	For backward compatibility, the former syntax is still accepted:
	DEM(X,Y,Z,OPT,CMAP,NOVALUE,SEACOLOR) where OPT = [A,C,LC,ZMIN,ZMAX,ZC],
	also option aliases DEC, DMS and SCALE, but there is no argument 
	checking. Please prefer the param/value syntax.

	Author: Franois Beauducel &ampltbeauducel@ipgp.fr&ampgt
	Created: 2007-05-17
	Updated: 2014-06-06
View <A HREF=file:../../climada_modules/flood/code/under_construction/climada_DEM_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_fl_centroids_prepare">
<H2>climada_fl_centroids_prepare</H2></A>
<font color="blue">function centroids = climada_fl_centroids_prepare(centroids, check_plots, force_recalc, save_file) </font>
 Equip centroids with all necessary hydrological information 
 MODULE:
   flood
 NAME:
	climada_fl_centroids_prepare
 PURPOSE:
   Equip centroids with flood scores, wetness indices, basin IDs, 
   evapotranspiration values, soil wetness indices, and values for the 
   available water-holding capacity of the soil, such that the centroids
   then contain all the information needed for the generation of 
   a flood hazard set. 
       In step 1, flood scores and topographic wetness indices are 
       calculated for the given centroids 
       (see function centroids_fl_score_calc for details)
       In step 2, basin IDs are assigned to the centroids (see function
       centroids_basinID_assign for details)
       In step 3, evapotranspiration (ET) is calculated for the centroids
       (see centroids_ET_assign for details)
       In step 4, soil wetness index (SWI) is calculated for the centroids 
       (see centroids_SWI_assign for details)
       In step 5, available water-holding capacity of the soil (WHC) is 
       calculated for the centroids (see centroids_WHC_assign for details)
 CALLING SEQUENCE:
   centroids = fl_centroids_prepare(centroids, res, basin_shapefile,...
       check_plots, force_recalc)
 EXAMPLE:
   centroids = fl_centroids_prepare(centroids,15,'',1)
 INPUTS:
   centroids: Climada centroids struct; the following fields are required:
         .lat:           Latitude
         .lon:           Longitude
         .centroid_ID:   centroid ID
         .admin0_name    Country name
 OPTIONAL INPUT PARAMETERS:
   basin_shapefile: name (including full path) of the basin shapefile to
   be used. If left empty, the code constructs default names corresponding
   to the shapefile names as provided by HydroSHEDS. The basin shapefiles
   need to be located in the data/system folder of the CLIMADA flood
   module. 
   res: resolution of shape file - the HydroSHEDS basin outline files are
   provided in 15 arcsecond (res==15) and 30 arcsecond (res==30; default)
   resolution.
   check_plots: whether a set of plots showing topography (elevation), 
   slope, aspect angle, flood scores and basins should be generated (=1),
   or not (=0; default)
   force_recalc: if set to 1, recalculate flood scores and basin IDs, even
   if they already exist (default is 0)
 OUTPUT:
   centroids: centroids with three additional fields: 
       centroids.flood_score: flow accumulation 
       centroids.topo_wetness_index: topographic wetness index 
       centroids.basin_ID: river basins 
       centroids.evapotranspiration: evapotranspiration (mm/yr)
       centroids.soil_wetness_index: soil wetness index (%)
       centroids.water_holding_capacity: available water-holding capacity
           of the soil (mm)
  
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150311, initial
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150319, added LAI
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150321, added ET
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150324, added FC
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150325, added SWI and WHC;
 Gilles Stassen, gillesstassen@hotmail.com, 20150414, cleanup
 Gilles Stassen, 20150416, added save functionality, added BD, SD
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 Lea Mueller, muellele@gmail.com, 20151125, rename to climada_centroids_TWI_calc from centroids_TWI
View <A HREF=file:../../climada_modules/flood/code/under_construction/climada_fl_centroids_prepare.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_fl_hazard_set">
<H2>climada_fl_hazard_set</H2></A>
<font color="blue">function hazard = climada_fl_hazard_set(centroids,hazard_rf,hazard_set_file, check_plots) </font>
 Generate flood hazard set from tr hazard set
 MODULE:
   flood
 NAME:
   climada_fl_hazard_set
 PURPOSE:
   Generate flood hazard set from tr hazard set by distributing rainfall
   volume according to flood scores (or wetness indices) of the centroids
 PREVIOUS STEP:
   centroids_fl_prepare
 CALLING SEQUENCE:
   hazard = climada_fl_hazard_set(hazard_tr,centroids,hazard_set_file, check_plots)
 EXAMPLE:
   hazard = climada_fl_hazard_set('',centroids,hazard_set_file)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   hazard_tr: a TR hazard event set, or a filename of a saved one
       &ampgt prompted for if not given
   hazard_set_file: the name of the hazard set file
       &ampgt prompted for if not given
   centroids: Climada centroids struct; the following fields are required:
         .lat:           Latitude
         .lon:           Longitude
         .centroid_ID:   centroid ID
         .admin0_name    Country name
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event
       matrix_density: the density of the sparse array hazard.intensity
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150310, initial
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150312, adjustments in rainfall distribution
 Lea Mueller, muellele@gmail.com, 20151125, rename to climada_centroids_TWI_calc from centroids_TWI
View <A HREF=file:../../climada_modules/flood/code/under_construction/climada_fl_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_grid2array">
<H2>climada_grid2array</H2></A>
<font color="blue">function [data, x, y] = climada_grid2array(data_grid, x_vector, y_vector) </font>
 climada
 MODULE:
   flood
 NAME:
   climada_grid2array
 PURPOSE:
   Restructure gridded data into singleton arrays. For consistency with
   imagesc, the first index in data_grid corresponds to the x coords,
   while the second index corresponds to the y coords. Used in
   climada_read_srtm_DEM, read_APHRO_MA_V1101 and climada_rf_hazard_set
 CALLING SEQUENCE:
 EXAMPLE:
 INPUTS:
   data_grid:  Gridded data  
 OPTIONAL INPUT PARAMETERS:
   x_vector:   Monotonically in/decreasing vector defining the x values of
               each of the columns of the data grid. If y_vector is left
               empty, x_vector can also be a vector of size 4, defining
               the corners of the grid as [min(x) max(x) min(y) max(y)]
   y_vector:   Monotonically in/decreasing vector defining the x values of
               each of the rows of the data grid.
 OUTPUTS:
   data:       The original data structured as a singleton array 
   x:          The x data structured as singleton array, same length as data array
   y:          The y data structured as singleton array, same length as data array
 MODIFICATION HISTORY:
 Gilles Stassen 20150107
 Gilles Stassen 20150224 major cleanup
View <A HREF=file:../../climada_modules/flood/code/under_construction/climada_grid2array.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_ls_cell_failure">
<H2>climada_ls_cell_failure</H2></A>
<font color="blue">function factor_of_safety = climada_ls_cell_failure(centroids, soil_moisture,moist_mod,slope_mod) </font>
 compute the factor of safety
 MODULE:
   flood
 NAME:
   climada_ls_cell_failure
 PURPOSE:
   Compute the factor of safety, given an appropriately prepared set of
   centroids and a soil moisture matrix
 PREVIOUS STEP:
   climada_ls_cell_failure
 CALLING SEQUENCE:
   factor_of_safety = climada_ls_cell_failure(centroids,soil_moisture)
 EXAMPLE:
   factor_of_safety = climada_ls_cell_failure(centroids,soil_moisture)
 INPUTS:
   centroids:          centroids with the necessary fields (use
                       climada_fl_centroids_prepare)
   soil_moisutr:       matrix with soil moisture values for each event at
                       each centroid (in mm)
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   factor_of_safety:   a 2d matrix the same size as the soil_moisture
                       input.
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150330 init
 Gilles Stassen, 20150710, soil moisture as 2d matrix with one time dimension
 Gilles Stassen, 20150806, moisture and slope modifiers
View <A HREF=file:../../climada_modules/flood/code/under_construction/climada_ls_cell_failure.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_ls_hazard_set_gilles">
<H2>climada_ls_hazard_set_gilles</H2></A>
<font color="blue">function [hazard, centroidsORhazard] = climada_ls_hazard_set_gilles(hazardORcentroids, hazard_set_file, focus_areas, check_plots, chrono_check, bool_hazard_check) </font>
 Generate ls hazard set from rainfall hazard set
 MODULE:
   flood
 NAME:
   climada_ls_hazard_set
 PURPOSE:
   Generate land slide hazard set from tr hazard set by distributing rainfall
   volume according to wetness indices of the centroids
 PREVIOUS STEP:
   centroids_fl_prepare
 CALLING SEQUENCE:
   hazard = climada_ls_hazard_set(hazard_rf,centroids,hazard_set_file, check_plots)
 EXAMPLE:
   hazard = climada_ls_hazard_set('',centroids,hazard_set_file)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   hazardORcentroids:  a TR hazard event set, or a filename of a saved
                       one. The centroids for the ls hazard set will be
                       constructed from the lat lons.
                    OR a centroids struct, which will also form the basis
                       for the rainfall hazard set.
                       &ampgt prompted for if not given
                       NOTE that for stable performance, centroids should
                       form a regular grid.
   focus_areas:        struct array containing shape files defining focus
                       areas of interest. Useful considering the
                       limitation imposed by the necessity for a regular
                       grid of centroids. Land slides will only be
                       calculated starting at centroids inside the regions
                       defined by these polygons. Can also be the pathname
                       of a .shp or .mat file.
   hazard_set_file: the name of the hazard set file
       &ampgt prompted for if not given
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event
       matrix_density: the density of the sparse array hazard.intensity
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
   centroidsORhazard:  if rainfall hazard set is provided as input arg,
                       then output is the centroids struct which is
                       constructed from this hazard set, and to which
                       topographic parameters have been assigned. If
                       centroids are given as input, then output is the
                       rainfall hazard set which has been calculated for
                       these centroids.
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150330
 Gilles Stassen, 20150708, renamed MS-&ampgtLS, time-dependent soil moisture, linear decay according to ET_mm_day, separate input args combined into hazardORcentroids
 Gilles Stassen, 20150710, factor of safety calculation vectorised over events
 Gilles Stassen, 20150713, focus_areas added as input
 Lea Mueller, muellele@gmail.com, 20150920, workaround if centroids.filename does not exist
 Lea Mueller, muellele@gmail.com, 20151125, rename to climada_centroids_generate from climada_generate_centroids
 Lea Mueller, muellele@gmail.com, 20151125, rename to climada_centroids_TWI_calc from centroids_TWI
 -
View <A HREF=file:../../climada_modules/flood/code/under_construction/climada_ls_hazard_set_gilles.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_ls_multi_layer_plot">
<H2>climada_ls_multi_layer_plot</H2></A>
<font color="blue">function climada_ls_multi_layer_plot(hazard,centroids,susc_check) </font>
 Lea Mueller, muellele@gmail.com, 20151125, rename to climada_centroids_TWI_calc from centroids_TWI
View <A HREF=file:../../climada_modules/flood/code/under_construction/climada_ls_multi_layer_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_rf_hazard_set">
<H2>climada_rf_hazard_set</H2></A>
<font color="blue">function hazard = climada_rf_hazard_set(centroids, precip_file, hazard_set_file,x_fraction, ens_size, ens_amp, check_plots) </font>
 climada RF hazard event set
 NAME:
   climada_RF_hazard_set
 PURPOSE:
   Construct hazard set structure from global historical daily precipitation data
   found here: ftp://ftp.cgd.ucar.edu/archive/PRECIP/GPCP_1DD_v1.2_199610-201407.nc.gz
               http://www.esrl.noaa.gov/psd/data/gridded/data.gpcc.html
   The ens_size probabilistic events are generated by taking the x_fraction most
   extreme events from the original data, and adjusting their intensity.
   The extent of the wiggle is determined by generating a random wiggle
   paramater from a normal distribution with standard deviation ens_amp.
 CALLING SEQUENCE:
   hazard = climada_rf_hazard_set(centroids, precip_file, x_fraction, ens_size, ens_amp, hazard_set_file, check_plots)
 EXAMPLE:
   hazard = climada_rf_hazard_set(centroids, '', 0.2, 9, 0.1, 'NO_SAVE', 1)
   hazard = climada_rf_hazard_set(centroids, '', 0.7, 1)
   hazard = climada_rf_hazard_set
 INPUTS:
   hazard_set_file: the name of the newly created rainfall (RF) hazard
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   x_fraction:     The fraction of most extreme events to take from input.
                   e.g. if x_fraction = 0.05 =&ampgt take 5% most extreme
                   events (default)
   ens_size:       Number of probabilistic events to be generated for each
                   extreme event. Default is set to depend on x_fraction,
                   such that if x_fraction = 0.1, then ens_size = 9, so
                   that the total number of events (historical &amp
                   probabilistic) is the same as number of days of input
                   data.
   ens_amp:        The standard deviation of the normal distribution from
                   which the random &quotwiggle_matrix&quot is constructed. For each
                   event, the wiggle matrix alters the intensity at each
                   centroid point to create the probabilistic events. See
                   help randn.
   check_plots:    Whether to show plots (default = 1)
 OUTPUTS:
   hazard:         a hazard event set, see core climada doc
                   also written to a .mat file (see hazard_set_file)
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150316
 Gilles Stassen, 20150406 overhaul to daily precipitation data, including 
                          auto download functionality, and probabilistic set of extreme events
 Gilles Stassen, 20150627 buffer size 0.5 -&ampgt precip data resolution
View <A HREF=file:../../climada_modules/flood/code/under_construction/climada_rf_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="dem">
<H2>dem</H2></A>
<font color="blue">function [h,I,z]=dem(x,y,z,varargin) </font>
DEM Shaded relief image plot

	DEM(X,Y,Z) plots the Digital Elevation Model defined by X and Y 
	coordinate vectors and elevation matrix Z, as a lighted image using
	specific &quotlandcolor&quot and &quotseacolor&quot colormaps. DEM uses IMAGESC 
	function which is much faster than SURFL when dealing with large 
	high-resolution DEM. It produces also high-quality and moderate-size 
	Postscript image adapted for publication.

	[H,I] = DEM(...); returns graphic handle H and illuminated image as I, 
	an MxNx3 matrix (if Z is MxN and DECIM is 1).

	DEM(X,Y,Z,'Param1',Value1,'Param2',Value2,...) specifies options or
	parameter/value couple (case insensitive):


	--- Lighting options ---

	'Azimuth',A
		Light azimuth in degrees clockwise relative to North. Default is
		A = -45 for	a natural northwestern illumination.

	'Contrast',C
		Light contrast, as the exponent of the gradient value:
			C = 1 for linear contrast (default),
			C = 0 to remove lighting,
			C = 0.5 for moderate lighting,
			C = 2 or more for strong contrast.

	'LCut',LC
		Lighting scale saturation cut with a median-style filter in % of 
	    elements, such as LC% of maximum gradient values are ignored:
			LC = 0.2 is default, 
			LC = 0 for full scale gradient.

	'km'
		Stands that X and Y coordinates are in km instead of m (default).
		This allows correct lighting. Ignored if LATLON option is used.


	--- Elevation colorscale options ---

	'ZLim',[ZMIN,ZMAX]
		Fixes min and max elevation values for colormap. Use NaN to keep 
		real min and/or max data values.

	'ZCut',ZC
		Median-style filter to cut extremes values of Z (in % of elements),
		such that ZC% of most min/max elevation values are ignored in the
		colormap application:
			ZC = 0.5 is default, 
			ZC = 0 for full scale.


	--- &quotNo Value&quot elevation options ---

	'NoValue',NOVALUE
		Defines the values that will be replaced by NaN. Note that values 
		equal to minimum of Z class are automatically detected as NaN 
		(e.g., -32768 for int16 class).

	'NaNColor',[R,G,B]
		Sets the RGB color for NaN/NoValue pixels (default is a dark gray).
		Note that your must specify a valid 3-scalar vector (between 0 and
		1);	color characters like 'w' or 'k' are not allowed, use [1,1,1]
		or [0,0,0] instead.

	'Interp'
		Interpolates linearly all NaN values (fills the gaps using linear 
		triangulation), using an optimized algorithm.


	--- Colormap options ---

	'LandColor',LMAP
		Uses LMAP colormap instead of default (landcolor, if exists or 
		jet) for Z &ampgt 0 elevations.

	'SeaColor',SMAP
		Sets the colormap used for Z &amplt= 0 elevations. Default is seacolor 
		(if exists) or single color [0.7,0.9,1] (a light cyan) to simulate
		sea color.

	'ColorMap',CMAP
		Uses CMAP colormap for full range of elevations, instead of default 
		land/sea. This option overwrites LANDCOLOR/SEACOLOR options.

	'Lake'
		Detects automaticaly flat areas different from sea level (non-zero 
		elevations) and colors them as lake surfaces.

	'Watermark',N
		Makes the whole image lighter by a factor of N.


	--- Basemap and scale options ---

	'Legend'
		Adds legends to the right of graph: elevation scale (colorbar)
		and a distance scale (in km).

	'Cartesian'
		Plots classic basemap-style axis, considering coordinates X and Y 
		as cartesian in meters. Use parameter &quotkm' for X/Y in km.

	'LatLon'
		Plots geographic basemap-style axis in deg/min/sec, considering 
		coordinates X as longitude and Y as latitude. Axis aspect ratio 
		will be adjusted to approximatively preserve distances (this is  
		not a real projection!). This overwrites ZRatio option.

	'AxisEqual', 'auto' (default) | 'manual' | 'off'
		When 'Cartesian' or 'LatLon' option is used, automatic axes scaling
		is applied to respect data aspect ratio. Default mode is 'auto' and
		uses AXIS EQUAL and DASPECT functions. The 'manual' mode modifies
		axes width or height with respect to the paper size in order to
		produce correct data scaling at print (but not necessarily at 
		screen). The 'off' mode disables any scaling.

	Additionnal options for basemap CARTESIAN or LATLON:

	'BorderWidth',BW
		Border width of the basemap axis, in % of axis height. Default is
		BW = 1%.

	'XTick',DX
	'YTick',DY
		X and Y Tick length (same unit as X and Y). Default is automatic.
		Tick labels are every 2 ticks.

	'FontSize',FS
		Font size for X and Y tick labels. Default is FS = 10.

	'FontBold'
		Font weight bold for tick labels.


	--- Decimation options ---

	For optimization purpose, DEM will automatically decimate data to limit
	to a total of 1500x1500 pixels images. To avoid this, use following
	options, but be aware that large grids may require huge computer 
	ressources or induce disk swap or memory errors.

	'Decim',N
		Decimates matrix Z at 1/N times of the original sampling.

	'NoDecim'
		Forces full resolution of Z, no decimation.



	--- Informations ---

	Colormaps are Mx3 RGB matrix so it is easy to modify saturation 
	(CMAP.^N), set darker (CMAP/N), lighter (1 - 1/N + CMAP/N), inverse
	it (flipud(CMAP)), etc...

	To get free worldwide topographic data (SRTM), see READHGT function.

	For backward compatibility, the former syntax is still accepted:
	DEM(X,Y,Z,OPT,CMAP,NOVALUE,SEACOLOR) where OPT = [A,C,LC,ZMIN,ZMAX,ZC],
	also option aliases DEC, DMS and SCALE, but there is no argument 
	checking. Please prefer the param/value syntax.

	Author: Franois Beauducel &ampltbeauducel@ipgp.fr&ampgt
	Created: 2007-05-17
	Updated: 2014-06-06
View <A HREF=file:../../climada_modules/flood/code/under_construction/dem.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fl_Climada_Aqueduct_compare">
<H2>fl_Climada_Aqueduct_compare</H2></A>
<font color="blue">function fl_Climada_Aqueduct_compare(country_risk,report_filename) </font>
 Compare flood damages with target model 
 MODULE:
   flood
 NAME:
   fl_Climada_Aqueduct_compare
 PURPOSE:
   Compare flood damages calculated by Climada to the flood damage 
   estimates of the Aqueduct Global Flood Analyzer developed by the World 
   Resources Insitute (WRI), which can be accessed here:
       http://www.wri.org/resources/maps/aqueduct-global-flood-analyzer
 PREREQUISITES:
   Country data from the Aqueduct flood tool needs to be downloaded from 
   here: 
   http://www.wri.org/resources/data-sets/aqueduct-global-flood-risk-maps
   (Click on the yellow button reading &quot3 DOWNLOADS&quot, select &quotData by 
   Country&quot and place the unzipped files in
       climada_module_flood/data/system)
 PREVIOUS STEP:
   Generate a &quotcountry flood risk&quot struct that collects all the flood 
   damage data for a list of countries. You can create such a struct 
   using the script fl_countryrisk_generate
 CALLING SEQUENCE:
   fl_Climada_Aqueduct_compare(fl_country_risk,report_filename)
 EXAMPLE:
   fl_Climada_Aqueduct_compare(fl_country_risk);
 INPUTS:
   fl_country_risk: a structure with the results from 
   fl_countryrisk_generate
 OPTIONAL INPUT PARAMETERS:
   report_filename: the filename of the Excel file the comparison is 
       written to. Prompted for if not given 
 OUTPUTS: writes an excel sheet
 NOTE: This function will probably just serve for developing purposes,
   i.e. to get a guideline for the calibration of flood damages and/or
   intensities. Hence the function might be removed from the repositories
   once it has fulfilled its purpose.
 MODIFICATION HISTORY:
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150326, initial
View <A HREF=file:../../climada_modules/flood/code/under_construction/fl_Climada_Aqueduct_compare.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="fl_hazard_plot_hr">
<H2>fl_hazard_plot_hr</H2></A>
<font color="blue">function fig = climada_hazard_plot_hr(hazard,event_i,label,caxis_range,plot_centroids,hist_check) </font>
 climada plot single hazard event footprint
 NAME:
   climada_hazard_plot_hr
 PURPOSE:
   plot hazard event as high resolution contour on a map, works for all perils

   See also the low-resolution version climada_hazard_plot
 CALLING SEQUENCE:
   climada_hazard_plot_hr(hazard,event_i,label,caxis_range,plot_centroids,hist_check)
 EXAMPLE:
   climada_hazard_plot_hr(hazard,1); % plot first event
   climada_hazard_plot_hr; % prompt for hazard event set, plot largest event
 INPUTS:
   hazard: hazard structure
       &ampgt prompted for if empty
   event_i: the i-th event in the hazard event set to be displayed
       if event_i=0, the maximum intensity at each centroid is shown
       if event_i=-i, the i-th 'largest' event (sum of intensities) is shown
           e.g. for event_i=-2, the second largest event is shown
       default=-1 (just to get something on the screen ;-)
 OPTIONAL INPUT PARAMETERS:
   label: a struct with a label to add on the plot (i.e. a place)
       longitude: the longitude (decimal)
       latitude: the latitude (decimal)
       name: the label itself, like 'gaga'
   caxis_range: [minval maxval], the range of the color axis, e.g. [20 40]
       to show colors for values brtween 20 and 40
   plot_centroids: =1, plot centroids, =0 no (default)
   hist_check: if =1, plot historic events only, =0 all (default)
 OUTPUTS:
   creates a figure and returns figure handle
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150206
 David N. Bresch, david.bresch@gmail.com, 20150313, synchronized with climada_hazard_plot
View <A HREF=file:../../climada_modules/flood/code/under_construction/fl_hazard_plot_hr.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="flood_countryrisk_generate">
<H2>flood_countryrisk_generate</H2></A>
 script go generade &quotcountry flood risks&quot
 How to use: Specify the countries you want to calculate the flood risks 
 for in &quotcountry_list&quot (in the PARAMETERS section just below). 
 The script will then calculate a struct &quotfl_country_risk&quot that contains 
 the flood risk for all these countries and can be given as an input to
 the function fl_Climada_Aqueduct_compare, which will write an excel
 spreadsheet that compares the flood damages for given return
 periods calculated by CLIMADA to the corresponding estimates by the
 Aqueduct Global Flood Analyzer (see fl_Climada_Aqueduct_compare for
 details)
 NOTE: This is a very stupid script that just assumes that all the 
 entities and centroids needed in the calculation are present in their
 respective default folders; no error checking is done!
 Modification history: 
 Melanie Bieli, melanie.bieli@bluewin.ch, 20150331, initial
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
View <A HREF=file:../../climada_modules/flood/code/under_construction/flood_countryrisk_generate.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="flood_damagefunction_entity_add">
<H2>flood_damagefunction_entity_add</H2></A>
 This script just replaces the damagefunctions of entities with the
 damagefunctions read from an entity template file. 
 In particular, it can be used to equip entities with the newly defined
 flood damagefunction in climada_module_flood\data\entity_template.xlsx
View <A HREF=file:../../climada_modules/flood/code/under_construction/flood_damagefunction_entity_add.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="landcolor">
<H2>landcolor</H2></A>
<font color="blue">function y = landcolor(n) </font>
LANDCOLOR Land colormap

	Author: Francois Beauducel &ampltbeauducel@ipgp.fr&ampgt
	$Revision: 1.0.0 $   $Date: 2012/05/17 11:22:44 $
View <A HREF=file:../../climada_modules/flood/code/under_construction/landcolor.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="seacolor">
<H2>seacolor</H2></A>
<font color="blue">function y = seacolor(n) </font>
SEACOLOR Sea colormap adapted from NGDC ETOPO1

	Author: Francois Beauducel &ampltbeauducel@ipgp.fr&ampgt
View <A HREF=file:../../climada_modules/flood/code/under_construction/seacolor.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="structfind">
<H2>structfind</H2></A>
<font color="blue">function index=structfind(a,field,value) </font>
 StructFind, Find the index of a certain string or value in a struct

       index=structfind(a,field,value)

  inputs,
       a : A Matlab struct, for example a(1).name='red', a(2).name='blue';
       field : The name of the field which is searched, for example 'name'
       value : The search value, for example 'blue'

  outputs,
       index : The Struct index which match the search

 Function is written by D.Kroon University of Twente (December 2010)
View <A HREF=file:../../climada_modules/flood/code/under_construction/structfind.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="helper_advanced_windfield_global">
<H2>helper_advanced_windfield_global</H2></A>
<font color="blue">function [vfull,pcen,vmax]=helper_advanced_windfield_global(msize,res,cgps,ngps,penv,pcen,rmax,vmax,tint,prepcen,model) </font>
 TC windfield calculation
 NAME:
   isimip_windfield_holland
 PURPOSE:
   function to determine advanced winfdield
   --&ampgt see isimip_windfield_holland

   given a TC track (lat/lon,CentralPressure,MaxSustainedWind), calculate
   the wind field at locations (=centroids)

   Matlab version of helper_advanced_windfield_global.py

   so far adapted to windfield by holland1980, holland2008, holland2010 cf peduzzi2012
   can be easily expanded to different wind-fields eg chavez2015

 CALLING SEQUENCE:
   [vfull,pcen,vmax]=isimip_windfield_holland(msize,res,cgps,ngps,penv,pcen,rmax,vmax,tint,prepcen,model)
 EXAMPLE:
   [vfull,pcen,vmax]=isimip_windfield_holland(10,1,[0 20],[0 21],1000,980,10,45,6,985,'H80')

     vfull =
            Inf       Inf       Inf       Inf  183.5299       Inf       Inf       Inf       Inf       Inf
            Inf       Inf       Inf       Inf  187.1617       Inf       Inf       Inf       Inf       Inf
            Inf       Inf       Inf       Inf  193.1919       Inf       Inf       Inf       Inf       Inf
            Inf       Inf       Inf       Inf  204.2339       Inf       Inf       Inf       Inf       Inf
            NaN       NaN       NaN       NaN       NaN       NaN       NaN       NaN       NaN       NaN
            Inf       Inf       Inf       Inf  204.1294       Inf       Inf       Inf       Inf       Inf
            Inf       Inf       Inf       Inf  193.1058       Inf       Inf       Inf       Inf       Inf
            Inf       Inf       Inf       Inf  187.1210       Inf       Inf       Inf       Inf       Inf
            Inf       Inf       Inf       Inf  183.5276       Inf       Inf       Inf       Inf       Inf
            Inf       Inf       Inf       Inf  181.1875       Inf       Inf       Inf       Inf       Inf
 INPUTS:
   msize=masksize in gridpoints, squared shape assumed
   res=resolution in degrees, regular grid assumed
   cgps=coordinate of grid center cgps=(xc,yc)
   ngps = next gps, consecutive track point
   penv= pressure around cyclone ie pressure at outermost closed isobar
   pcen= central pressure in cyclone
   rmax= radius of maximum winds
   vmax= max observed wind in knots
   tint= time interval between grid points
   prepcen= previous time step central pressure in cyclone
   static windfield model to choose
   H80 = holland1980 including gradient wind
   H08 = holland2008 as H80 but with bs instead of b
   H10 = holland2010 as H08 so far (x_exp=0.5) but no gradient wind included!
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Tobias Geiger, geiger@pik-potsdam.de, 2016, Copyright
 David N. Bresch, david.bresch@gmail.com, 20161203, python to matlab
View <A HREF=file:../../climada_modules/isimip/code/helper_advanced_windfield_global.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_NatID_RegID">
<H2>isimip_NatID_RegID</H2></A>
<font color="blue">function NatID_RegID=isimip_NatID_RegID(ISO3_code,isimip_NatID) </font>
 climada template
 MODULE:
   isimip
 NAME:
   isimip_NatID_RegID
 PURPOSE:
   return the isimip standard list of ISO3 country codes and the isimip
   internal country number (NatID) as well as the isimip regions for
   different purposes. 

   Programmer's note: replaces isimip_ISO3_list

 CALLING SEQUENCE:
   ISO3_list=isimip_NatID_RegID(ISO3_code,isimip_NatID)
 EXAMPLE:
   ISO3_list=isimip_NatID_RegID; % return whole list
   NatID_RegID_DEU=isimip_NatID_RegID('DEU'); % entries for DEU
   NatID_RegID_USA_DEU=isimip_NatID_RegID('',[217 52]); % return entries for NatID 52
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   ISO3_code: ISO3 country code(s)
   isimip_NatID: isimip internal country number(s), so-called NatID
       if you provide a vector, such as [217 52], get a strcuture with all
       cuntries that matched (in this example USA and DEU).
 OUTPUTS:
   NatID_RegID: a strcuture with fields
       ISO3{i}: the ISO3 country code for counry i
       NatID(i): the isimip NatID code for counry i
       TCRegID(i): the isimip region ID for TC
       TCRegName{i}: the isimip name for the TC region
   future: further regions, such as FLRegID, FLRegName (for flood), just
       add the columns in the .xlsx file, the code automatically reads all
       columns.
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170224, initial, replaces isimip_ISO3_list
View <A HREF=file:../../climada_modules/isimip/code/isimip_NatID_RegID.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_YDS_calc">
<H2>isimip_YDS_calc</H2></A>
<font color="blue">function [YDS,EDS,stats]=isimip_YDS_calc(entity,hazard,params) </font>
 climada isimip YDS EDS calc
 MODULE:
   isimip
 NAME:
   isimip_YDS_calc
 PURPOSE:
   calculate year damage set (YDS) for isimip assets and hazards

   for each year where there are assets, find the corresponding events and
   calculate the event damage set (EDS) for this particular year, then
   store the year damage set (YDS, i.e. summed over events within given year).

   If the entity does contain more than one (isimip) country, creates one
   EDS and YDS for each country separately (based upon entity.assets.NatID).

   Set climada_global.damage_at_centroid=1 to run many countries fast, but
   set climada_global.damage_at_centroid=0 if memory problems arise
   (slower, but mch less memory intense).

   previous call: isimip_gdp_entity and e.g. isimip_flood_load
   next call: isimip_YDS_table
 CALLING SEQUENCE:
   [YDS,EDS,stats]=isimip_YDS_calc(entity,hazard,params)
 EXAMPLE:
   one country:
   entity=isimip_gdp_entity('DEU') % create single country entity
   entity=climada_entity_load('DEU_entity') % load DEU entity
   hazard=isimip_flood_load('global_FL.nc','auto',entity,0); % create DEU FL hazard set
   [YDS,EDS,stats]=isimip_YDS_calc(entity,hazard);

   entity=isimip_gdp_entity('USA') % create single country entity
   entity=climada_entity_load('USA_entity') % load entity
   hazard=isimip_flood_load('global_FL.nc','auto',entity,0); % create USA FL hazard set
   [YDS,EDS,stats]=isimip_YDS_calc(entity,hazard);

   entity=isimip_gdp_entity('USA') % create single country entity
   entity=climada_entity_load('USA_entity') % load entity
   hazard=climada_hazard_load('GLB_glb_TC'); % see isimip_tc_hazard_set
   [YDS,EDS,stats]=isimip_YDS_calc(entity,hazard);

   entity=isimip_gdp_entity({'PRI','DOM','BRB','CUB'}) % create single country entity
   entity=climada_entity_load('BRBCUBDOMPRI') % load entity
   hazard=climada_hazard_load('GLB_0360as_TC'); % see isimip_tc_hazard_set
   [YDS,EDS,stats]=isimip_YDS_calc(entity,hazard);

   list of countries:
   entity=isimip_gdp_entity({'DEU','ITA','FRA'}) % create entity for DEU ITA and FRA
   entity=climada_entity_load('DEUITAFRA_entity') % load DEU entity
   hazard=isimip_flood_load('global_FL.nc','auto',entity,0); % create DEU FL hazard set
   [YDS,EDS,stats]=isimip_YDS_calc(entity,hazard);
 INPUTS:
   entity: an isimip entity (i.e. an entity with entity.assets.Values for
       many years). Needs to contain the following additional a fields:
       (a so-called isimip entity has that, e.g. if created by isimip_gdp_entity) 
       entity.assets.NatID(centroid_i): to link each centroid to one country  
       entity.assets.Values(year_i,centroid_i): the assets for year_i
       entity.assets.Value_yyyy(year_i): the year assets are valid for
       If ='params', return all default parameters in YDS, params=isimip_YDS_calc('params')
   hazard: a hazard event set (either a regular one or an isimip special
       one)
 OPTIONAL INPUT PARAMETERS:
   params: a structure with fields:
    check_plot: if=1, plot exected damage at each centroid for each country
       separately. Default=0 (no plot)
    markersize: the marker size for the check plot, default=3
    damage_function_regions_file: the filename (with path) where the damage
       functions regions (groups of countries) are defined. A .csv file
       with columns ISO (3-char), ID (int), Reg_ID (int) and Reg_name (3-char)
 OUTPUTS:
   YDS: the year damage set (YDS), see e.g. climada_EDS2YDS for details
    PLUS the fields
       YDS.lon and YDS.lat lat/lon for ED_at_centroid (if YDS has more than
           one element)
       NOTE: to plot the expected damage at each centroid for YDS i, use e.g.
       a.assets.lon=YDS(i).lon;a.assets.lat=YDS(i).lat;
       a.assets.Value=YDS(i).ED_at_centroid';climada_entity_plot(a);
       title(YDS(i).comment)
   EDS(country_i): the event damage set (EDS) for country i
   stats: some statistics (i.e. entity and hazard year matches etc.)
       entity_yyyy: the years as in the entity (all)
       hazard_yyyy: the years there has been a matching hazard (=NaN no
           hazard for a particular corresponding year in entity_yyyy)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161120, initial
 David N. Bresch, david.bresch@gmail.com, 20170107, damage_at_centroid
 David N. Bresch, david.bresch@gmail.com, 20170216, EDS(country_i) returned
 David N. Bresch, david.bresch@gmail.com, 20170217, simplified
View <A HREF=file:../../climada_modules/isimip/code/isimip_YDS_calc.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_damage_read">
<H2>isimip_damage_read</H2></A>
<font color="blue">function damage_data=isimip_damage_read(damage_data_file,price_deflator_file,hazard_ID_no,check_plot) </font>
 climada template
 MODULE:
   isimip
 NAME:
   isimip_damage_read
 PURPOSE:
   read isimip reported damage records (from .xlsx)

   Note: use and adapt this code to read other damage data

   previous call: -
   next call: isimip_tc_calibrate
 CALLING SEQUENCE:
   damage_data=isimip_damage_read(damage_data_file,price_deflator_file,hazard_ID_no,check_plot)
 EXAMPLE:
   damage_data=isimip_damage_read; % read default isimip damage table
   damage_data_file='matching_Natcat-damages_ibtracs_1980-2014.csv';
   price_deflator_file='GDP_deflator_converted_base2005_1969-2016_source_BEA.csv';
   hazard=climada_hazard_load('GLB_0360as_TC_hist')
   damage_data=isimip_damage_read(damage_data_file,price_deflator_file,hazard.ID_no);
 INPUTS:
   damage_data_file: file with damage data, needs to have some fields, see
       documentation. Path added, if not provided
   price_deflator_file: file to deflate/inflate historic damage data
       Needs to have some fields, see documentation. Path added, if not provided
 OPTIONAL INPUT PARAMETERS:
   hazard_ID_no(event_i): the ID_no for event i, we match reported damage
       and events according to this ID_no and only return matched records.
   check_plot_ if=1, plot raw and inflated damages (default=0).
 OUTPUTS:
   damage_data: the output, a struct, empty if not successful, key fields are:
       damage(i): damage for record i
       year(i): year of record i
       hazard_index(i): index into hazard.*(hazard_index(i)), if
           hazard_ID_no has been provided, otherwise not returned
      optional (in decreasing order of importance):
       ISO{i}: ISO3 country code of record i
       ID_no(i): ibtracs ID no, 1950166N14262 converted to 1950166114262
           (just converted to integer, after N-&ampgt1, S-&ampgt0)
       damage_ins(i): insured damage record i
       NatID(i): isimip NatID
       inflator_factor(i): de/inflation factor applied to record i
       RegID(i): region ID for record i
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170305, initial
 David N. Bresch, david.bresch@gmail.com, 20170314, new damage file format adopted
 David N. Bresch, david.bresch@gmail.com, 20170315, switched to damage.damage to be fully consistent with climada
 David N. Bresch, david.bresch@gmail.com, 20170320, ID_no as integer
View <A HREF=file:../../climada_modules/isimip/code/isimip_damage_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_flood_load">
<H2>isimip_flood_load</H2></A>
<font color="blue">function hazard=isimip_flood_load(flood_filename,hazard_filename,entity,check_plot) </font>
 climada isimip flood
 MODULE:
   isimip
 NAME:
   isimip_flood_load
 PURPOSE:
   load .mat file with flood footprints and construct a climada flood
   hazard event set

   flood data reference: sven.willner@pik-potsdam.de

   Sepcial: since flood footrpints are 'tiny', i.e. should not be
   displayed using interpolation between far distand grid points, this
   code does check for entity.assets.isgridpoint and only assigns flood
   depth and fraction values to 'real' asset centroids, not to the grid
   'around' (see code)  

   Octave: please install the netCDF package first: 
   pkg install -forge netcdf -local -auto
   or: pkg install -verbose -forge -auto netcdf

   next call: climada_EDS_calc
 CALLING SEQUENCE:
   hazard=isimip_flood_load(flood_filename,hazard_filename,entity,check_plot)
 EXAMPLE:
   entity=climada_entity_load('USA_UnitedStates_Florida');
   hazard=isimip_flood_load('USA_UnitedStates_Florida_FL.nc','auto',entity);
   hazard=isimip_flood_load('global_FL.nc','auto',entity);
 INPUTS:
   flood_filename: filename of the .nc file with the flood
       footprints, default folder is ..climada_data/isimip/FL
       &ampgt promted for if not given
       fraction (variable name 'fldfrc') is in the range 0..1
       depth (variable name 'flddph') in units of meters [m]
   hazard_filename: the filename (with or without path) the generated
       hazard set is stored to. If='auto', the name is autmatically
       generated, by appendign _FL to the entity name (still stored into
       ../hazards folder)
   entity: an entity struct to interpolate the flood footprints to, see
       climada_entity_load and climada_entity_read for a description
 OPTIONAL INPUT PARAMETERS:
   check_plot: whether show a check plot (=1, default), or not (=0)
       Note that plotting might often take longer than the full
       conversion...
       if =2, also show the centroids as red dots
       if =3, also show the original data grid as blue dots (might take time...)
 OUTPUTS:
   hazard: a climada hazard structure, see manual
       in addition to the standard hazard.intensity, this hazard also
       contains hazard.fraction, the flooded fraction of the area the
       centroid represents. See special case in climada_EDS_calc, too.
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160929, initial
 David N. Bresch, david.bresch@gmail.com, 20160930, generalized, hazard.fraction added
 Sven Willner, sven.willner@pik-potsdam.de, 20160930, reduced to one flood file
 David N. Bresch, david.bresch@gmail.com, 20161002, small fix to print netCDF filename in stdout
 David N. Bresch, david.bresch@gmail.com, 20170705, climada_global.save_file_version
View <A HREF=file:../../climada_modules/isimip/code/isimip_flood_load.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_gdp_entity">
<H2>isimip_gdp_entity</H2></A>
<font color="blue">function [entity,params]=isimip_gdp_entity(ISO3,params) </font>
 climada isimip entity population gdp
 MODULE:
   isimip
 NAME:
   isimip_gdp_entity
 PURPOSE:
   create the entity based on isimip GDP (and add population data).

   Reads the GDP grid (per time, usually once per year) from
   val_filename, multiplies with the conversion_factor (per gridcell)
   from con_filename and stores into climada
   entity.assets.Values(i,j) for year i and centroid j. The code maps to
   the GLOBAL centroids, such that one can generate one (global) hazard
   set and all single/multi country entities run properly (see
   entity.assets.centroid_index on otuput below).

   If the matching population netCDF file exists (pop_filename), the variable
   entity.assets.Population(i,j) contains the populaiton (number of people
   per centroid) for year i and centroid j.  Note that year i matches with
   year i of entity.assets.Values, i.e. Population is only stored for
   years with Values.

   Please be PATIENT the first time you run this code, as it generates the
   global reference grid, where calculation of distance to coast for all
   land points does take (substantial) time. See PARAMETERS to switch
   distance_to_coast off. In the first run, it also saves a centroids
   file, in case more than 4 mio centroids, it also saves a reduced
   verison (see code for details).

   single/multi country mode (e.g. ISO3='DEU', ISO3={'DEU','FRA'}):
    Checks the country ID(s) (NatID) on NatID_filename and takes all gridcells
    within the requested country(s). If the resolution of the NatID does not
    match the population data or if there is no NatID_filename provided,
    the code uses the climada country shape files to select the gridcells
    within the country(s) (the code notifies to stdout).

   all country mode (ISO3='ALL_IN_ONE'):
    same as for single country, but create one global entity with
    additional fields as described in OUTPUTS below.

   Octave: please install the netCDF package first:
    pkg install -forge netcdf -local -auto
    or: pkg install -verbose -forge -auto netcdf

   next call: isimip...
 CALLING SEQUENCE:
   entity=isimip_gdp_entity(ISO3,params)
 EXAMPLE:
   entity=isimip_gdp_entity('DEU') % single country entity
   entity=isimip_gdp_entity({'DEU','FRA','ITA'}) % multi country entity
   entity=isimip_gdp_entity('ALL_IN_ONE') % one global entity
   params=isimip_gdp_entity('params') % get default parameters
   % to check population for year 2030:
   params.plot_population=1;params.year=2030;climada_entity_plot(entity,2,params)

   % store the hazard also into the entity for special isimip use
   params.hazard_file='GLB_0360as_TC_hist';
   entity=isimip_gdp_entity('BRB',params)
 INPUTS:
 INPUTS:
   ISO3: the ISO3 country code, e.g. 'DEU' or 'FRA' or {'DEU','FRA'} to
       combine two countries in one entity (the entity still knows which
       centroids belong to which country, see entity.assets.NatID)
       if ='all': process all countries (be careful, test a few first),
           create one single entity for each country (takes time and memory,
           hence see also nexst option).
       if ='ALL_IN_ONE', one entity with all countries is created
           This is a bit a special case, as the entity is mainly to be
           used within the ismip context.
       &ampgt promted for (to select from a list, also multiple) if not given
       if ='params', just return default parameters, in entity, i.e. the
           first output, already.
 OPTIONAL INPUT PARAMETERS:
   params: a structure with fields (see also ISO3='params' above):
    val_filename: filename of the .nc file with the (annual) GDP values
       ='0360as': use 0.1 degree default file (default, set in PARAMETERS)
       ='0150as': use 2.5 minutes default file (set in PARAMETERS)
       If only a filename (without path) is passed, isimip_data_dir (set
       in PARAMETERS) is prepended
    pop_filename: filename of the .nc file with the population values
       if not existing, population is not written into the entity. Same
       conventions as for val_filename apply
    pop2_filename: filename of the .nc file with the second set of
       population values. if not existing, population is not written into
       the entity. Same conventions as for pop_filename apply.
    con_filename: filename of the .nc file with the conversion
       factor from either GDP or population to assets (per gridpoint)
       if val_filename is one of the short names, con_filename is
       set to the corresponding file, if empty on input. Default set in
       PARAMETERS. If only a filename (without path) is passed,
       isimip_data_dir (set in PARAMETERS) is prepended.
    NatID_filename: filename of the .nc file with the national grid IDs (to
       assign grid cells to countries). Default set in PARAMETERS
       if val_filename is one of the short names, NatID_filename is
       set to the corresponding file, if empty on input
       To avoid using NatID and just use the grid cells within a country
       shape, set NatID_filename='ignore', but if ISO3='ALL_IN_ONE', NatID
       is needed, hence ='ignore' does not work.
       If only a filename (without path) is passed, isimip_data_dir (set
       in PARAMETERS) is prepended .
    check_plot: whether show a check plot (=1, default), or not (=0)
    distance_to_coast: whether we calculate distant to coast (in km) of
       call centroids (default=1), which speeds up later climada calculations
       substantially (as coastal hazards need not to be evaluated at
       inner-continental points). Set =0 in special cases, as initial
       calculation might easily take 1h (we're talking about millions of
       centroids... but since climada_distance2coast_km listens to
       climada_global.parfor, set climada_global.parfor=1 for speedup).
    hazard_file: if the name of a valid hazard event set, join the hazard
       intensity as field entity.hazard.intensity(event_i,centroids) and
       the field entity.hazard.yyyy(event_i) to contain the year of the
       event_i. Since we use climada_hazard_load, hazard_file does neither
       need to contain the path nor the .mat extension, e.g.
       ='GLB_0360as_TC_hist' is ok.
    hazard_match: if=1, match assets (population) and (historic) hazard, 
       i.e. only keep data for years we have all three. Default=1 (keeps 
       size manageable)
    currency_unit: default=1, can be eg 1e6 or 1e9, in which case all
       Values are divided by this unit before storing to the file, to store
       hence millions or billions. Adds the field entity.assets.currency_unit  
       Note that other units than one on input (e.g. on the netCDF files)
       are first converted to units of one, then currency_unit gets
       applied.
 OUTPUTS:
   entity: a climada entity structure, see climada_entity_read for a full
       description of all fields
   PLUS the fields
       entity.assets.Values(n_times,n_centroids) with the assets as in the
           variable as on the gdp file for each timestep at each centroid.
           These values are scaled by conversion_factor, see description.
       entity.assets.Values_yyyy: the year the Values(i,:) are valid for
       entity.assets.Population(n_times,n_centroids) with the population
           as in the pop file for each timestep at each centroid.
       entity.assets.Population2(n_times,n_centroids) with the population
           as on the second  pop file for each timestep at each centroid.
       entity.assets.NatID: the isimip country number for each centroid
       entity.assets.ISO3_list: the list linking isimip country numbers
           in ISO3_list(:,2) with ISO names in ISO3_list(:,1)
       entity.assets.centroid_index: is already pointing to the
           correct centroids in the corresponding global centroids file
           (as retunred in params.centroid_file), but the hazard is not
           set yet (instead of re-encoding, just define
           entity.assets.hazard yourself).
       entity.hazard: the hazard set just for the centroids as in assets

   for direct isimip usage, you might mainly consider the fields
       note that we have assets at centroids for each year, hazard events within years
       entity.assets.lon(centroid_i): the longitude of each centroid
       entity.assets.lat(centroid_i): the latitude of each centroid
       entity.assets.Values(year_i,centroid_i): asset value for year_i at centroid_i
       entity.assets.Values_yyyy(year_i): the years
       entity.assets.Population(year_i,centroid_i): population for year_i at centroid_i
       entity.hazard.intensity(event_i,centroid_i): the hazard intensity for event_i at centroid_i
       entity.hazard.yyyy(event_i): the year of event_i, e.g.
           pos=find(entity.hazard.yyyy==entity.assets.Values_yyyy(1)) gives all events in first year of assets
       entity.hazard.name{event_i}: the ibtracsID (such as 1950058S20114)
       entity.hazard.ID_no(event_i): ibtracsID as number, such as 1971275N10176 -&ampgt 1971275.10176

 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161017, initial
 David N. Bresch, david.bresch@gmail.com, 20161120, ALL_IN_ONE added
 David N. Bresch, david.bresch@gmail.com, 20161121, list of ISO3 allowed
 David N. Bresch, david.bresch@gmail.com, 20161123, checked for 2.5min
 David N. Bresch, david.bresch@gmail.com, 20170205, renamed to isimip_gdp_entity, overhaul, con_factor, params
 David N. Bresch, david.bresch@gmail.com, 20170209, 0150as files updated
 David N. Bresch, david.bresch@gmail.com, 20170215, ISO3 sorted, if a list
 David N. Bresch, david.bresch@gmail.com, 20170217, pop_filename, hazard_file
 David N. Bresch, david.bresch@gmail.com, 20170224, isimip_NatID_RegID instead of isimip_ISO3_list
 David N. Bresch, david.bresch@gmail.com, 20170225, filename does contain resolution, such as 0360as
 David N. Bresch, david.bresch@gmail.com, 20170304, pop2_* added
 David N. Bresch, david.bresch@gmail.com, 20170320, hazard.ID_no as integer
 David N. Bresch, david.bresch@gmail.com, 20170705, climada_global.save_file_version instead of hard-wired HDF5
 David N. Bresch, david.bresch@gmail.com, 20170706, currency_unit, gdp_1860-2100_0360as_yearly.nc and time_val_yyyy starting 1860
View <A HREF=file:../../climada_modules/isimip/code/isimip_gdp_entity.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_haversine">
<H2>isimip_haversine</H2></A>
<font color="blue">function dist_km=isimip_haversine(lon1,lat1,lon2,lat2,avoid_zero_km) </font>
 climada isimip haversine
 MODULE:
   isimip
 NAME:
   climada_template
 PURPOSE:
   Calculate the great circle distance between two points
   on the earth (specified in decimal degrees)

   See also climada_nonspheric_distance_m (the present code just to be
   100% in line with other isimip code)

 CALLING SEQUENCE:
   dist_km=isimip_haversine(lon1,lat1,lon2,lat2)
 EXAMPLE:
   dist_km=isimip_haversine(lon1,lat1,lon2,lat2)
 INPUTS:
   lon1,lat1: point 1 (or vector of points)
   lon2,lat2: point 2 (always one point, if *1 are vectors, the function
       returns the distances to point 2)
 OPTIONAL INPUT PARAMETERS:
   avoid_zero_km: avoid exact zeros, set them to the value of
       avoid_zero_km, usualy =0.001 (for 1 meter) to avoid division by zero
       if normalized by distance 
 OUTPUTS:
   dist_km: distance in km
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161204
 David N. Bresch, david.bresch@gmail.com, 20161224, div by zero avoided
View <A HREF=file:../../climada_modules/isimip/code/isimip_haversine.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_ibtracs_load">
<H2>isimip_ibtracs_load</H2></A>
<font color="blue">function [tc_track,save_file]=isimip_ibtracs_load(basin_name) </font>
 climada isimip ibtracs load tc
 MODULE:
   isimip
 NAME:
   isimip_ibtracs_load
 PURPOSE:
   load isimip ibtracs tropical cyclone (TC) track data
   Either a single track or all tracks within a folder

   A simple code to load tc_track structure of the repsective basin into
   memory, see isimip_ibtracs_read for details.

   next call: isimip_tc_hazard_set
 CALLING SEQUENCE:
   tc_track=isimip_ibtracs_load(basin_name)
 EXAMPLE:
   tc_track=isimip_ibtracs_load('NA'); % all North Atlantic tracks
   climada_tc_track_info(tc_track,1); % check plot   
 INPUTS:
   basin_name: the ocean basin name, such as 'EP', 'NA', 'NI', 'SA', 'SI',
       'SP', 'WP'. If the .mat file ibtracs.mat does not yet exists,
       tc_track=isimip_ibtracs_read(basin_name) is called
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   tc_track: a climada TC track structure, see e.g. climada_tc_read_unisys_database
       plus the fields RadiusMaxWind, EnvironmentalPressure
   save_file: the file (with path) where the tc_track structure has been
       saved to and read from
 David N. Bresch, david.bresch@gmail.com, 20161226, intial
View <A HREF=file:../../climada_modules/isimip/code/isimip_ibtracs_load.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_ibtracs_read">
<H2>isimip_ibtracs_read</H2></A>
<font color="blue">function [tc_track,save_file]=isimip_ibtracs_read(csv_filename,delimiter,save_flag,quality_check) </font>
 climada isimip ibtracs read tc
 MODULE:
   isimip
 NAME:
   isimip_ibtracs_read
 PURPOSE:
   read isimip ibtracs tropical cyclone (TC) track data
   Either a single track or all tracks within a folder

   The code basically assumes single .csv files to be stored in
   {climada_global.data_dir}/isimip/ibtracs/*.csv
   where climada_global.data_dir is the local users climada data dir

   If a whoe folder is processed, tracks with less than 3 nodes are
   skipped. For the whole dataset, we obtained:
   5720 tracks, 5689 ok, 31 not ok (less than 3 nodes, skipped)
   after quality check, we end up with 5686 (three rejected due to too
   fast movement, &ampgt10 degree in 6h)

   For the original data, see https://www.ncdc.noaa.gov/ibtracs/ 

   next call: climada_tc_track_info % to check
              isimip_tc_hazard_set % to generate the hazard event set
 CALLING SEQUENCE:
   [tc_track,save_file]=isimip_ibtracs_read(csv_filename,delimiter,save_flag,quality_check)
 EXAMPLE:
   tc_track=isimip_ibtracs_read('TEST'); % returns test track (Andrew,1992)
   tc_track=isimip_ibtracs_read('all','',1,1); % all tracks globally, quality checked
   csv_filename=[climada_global.modules_dir filesep 'isimip' ...
       filesep 'data' filesep 'isimip' filesep ...
       'ibtracs_global_intp-None_1992230N11325.csv']; % Andrew, 1992
   tc_track=isimip_ibtracs_read(csv_filename);
   climada_tc_track_info(tc_track,1) % check plot

 INPUTS:
   csv_filename: the filename of an isimip ibtracs tropical cyclone (TC)
       track data .csv file, OR the folder name containing such single
       .csv files (processing all .csv files within)
       &ampgt promted for if not given (for single track)
       ='TEST' to run TEST mode (just one track, Andrew 1992)
        Note that this reads the test file in the isimip module's data folder, i.e
        {climada_global.modules_dir}/isimip/data/ibtracs/ibtracs_basin-NA_intp-None_1992230N11325.csv
       ='EP', 'NA', 'NI', 'SA', 'SI', 'SP', 'WP': read all tracks of one
        basin, assuming the .csv files are named  {climada_global.data_dir}/isimip/ibtracs/ibtracs_basin-{basin}_intp-None_*.csv
        Resulting tc_track saved as ibtracs{basin}.mat in the same folder the ibtracs file were found
        Preferred option: use 'all' and take basin from 
       ='all' to process all tracks globally in {climada_global.data_dir}/isimip/ibtracs. 
        Resulting tc_track saved as ibtracs.mat in the same folder the ibtracs file were found
        Usually processing 6462 single track files, 6323 tracks ok, 139 not ok (less than 3 nodes, skipped)
        1407 tracks more than once, duplicates removed
 OPTIONAL INPUT PARAMETERS:
   delimiter: the delimiter, default is climada_global.csv_delimiter
   save_flag: if =1, save as .mat file, named */ibtracs.mat in the folder
       that has been processed (only if called for a folder). Default=0
   quality_check: =1 (default), run quality check, i.e. reject tracks
       moving too fast (&ampgt10 degrees in one timestep) and fix dateline issue.
       If =0, read data as is.
 OUTPUTS:
   tc_track: a climada TC track structure, see e.g. climada_tc_read_unisys_database
       plus the fields RadiusMaxWind, EnvironmentalPressure,
       data_provider, basin, ID_str. Note that ID_no is ID_str, with the
       number after N or S as decimals, such as 1971275N10176 -&ampgt 1971275.10176
   save_file: the file (with path) where the tc_track structure has been
       saved to if save_flag=1, ='' otherwise
 David N. Bresch, david.bresch@gmail.com, 20161203, intial
 David N. Bresch, david.bresch@gmail.com, 20161222, new field isotime used to properly define yyyy,mm,dd and hh
 David N. Bresch, david.bresch@gmail.com, 20161226, allow for basin name, such as 'NA'
 David N. Bresch, david.bresch@gmail.com, 20170121, allow for all tracks globally (currently basin name not operational), duplicates removed
 David N. Bresch, david.bresch@gmail.com, 20170127, ..data/tc_tracks/ibtracs, data_provider, basin added
 David N. Bresch, david.bresch@gmail.com, 20170715, ibtracc webpage added
View <A HREF=file:../../climada_modules/isimip/code/isimip_ibtracs_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_step_by_step">
<H2>isimip_step_by_step</H2></A>
 isimip_step_by_step
 climada isimip step by step
 MODULE:
   isimip
 NAME:
   isimip_step_by_step
 PURPOSE:
   batch script to run isimip input into climada and core climada
   calculations.

   Mainly demonstrates the use of isimip_tc_track_load and isimip_flood_load

   this batch job reads already existing (intermediate step) .mat files,
   otherwise creates them (faster on subsequent calls).

   needs modules:
   climada         https://github.com/davidnbresch/climada
   country_risk    https://github.com/davidnbresch/climada_module_country_risk
   isimip          https://github.com/davidnbresch/climada_module_isimip

 CALLING SEQUENCE:
   isimip_step_by_step
 EXAMPLE:
   isimip_step_by_step
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   some figures and all data loaded into MATLAB session (accessible from
       comand line, obviously)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160929, initial
 David N. Bresch, david.bresch@gmail.com, 20160929, hazard_dummy_std_file added
 David N. Bresch, david.bresch@gmail.com, 20160930, flood added
 David N. Bresch, david.bresch@gmail.com, 20161009, tested with fraction in EDS_calc
 David N. Bresch, david.bresch@gmail.com, 20161010, IFC added
View <A HREF=file:../../climada_modules/isimip/code/isimip_step_by_step.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_tc_calibrate copy">
<H2>isimip_tc_calibrate copy</H2></A>
function res=isimip_tc_calibrate(entity,params)
 climada isimip tropcial cyclone calibrate
 MODULE:
   isimip
 NAME:
   isimip_tc_calibrate
 PURPOSE:
   calibrate the global model for tropical cyclones based on ibtracs data

   previous call: isimip_gdp_entity
   next call: many...
 CALLING SEQUENCE:
   res=isimip_tc_calibrate(params)
 EXAMPLE:
   params.hazard_file='GLB_0360as_TC_hist';
   entity=isimip_gdp_entity({'PRI','DOM','BRB','CUB'},params);
   entity=climada_entity_load('BRBCUBDOMPRI'); % if repeated
   isimip_tc_calibrate(entity);

   params.hazard_file='GLB_0360as_TC_hist';
   entity=isimip_gdp_entity('ALL_IN_ONE',params);
   entity=climada_entity_load('GLB_0360as_entity'); % full globe
   isimip_tc_calibrate(entity);
 INPUTS:
   entity: an isimip entity, output from isimip_gdp_entity
       in essence a climada entity on isimip NatID grid with additional
       fields for special isimip use and hazard intensity joined.
       if ='params', just return default parameters, in res, i.e. the
           first output, already.
 OPTIONAL INPUT PARAMETERS:
   params: a structure with fields (see also ISO3='params' above):
    damage_data_file: the .csv file with damage data to be joined to.
       Default file is matching_Natcat-damages_ibtracs_1980-2014.csv in
       the isimip data folder. See there for required columns
    price_deflator_file: the .csv file with the price deflator. Needs to
       contain cloumns labeled year and GDP_deflator_base (or GDP_deflator_base2005)
       We inflate damages with a factor 1/deflator
       Default file is GDP_deflator_converted_base2005_1969-2016_source_BEA.csv
       in the isimip data folder.
    inflation_reference_year: the reference year for de/inflation, default=2005
    regions_file: the .csv file with the region definition (groups of
       countries)
    hazard_file: the filename of a climada hazard set (if not part of
       entity, as might be the case if entity from isimip_gdp_entity)
       Does not not need to contain path or .mat extension, since loaded
       using climada_hazard_load
    check_plot; =1; plot checkp plots, =0 not (default)
       if =-1, only plot inflated damages
       if =-2, only plot year view of damages (currently disabled)
       if =-3, only plot scatter plot reported vs simulated
 OUTPUTS:
   res: the output, empty if not successful
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160218, initial
 David N. Bresch, david.bresch@gmail.com, 20160224, all done, NatID
 David N. Bresch, david.bresch@gmail.com, 20160304, store_to_entity, DFC added
View <A HREF=file:../../climada_modules/isimip/code/isimip_tc_calibrate copy.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_tc_calibrate">
<H2>isimip_tc_calibrate</H2></A>
function res=isimip_tc_calibrate(entity,params)
 climada isimip tropcial cyclone calibrate
 MODULE:
   isimip
 NAME:
   isimip_tc_calibrate
 PURPOSE:
   calibrate the global model for tropical cyclones based on ibtracs data

   previous call: isimip_gdp_entity
   next call: many...
 CALLING SEQUENCE:
   res=isimip_tc_calibrate(params)
 EXAMPLE:
   params.hazard_file='GLB_0360as_TC_hist';
   entity=isimip_gdp_entity({'PRI','DOM','BRB','CUB'},params);
   entity=climada_entity_load('BRBCUBDOMPRI_0360as'); % if repeated
   isimip_tc_calibrate(entity);

   params.hazard_file='GLB_0360as_TC_hist';
   entity=isimip_gdp_entity('ALL_IN_ONE',params);
   entity=climada_entity_load('GLB_0360as_entity'); % full globe
   isimip_tc_calibrate(entity);
 INPUTS:
   entity: an isimip entity, output from isimip_gdp_entity
       in essence a climada entity on isimip NatID grid with additional
       fields for special isimip use and hazard intensity joined.
       if ='params', just return default parameters, in res, i.e. the
           first output, already.
 OPTIONAL INPUT PARAMETERS:
   params: a structure with fields (see also ISO3='params' above):
    damage_data_file: the .csv file with damage data to be joined to.
       Default file is matching_Natcat-damages_ibtracs_1980-2014.csv in
       the isimip data folder. See there for required columns
    price_deflator_file: the .csv file with the price deflator. Needs to
       contain cloumns labeled year and GDP_deflator_base (or GDP_deflator_base2005)
       We inflate damages with a factor 1/deflator
       Default file is GDP_deflator_converted_base2005_1969-2016_source_BEA.csv
       in the isimip data folder.
    inflation_reference_year: the reference year for de/inflation, default=2005
    regions_file: the .csv file with the region definition (groups of
       countries)
    hazard_file: the filename of a climada hazard set (if not part of
       entity, as might be the case if entity from isimip_gdp_entity)
       Does not not need to contain path or .mat extension, since loaded
       using climada_hazard_load
    check_plot; =1; plot checkp plots, =0 not (default)
       if =-1, only plot inflated damages
       if =-2, only plot year view of damages (currently disabled)
       if =-3, only plot scatter plot reported vs simulated
 OUTPUTS:
   res: the output, empty if not successful
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160218, initial
 David N. Bresch, david.bresch@gmail.com, 20160224, all done, NatID
 David N. Bresch, david.bresch@gmail.com, 20160304, store_to_entity, DFC added
 David N. Bresch, david.bresch@gmail.com, 20170320, ID_no as integer
View <A HREF=file:../../climada_modules/isimip/code/isimip_tc_calibrate.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_tc_hazard_set">
<H2>isimip_tc_hazard_set</H2></A>
<font color="blue">function hazard = isimip_tc_hazard_set(tc_track,hazard_set_file,centroids,verbose_mode,annotation_str) </font>
 climada TC hazard event set generate
 NAME:
   climada_tr_hazard_set
 PURPOSE:
   generate a tc (tropical cyclone) hazard event set

   COPY of climada_tc_hazard_set, just calling isimip_windfield_holland
   instead of climada_tc_windfield

   If centroids.distance2coast_km exists, the hazard intensity is only
   calculated in the coastal_range_km (usually 200km, see PARAMETERS in
   climada_tc_windfield) - this speeds up calculation for large countries
   considerably.

   Special: the hazard event set is stored every 100 tracks in order to
   allow for interruption of the hazard set generation. Just re-start the
   calculation by calling climada_tr_hazard_set with exactly the sameisimip_tc_hazard_set
   input parameters (the last track calculated is stored in hazard.track_i
   and the field track_i is removed in the final complete hazard event set).
   Therefore, if you get errors such as
       Subscripted assignment dimension mismatch.
       Error in climada_tr_hazard_set (line 270) % ... or nearby
       hazard.intensity(track_i,:)     = res.gust;
   It is VERY likely that you changed something between subsequent calls
   (i.e. different centroids). Just delete the hazard set .mat file and run
   climada_tr_hazard_set again.

   NOTE: this code listens to climada_global.parfor for substantial speedup

   previous: likely climada_random_walk
   next: diverse
 CALLING SEQUENCE:
   res=isimip_tc_hazard_set(tc_track,hazard_set_file,centroids,verbose_mode,annotation_str)
 EXAMPLE:
   tc_track=isimip_ibtracs_read('all'); % isimip's ibtracs
   %tc_track=climada_tc_track_load('TEST_tracks.atl_hist'); % default HURDAT tracks
   centroids=climada_entity_load('USA_UnitedStatesFlorida');
   hazard=isimip_tc_hazard_set(tc_track,'_TC_TEST',centroids);
   climada_global.parfor=1; % switch to parallel mode
   hazard=isimip_tc_hazard_set(tc_track,'_TC_TEST_PARFOR',centroids);
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   tc_track: a TC track structure, or a filename of a saved one
       details: see e.g. climada_tc_random_walk
       &ampgt promted for if not given
   hazard_set_file: the name (and path, optional) of the hazard set file
       If no path provided, default path ../data/hazards is used (and name
       can be without extension .mat). If ='NOSAVE', the hazard set is not
       saved (but returned as output)
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           lon(1,:): the longitudes
           lat(1,:): the latitudes
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a .mat-file which contains a centroids struct (saved by
       climada_centroids_read) or the filename of an Excel file (the original
       input to climada_centroids_read) which holds the centroids, in
       which case climada_centroids_read is called.
       OR: an entity, in which case the entity.assets.lat and
       entity.assets.lon are used as centroids.
       If empty, the code usses the default 0.1 degree isimip resolution
       NOTE: only coastal centroids (centroid_inland_max_dist_km) are used
           in windfield calculations, but the hazard strcuture is defined for
           all centroids as on input. 
   verbose_mode: default=1, =0: do not print anything to stdout
   annotation_str: free annotation string added to hazard
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       intensity(event_i,centroid_i), sparse: the hazard intensity of
           event_i at centroid_i
       frequency(event_i): the frequency of each event
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
       tropical cyclone or 'ET' for extratropical cyclone
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       matrix_density: the density of the sparse array hazard.intensity
       windfield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20160909, starting from climada_tc_hazard_set
 david.bresch@gmail.com, 20161008, hazard.fraction added
 david.bresch@gmail.com, 20161023, noparfor and verbose_mode added
 david.bresch@gmail.com, 20170121, default global centroids added
 david.bresch@gmail.com, 20170121, memory use optimized (intensity), coastal_centroids introduced
 david.bresch@gmail.com, 20170121, annotation_str
 david.bresch@gmail.com, 20170202, noparfor -&ampgt climada_global.parfor
 david.bresch@gmail.com, 20170212, climada_progress2stdout
 david.bresch@gmail.com, 20170224, NatID instead of NatId
 david.bresch@gmail.com, 20170320, hazard.ID_no added
 david.bresch@gmail.com, 20170402, centroids &ampgt60N ignored in windfield calc
View <A HREF=file:../../climada_modules/isimip/code/isimip_tc_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_tc_track_load">
<H2>isimip_tc_track_load</H2></A>
<font color="blue">function [tc_track,tc_track_raw]=isimip_tc_track_load(track_filename,hemisphere,maxlon,check_plot,rmstore_factor) </font>
 climada template
 MODULE:
   module name
 NAME:
   isimip_tc_track_load
 PURPOSE:
   load .mat file with (Kerry Emanuel) tracks and convert to climada
   tc_track strcuture for use in all climada TC functions

   data reference: tobias.geiger@pik-potsdam.de

   next call: climada_tc_hazard_set (or climada_tc_hazard_set_for)
   possibly also: climada_tc_random_walk...
 CALLING SEQUENCE:
   tc_track=isimip_tc_track_load(track_filename,hemisphere,maxlon,check_plot)
 EXAMPLE:
   tc_track=isimip_tc_track_load('temp_mpi20thcal' ,'N',180,1)
   tc_track=isimip_tc_track_load('temp_mpircp85cal','S',180,1)
 INPUTS:
   track_filename: filename of the .mat file with the (Kerry Emanuel)
       tracks, default folder is ../climada_data/isimip/tc_tracks
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   hemisphere: 'N' (default) or 'S', or 'both' (speeds up)
   maxlon: the maximum longitude, either =180 (default) or =360
       For North Atlantic, for example, 180 is much more suitable.
       360 makes mainly sense for Pacific (islands).
       Note that climda prefers to deal with -180..180 whenever possible.
   check_plot: whether show a check plot (=1), or not (=0, default)
       Note that plotting might often take longer than the full
       conversion...
       =-1 for no plot and no messages to stdout (silent)
   rmstore_factor: factor to multiply rmstore from Kerry's file when
       storing into tc_track.RadiusMaxWind. Default=1.0
       Some data files from Kerry reuqire this correction (factor 2), see
       also rmstore_factor_filelist in PARAMETERS section of this code.
       To check, you can compare tc_track_raw.rmstore (uncorrected) with
       tc_track.RadiusMaxWind (correction applied).
 OUTPUTS:
   tc_track: a tc_track structure, with fields
   tc_track_raw: the raw data, inspect the structure
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20160928, initial
 David N. Bresch, david.bresch@gmail.com, 20160929, renamed to isimip_tc_track_load (from isimip_load_tc_tracks)
 David N. Bresch, david.bresch@gmail.com, 20170402, check_plot=-1
 David N. Bresch, david.bresch@gmail.com, 20170704, rmstore_factor added
View <A HREF=file:../../climada_modules/isimip/code/isimip_tc_track_load.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_windfield_TESTS">
<H2>isimip_windfield_TESTS</H2></A>
 isimip climada tests
 MODULE:
   isimip
 NAME:
   isimip_windfield_TESTS
 PURPOSE:
   a batch job which runs several TESTS to compare windfields (and parts thereof)

   One might rather run specifc segments (see code). Each segment
   (starting after a line of =====) is independent of the code above it

   see isimip_windfield_holland and climada_tc_windfield
   next: isimip_tc_hazard_set
 CALLING SEQUENCE:
   isimip_windfield_TESTS
 EXAMPLE:
   isimip_windfield_TESTS
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   plots and stdout
 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161225, initial
 David N. Bresch, david.bresch@gmail.com, 20170202, climada_global.parfor
View <A HREF=file:../../climada_modules/isimip/code/isimip_windfield_TESTS.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="isimip_windfield_holland">
<H2>isimip_windfield_holland</H2></A>
<font color="blue">function [gust,hazard]=isimip_windfield_holland(tc_track,centroids,~,silent_mode,~) </font>
 TC windfield calculation
 MODULE:
   isimip
 NAME:
   isimip_windfield_holland
 PURPOSE:
   given a TC track (lat/lon,CentralPressure,MaxSustainedWind), calculate
   the wind field at locations (=centroids). 

   Using a FAST distance calculation (not haversine), which speeds
   calculations up by factor 2-3. See r_arr and dist in code.

   see isimip_windfield_TESTS to check for haversine/fast difference, for
   the vtrans calculation and for the difference between isimip and
   default climada windfield calculation

   see TEST for testing options (to check for 1-to-1 correspondence with
   python). There are several TEST sections, indicated always with
   TEST_START and ending with TEST_END

   units not double-checked yet, see UNIT_TEST

   See also the original (not fully functional) Matlab version of
   helper_advanced_windfield_global.py, i.e.
   helper_advanced_windfield_global.m

   so far adapted to windfield by holland1980, holland2008, holland2010 cf peduzzi2012
   can be easily expanded to different wind-fields eg chavez2015.
   Greg J. Holland, 1980: An Analytic Model of the Wind and Pressure Profiles in
   Hurricanes. DOI: http://dx.doi.org/10.1175/1520-0493(1980)108&amplt1212:AAMOTW&ampgt2.0.CO;2 

 CALLING SEQUENCE:
   gust = isimip_windfield_holland(tc_track,centroids,~,silent_mode,~)%
 EXAMPLE:
   gust=isimip_windfield_holland; % TEST, does the same as next line
   gust=isimip_windfield_holland(climada_subarray(isimip_ibtracs_read('TEST'),30:33));
   tc_track=isimip_ibtracs_read('TEST');
   tc_track=climada_tc_equal_timestep(tc_track,1); % make equal timestep, 1 hour
   gust=isimip_windfield_holland(tc_track)
   climada_color_plot(gust,centroids.lon,centroids.lat);

   a bit special to plot single event footprint
   tc_track=climada_tc_track_load([climada_global.data_dir filesep 'tc_tracks' filesep 'ibtracs' filesep 'ibtracs.mat']);
   for ii=1:length(tc_track),iii=findstr('2005236N23285',tc_track(ii).ID_str);if iii==1,i=ii;end;end % Katrina
   %for ii=1:length(tc_track),iii=findstr('2013306N07162',tc_track(ii).ID_str);if iii==1,i=ii;end;end % Haiyan
   [gust,hazard] = isimip_windfield_holland(climada_tc_equal_timestep(tc_track(i)),'0360as');
   climada_hazard_plot_nogrid(hazard);title('2005236N23285');
 INPUTS:
   tc_track: a structure with the single track information (length(tc_track)!=1)
       see e.g. climada_tc_read_unisys_tc_track
       tc_track.Azimuth and/or tc_track.Celerity calculated, if not existing
       but climada_tc_equal_timestep mist have been run and
       tc_track.MaxSustainedWind must exist on input
       If empty: TEST mode, use three nodes of Andrew
   centroids: a structure with the centroids information (see e.g.
       climada_centroids_read):
       centroids.lat: the latitude of the centroids
       centroids.lon: the longitude of the centroids
       If empty together with tc_track: TEST mode, use three nodes of Andrew
       If ='0360as' or ='0150as', generate centroids to cover the track
       region (mainly used for nice footprint plots, also over water)
 OPTIONAL INPUT PARAMETERS:
   silent_mode: default=1 (for speedup), do not print or plot
       if =-7, do show output to stdout and print windfield, only makes
       sense for TEST mode, since comparison windfields are read from files
 OUTPUTS:
   gust: the 1-im peak gust windfield [m/s] at all centroids, NOT sparse 
       for speedup, i.e. convert like hazard.intensity()=sparse(gust)
   hazard: the single-event hazard set, if requested (not provied on
       output by default for speedup)
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Tobias Geiger, geiger@pik-potsdam.de, 2016, Copyright, python verison
 David N. Bresch, david.bresch@gmail.com, 20161204, intial
 David N. Bresch, david.bresch@gmail.com, 20161205, traslation added
 David N. Bresch, david.bresch@gmail.com, 20161223, traslation removed for TESTS
 David N. Bresch, david.bresch@gmail.com, 20161224, TEST options finalized
 David N. Bresch, david.bresch@gmail.com, 20161225, final output in m/s
 David N. Bresch, david.bresch@gmail.com, 20170707, centroids='0360as' and hazard as optional  output
View <A HREF=file:../../climada_modules/isimip/code/isimip_windfield_holland.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="job_isimip01">
<H2>job_isimip01</H2></A>
 batch job for cluster: bsub -R &quotrusage[mem=5000]&quot -n 24 matlab -nodisplay -singleCompThread -r job_isimip01
 MODULE:
   isimip
 NAME:
   job_isimip01
 PURPOSE:
   generate isimip tropical cyclone (TC) hazard event sets based on Kerry
   Emmanuel TC track files

   See PARAMETERS before running this

   some hints to work with the cluster (explicit paths, edit this ;-)
   copy job to cluster:    scp -r Documents/_GIT/euler_jobs/job_isimip01b.m dbresch@euler.ethz.ch:/cluster/home/dbresch/euler_jobs/.
   copy job logfiles back: scp -r dbresch@euler.ethz.ch:/cluster/scratch/dbresch/climada_data/hazards/*.mat Documents/_GIT/climada_data/hazards/.
   copy results back:  scp -r dbresch@euler.ethz.ch:
 CALLING SEQUENCE:
   bsub -R &quotrusage[mem=5000]&quot -n 24 matlab -nodisplay -singleCompThread -r job_isimip01
 EXAMPLE:
   bsub -R &quotrusage[mem=5000]&quot -n 24 matlab -nodisplay -singleCompThread -r job_isimip01
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   to scratch disk, see PARAMETERS
 MODIFICATION HISTORY:
 David N. Bresch, dbresch@ethz.ch, 20170403
 David N. Bresch, dbresch@ethz.ch, 20170704, just checked
 David N. Bresch, dbresch@ethz.ch, 20170705, cluster hints added
View <A HREF=file:../../climada_modules/isimip/code/job_isimip01.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="README">
<H2>README</H2></A>
f isempty(which('kml'))
   disp(repmat('_',1,80))
   disp('     _  ____  __ _      _____         _ _             ')
   disp('    | |/ /  \/  | |    |_   _|__  ___| | |__  _____ __')
   disp('    | '' &amplt| |\/| | |__    | |/ _ \/ _ \ | ''_ \/ _ \ \ /')
   disp('    |_|\_\_|  |_|____|   |_|\___/\___/_|_.__/\___/_\_\')
   disp(sprintf('\n'));
   disp('          Thanks for downloading the KML toolbox v1.4!');
   disp(sprintf('\n'));
   disp('For some cool examples on how to use the KML toolbox,');
   disp(sprintf('please check the file RunTests.m located in the folder %s',pwd));
   disp(repmat('_',1,80));
lse
   tmp = getpref('kmltoolbox','ShowDisclaimer',true);
   setpref('kmltoolbox','ShowDisclaimer',true);
   display(kml);
   setpref('kmltoolbox','ShowDisclaimer',tmp);
nd
View <A HREF=file:../../climada_modules/kml_toolbox/code/README.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="kmldoc">
<H2>kmldoc</H2></A>
<font color="blue">function kmldoc(topic) </font>
 no documentation
View <A HREF=file:../../climada_modules/kml_toolbox/code/html/kmldoc.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="RunTestTour">
<H2>RunTestTour</H2></A>

 no documenatation, see code
View <A HREF=file:../../climada_modules/kml_toolbox/code/test/RunTestTour.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="RunTests">
<H2>RunTests</H2></A>
dit climada_centroids_distance_to_coast%% create a KML toolbox object
 = kml('kml toolbox tests'); %create an kmltoolbox object
View <A HREF=file:../../climada_modules/kml_toolbox/code/test/RunTests.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="RunTestsRadians">
<H2>RunTestsRadians</H2></A>

 no documenatation, see code
View <A HREF=file:../../climada_modules/kml_toolbox/code/test/RunTestsRadians.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="bitslice">
<H2>bitslice</H2></A>
<font color="blue">function b = bitslice(a,lowbit,highbit) </font>
BITSLICE(A,LOWBIT,HIGHBIT)
View <A HREF=file:../../climada_modules/kml_toolbox/code/test/bitslice.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="testAnim">
<H2>testAnim</H2></A>

 no documenatation, see code
View <A HREF=file:../../climada_modules/kml_toolbox/code/test/testAnim.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_meteorite_hazard_set">
<H2>climada_meteorite_hazard_set</H2></A>
<font color="blue">function hazard=climada_meteorite_hazard_set </font>
 climada
 NAME:
   climada_meteorite_hazard_set
 PURPOSE:
   generate the meteorite hazard event set

   first, create a centroids file prior to calling this code:
   ...data/system/Meteorite_centroids.xls

   for 1'000'000 events:
       generation of 1000000 events took 0.107830 sec
       latitude/longitude conversion took 0.620342 sec
       diameter conversion took 1.090989 sec
       CalculationUnit interpolation took 13996.156000 sec (almost 4h)
       37272 (100.00%) CalculationUnits hit (by 1390444 events)
       matrix density 0.0037%
       storing as C:\Data\climada\climada_data\hazards\MEXX_B_Probabilistic_1e6.mat ...
       for the Test ptf: loss calculation took 10.275969 seconds, based
       upon 5000000 events @ 279 locations
 CALLING SEQUENCE:
   hazard=climada_meteorite_hazard_set
 EXAMPLE:
   hazard=climada_meteorite_hazard_set
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   hazard: a climada hazard set structure, stored automatically also 
       in ...data/hazards... struct fields are:
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
       tropical cyclone or 'ET' for extratropical cyclone
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one - here all=0
       event_ID: a unique ID for each event
       date: the creation date of the set
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event
       matrix_density: the density of the sparse array hazard.intensity
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
 MODIFICATION HISTORY: 
 David N. Bresch, david.bresch@gmail.com, 20130317, based on work back in 20080801
 David N. Bresch, david.bresch@gmail.com, 20170524, climada_init_vars without reset
View <A HREF=file:../../climada_modules/meteorite/code/climada_meteorite_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="WS_intensity_correction">
<H2>WS_intensity_correction</H2></A>
<font color="blue">function WS_intensity_correction(save_files) </font>
 climada
 NAME:
   WS_intensity_correction
 PURPOSE:
   correct WS intenisty as documented in the paper:

   Schwierz, C., P. K?llner-Heck, E. Zenklusen Mutter, D. N. Bresch,
   P.-L.Vidale, M. Wild, C., and Sch?r, 2010: Modelling European winter
   wind storm losses in current and future climate. Climatic Change (2010)
   101:485?514, doi: 10.1007/s10584-009-9712-1.

   If applied a second time, the correction is reversed

   WARNING: a truly expert level code, to be used with utmost caution

   see also winterstorm_compare and winterstorm_compare_severity
 CALLING SEQUENCE:
   WS_intensity_correction(param1);
 EXAMPLE:
   WS_intensity_correction
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   save_files: whether files are saves(=1) or only inspected (=0, default)
 OUTPUTS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141129
View <A HREF=file:../../climada_modules/storm_europe/code/WS_intensity_correction.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_cosmo2hazard">
<H2>climada_cosmo2hazard</H2></A>
<font color="blue">function hazard=climada_cosmo2hazard(cosmo_filename,params,entity) </font>
 climada cosmo winterstorm europe Switzerland netcdf
 MODULE:
   storm_europe
 NAME:
   climada_cosmo2hazard
 PURPOSE:
   read COSMO windfields from netCDF and store into climada hazard structure, 
   ready for movie generation, if an entity is passed on, too.

   next call: climada_hazard_stats, climada_event_damage_animation
 CALLING SEQUENCE:
   hazard=climada_cosmo2hazard(cosmo_filename,params,entity)
 EXAMPLE:
   climada_cosmo2hazard('TEST')
   p.resolution_km=1;entity=climada_nightlight_entity_load('CHE','',p);
   entity=climada_entity_load('CHE_Switzerland_01x01');
   p.focus_region=[3 13 45 49];
   climada_cosmo2hazard('DEF',p,entity)
   p.asset_markersize=3;p.schematic_tag=1;p.npoints=799;p.Position=[1 5 2560 1340];
   climada_event_damage_animation('',p)

   LATEST
   p.focus_region=[4 13 45 49];p.asset_markersize=4;p.schematic_tag=1;p.axis_equal=0;
   p.npoints=799;p.Position=[1 1 3840 2160];climada_event_damage_animation('',p)

   params=climada_cosmo2hazard('params') % return default parameters
 INPUTS:
   cosmo_filename: filename of the netCDF file with COSMO output
       &ampgt promted for if not given, path and .nc appended if missing
       If ='params', return default params structure
       If ='TEST', run test mode
       If ='DEF', use default file, see PARAMETERS
 OPTIONAL INPUT PARAMETERS:
   params: a structure with fields (see also tc_track='params' above):
    windspeed_threshold: above which wind speeds are kept in hazard set
       Default =20, since no damages below anyway
    damage_threshold: above which damages at single centroids are kept
       Default =1000 Value units, speeds up visualization
    hazard_filename: the filename the hazard structure will be saved to
    animation_data: the filename the anaimation data will be saved to,
       default is animation_data.mat in the climada results folder.
    test_mode: default=0
       &ampgt0: use only a few timesteps
       abs(.)&ampgt1: run movie generation automatically after generating the data
    focus_region: the region we're going to show [minlon maxlon minlat maxlat]
       default=[], automatically determined by area of data lat/lon
    hazard_density: the sparse intensity array density, default=.01
    damage_cumsum: if =1, store cumulative damage over time, default=0
   entity: a climada entity structure, e.g. from entity=climada_entity_load
       is passed, the animation data file is created, i.e. strong the
       assets to hazard in the hazard.assets and the resulting damage in
       hazard.damage. See climada_event_damage_animation
 OUTPUTS:
   hazard: a climada hazard set, if entity passed including the fields
       needed for animation generation, i.e. hazard.damage and hazard.assets
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170228, initial
 David N. Bresch, david.bresch@gmail.com, 20170301, focus region added to hazard
 David N. Bresch, david.bresch@gmail.com, 20170707, climada_global.save_file_version added
View <A HREF=file:../../climada_modules/storm_europe/code/climada_cosmo2hazard.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="schwierz_etal_2010">
<H2>schwierz_etal_2010</H2></A>
<font color="blue">function res=schwierz_etal_2010(return_period) </font>
 climada schwierz 2010
 MODULE:
   storm_europe
 NAME:
   schwierz_etal_2010
 PURPOSE:
   reproduce results of Schwierz et al, 2010. Plot a figure similar to
   Fig. 10 in the paper.

   Schwierz, C., K?llner-Heck, P., Zenklusen, E., Bresch, D. N., Vidale,
   P.L., Wild, M., &amp Sch?r, C., 2010: Modelling European winter windstorm
   losses in current and future climate, Climatic change, Vol. 101,
   485-514. DOI 10.1007/s10584-009-9712-1.
   http://www.iac.ethz.ch/doc/publications/Schwierz.pdf    

 CALLING SEQUENCE:
   res=schwierz_etal_2010(return_period)
 EXAMPLE:
   res=schwierz_etal_2010
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   return_period: the return period (e.g.=100) for which we show results,
       default='AEL'
 OUTPUTS:
   res: the results, empty if not successful
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170505, initial
 David N. Bresch, david.bresch@gmail.com, 20170507, figure as in paper
View <A HREF=file:../../climada_modules/storm_europe/code/schwierz_etal_2010.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="winterstorm_TEST">
<H2>winterstorm_TEST</H2></A>
<font color="blue">function winterstorm_TEST(check_plots) </font>
 climada
 NAME:
   winterstorm_TEST
 PURPOSE:
   TEST European winter storm module
 CALLING SEQUENCE:
   winterstorm_TEST(check_plot);
 EXAMPLE:
   winterstorm_TEST(1);
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   check_plots: if =1, show figures to check hazards etc.
       If =0, skip figures (default)
       If country_name is set to 'ALL', be careful to set check_plots=1
 OUTPUTS:
   to stdout and storing an encoded entity to data/entities
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141029
View <A HREF=file:../../climada_modules/storm_europe/code/winterstorm_TEST.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="winterstorm_blend_hazard_event_sets">
<H2>winterstorm_blend_hazard_event_sets</H2></A>
<font color="blue">function hazard=winterstorm_blend_hazard_event_sets(hazard_save_file,frequency_screw,intensity_screw) </font>
 climada
 MODULE:
   ws_europe
 NAME:
   winterstorm_blend_hazard_event_sets
 PURPOSE:
   Blend the four WS hazard events sets into one, see PARAMETERS in code

   Hazard sets from:
   Schwierz, C., P. Koellner-Heck, E. Zenklusen Mutter, D. N. Bresch,
   P.-L.Vidale, M. Wild, C., and Sch?r, 2010: Modelling European winter
   wind storm losses in current and future climate. Climatic Change (2010)
   101:485?514, doi: 10.1007/s10584-009-9712-1.

   See also winterstorm_compare and winterstorm_compare_severity
 CALLING SEQUENCE:
   hazard=winterstorm_blend_hazard_event_sets(hazard_save_file,frequency_screw)
 EXAMPLE:
   hazard=winterstorm_blend_hazard_event_sets('WS_Europe_blend.mat',0.9)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   hazard_save_file: the filename (w/o path) of the blended output file
       It is always stored in the same folder as the files it is blended
       from, e.g. only a filename, such as 'WS_Europe_blend.mat'.
   frequency_screw: an EXPERIMENTAL multiplier for the frequency, just
       multiplies all single event frequencies. Default=1 (obviously)
       (Can be justified to adjust, due to the fact that we blend hazard
       sets, an adjustment accounts for especially smaller scale events) 
   intensity_screw: scale intensity with, default=1
 OUTPUTS:
   hazard: the blended hazard event set, usually named WS_Europe.mat, see
       optional input parameter hazard_save_file
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141201, initial
 David N. Bresch, david.bresch@gmail.com, 20141206, frequency_screw added
 David N. Bresch, david.bresch@gmail.com, 20141213, intensity_screw added
View <A HREF=file:../../climada_modules/storm_europe/code/winterstorm_blend_hazard_event_sets.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="winterstorm_compare">
<H2>winterstorm_compare</H2></A>
<font color="blue">function EDS=winterstorm_compare(entity,compare_damage_functions,compare_hazard_sets,compare_scenarios) </font>
 climada
 NAME:
   winterstorm_compare
 PURPOSE:
   Run a winterstorm Europe analysis for a given entity with different
   damage functions and different hazard event sets.

   compare_damage_functions: those derived based upon DWD and EuroTempest gust
   data. The code tries to use the matching hazard event set (as as
   created by country_risk_calc). If not found, the code prompts for a WS
   hazard event set and re-encodes assets.

   compare_hazard_sets, hazard sets from:
   Schwierz, C., P. K?llner-Heck, E. Zenklusen Mutter, D. N. Bresch,
   P.-L.Vidale, M. Wild, C., and Sch?r, 2010: Modelling European winter
   wind storm losses in current and future climate. Climatic Change (2010)
   101:485?514, doi: 10.1007/s10584-009-9712-1.

   compare_scenarios: show the modeled scenario loss for the events as
   defined in the data/validation folder in Database_master_table.xls
   WARNING: does not make much sense, since the scenario hazard intensity
   is not calibrated with the hazard intensities in the hazard event sets
   based on Schwierz et al. Code just kept for reference.

   See also winterstorm_validate and winterstorm_compare_severity
   See also climada_DFC_compare in core climada
 CALLING SEQUENCE:
   EDS=winterstorm_compare(entity,compare_damage_functions,compare_hazard_sets,compare_scenarios)
 EXAMPLE:
   EDS=winterstorm_compare('',1,1) % run damage function and hazard set
       comparisons
 INPUTS:
   entity: an encoded entity, see climada_entity_read
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   compare_damage_functions: if =1, compare damage functions (default)
       run 4 times: damage function as in entity, 2 versions with explicit
       function and using the standard WS damage function, see
       damagefunctions_filename in PARAMETERS in code
       =0: omit this
   compare_hazard_sets: if =1, compare hazard sets using the standard
       damage function, see damagefunctions_filename in PARAMETERS in code
       =0: omit this (default)
       =2, use the damage function as in entity, not the standard one
       Note that for each damage calculation, the entity is re-encoded (to
       be on the safe side)
   compare_scenarios: if =1, show modeled scenario losses, using standard
       damage function, see damagefunctions_filename in PARAMETERS in code.
       See PARAMETERS to define the location and name of the
       Database_master_table. WARNING: results do not make much sense,
       since scenario hazard intensities are not calibrated.
       =0: omit (default)
       =2, use the damage function as in entity, not the standard one
       Note that for each damage calculation, the entity is re-encoded (to
       be on the safe side)
       Note further that compare_scenarios only does not make much sense,
       but is permitted, as one might want to overlay scenario results to
       an existing DFC plot.
 OUTPUTS:
   EDS: the event damage set(s), see climada_EDS_calc
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141121, ICE initial
 David N. Bresch, david.bresch@gmail.com, 20141128, compare_hazard_sets, compare_scenarios
 David N. Bresch, david.bresch@gmail.com, 20141201, WARNING for compare_scenarios added
 David N. Bresch, david.bresch@gmail.com, 20141223, LOCAL folders moved
View <A HREF=file:../../climada_modules/storm_europe/code/winterstorm_compare.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="winterstorm_compare_severity">
<H2>winterstorm_compare_severity</H2></A>
<font color="blue">function severity=winterstorm_compare_severity(compare_scenarios,plot_linear) </font>
 climada
 NAME:
   winterstorm_compare_severity
 PURPOSE:
   Compare the hazard severity of different hazard sets

   See also winterstorm_compare
   See also climada_DFC_compare in core climada
 CALLING SEQUENCE:
   severity=winterstorm_compare_severity(compare_scenarios)
 EXAMPLE:
   severity=winterstorm_compare_severity
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   compare_scenarios: if =1, run the severity calculation for single
       scenarios, too, and add them to the severity comparison
       =0: omit (default)
       See HARD CHOICE, TO BE REVISED in code, too
 OUTPUTS:
   severity: the severity information for all
       hazard event sets is stored (inspect yourself)
       For speedup, the routine saves .mat files with each hazard set's
       results in {module_data_dir}/results
   plot_linear: if =1, plot linear (default), otherwise loglog (=0)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141128, initial
 David N. Bresch, david.bresch@gmail.com, 20141223, folders moved
 David N. Bresch, david.bresch@gmail.com, 20170511, winterstorm_severity method added
View <A HREF=file:../../climada_modules/storm_europe/code/winterstorm_compare_severity.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="winterstorm_scenario_hazard">
<H2>winterstorm_scenario_hazard</H2></A>
<font color="blue">function hazard=winterstorm_scenario_hazard(storm_data_filename,plot_gust_field,save_hazard_flag) </font>
 climada
 NAME:
   winterstorm_scenario_hazard
 PURPOSE:
   read the single storm gust table and create a single storm hazard event

   see winterstorm_validate and winterstorm_compare
 CALLING SEQUENCE:
   hazard=winterstorm_scenario_hazard(storm_data_filename,save_hazard_flag)
 EXAMPLE:
   hazard=winterstorm_scenario_hazard(storm_data_filename,save_hazard_flag)
 INPUTS:
   storm_data_filename: the filename of a single storm (.csv). The file
   just contains n lines with grid number, gust. Hence we also read the
   grid table (see )
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   plot_gust_field: if =1, plot the gust field (default=0)
   save_hazard_flag: if =1, save as single hazard event set (default=0)
       on subsequent calls, the hazard is read from this file, rather than
       re-created (hence delete the .mat file to re-create from .csv).
       If =2, force re-creation of the .mat file, i.e. re-read from the
       .csv file and create the scenario hazard set again
 OUTPUTS:
   hazard: a single hazard event set
       if save_hazard_flag=1, stored as climada hazard event set (with
       just one event)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141128, initial
View <A HREF=file:../../climada_modules/storm_europe/code/winterstorm_scenario_hazard.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="winterstorm_severity">
<H2>winterstorm_severity</H2></A>
<font color="blue">function severity=winterstorm_severity(hazard,check_plot,method) </font>
 climada
 NAME:
   winterstorm_severity
 PURPOSE:
   calculate the winterstorm severity, a measure for it's 'strength'

   in essence, calculate sum of v^3 over all centroids of a each event

   see winterstorm_compare_severity (to show severity exceedence curve etc)
 CALLING SEQUENCE:
   severity=winterstorm_severity(hazard,check_plot,method)
 EXAMPLE:
   hazard.severity=winterstorm_severity(hazard)
 INPUTS:
   hazard: either a hazard set (struct) or a hazard set file (.mat with a struct)
       If a file and no path provided, default path ../data/hazards is
       used (and name can be without extension .mat).
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   check_plot: if =1, show check plot of selected centroids
       =0: no plot (default)
   method: what methos to use, either 'SSI' (default) for the full Storm
       Severity Index (SSI) over the whole domain (also over water)
       calculated as sum(hazard.intensity(event_i,:).^3.*coslat)*8e-9
       ='severity' simply sum of v^3 over land for the following
       countries: Belgium, Switzerland, Germany, Denmark, France, United
       Kingdom, Austria, Netherlands, Ireland.
 OUTPUTS:
   severity:
       if method='SSI', just the severity(event_i), a vector
       if method='severity', a structure with
           index= the storm severity index
           frequency: the event frequency
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20141128, initial
 David N. Bresch, david.bresch@gmail.com, 20141212, compatible with new admin0.mat
 David N. Bresch, david.bresch@gmail.com, 20170511, complete overhaul, SSI added
View <A HREF=file:../../climada_modules/storm_europe/code/winterstorm_severity.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="wisc_demo">
<H2>wisc_demo</H2></A>
 wisc_demo
 wisc_demo
 MODULE:
   storm_europe
 NAME:
   wisc_demo
 PURPOSE:
   batch job to run WISC demo (key function called: wisc_hazard_set)

   FIRST, set PARAMETERS in code below, such as the folder with the WISC
   netCDF storm footprints

   see comments in code below. For speedup in subsequent calls, the WISC
   hazard event sets are stored. If run in Ocatve, only damage frequency
   curve (DFC) is shown, as plotting of hazard and entity takes a lot of
   time (Octave is much slower in plotting than MATLAB).

   SPECIAL: if there is a WS hazard set for the specified country, the
   code does also encode to and compare with.
   If you further provide a hazard set as hazard_cmp (being loaded before
   you call wisc_demo), the code does also encode to and compare with.

 CALLING SEQUENCE:
   wisc_demo
 EXAMPLE:
   wisc_demo
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   to stdout and figures stores as .png files
   the WISC hazard sets are stored into the climada hazards folder
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170721, initial
 David N. Bresch, david.bresch@gmail.com, 20170722, Octave version (few plots, for speedup)
 David N. Bresch, david.bresch@gmail.com, 20170722, EM-DAT comparison added
 David N. Bresch, david.bresch@gmail.com, 20170725, storm module comparison added
 David N. Bresch, david.bresch@gmail.com, 20170726, combined view added
 David N. Bresch, david.bresch@gmail.com, 20170730, Octave use improved
 David N. Bresch, david.bresch@gmail.com, 20170731, Octave printing
View <A HREF=file:../../climada_modules/storm_europe/code/wisc_demo.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="wisc_hazard_set">
<H2>wisc_hazard_set</H2></A>
<font color="blue">function [hazard,nc]=wisc_hazard_set(wisc_file,check_plot,hazard_filename) </font>
 climada WS Europe
 MODULE:
   storm_europe
 NAME:
   wisc_hazard_set
 PURPOSE:
   convert WISC storm footprint(s) into climada hazard event set

   In essence, it reads the variables latitude, longitude, time and
   max_wind_gust from the netCDF file. If latitude and longitude are 1D,
   it constructs the 2D grid, otherwise it takes the 2D grid as stored
   already in latitude and longitude. The code assumes all timesteps to be
   on the same grid for all times, as it reads it from the first file.

   The code loops over the files twice, first to infer all timesteps, as
   one netCDF file could contain more than one timestep, then a second
   time over all files and all timesteps therein to extract the wind
   speed.

   NOTE: if climada_global.save_file_version is set to ='-v7' to allow hazard sets to
   be read in Octave, too, hazard.fraction is not saved, but re-processed
   each time the hazard is loaded (saves almost 25% of .mat file size).

   previous call: none
   next call: climada_EDS_calc or e.g. climada_hazard_plot(hazard,0)
   see also: wisc_demo
 CALLING SEQUENCE:
   hazard=wisc_hazard_set(wisc_file)
 EXAMPLE:
   hazard=wisc_hazard_set('test') % also: wisc_demo
   hazard=wisc_hazard_set('{dir}fp_era20c_*.nc')
   hazard=wisc_hazard_set('{dir}fp_eraint_*.nc')
   entity=climada_entity_country('DNK');
   EDS=climada_EDS_calc(entity,hazard);
 INPUTS:
   wisc_file: the filename (with path) to the WISC footprint data
       If wisc_file is a regexp (e.g. ='{dir}fn_*.nc'), the code reads all
       netCDF files according to regexp and stores them in ine hazard
       event set.
       If ='test', a TEST windfield (Anatol, Dec 1999) is used (in this
       special TEST case, the hazard set is stored at the same location as
       the TEST file, i.e. within the module, not in the hazards folder)
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   check_plot: if =1, show check plot(s), =0 not (default, except for TEST
       mode)
   hazard_filename: the name of the hazard set file, with or without path
       (in which case path is the default climada_global.hazards_dir).
       If empty, this is set to t
 OUTPUTS:
   hazard: a climada hazard even set structure, see e.g. climada_tc_hazard_set
       for a detailed description of all fields. Key fields are:
       hazard.lon(c): longitude (decimal) of centroid c
       hazard.lat(c): latitude (decimal) of centroid c
       hazard.intensity(e,c): the wind speed for event e at centroid c
       hazard.units: the physical units of intensity, here m/s
       hazard.event_ID(e): ID of event e (usually 1..hazard.event_count)
       hazard.event_count: the number of events
       hazard.frequency(e): the frequency of event e = 1/hazard.orig_years
       hazard.yyyy(e): the year of event e
       hazard.mm(e): the month of event e
       hazard.dd(e): the day of event e
       hazard.comment: a free comment, contains the regexp passed to this function
       NOTE: for performance reasons, lon and lat are stored as vectors,
        not as 2D grids any more. Therefore, hazard.intensity(e,c) is a 2D
        matrix, but hazard.intensity(e,:) is a vector of all centroids for
        event e and hence can be processed fast in vector-based MATLAB.
       SPECIAL: hazard.lonlat_size allows to convert back to 2D grid, i.e
        lon2d=reshape(hazard.lon,hazard.lonlat_size)
        lat2d=reshape(hazard.lat,hazard.lonlat_size)
        wind=reshape(hazard.intensity(1,c),hazard.lonlat_size)
   nc: the content of the netCDF file (for check, info of the first file)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20170319, initial
 David N. Bresch, david.bresch@gmail.com, 20170705, climada_entity_country
 David N. Bresch, david.bresch@gmail.com, 20170721, checked with latest WISC data and allow for regexp
 David N. Bresch, david.bresch@gmail.com, 20170730, save for Octave compatibility
 David N. Bresch, david.bresch@gmail.com, 20170801, NaN set to zero
View <A HREF=file:../../climada_modules/storm_europe/code/wisc_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="_climada_nonspheric_distance_m">
<H2>_climada_nonspheric_distance_m</H2></A>
<font color="blue">function [fDistance_km GridVect] = climada_nonspheric_distance_m(fLon1,fLat1,fLon2,fLat2,CUID, inreach)       </font>
 This function calculates the distance for each individual gridpoint from
 the TC center. Distance differences in x direction, depending on
 latitude, are normalized in the whole inreach-box with the value at the
 TC-Center

 --------------------------------------------------------------------------
 Modified Haversine Formula to normalize distance differences in y (longitudinal)
 direction at different latitudes
 --------------------------------------------------------------------------
 used in climada_tc_rainfield
 MODIFICATION HISTORY:
 Fabian Schoenenberger, 20110601
View <A HREF=file:../../climada_modules/tropical_cyclone/code/_climada_nonspheric_distance_m.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_EDS_scaleup_factor">
<H2>climada_EDS_scaleup_factor</H2></A>
<font color="blue">function ELS = climada_ELS_scaleup_factor(ELS, factor_) </font>
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_EDS_scaleup_factor.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_RCLIPER">
<H2>climada_RCLIPER</H2></A>
<font color="blue">function [rainrate] = climada_RCLIPER(fmaxwind_kn,inreach,Radius_km)                                   </font>
 calculate rainrate based on RCLIPER in mm/h
 NAME:
   climada_RCLIPER
 PURPOSE:
   given the windspeed (kn) at a specific node calculate the rainrate at 
   all centroids according to RCLIPER (symmetric rainfield)

   usually called from: climada_tr_rainfield (see there)
 CALLING SEQUENCE:
   climada_RCLIPER(fmaxwind_kn, inreach, Radius_km)
 EXAMPLE:
   rainrate=climada_RCLIPER(tc_track.MaxSustainedWind(i),inreach,fRadius_km);      
 INPUTS:
   fmaxwind_kn: maximum sustained wind at specific node (array) 
   inreach:     logical vector of centroids length, containing 1 if centroid
                is within (3, see climada_tr_rainfield) deg of node, otherwise 0 
   Radius_km:   vector of centroids length, containing distance to node
                for every centroid
 OPTIONAL INPUT PARAMETERS:
   none
 OUTPUTS:
   res.G: the rainrate [mm/h] at all centroids
       the single-character variables refer to the Pioneer offering circular
       that's why we kept these short names (so one can copy the OC for
       documentation)
   res.lat: the latitude of the centroids
   res.lon: the longitude of the centroids
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 201106038
 david.bresch@gmail.com, 20140804, GIT update
 david.bresch@gmail.com, 20160529, header edited
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_RCLIPER.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_admin_name">
<H2>climada_admin_name</H2></A>
<font color="blue">function [admin_name, admin_shapes, adm_lvl, shape_ndx, country_name, location] ... </font>
   = climada_admin_name(country_name,admin_name,adm_lvl,climada_global_border_file_check)
 climada_admin_name
 MODULE:
   climada core
 NAME:
   climada_admin_name
 PURPOSE:
   check for valid admin name on different levels (0: country, 1: states, 2: districts) 
   and download admin shape files, return all the arguments incl. shape files
   Same concept as climada_country_name, but for admin regions. The map
   border file in climada_global as used in climada_plot_world_borders
   may be replaced with the shape files for the desired admin level, but
   this may cause problems later
 CALLING SEQUENCE:
   [admin_name, admin_shapes, adm_lvl, shape_ndx, country_name, location] ...
     = climada_admin_name(country_name,admin_name,adm_lvl,climada_global_border_file_check)
 EXAMPLE:
   [admin_name, admin_shapes, adm_lvl, shape_ndx, country_name, location] ...
     = climada_admin_name('Netherlands','Utrecht',2,1)
 INPUTS: 
 OPTIONAL INPUT PARAMETERS:
   country_name:   country of interest,prompted from if not given
   admin_name:     set to 'SINGLE' (default) for single admin region
                   selection at the specified admin level
                   set to 'MULTIPLE' for multi-region select within one
                   admin level, e.g. admin level set to 2 =&ampgt select
                   country, select admin region at level 1, then choose
                   multiple regions at level 2
                   set to 'ALL' to return all admin regions at desired
                   admin level for entire country
   adm_lvl:        define admin level of interest (max admin level varies
                   per country)
   climada_global_border_file_check:   whether to set admin shapes as
                                       default climada global map border file.
 OUTPUTS:
   admin_name:     name of the selected admin region
   admin_shapes:   shapes struct array at admin level
   adm_lvl:        administrative region (0 = country)
   shape_ndx:      shape index of selected admin region in admin shapes
                   structure array
   country_name:   country name
   location:       struct with .lon .lat for centre of selected admin region
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150508 init
 Gilles Stassen, gillesstassen@hotmail.com, 20150615, documentation, hopefully all bugs are gone (they never are...)
 Lea Mueller, muellele@gmail.com, 20150615, climada_global.data dir instead of module_dir
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_admin_name.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_centroids_distance_to_coast">
<H2>climada_centroids_distance_to_coast</H2></A>
<font color="blue">function centroids = climada_centroids_distance_to_coast(centroids,coastline,check_figure) </font>
 calculate distance to coast in km for every centroid and add information
 in the field centroids.dist_to_coast
 NAME:
   climada_centroids_distance_to_coast
 PURPOSE:
   calculate distance to coast in km for every centroid and add information
   in the field centroids.dist_to_coast
   within: climada_hazard_distance_to_coast
 CALLING SEQUENCE:
   centroids = climada_centroids_distance_to_coast(centroids, coastline,
   check_figure)
 EXAMPLE:
   centroids = climada_centroids_distance_to_coast
 INPUTS:
   none, if coastline_file empty default file is loaded from 
 OPTIONAL INPUT PARAMETERS:
   check_figure to create figure
 OUTPUTS:
   centroids structure variable including field centroids.dist_to_coast
   with distance to coast in km
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20121203
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_centroids_distance_to_coast.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_centroids_hazard_expand">
<H2>climada_centroids_hazard_expand</H2></A>
<font color="blue">function [centroids,hazard] = climada_centroids_hazard_expand(centroids_ori, hazard_ori, tc_track) </font>
 UNDOCUMENTED
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_centroids_hazard_expand.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_coastline_read">
<H2>climada_coastline_read</H2></A>
<font color="blue">function coastline = climada_coastline_read(coastline_file, check_plot) </font>
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_coastline_read.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_event_damage_animation_ge">
<H2>climada_event_damage_animation_ge</H2></A>
<font color="blue">function res=climada_event_damage_animation_ge(animation_data_file,google_earth_save,schematic_tag) </font>
 climada_event_damage_animation_ge
 MODULE:
   tc_hazard_advanced
 NAME:
   climada_event_damage_animation_ge
 PURPOSE:
   Animation of event damage in google earth
   This code write the kmz file for google earth, see e.g.
   climada_event_damage_data_tc to calculate all the data. As one often
   needs to play with visualization parameters, the process is split.

   An animation of the tropical cylclone track hitting the assets as
   defined in entity.

   The code determines the plot area based on entity (but since there can be
   more than one ocean basin's tracks hitting the centroids, the user has
   to select the track file).

   prior calls: climada_event_damage_data_tc or similar to prepare the
   event damage information
 CALLING SEQUENCE:
   res=climada_event_damage_animation_ge(animation_data_file,google_earth_save)
 EXAMPLE:
   res=climada_event_damage_animation_ge; % prompt for
 INPUTS:
   animation_data_file: the data file (.mat) with hazard set which
       includes event damage information, see e.g. climada_event_damage_data_tc
       &ampgt promted for if not given
   google_earth_save: the filename of the resulting .kmz google earth file
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   schematic_tag: set to 1 if schematic plot (no colorbar, indicative
   colorscale). if set to 0, e.g. tc wind color scale is yellow
   (20-30 m/s), orange (30-40 m/s), dark orange (40-50 m/s), etc...
 OUTPUTS:
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20150130, initial
 Lea Mueller, muellele@gmail.com, 20150203, schematic tag
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_event_damage_animation_ge.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_clim_scen_IPCC">
<H2>climada_hazard_clim_scen_IPCC</H2></A>
<font color="blue">function hazard = climada_hazard_clim_scen_IPCC(hazard, tc_track, hazard_save_name, reference_year, screw) </font>
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_hazard_clim_scen_IPCC.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_clim_scen_advanced">
<H2>climada_hazard_clim_scen_advanced</H2></A>
<font color="blue">function hazard = climada_hazard_clim_scen_advanced(hazard, tc_track, hazard_save_name, reference_year, screw) </font>
 NAME:
   climada_hazard_clim_scen_advanced
 PURPOSE:
   starting from a given hazard event set (hazard), construct the
   hazard event set (hazard_clim_file) for a climate change scenario, e.g.
   from IPCC SREX
   
   see also core climada code climada_hazard_clim_scen
 CALLING SEQUENCE:
   hazard = climada_tc_hazard_clim_scen(hazard, tc_track, reference_year, screw)
 EXAMPLE:
   hazard = climada_tc_hazard_clim_scen
 INPUTS:
   hazard  :         either a hazard set (struct) or a hazard set file (.mat with a struct)
                     &ampgt promted for if not given
   tc_track:         either a tc track set (struct) or a tc track set file (.mat with a struct)
                     &ampgt promted for if not given (important for storm
                     category)
 OPTIONAL INPUT PARAMETERS:
   reference_year:   the reference year for the give climate change scenario, 
                     e.g. 2017 (+5 years), and then frequency and or intensity 
                     changes are linearly interpolated from the projected time 
                     horizon (e.g. 2100 from IPCC SREX) to the requested
                     reference year.
   screw:            structure of one or multiple frequency or intensity 
                     changes given a certain projected time horizon, default
                     from IPCC SREX taken if not given
                     example:  
                        screw.variable_to_change = 'frequency';
                        screw.frequency          = 0.8;
                        screw.time_horizon       = 2100;
                        screw.cat                = [4 5];
   hazard_save_name: the filename of the new climate scenario hazard event set
                     &ampgt promted for if not given
 OUTPUTS:
   hazard  :        the hazard event set for the climate scenario, also
                     stored to hazard_save_name
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090920
 Lea Mueller, 20120816
 David N. Bresch, david.bresch@gmail.com, 20141103, named climada_hazard_clim_scen_advanced
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_hazard_clim_scen_advanced.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_climate_screw">
<H2>climada_hazard_climate_screw</H2></A>
<font color="blue">function hazard = climada_hazard_climate_screw(hazard, hazard_set_file, reference_year, screw) </font>
 NAME:
 climada_hazard_climate_screw
 PURPOSE:
   Compute the future hazard set for a given climate change scenario from
   a hazard set defining the risk today.
 CALLING SEQUENCE:
   hazard = climada_hazard_climate_screw(hazard, hazard_set_file, reference_year, screw)
 EXAMPLE:
   hazard_cc = climada_hazard_climate_screw(hazard, '', 2040, screw)
   hazard_cc = climada_hazard_climate_screw(hazard, 'NO_SAVE')
   hazard_cc = climada_hazard_climate_screw
 INPUTS:
   hazard:     hazard set today (can be any peril which may be subject to
               climate change)
 OPTIONAL INPUT PARAMETERS:
   hazard_set_file:    file name defining where the new hazard should be
                       saved. If set to 'NO_SAVE', the hazard set will not 
                       be saved. Prompted for if left empty.
   reference_year:     time horizon for which one wishes to compute the
                       climate change hazard set. If left empty, the 
                       reference year in climada_global will be used.
   screw:      defines the climate change scenario. A 1xN structure with
               fields:
                   .hazard_fld     defines the hazard field to be changed
                   .change         extent of the change at time horizon
                   .year           time horizon
                   .hazard_crit    hazard field to which criteria apply
                   .criteria       criteria for events/locations to change
                   .bsxfun_op      operation of change (e.g. @times,@plus) (function handle)
               specifying N transformations to the original hazard set.
 OUTPUTS:
   hazard:     new hazard for a future reference year, given a climate
               change scenario specified by screw.
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150421 based on original
           function climada_hazard_clim_scen_advanced by David N. Bresch &amp Lea Mueller
 Lea Mueller, muellele@gmail.com, 20151021, do not change hazard if it corresponds already to the required year
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_hazard_climate_screw.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_distance_to_coast">
<H2>climada_hazard_distance_to_coast</H2></A>
<font color="blue">function hazard = climada_hazard_distance_to_coast(hazard, centroids, tc_track, check_figure) </font>
 Weakening of hazard, namely maximum sutained wind over land depending on
 distance to coast 
 NAME:
   climada_hazard_distance_to_coast
 PURPOSE:
   Weakening of hazard, namely maximum sutained wind over land depending
   on
   previous step:  climada_tc_hazard_set
   next step    :  climada_ELS_calc, or climada_hazard_clim_scen, diverse
 CALLING SEQUENCE:
   hazard = climada_hazard_distance_to_coast(hazard, centroids, tc_track)
 EXAMPLE:
   hazard = climada_hazard_distance_to_coast
 INPUTS:
   none, if hazard, centroids or tc_track empty prompted for
 OPTIONAL INPUT PARAMETERS:
   check_figure to create figure
 OUTPUTS:
   same hazard structure but hazard.intensity are lower values depending on
   distance to coast
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20121203
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_hazard_distance_to_coast.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_distance_to_coast_USA">
<H2>climada_hazard_distance_to_coast_USA</H2></A>
<font color="blue">function hazard = climada_hazard_distance_to_coast_USA(hazard, centroids, tc_track, check_figure) </font>
 Weakening of hazard, namely maximum sutained wind over land depending on
 distance to coast 
 NAME:
   climada_hazard_distance_to_coast
 PURPOSE:
   Weakening of hazard, namely maximum sutained wind over land depending
   on
   previous step:  climada_tc_hazard_set
   next step    :  climada_ELS_calc, or climada_hazard_clim_scen, diverse
 CALLING SEQUENCE:
   hazard = climada_hazard_distance_to_coast(hazard, centroids, tc_track)
 EXAMPLE:
   hazard = climada_hazard_distance_to_coast
 INPUTS:
   none, if hazard, centroids or tc_track empty prompted for
 OPTIONAL INPUT PARAMETERS:
   check_figure to create figure
 OUTPUTS:
   same hazard structure but hazard.intensity are lower values depending on
   distance to coast
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20121203
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_hazard_distance_to_coast_USA.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_distance_to_coast_australia">
<H2>climada_hazard_distance_to_coast_australia</H2></A>
<font color="blue">function hazard = climada_hazard_distance_to_coast_australia(hazard, centroids, tc_track, check_figure) </font>
 Weakening of hazard, namely maximum sutained wind over land depending on
 distance to coast 
 NAME:
   climada_hazard_distance_to_coast
 PURPOSE:
   Weakening of hazard, namely maximum sutained wind over land depending
   on
   previous step:  climada_tc_hazard_set
   next step    :  climada_ELS_calc, or climada_hazard_clim_scen, diverse
 CALLING SEQUENCE:
   hazard = climada_hazard_distance_to_coast(hazard, centroids, tc_track)
 EXAMPLE:
   hazard = climada_hazard_distance_to_coast
 INPUTS:
   none, if hazard, centroids or tc_track empty prompted for
 OPTIONAL INPUT PARAMETERS:
   check_figure to create figure
 OUTPUTS:
   same hazard structure but hazard.intensity are lower values depending on
   distance to coast
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20121203
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_hazard_distance_to_coast_australia.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_distance_to_coast_china">
<H2>climada_hazard_distance_to_coast_china</H2></A>
<font color="blue">function hazard = climada_hazard_distance_to_coast_china(hazard, centroids, tc_track, check_figure) </font>
 Weakening of hazard, namely maximum sutained wind over land depending on
 distance to coast 
 NAME:
   climada_hazard_distance_to_coast
 PURPOSE:
   Weakening of hazard, namely maximum sutained wind over land depending
   on
   previous step:  climada_tc_hazard_set
   next step    :  climada_ELS_calc, or climada_hazard_clim_scen, diverse
 CALLING SEQUENCE:
   hazard = climada_hazard_distance_to_coast(hazard, centroids, tc_track)
 EXAMPLE:
   hazard = climada_hazard_distance_to_coast
 INPUTS:
   none, if hazard, centroids or tc_track empty prompted for
 OPTIONAL INPUT PARAMETERS:
   check_figure to create figure
 OUTPUTS:
   same hazard structure but hazard.intensity are lower values depending on
   distance to coast
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20121203
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_hazard_distance_to_coast_china.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_distance_to_coast_japan">
<H2>climada_hazard_distance_to_coast_japan</H2></A>
<font color="blue">function hazard = climada_hazard_distance_to_coast_japan(hazard, centroids, tc_track, check_figure) </font>
 Weakening of hazard, namely maximum sutained wind over land depending on
 distance to coast 
 NAME:
   climada_hazard_distance_to_coast
 PURPOSE:
   Weakening of hazard, namely maximum sutained wind over land depending
   on
   previous step:  climada_tc_hazard_set
   next step    :  climada_ELS_calc, or climada_hazard_clim_scen, diverse
 CALLING SEQUENCE:
   hazard = climada_hazard_distance_to_coast(hazard, centroids, tc_track)
 EXAMPLE:
   hazard = climada_hazard_distance_to_coast
 INPUTS:
   none, if hazard, centroids or tc_track empty prompted for
 OPTIONAL INPUT PARAMETERS:
   check_figure to create figure
 OUTPUTS:
   same hazard structure but hazard.intensity are lower values depending on
   distance to coast
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20121203
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_hazard_distance_to_coast_japan.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_extract_event">
<H2>climada_hazard_extract_event</H2></A>
<font color="blue">function event = climada_hazard_extract_event(hazard,event_i) </font>
 climada
 MODULE:
 NAME:
   climada_hazard_extract_event
 PURPOSE:
   easily extract one event from a hazard set for faster testing/debugging/developing
 CALLING SEQUENCE:
   event = climada_hazard_extract_event(hazard,event_i)
 EXAMPLE:
   event = climada_hazard_extract_event
   event = climada_hazard_extract_event(hazard,153)
 INPUTS:
   hazard:     standard climada hazard event set struct
   event_i:    event number of interest, can be a vector containing
               multiple event numbers
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   event:  struct of the same format as a hazard event set, but only
           containing the events specified by the event numbers in event_i
 MODIFICATION HISTORY:
 Gilles Stassen, gillesstassen@hotmail.com, 20150428
 Gilles Stassen, 20150706, multiple events, negative input for nth largest event
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_hazard_extract_event.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_footprint_plot">
<H2>climada_hazard_footprint_plot</H2></A>
<font color="blue">function climada_hazard_footprint_plot(hazard, event_no, nametag) </font>
 TC footprint figure
 NAME:
   climada_plot_tc_footprint
 PURPOSE:
 create footprint figure
 CALLING SEQUENCE:
   [contr t_handle] = climada_plot_tc_footprint(hazard, tc_track, track_no)
 EXAMPLE:
   climada_plot_tc_footprint
 INPUTS:
   hazard: hazard.intensity with intensities per centroid
   event_no: a number, event number of hazard to be shown
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   figure with footprint
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20121205
 Lea Mueller, muellele@gmail.com, 20150423
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_hazard_footprint_plot.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_hazard_merge">
<H2>climada_hazard_merge</H2></A>
<font color="blue">function hazard = climada_hazard_merge(hazard1, hazard2) </font>
 hazard1 = hazard_wkn;
 hazard2 = hazard_ext;
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_hazard_merge.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_loss_hist">
<H2>climada_plot_loss_hist</H2></A>
<font color="blue">function climada_plot_loss_hist(event_loss) </font>
 EDS loss damage histogram
 NAME:
   climada_plot_loss_hist
 PURPOSE:
 	plot a histogram of event losses
 CALLING SEQUENCE:
   [contr t_handle] = climada_plot_windfield(hazard, tc_track, track_no)
 EXAMPLE:
   climada_plot_windfield
 INPUTS:
   hazard: hazard.intensity with wind intensities per centroid
   tc_track: a structure with the track information:
   track_no: number of track to show footprint
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   figure with footprint
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, david.bresch@gmail.com, 20121205
 Lea Mueller, david.bresch@gmail.com, 20141121, fixed (was a mess)
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_plot_loss_hist.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_lossfootprint">
<H2>climada_plot_lossfootprint</H2></A>
<font color="blue">function climada_plot_lossfootprint(event_loss, centroids, tc_track, nametag) </font>
 TC footprint figure
 NAME:
   climada_plot_windfield
 PURPOSE:
 create footprint figure
 CALLING SEQUENCE:
   [contr t_handle] = climada_plot_windfield(hazard, tc_track, track_no)
 EXAMPLE:
   climada_plot_windfield
 INPUTS:
   hazard: hazard.intensity with wind intensities per centroid
   tc_track: a structure with the track information:
   track_no: number of track to show footprint
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   figure with footprint
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, david.bresch@gmail.com, 20121205
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_plot_lossfootprint.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_probabilistic_wind_speed_decay">
<H2>climada_plot_probabilistic_wind_speed_decay</H2></A>
<font color="blue">function track_req = climada_plot_probabilistic_wind_speed_decay(tc_track, track_req, single) </font>
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_plot_probabilistic_wind_speed_decay.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_plot_probabilistic_wind_speed_map_gui">
<H2>climada_plot_probabilistic_wind_speed_map_gui</H2></A>
<font color="blue">function [track_req,h,g] = climada_plot_probabilistic_wind_speed_map_gui(tc_track, track_req) </font>
 plot historical tc track (Longitude, Latitude) in world map according to
 saffir-simpson hurrican scale. Add plot of probabilistic generated sister
 storms. Historical tracks has black lines around markers to identify as
 original track.
 NAME:
   climada_plot_probabilistic_wind_speed_map
 PURPOSE:
   analyse visuallly historical tc track and its generated probabilistic
   sister storms. Check Longitude, Latitude and wind speed category
   (saffir-simpson hurricane scale) 
 CALLING SEQUENCE:
   climada_plot_probabilistic_wind_speed_map(tc_track)
 EXAMPLE:
   climada_plot_probabilistic_wind_speed_map
 INPUTS:
   tc_track: probabilistic tc track set (random walk of wind speed, 
   longitude and latitude), wind speed in knots, nodes every six hours, if
   not given, prompted for
 OPTIONAL INPUT PARAMETERS:
   track_req:  number of specific historical track to be displayed with
   its probabilistic sister storms, prompts for input 
   p:          to print figure
   x:          to exit
   41:         or any other track number. will be rounded to the nearest 
               historical track.
   enter:      to continue.
 OUTPUTS:
   figure, printout of figure if requested
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20110628
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_plot_probabilistic_wind_speed_map_gui.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_scale_to_MSP_to_market">
<H2>climada_scale_to_MSP_to_market</H2></A>
<font color="blue">function [entity,ELS] = climada_scale_to_MSP_to_market(entity, ELS, MSP_AEL, market_TIV) </font>
 UNDOCUMENTED

View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_scale_to_MSP_to_market.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_global_impact">
<H2>climada_tc_global_impact</H2></A>
<font color="blue">function parameters=climada_tc_global_impact(parameters,test_mode) </font>
 climada template
 MODULE:
   tropical_cyclone
 NAME:
   climada_tc_global_impact
 PURPOSE:
   show global impact of tropical cyclones, save animation

   for speedup, consder to set climada_global.parfor=1

   previous call: climada_tc_read_unisys_database or climada_tc_track_combine
   next call: diverse
 CALLING SEQUENCE:
   parameters=climada_tc_global_impact(parameters,test_mode)
 EXAMPLE:
   parameters=climada_tc_global_impact([],-1) % obtain all default values
   climada_tc_global_impact('',1) % test and return defaults
   p.entity_file=[climada_global.entities_dir filesep 'USA_UnitedStates_Florida_entity.mat'];
   p.basin='atl_hist';climada_tc_global_impact(p);
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   parameters: a structure to pass on parameters, with fields as
       (run parameters=climada_tc_global_impact([],-1) to obtain
       all default values)
       basin: the basin name, such as 'atl_hist' or 'wpa_prob', default='atl_hist'
           if ='all', climada_tc_track_combine is invoked to combine all
           tracks of all basins (starting with common first year)
       boundary_rect: the boundary to plot [minlon maxlon minlat maxlat]
           default is whole globe
       markersize: the size of the 'tiles', one might need to experiment a
           bit, as the code tries (hard) to set a reasonabls default (based on
           resolution)
       d_lola: (default=1) degrees around min/max lat/lon of assets
       assets_cmap: assets coloring (used for solid colored assets)
           Test with close all;plotclr(0:10,0:10,0:10,'s',20,0,0,10*1.05,assets_cmap,1,0);
       damage_cmap: damage coloring (used for solid colored assets)
           Test with close all;plotclr(0:10,0:10,0:10,'s',20,0,0,10*1.05,damage_cmap,1,0);
       check_plot: if =1, show on screen, =0 only save to animation file (default)
           Do NOT set check_plot=1 except for debugging, it slows down
           substantially
           Set check_plot=3 to stop after plotting assets to check whether
           e.g. markersize is fine.
           If check_plot is negative, the routine stops after processing
           abs(check_plot) tracks.
       STOP_after_n_tracks: stop after processing the images for n tracks,
           (not already after looping over n tracks). Default =NaN
       start_year: first year to deal with, default=-9999 to start with first
           year tracks are available
       default_min_TimeStep: the timestep in hours between nodes 
           (defaul =24 for speed, but =6 would be nicer)
       verbose: =1 verbose mode, =0 not (default)
           In any case, progress is written to stdout (time elapsed, est.)
   test_mode: if =-1, return all default parameters, =1 real test mode
       default =0
 OUTPUTS:
   plots and animation
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161023
 David N. Bresch, david.bresch@gmail.com, 20161024, substantial speedup
 David N. Bresch, david.bresch@gmail.com, 20161024, switched to parameters
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tc_global_impact.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_hazard_set_slow">
<H2>climada_tc_hazard_set_slow</H2></A>
<font color="blue">function hazard = climada_tc_hazard_set_slow(tc_track,hazard_set_file,centroids) </font>
 climada TC hazard event set generate
 NAME:
   climada_tc_hazard_set
 PURPOSE:
   SLOW, only kept for backward compatibility, see climada_tc_hazard_set

   generate a tc (tropical cyclone) hazard event set

   If centroids.distance2coast_km exists, the hazard intensity is only
   calculated in the coastal_range_km (usually 200km, see PARAMETERS in
   climada_tc_windfield) - this speeds up calculation for large countries
   considerably.

   Special: the hazard event set is stored every 100 tracks in order to
   allow for interruption of the hazard set generation. Just re-start the
   calculation by calling climada_tc_hazard_set with exactly the same
   input parameters (the last track calculated is stored in hazard.track_i
   and the field track_i is removed in the final complete hazard event set).  
   Therefore, if you get errors such as 
       Subscripted assignment dimension mismatch.
       Error in climada_tc_hazard_set (line 270) % ... or nearby
       hazard.intensity(track_i,:)     = res.gust;
   It is VERY likely that you changed something between subsequent calls
   (i.e. different centroids). Just delete the hazard set .mat file and run
   climada_tc_hazard_set again.

   previous: likely climada_random_walk
   next: diverse
 CALLING SEQUENCE:
   res=climada_tc_hazard_set_slow(tc_track,hazard_set_file,centroids)
 EXAMPLE:
   res=climada_tc_hazard_set_slow(tc_track)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   tc_track: a TC track structure, or a filename of a saved one
       details: see e.g. climada_tc_random_walk
       &ampgt promted for if not given
   hazard_set_file: the name (and path, optional) of the hazard set file
       If no path provided, default path ../data/hazards is used (and name
       can be without extension .mat). If ='NOSAVE', the hazard set is not
       saved (but returned as output)
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           lon(1,:): the longitudes
           lat(1,:): the latitudes
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a .mat-file which contains a centroids struct (saved by
       climada_centroids_read) or the filename of an Excel file (the original
       input to climada_centroids_read) which holds the centroids, in
       which case climada_centroids_read is called.
       OR: an entity, in which case the entity.assets.lat and
       entity.assets.lon are used as centroids.
       &ampgt promted for .mat or .xls filename if not given
       NOTE: if you then select Cancel, a regular default grid is used, see hard-wired definition in code
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
       tropical cyclone or 'ET' for extratropical cyclone
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event
       matrix_density: the density of the sparse array hazard.intensity
       windfield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090729
 David N. Bresch, david.bresch@gmail.com, 20130506, centroids filename handling improved
 David N. Bresch, david.bresch@gmail.com, 20140421, waitbar with secs
 David N. Bresch, david.bresch@gmail.com, 20141226, optional fields in centroids added
 David N. Bresch, david.bresch@gmail.com, 20150103, equal_timestep (much) improved
 Lea Mueller, muelleleh@gmail.com, 20150420, include tc category into hazard structure
 David N. Bresch, david.bresch@gmail.com, 20150804, allow for filename without path for hazard set name on input
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir
 David N. Bresch, david.bresch@gmail.com, 20150824, removed 'TCNA' from hazard.comment
 David N. Bresch, david.bresch@gmail.com, 20150906, note on a frequent issue added to header
 David N. Bresch, david.bresch@gmail.com, 20151008, NOSAVE option added
 Lea Mueller, muelleleh@gmail.com, 20151127, add hazard.scenario, default is 'no climate change'
 David N. Bresch, david.bresch@gmail.com, 20160514, -v7.3 in save added
 David N. Bresch, david.bresch@gmail.com, 20160529, renamed to climada_tc_hazard_set_slow
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tc_hazard_set_slow.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_on_land">
<H2>climada_tc_on_land</H2></A>
<font color="blue">function tc_track = climada_tc_on_land(tc_track, border_mask) </font>
 Add on land variable to tc track structure for every tc track (former
 climada_tc_track_on_land)
 NAME:
   climada_tc_on_land
 PURPOSE:
   add on land variable (1 on land, 0 over sea) for every tc track in tc 
   track strucuture based on world map (raster file)
   within:  climada_tc_track_wind_decay
 CALLING SEQUENCE:
   tc_track = climada_tc_on_land(tc_track, border_mask);
 EXAMPLE:
   tc_track = climada_tc_on_land;
 INPUTS:
   none, if tc_track empty prompted for
 OPTIONAL INPUT PARAMETERS:
   tc_track: a structure with the track information including
   tc_track.onLand (1 for on land, 0 for over sea)
 OUTPUTS:
   same structure now including tc track variable for every tc track
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20121203
 David N. Bresch, david.bresch@gmail.com, 20140716, minor edit to catch date-line issue
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tc_on_land.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_track_combine">
<H2>climada_tc_track_combine</H2></A>
<font color="blue">function [tc_track,info]=climada_tc_track_combine(tc_track1,tc_track2,start_year) </font>
 climada template
 MODULE:
   tropical_cyclone
 NAME:
   climada_tc_track_combine
 PURPOSE:
   combine two tc_track structures, i.e merge them , such that the
   temporal sequence is correct

   previous call: climada_tc_read_unisys_database and climada_tc_track_load
   next call: any tc code, such as climada_tc_track_info
 CALLING SEQUENCE:
   tc_track=climada_tc_track_combine(tc_track1,tc_track2)
 EXAMPLE:
   tc_track1=climada_tc_track_load('atl_hist');
   tc_track2=climada_tc_track_load('wpa_hist');
   tc_track=climada_tc_track_combine(tc_track1,tc_track2,-1);
   info=climada_tc_track_info(tc_track,1) % check plot
   tc_track2=climada_tc_track_load('epa_hist');
   tc_track=climada_tc_track_combine(tc_track ,tc_track2,-1);
   tc_track2=climada_tc_track_load('nio_hist');
   tc_track=climada_tc_track_combine(tc_track ,tc_track2,-1);
   tc_track2=climada_tc_track_load('she_hist');
   tc_track=climada_tc_track_combine(tc_track ,tc_track2,-1);
 INPUTS:
   tc_track1: a TC track strcuture, as returned from e.g. climada_tc_read_unisys_database
   tc_track2: a second TC track strcuture
 OPTIONAL INPUT PARAMETERS:
   start_year: a starting year, thus tracks prior to this year are ignored
       default: empty. using all years
       if =-1, take earliest year where both sets have tracks
 OUTPUTS:
   tc_track: the combined tc_track structure
   info: the (internal) info as used to compile the combined set, see code
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20161023, initial
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tc_track_combine.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_track_google_earth">
<H2>climada_tc_track_google_earth</H2></A>
<font color="blue">function climada_tc_track_google_earth(tc_track, google_earth_save) </font>
 climada_tc_track_google_earth
 MODULE:
   tc_hazard_advanced
 NAME:
   climada_tc_track_google_earth
 PURPOSE:
   visualisation of historical tracks with time stamp in google
   create kml-file of all historical tc tracks 
   lines with colors according to saffir-simpson scale
 CALLING SEQUENCE:
   climada_tc_track_google_earth(tc_track, google_earth_save)
 EXAMPLE:
   climada_tc_track_google_earth
 INPUTS:
   tc_track: track set, historical or probabilistic, but only historical
   tracks are visualized. prompted for, if not given.
 OPTIONAL INPUT PARAMETERS:
   google_earth_save:  file to be saved in
                       \climada\data\tc_tracks\tc_track....kml
 OUTPUTS:
   kmz-file, visualisation of historical tracks with time stamp in google
   earth
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20110724
 Lea Mueller, muellele@gmail.com, 20150123, changed nodetime_mat to datenum
 Lea Mueller, muellele@gmail.com, 20150130, new kml toolbox
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tc_track_google_earth.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_track_wind_decay">
<H2>climada_tc_track_wind_decay</H2></A>
<font color="blue">function tc_track = climada_tc_track_wind_decay(tc_track, p_rel, check_plot) </font>
 Incorporate wind decay after landfall for probabilistic tracks, based on
 historical tc tracks
 NAME:
   climada_tc_track_wind_decay
 PURPOSE:
   incorporate wind decay after landfall of probabilistic tracks. The
   decay can be calculated based on historical tracks or can be loaded
   from a mat file (p_rel)
   within:  climada_tc_random_walk_position_windspeed
 CALLING SEQUENCE:
   tc_track = climada_tc_track_wind_decay(tc_track, p_rel, check_plot)
 EXAMPLE:
   tc_track = climada_tc_track_wind_decay(tc_track)
 INPUTS:
   none, if tc_track empty prompted for
 OPTIONAL INPUT PARAMETERS:
   p_rel: parameters for exponential decay, y = exp(B) * exp(x*A), where 
          A = p_rel(1,1), B = p_rel(1,2), can be newly calculated or can
          be loaded from data within globalGDP modul
   check_plot: to create plot
 OUTPUTS:
   same structure now MaxSustainedWind in tc track decays after landfall
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20121203
 David N. Bresch, david.bresch@gmail.com, 20150106, climada_tc_equal_timestep
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tc_track_wind_decay.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_track_wind_decay_calculate">
<H2>climada_tc_track_wind_decay_calculate</H2></A>
<font color="blue">function [tc_track p_rel] = climada_tc_track_wind_decay_calculate(tc_track, check_plot) </font>
 Calculate wind decay after landfall based on historical tc tracks
 NAME:
   climada_tc_track_wind_decay_calculate
 PURPOSE:
   Calculate wind decay after landfall based on historical tc tracks
   within:  climada_tc_random_walk_position_windspeed
 CALLING SEQUENCE:
   [tc_track p_rel] = climada_tc_track_wind_decay_calculate(tc_track, check_plot)
 EXAMPLE:
   [tc_track p_rel] = climada_tc_track_wind_decay_calculate(tc_track)
 INPUTS:
   none, if tc_track empty prompted for
 OPTIONAL INPUT PARAMETERS:
   check_plot: to create plot
 OUTPUTS:
   p_rel contains the parameters for exponential decay for tropical
   depression, tropical storm and hurricanes category 1 to 5
   wind decay = exp(B) * exp(x*A), where A = p_rel(1,1), B = p_rel(1,2)
   wind decay = 1      * exp(x*A), where A = p_rel(1,1), B = p_rel(1,2)
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20121203
 David N. Bresch, david.bresch@gmail.com, 20150106, climada_tc_equal_timestep
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tc_track_wind_decay_calculate.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_track_windfield_google_earth">
<H2>climada_tc_track_windfield_google_earth</H2></A>
<font color="blue">function climada_tc_track_windfield_google_earth(tc_track,centroids,aggregation,google_earth_save) </font>
 climada_tc_track_windfield_google_earth
 MODULE:
   tc_hazard_advanced
 NAME:
   climada_tc_track_windfield_google_earth
 PURPOSE:
   create kmz-file of wind field animation in google earth
 CALLING SEQUENCE:
   climada_tc_track_windfield_google_earth(tc_track, centroids, aggregation, google_earth_save)
 EXAMPLE:
   climada_tc_track_windfield_google_earth
 INPUTS:
   tc_track: track set, historical or probabilistic, but only historical
   tracks are visualized. prompted for, if not given.
   centroids
 OPTIONAL INPUT PARAMETERS:
   aggregation:        aggregation time, default is 6h
   google_earth_save:  filename, to be saved in
                       \climada\data\tc_tracks\tc_track....kml
 OUTPUTS:
   kmz-file, visualisation of historical track and winfield with time stamp in google
   earth
 RESTRICTIONS:
   none
 MODIFICATION HISTORY:
 Lea Mueller, muellele@gmail.com, 20110724
 Lea Mueller, muellele@gmail.com, 20150123, changed nodetime_mat to datenum
 Lea Mueller, muellele@gmail.com, 20150130, new kml toolbox
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tc_track_windfield_google_earth.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_wind_decay">
<H2>climada_tc_wind_decay</H2></A>
<font color="blue">function tc_track = climada_tc_wind_decay(tc_track) </font>
 UNDOCUMENTED
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tc_wind_decay.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tc_windfield_slow">
<H2>climada_tc_windfield_slow</H2></A>
<font color="blue">function res=climada_tc_windfield_slow(tc_track,centroids,equal_timestep,silent_mode,check_plot) </font>
 TC windfield calculation
 NAME:
   climada_tc_windfield_slow
 PURPOSE:
   SLOW version, see climada_tc_windfield

   given a TC track (lat/lon,CentralPressure,MaxSustainedWind), calculate
   the wind field at locations (=centroids)

   If centroids.distance2coast_km exists, the hazard intensity is only
   calculated in the coastal_range_km (usually 300km, see PARAMETERS) -
   this speeds up calculation for large countries considerably. To switch
   this feature off, just centroids=rmfield(centroids,'distance2coast_km')
   prior to passing centroids to climada_tc_windfield_slow

   mainly called from: see climada_tc_hazard_set
 CALLING SEQUENCE:
   climada_tc_windfield_slow(tc_track,centroids,equal_timestep,silent_mode)
 EXAMPLE:
   climada_tc_windfield_slow
   plot windfield:
   climada_tc_windfield_slow(tc_track(1411), centroids,1,1,1)
 INPUTS:
   tc_track: a structure with the track information:
       tc_track.lat
       tc_track.lon
       tc_track.MaxSustainedWind: maximum sustained wind speed (one-minute)
       tc_track.MaxSustainedWindUnit as 'kn', 'mph', 'm/s' or 'km/h'
       tc_track.CentralPressure: optional
       tc_track.Celerity: translational (forward speed) of the hurricane.
           optional, calculated from lat/lon if missing
       tc_track.TimeStep: optional, only needed if Celerity needs to be
           calculated, 6h assumed as default
       tc_track.Azimuth: the forward moving angle, calculated if not given
           to ensure consistency, it is even suggested not to pass Azimuth
       tc_track.yyyy: 4-digit year, optional
       tc_track.mm: month, optional
       tc_track.dd: day, optional
       tc_track.ID_no: unique ID, optional
       tc_track.name: name, optional
       tc_track.SaffSimp: Saffir-Simpson intensity, optional
   centroids: a structure with the centroids information
       centroids.lat: the latitude of the centroids
       centroids.lon: the longitude of the centroids
       If centroids.distance2coast_km exists, the hazard intensity is only
       calculated in the coastal_range_km (usually 300km, see PARAMETERS) -
       this speeds up calculation for large countries considerably. To switch
       this feature off, just centroids=rmfield(centroids,'distance2coast_km')
       prior to passing centroids to climada_tc_windfield_slow.
       Some other fields of centroids are also appended to res struct
 OPTIONAL INPUT PARAMETERS:
   equal_timestep: if set=1 (default), first interpolate the track to a common
       timestep, if set=0, no equalization of TC track data (not recommended)
       BUT: for speedup, run climada_tc_equal_timestep for ALL tracks
       prior to calling climada_tc_windfield_slow (see e.g. climada_tc_hazard_set)
       and then set equal_timestep=0 in calling climada_tc_windfield_slow
   silent_mode: if =1, do not write to stdout unless severe warning
       If silent_mode=-1, use step-by-step detailed windfield, i.e. reduce
       wind to zero at center of the eye (not recommended for
       probabilistic, since hit/miss issue with closest node, see variable
       max_wind_at_bullseye in code).
   check_plot: disabled, see code, commented out for speedup
 OUTPUTS:
   res: the output strcuture, with fields
       gust(i): the windfield [m/s] at all centroids i
       lat(i): the latitude of the centroids i
       lon(i): the longitude of the centroids i
       Some other fields of centroids are also appended to res struct
 RESTRICTIONS:
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20090728
 David N. Bresch, david.bresch@gmail.com, 20141227, centroids.distance2coast_km treatment added
 David N. Bresch, david.bresch@gmail.com, 20150124, wind_threshold=15 (was 0), coastal_range_km=375 (was 300)
 David N. Bresch, david.bresch@gmail.com, 20150315, back to real Holland for single timestep
 David N. Bresch, david.bresch@gmail.com, 20150319, eye 'filled' for probabilistic windfields
 David N. Bresch, david.bresch@gmail.com, 20150515, optional plot debugged (usually commented out, starting line 333)
 David N. Bresch, david.bresch@gmail.com, 20150807, climada_global.tc.extratropical_transition
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tc_windfield_slow.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tr_hazard_set">
<H2>climada_tr_hazard_set</H2></A>
<font color="blue">function hazard  = climada_tr_hazard_set(tc_track,hazard_set_file,centroids) </font>
 generate hazard rain set from tc_tracks
 NAME:
   climada_tr_hazard_set
 PURPOSE:
   generate tropical cyclone hazard rain set
   previous: likely climada_random_walk

   See climada_tr_hazard_set_slow for backward compatibility.

   next: diverse, e.g. climada_EDS_calc
 CALLING SEQUENCE:
   hazard = climada_tr_hazard_set(tc_track,hazard_set_file)
 EXAMPLE:
   tc_track=climada_tc_track_load('TEST_tracks.atl_hist');
   centroids=climada_centroids_load('USFL_MiamiDadeBrowardPalmBeach');
   hazard=climada_tr_hazard_set(tc_track,'_TR_TEST_PARFOR',centroids);
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   tc_track: a TC track structure, or a filename of a saved one
       details: see e.g. climada_random_walk
       &ampgt promted for if not given
   hazard_set_file: the name of the hazard set file
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           lon(1,:): the longitudes
           lat(1,:): the latitudes
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a file which contains the struct (saved after climada_centroids_read)
       or an entity with entity.assets, centroids are then inferred from
       if you select Cancel, a regular default grid is used, see hard-wired definition in code
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
       tropical cyclone or 'ET' for extratropical cyclone
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event
       matrix_density: the density of the sparse array hazard.intensity
       windfield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
 MODIFICATION HISTORY:
 Lea Mueller, 20110722
 david.bresch@gmail.com, 20140804, GIT update
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 David N. Bresch, david.bresch@gmail.com, 20160529, parfor, much faster (factor 3-10)
 david.bresch@gmail.com, 20170524, climada_progress2stdout
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tr_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tr_hazard_set_slow">
<H2>climada_tr_hazard_set_slow</H2></A>
<font color="blue">function hazard  = climada_tr_hazard_set_slow(tc_track, hazard_set_file, centroids) </font>
 generate hazard rain set from tc_tracks
 NAME:
   climada_tr_hazard_set_slow
 PURPOSE:
   see climada_tr_hazard_set, this is the SLOW version, kep for backward
   compatibility only

   generate tropical cyclone hazard rain set
   previous: likely climada_random_walk
   next: diverse
 CALLING SEQUENCE:
   hazard = climada_tr_hazard_set_slow(tc_track,hazard_set_file)
 EXAMPLE:
   hazard = climada_tr_hazard_set_slow(tc_track)
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
   tc_track: a TC track structure, or a filename of a saved one
       details: see e.g. climada_random_walk
       &ampgt promted for if not given
   hazard_set_file: the name of the hazard set file
       &ampgt promted for if not given
   centroids: the variable grid centroids (see climada_centroids_read)
       a structure with
           Longitude(1,:): the longitudes
           Latitude(1,:): the latitudes
           centroid_ID(1,:): a unique ID for each centroid, simplest: 1:length(Longitude)
       or a file which contains the struct (saved after climada_centroids_read)
       if you select Cancel, a regular default grid is used, see hard-wired definition in code
 OUTPUTS:
   hazard: a struct, the hazard event set, more for tests, since the
       hazard set is stored as hazard_set_file, see code
       lon(centroid_i): the longitude of each centroid
       lat(centroid_i): the latitude of each centroid
       centroid_ID(centroid_i): a unique ID for each centroid
       peril_ID: just an ID identifying the peril, e.g. 'TC' for
       tropical cyclone or 'ET' for extratropical cyclone
       comment: a free comment, normally containing the time the hazard
           event set has been generated
       orig_years: the original years the set is based upon
       orig_event_count: the original events
       event_count: the total number of events in the set, including all
           probabilistic ones, hence event_count&ampgt=orig_event_count
       orig_event_flag(event_i): a flag for each event, whether it's an original
           (1) or probabilistic (0) one
       event_ID: a unique ID for each event
       date: the creation date of the set
       arr(event_i,centroid_i),sparse: the hazard intensity of event_i at
           centroid_i
       frequency(event_i): the frequency of each event
       matrix_density: the density of the sparse array hazard.intensity
       windfield_comment: a free comment, not in all hazard event sets
       filename: the filename of the hazard event set (if passed as a
           struct, this is often useful)
 MODIFICATION HISTORY:
 Lea Mueller, 20110722
 david.bresch@gmail.com, 20140804, GIT update
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 David N. Bresch, david.bresch@gmail.com, 20160529, renamed to climada_tr_hazard_set_slow
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tr_hazard_set_slow.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tr_rainfield">
<H2>climada_tr_rainfield</H2></A>
<font color="blue">function rainsum=climada_tr_rainfield(tc_track,centroids,~,~,~,~) </font>
 TC rainfield calculation (rainsum)
 NAME:
   climada_tr_rainfield
 PURPOSE:
   given a single TC track (lat/lon,CentralPressure,MaxSustainedWind), calculate
   the rain sum field at locations (=centroids)

   Note: this code is optimized for speed, hence assumes that tc_track is
   free of missing data, climada_tc_equal_timestep applied and
   MaxSustainedWind calculated.

   there is still the old SLOW version climada_tr_rainfield_slow, not
   recommended, just kep for backward compatibility

   mainly called from: see climada_tr_hazard_set
 CALLING SEQUENCE:
   rainsum=climada_tr_rainfield(tc_track,centroids,~,~,~,~)
 EXAMPLE:
   tc_track=climada_tc_track_load('TEST_tracks.atl_hist');
   tc_track=climada_tc_equal_timestep(tc_track);
   centroids=climada_centroids_load('USFL_MiamiDadeBrowardPalmBeach');
   rainsum=climada_tr_rainfield(tc_track(68),centroids);
   climada_color_plot(rainsum,centroids.lon,centroids.lat);
 INPUTS:
   tc_track: a structure with the single track information (length(tc_track)!=1)
       see e.g. climada_tc_read_unisys_tc_track
       tc_track.Azimuth and/or tc_track.Celerity calculated, if not existing
       but climada_tc_equal_timestep mist have been run and
       tc_track.MaxSustainedWind must exist on input
   centroids: a structure with the centroids information (see e.g.
       climada_centroids_read):
       centroids.lat: the latitude of the centroids
       centroids.lon: the longitude of the centroids
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   rainsum(i): the rain fall sum [mm over full lieftime of the event] 
       at all centroids(i)

   One could also return res (switched off for speedup, 
   search for res. in code to swithc this on):
   (res.rainsum: the rain fall sum [mm per storm] at all centroids
       the single-character variables refer to the Pioneer offering circular
       that's why we kept these short names (so one can copy the OC for
       documentation)
   (res.lat: the latitude of the centroids (=centroids.lat)
   (res.lon: the longitude of the centroids (=centroids.lon)
   (res.rainrate: COULD be returned, but most cases not needed, see code)
   (res.time: time in sec, coiuld be returned, see TIMING in code)
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20110606
 Martin Heyenn 20120503
 david.bresch@gmail.com, 20140804, GIT update
 david.bresch@gmail.com, 20141020, cleanup, inreach speedup
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 David N. Bresch, david.bresch@gmail.com, 20160529, major speedup, five times faster
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tr_rainfield.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tr_rainfield_slow">
<H2>climada_tr_rainfield_slow</H2></A>
<font color="blue">function rainsum=climada_tr_rainfield_slow(tc_track,centroids,equal_timestep,silent_mode,check_plot,unit_) </font>
 TC rainfield calculation (rainsum)
 NAME:
   climada_tr_rainfield_slow
 PURPOSE:
   see climada_tr_rainfield for a much FASTER version (same result), 
   kept for backward compatipibility only

   given a single TC track (lat/lon,CentralPressure,MaxSustainedWind), calculate
   the rain sum field at locations (=centroids)
   mainly called from: see climada_tr_hazard_set

 CALLING SEQUENCE:
   [res,tc_track_ori,centroids]=climada_tr_rainfield_slow(tc_track,centroids,equal_timestep,silent_mode,check_plot,unit_)
 EXAMPLE:
   tc_track=climada_tc_track_load('TEST_tracks.atl_hist');
   centroids=climada_centroids_load('USFL_MiamiDadeBrowardPalmBeach');
   rainsum=climada_tr_rainfield_slow(tc_track(68),centroids);
   climada_color_plot(rainsum,centroids.lon,centroids.lat);
 INPUTS:
   tc_track: a structure with the information for a single (1) tc track:
       tc_track.lat
       tc_track.lon
       tc_track.MaxSustainedWind: maximum sustained wind speed (one-minute)
       tc_track.MaxSustainedWindUnit as 'kn', 'mph', 'm/s' or 'km/h'
       tc_track.CentralPressure: optional
       tc_track.Celerity: translational (forward speed) of the hurricane.
           optional, calculated from lat/lon if missing
       tc_track.TimeStep: optional, only needed if Celerity needs to be
           calculated, 6h assumed as default
       tc_track.Azimuth: the forward moving angle, calculated if not given
           to ensure consistency, it is even suggested not to pass Azimuth
       tc_track.yyyy: 4-digit year, optional
       tc_track.mm: month, optional
       tc_track.dd: day, optional
       tc_track.ID_no: unique ID, optional
       tc_track.name: name, optional
       tc_track.SaffSimp: Saffir-Simpson intensity, optional
       NOTE: if empty, the user can also select a file with tc_track and will then
       get promted for a single track number to use (mainly useful for TESTs)
   centroids: a structure with the centroids information
       centroids.lat: the latitude of the centroids
       centroids.lon: the longitude of the centroids
 OPTIONAL INPUT PARAMETERS:
   unit_: rainfall unit, either unit_='mm' (millimeters, default) or for inches unit_='in'
   equal_timestep: if set=1 (default), first interpolate the track to a common
       timestep, if set=0, no equalization of TC track data (not recommended)
   silent_mode: if =1, do not write to stdout unless severe warning
   check_plot: whether some plots are created =1 (default=0, silent_mode=1
       sets check_plot also =0)
 OUTPUTS:
   rainsum(i): the rain fall sum [mm over full lieftime of the event] 
       at all centroids(i)

   One could also return res (switched off for speedup, 
   search for res. in code to swithc this on):
   (res.rainsum: the rain fall sum [mm per storm] at all centroids
       the single-character variables refer to the Pioneer offering circular
       that's why we kept these short names (so one can copy the OC for
       documentation)
   (res.lat: the latitude of the centroids (=centroids.lat)
   (res.lon: the longitude of the centroids (=centroids.lon)
   (res.rainrate: COULD be returned, but most cases not needed, see code)
   (res.time: time in sec, coiuld be returned, see TIMING in code)
 RESTRICTIONS:
 MODIFICATION HISTORY:
 Lea Mueller, 20110606
 Martin Heyenn 20120503
 david.bresch@gmail.com, 20140804, GIT update
 david.bresch@gmail.com, 20141020, cleanup, inreach speedup
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 David N. Bresch, david.bresch@gmail.com, 20160529, renamed to climada_tr_rainfield_slow
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tr_rainfield_slow.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tr_rainrate_field_animation">
<H2>climada_tr_rainrate_field_animation</H2></A>
<font color="blue">function climada_tr_rainrate_field_animation(tc_track, centroids,... </font>
                                            aggregation,check_avi)                        
 plot animation of rainrate field for a specific historical or
 probabilistic storm
 NAME:
   climada_tc_rainrate_field_animation
 PURPOSE:
   plot animation of rainrate field for a specific historical or
   probabilistic storm, plot is produced every aggregation time step
   (minimum 1 hour or more)
 CALLING SEQUENCE:
   climada_tr_rainrate_field_animation(tc_track       ,...
                                  centroids      ,...
                                  aggregation    ,...
                                  check_printplot)
 EXAMPLE:
   climada_tc_rainrate_field_animation(tc_track_prob(1226), centroids, 1, 6)
 INPUTS:
	tc_track:           just one tc_track, tc_track_prob(1)
   centroids:          centroid mat file
 OPTIONAL INPUT PARAMETERS:
   aggregation:        desired timestep for plots (minimum one plot per
   hour, can be one plot for 6 hours or more)
   check_avi:         if set to 1 will save animation as avi-file
 OUTPUTS:
   plot of rainrate field (footprint) for every aggreagation step
   (minimum 1 hour) for one specific storm track
 MODIFICATION HISTORY:
 Lea Mueller, 20110603
 david.bresch@gmail.com, 20140804, GIT update
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tr_rainrate_field_animation.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_tr_rainsum_field_animation">
<H2>climada_tr_rainsum_field_animation</H2></A>
<font color="blue">function climada_tr_rainsum_field_animation(tc_track, centroids,... </font>
                                           aggregation,check_avi)                                        
 plot animation of rainrate field for a specific historical or
 probabilistic storm
 NAME:
   climada_tc_rainrate_field_animation
 PURPOSE:
   plot animation of rainrate field for a specific historical or
   probabilistic storm, plot is produced every aggregation time step
   (minimum 1 hour or more)
 CALLING SEQUENCE:
   climada_tr_rainrate_field_animation(tc_track       ,...
                                  centroids      ,...
                                  aggregation    ,...
                                  check_printplot)
 EXAMPLE:
   climada_tr_rainrate_field_animation(tc_track_prob(1226), centroids, 1, 6)
 INPUTS:
	tc_track:           just one tc_track, tc_track_prob(1)
   centroids:          centroid mat file
 OPTIONAL INPUT PARAMETERS:
   aggregation:        desired timestep for plots (minimum one plot per
   hour, can be one plot for 6 hours or more)
   check_avi:         if set to 1 will save animation as avi-file
 OUTPUTS:
   plot of rainrate field (footprint) for every aggreagation step
   (minimum 1 hour) for one specific storm track
 MODIFICATION HISTORY:
 Lea Mueller, 20110603
 david.bresch@gmail.com, 20140804, GIT update
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_tr_rainsum_field_animation.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_track_map">
<H2>climada_track_map</H2></A>
<font color="blue">function varargout = climada_track_map(varargin) </font>
 CLIMADA_TRACK_MAP M-file for climada_track_map.fig
      CLIMADA_TRACK_MAP, by itself, creates a new CLIMADA_TRACK_MAP or raises the existing
      singleton*.

      H = CLIMADA_TRACK_MAP returns the handle to a new CLIMADA_TRACK_MAP or the handle to
      the existing singleton*.

      CLIMADA_TRACK_MAP('CALLBACK',hObject,eventData,handles,...) calls the local
      function named CALLBACK in CLIMADA_TRACK_MAP.M with the given input arguments.

      CLIMADA_TRACK_MAP('Property','Value',...) creates a new CLIMADA_TRACK_MAP or raises the
      existing singleton*.  Starting from the left, property value pairs are
      applied to the GUI before climada_track_map_OpeningFcn gets called.  An
      unrecognized property name or invalid value makes property application
      stop.  All inputs are passed to climada_track_map_OpeningFcn via varargin.

      *See GUI Options on GUIDE's Tools menu.  Choose &quotGUI allows only one
      instance to run (singleton)&quot.

 See also: GUIDE, GUIDATA, GUIHANDLES

 Edit the above text to modify the response to help climada_track_map

 Last Modified by GUIDE v2.5 08-Feb-2013 18:15:03
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_track_map.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="climada_ts_hazard_set">
<H2>climada_ts_hazard_set</H2></A>
<font color="blue">function hazard=climada_ts_hazard_set(hazard,hazard_set_file,elevation_data,check_plots) </font>
 climada storm surge TS hazard event set
 NAME:
   climada_ts_hazard_set
 PURPOSE:
   create a storm surge (TS) hazard event, based on an existing
   tropical cyclone (TC) hazard event set

   two steps:
   1) check wether we need to obtain bathymetry (high res, calls etopo_get
   from module etopo) or elevation is provided (see elevation_data)
   2) convert all TC footprints into TS footprints
   see CORE_CONVERSION in code below for the conversion formula

   Note on bathymetry data: see https://github.com/davidnbresch/climada_module_elevation_models 

   see tc_surge_TEST for a testbed for this code

 CALLING SEQUENCE:
   hazard=climada_ts_hazard_set(hazard,hazard_set_file,elevation_data,check_plot)
 EXAMPLE:
   hazard_TC=climada_hazard_load('TCNA_today_small')
   hazard_TS=climada_ts_hazard_set(hazard_TC,'TCNA_today_small_TS')
 INPUTS:
   hazard: an already existing tropical cyclone (TC) hazard event set (a
       TC hazard structure)
       &ampgt prompted for if not given (for .mat file containing a TC hazard event set)
       Note: if hazard.elevation_m exists on input, this elevation
       information is used, hence elevation_data is ignored
       The variable hazard is modified on output (saves a lot of memory).
   hazard_set_file: the name of the newly created storm surge (TS) hazard
       event set (if ='NO_SAVE', the hazard is just returned, not saved)
       &ampgt promted for if not given
 OPTIONAL INPUT PARAMETERS:
   elevation_data: if a scalar, take elevation (or bathymetry) from etopo
       (needs module etopo). If =1, save bathymetry in a .mat file (speeds up
       subsequent calls), if =0 do not save bathymetry (default)
       If elevation_data is a structure with the fields lon(i), lat(i),
       elevation_m(i) and centroid_ID(i), check for centroid IDs being the
       same as in hazard.centroid_ID and then just 'attach' the elevation
       to hazard (i.e. hazard.elevation_m=elevation_data.elevation_m)
       Note: if hazard.elevation_m exists on input, this elevation
       information is used.
   check_plots: =1, do show check plots (only if BATI used), =0: no plots (default)
 OUTPUTS:
   hazard: a hazard event set, see core climada doc
       also written to a .mat file (see hazard_set_file)
       NOTE: for memory allocation reasons, the input hazard is used and
       modified to create the output hazard
 MODIFICATION HISTORY:
 david.bresch@gmail.com, 20140421
 david.bresch@gmail.com, 20141017, module path relative
 david.bresch@gmail.com, 20141026, save_bathymetry_flag
 david.bresch@gmail.com, 20150106, elevation_data
 david.bresch@gmail.com, 20160516, elevation_data single precision allowed (as eg from SRTM)
 david.bresch@gmail.com, 20160525, better error messaging for ETOPO issues
 david.bresch@gmail.com, 20160529, renamed to climada_ts_hazard_set and tc_surge_hazard_create deleted
 david.bresch@gmail.com, 20161009, strcmpi used
 david.bresch@gmail.com, 20170523, &ampgt in save fprintf to identify latest version
View <A HREF=file:../../climada_modules/tropical_cyclone/code/climada_ts_hazard_set.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="figures_for_hazard_advanced_manual">
<H2>figures_for_hazard_advanced_manual</H2></A>
View <A HREF=file:../../climada_modules/tropical_cyclone/code/figures_for_hazard_advanced_manual.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="haversine">
<H2>haversine</H2></A>
<font color="blue">function [km nmi mi] = haversine(loc1, loc2) </font>
 HAVERSINE     Compute distance between locations using Haversine formula
   KM = HAVERSINE(LOC1, LOC2) returns the distance KM in km between
   locations LOC1 and LOC2 using the Haversine formula.  LOC1 and LOC2 are
   latitude and longitude coordinates that can be expressed as either
   strings representing degrees, minutes, and seconds (suffixed with
   N/S/E/W), or numeric arrays representing decimal degrees (where
   negative indicates West/South).

   [KM, NMI, MI] = HAVERSINE(LOC1, LOC2) returns the computed distance in
   kilometers (KM), nautical miles (NMI), and miles (MI).

   Examples
       haversine('53 08 50N, 001 50 58W', '52 12 16N, 000 08 26E') returns
           170.2547
       haversine([53.1472 -1.8494], '52 12.16N, 000 08.26E') returns
           170.2508
       haversine([53.1472 -1.8494], [52.2044 0.1406]) returns 170.2563

   Inputs
       LOC must be either a string specifying the location in degrees,
       minutes and seconds, or a 2-valued numeric array specifying the
       location in decimal degrees.  If providing a string, the latitude
       and longitude must be separated by a comma.

   Notes
       The Haversine formula is used to calculate the great-circle
       distance between two points, which is the shortest distance over
       the earth's surface.

       This program was created using equations found on the website
       http://www.movable-type.co.uk/scripts/latlong.html
 Created by Josiah Renfree
 May 27, 2010
View <A HREF=file:../../climada_modules/tropical_cyclone/code/haversine.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="tc_surge_TEST">
<H2>tc_surge_TEST</H2></A>
function [hazard_TS,hazard_TC]=tc_surge_TEST
 climada
 NAME:
   tc_surge_TEST
 PURPOSE:
   TEST the tropical cyclone (TC) storm surge (TS) hazard creation
   1) get centroids for the test country (eg Bangladesh, see PARAMETERS)
      if they do not exist, try to run GDP_entity in order to create them
   2) create TC wind hazard event set
   call climada_ts_hazard_set in order to
      3) create bathymetry file for region
      4) create TC surge hazard event set
   show the result

   In essence, you define the country and the code checks the generation
   of centroids, TC and TS hazard event sets

   in essence a caller for code climada_ts_hazard_set

   see tc_surge_plot_3d for 3D plots of surge fields
 CALLING SEQUENCE:
   [hazard_TS,hazard_TC]=tc_surge_TEST % if run as a function
 EXAMPLE:
   tc_surge_TEST
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   writes a couple files, such as entity, assets, bathymetry and a
       hazard event set
   hazard_ts: the storm surge hazard event set
   hazard_tc: the storm wind speed hazard event set
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20140420
 David N. Bresch, david.bresch@gmail.com, 20141017 module independent of location
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
 David N. Bresch, david.bresch@gmail.com, 20170522, climada_hazard_plot
View <A HREF=file:../../climada_modules/tropical_cyclone/code/tc_surge_TEST.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="tc_surge_TEST_Netherlands">
<H2>tc_surge_TEST_Netherlands</H2></A>
<font color="blue">function hazard=tc_surge_TEST_Netherlands </font>
 climada
 NAME:
   tc_surge_TEST
 PURPOSE:
   See tc_surge_TEST for the real TEST environment

   A kind of silly test, just to see whether it all works with just one or
   just ten tracks...

   TEST the tropical cyclone (TC) storm surge (TS) raw hazard creation
   1) get centroids for the test country (eg Bangladesh, see PARAMETERS)
      if they do not exist, try to run GDP_entity in order to create them
   2) create TC wind hazard event set
   call climada_ts_hazard_set in order to
      3) create bathymetry file for region
      4) create TC surge hazard event set
   show the result

   In essence, you define the country and the code checks the generation
   of centroids, TC and TS hazard event sets

   in essence a caller for code climada_ts_hazard_set
 CALLING SEQUENCE:
   tc_surge_TEST(force_recalc_ts)
 EXAMPLE:
   tc_surge_TEST
 INPUTS:
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   writes a couple files, such as entity, assets, bathymetry and a
       hazard event set
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20140421
 David N. Bresch, david.bresch@gmail.com, 20150819, climada_global.centroids_dir introduced
View <A HREF=file:../../climada_modules/tropical_cyclone/code/tc_surge_TEST_Netherlands.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>


<A NAME="tc_surge_plot_3d">
<H2>tc_surge_plot_3d</H2></A>
<font color="blue">function tc_surge_plot_3d(hazard,event_i) </font>
 climada
 NAME:
   tc_surge_plot3d
 PURPOSE:
   plot surge hazard as 3D surface, 'overshadowing' terrain
 CALLING SEQUENCE:
   tc_surge_plot3d(hazard,event_i);
 EXAMPLE:
   climada_hazard_plot(climada_hazard_load);
 INPUTS:
   hazard: hazard structure
       consider to use climada_hazard_load, as in the example
   event_i: the i-th event in the hazard event set to be displayed
       if event_i=0, the maximum intensity at each centroid is shown
       if event_i=-i, the i-th 'largest' event (sum of intensities) is shown
           e.g. for event_i=-2, the second largest event is shown
       default=-1 (just to get something on the screen ;-)
 OPTIONAL INPUT PARAMETERS:
 OUTPUTS:
   figure
 MODIFICATION HISTORY:
 David N. Bresch, david.bresch@gmail.com, 20140503
View <A HREF=file:../../climada_modules/tropical_cyclone/code/tc_surge_plot_3d.m>source</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
